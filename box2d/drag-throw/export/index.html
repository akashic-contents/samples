<!doctype html>
<!-- Generated by akashic-cli-export-html@0.7.85. -->
<!-- Options: {"strip":true,"minify":true,"bundle":true,"magnify":true} -->
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>game</title>
<script>

	!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).engineFilesV2_1_47=t()}(function(){return function r(o,n,s){function a(e,t){if(!n[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);throw(i=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",i}i=n[e]={exports:{}},o[e][0].call(i.exports,function(t){return a(o[e][1][t]||t)},i,i.exports,r,o,n,s)}return n[e].exports}for(var h="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,i){e.exports=t("./lib/main.node")},{"./lib/main.node":2}],2:[function(t,Rt,e){(function(){"use strict";var r,o,i,s,n,a,u,h,c,l,d,e,p,f,_,g,y,m,v,T,A,x,w,S,E,b,P,k,R,L,M,C,O,F,I,D,G,H,U,W,N,B,j,V,t,q,X,z,Y,K=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function J(){}function $(t){this._value=t}function Z(t,e,i,r){this.game=t,this.configuration=this._normalize(e||{},function(t){t=t||{};var e,i={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(e in i)e in t||(t[e]=i[e]);return t}(i)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=r||{},this._refCounts={},this._loadings={}}function Q(t,e){this._game=t,this._asset=e,this._module=new a.Module(t,e.path,e.path),this._g=this._module._g,this._started=!1}function tt(t,e,i,r,o,n,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=n&&null!=s?this.updateWithAnchor(t,e,i,r,o,0,0,n,s):this.update(t,e,i,r,o,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}function et(t,e){this.interval=t,this._scaledInterval=Math.round(t*e),this.elapsed=new d.Trigger,this._scaledElapsed=0}function it(t){this.played=new e.Trigger,this.stopped=new e.Trigger,this.currentAudio=void 0,this.volume=t.volume,this._muted=t._muted,this._playbackRate=t._playbackRate,this._system=t}function rt(t){this._loop=!!t,this.played=new p.Trigger,this.stopped=new p.Trigger,this.currentVideo=void 0,this.volume=1}function ot(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity="opacity"in t?t.opacity:1,this.scaleX="scaleX"in t?t.scaleX:1,this.scaleY="scaleY"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0),this._matrix=void 0}function nt(t){var e=g.call(this,t)||this;if(e.children=void 0,e.parent=void 0,e._touchable=!1,e.state=0,e._hasTouchableChildren=!1,e._update=void 0,e._message=void 0,e._pointDown=void 0,e._pointMove=void 0,e._pointUp=void 0,e._targetCameras=void 0,e.tag=t.tag,e.shaderProgram=t.shaderProgram,e.local=t.scene.local!==_.LocalTickMode.NonLocal||!!t.local,t.children)for(var i=0;i<t.children.length;++i)e.append(t.children[i]);return t.parent&&t.parent.append(e),t.targetCameras&&(e.targetCameras=t.targetCameras),"touchable"in t&&(e.touchable=t.touchable),t.hidden&&e.hide(),e.id=t.id,t.scene.register(e),e}function st(t){t=y.call(this,t)||this;return t._shouldRenderChildren=!0,t._cache=void 0,t._renderer=void 0,t._renderedCamera=void 0,t}function at(t){var e=this;return t.local=!0,(e=v.call(this,t)||this).targetReset=new m.Trigger,e.targetReady=new m.Trigger,e.targetAssetLoaded=new m.Trigger,e._explicitEnd=!!t.explicitEnd,e._targetScene=void 0,e}function ht(t){t=A.call(this,t)||this;return t._canceller=new T.Object2D,t}function ct(t){var e=w.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}function ut(t){var e=E.call(this,t)||this;return e.surface=S.Util.asSurface(t.src),"width"in t||(e.width=e.surface.width),"height"in t||(e.height=e.surface.height),e.srcWidth="srcWidth"in t?t.srcWidth:e.width,e.srcHeight="srcHeight"in t?t.srcHeight:e.height,e.srcX=t.srcX||0,e.srcY=t.srcY||0,e._stretchMatrix=void 0,e._beforeSurface=e.surface,S.Util.setupAnimatingHandler(e,e.surface),e._invalidateSelf(),e}function lt(t){var e=P.call(this,t)||this;return e._lastUsedIndex=0,e.frameNumber=t.frameNumber||0,e.frames="frames"in t?t.frames:[0],e.interval=t.interval,e._timer=void 0,e.loop=null==t.loop||t.loop,e.finished=new b.Trigger,e._modifiedSelf(),e}function dt(t,e,i,r,o){t=this._normalizeConfiguration(t),this.fps=t.fps,this.width=t.width,this.height=t.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=i||"",this.resourceFactory=e,this.selfId=r||void 0,this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this._audioSystemManager=new k.AudioSystemManager(this),this.audio={music:new k.MusicAudioSystem("music",this),sound:new k.SoundAudioSystem("sound",this)},this.defaultAudioSystemId="sound",this.storage=new k.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new k.Trigger,this.leave=new k.Trigger,this.seed=new k.Trigger,this._eventTriggerMap={},this._eventTriggerMap[k.EventType.Join]=this.join,this._eventTriggerMap[k.EventType.Leave]=this.leave,this._eventTriggerMap[k.EventType.Seed]=this.seed,this._eventTriggerMap[k.EventType.Message]=void 0,this._eventTriggerMap[k.EventType.PointDown]=void 0,this._eventTriggerMap[k.EventType.PointMove]=void 0,this._eventTriggerMap[k.EventType.PointUp]=void 0,this._eventTriggerMap[k.EventType.Operation]=void 0,this.resized=new k.Trigger,this.skippingChanged=new k.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new k.Trigger,this._started=new k.Trigger,this.isLoaded=!1,this.snapshotRequest=new k.Trigger,this.external={},this.logger=new k.Logger(this),this._main=t.main,this._mainParameter=void 0,this._configuration=t,this._assetManager=new k.AssetManager(this,t.assets,t.audio,t.moduleMainScripts);t=t.operationPlugins||[];this._operationPluginManager=new k.OperationPluginManager(this,o,t),this._operationPluginOperated=new k.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new k.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new k.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}function pt(t){var e=R.call(this,t)||this;return e.game=t.game,e.local=!!t.local,e.name=t.name,e._modifiedCount=0,e.width=t.game.width,e.height=t.game.height,e.id=e.local?void 0:e.game._cameraIdx++,e}function ft(){}function _t(t,e,i,r){if(void 0===r&&(r=!1),t%1!=0||e%1!=0)throw L.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");this.width=t,this.height=e,i&&(this._drawable=i),this.isDynamic=r,this.isDynamic?(this.animatingStarted=new L.Trigger,this.animatingStopped=new L.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}function gt(t){var e=C.call(this,t)||this;return e.text=t.text,e.font=t.font,e.textAlign="textAlign"in t?t.textAlign:M.TextAlign.Left,e.glyphs=new Array(t.text.length),e.fontSize=t.fontSize,e.maxWidth=t.maxWidth,e.widthAutoAdjust=!("widthAutoAdjust"in t)||t.widthAutoAdjust,e.textColor=t.textColor,e._textWidth=0,e._game=void 0,e._overhangLeft=0,e._overhangRight=0,e._invalidateSelf(),e}function yt(t,e,i,r,o,n,s,a,h,c){void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=o,this.offsetX=n,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}function mt(t){var e=F.call(this,t)||this;if("string"!=typeof t.cssColor)throw O.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",t.cssColor);return e.cssColor=t.cssColor,e}function vt(t){var e=D.call(this,t)||this;return e._oldWidth=t.width,e._oldHeight=t.height,e.backgroundImage=I.Util.asSurface(t.backgroundImage),e.backgroundEffector=t.backgroundEffector,e._shouldRenderChildren=!1,e._padding=t.padding,e._initialize(),e._paddingChanged=!1,e._bgSurface=void 0,e._bgRenderer=void 0,e}function Tt(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}function At(t,e,i){this.operated=new G.Trigger,this.plugins={},this._game=t,this._viewInfo=e,this._infos=i,this._initialized=!1}function xt(){}function wt(t){var e=N.call(this)||this;return e.surface=W.Util.asSurface(t.src),e.map=t.map,e.defaultGlyphWidth=t.defaultGlyphWidth,e.defaultGlyphHeight=t.defaultGlyphHeight,e.missingGlyph=t.missingGlyph,e.size=t.defaultGlyphHeight,e}function St(t){this._game=t,this._muted=!1,this._playbackRate=1}function Et(t,e,i,r,o,n,s,a){void 0===i&&(i=e),void 0===r&&(r="black"),void 0===o&&(o=0),void 0===n&&(n="black"),void 0===s&&(s=!1),void 0===a&&(a=B.FontWeight.Normal),this.fontFamily=t,this.fontSize=e,this.fontWeight=a,this.baselineHeight=i,this.fontColor=r,this.strokeWidth=o,this.strokeColor=n,this.strokeOnly=s}function bt(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}function Pt(t){this.initState(t)}function kt(t,e){var i=this;if(void 0===t)throw q.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(i=X.call(this,t)||this)._xorshift=e?q.Xorshift.deserialize(e):new q.Xorshift(t),i}(z=(z=Y=Y||{}).AssetLoadErrorType||(z.AssetLoadErrorType={}))[z.Unspecified=0]="Unspecified",z[z.RetryLimitExceeded=1]="RetryLimitExceeded",z[z.NetworkError=2]="NetworkError",z[z.ClientError=3]="ClientError",z[z.ServerError=4]="ServerError",o=Y=Y||{},(t=o.ExceptionFactory||(o.ExceptionFactory={})).createAssertionError=function(t,e){return(t=new Error(t)).name="AssertionError",t.cause=e,t},t.createTypeMismatchError=function(t,e,i,r){var o="Type mismatch on "+t+", expected type is "+e;if(2<arguments.length)try{var n=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i;o+=", actual type is "+(40<n.length?n.substr(0,40):n)}catch(t){}return o+=".",(t=new Error(o)).name="TypeMismatchError",t.cause=r,t.expected=e,t.actual=i,t},t.createAssetLoadError=function(t,e,i,r){return void 0===e&&(e=!0),void 0===i&&(i=o.AssetLoadErrorType.Unspecified),(t=new Error(t)).name="AssetLoadError",t.cause=r,t.retriable=e,t.type=i,t},i=Y=Y||{},J.prototype.createSurfaceAtlas=function(t,e){return new i.SurfaceAtlas(this.createSurface(t,e))},J.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),e=r.renderer();return e.begin(),e.drawImage(t,i.x,i.y,i.width,i.height,0,0),e.end(),r},z=J,i.ResourceFactory=z,t=Y=Y||{},$.prototype._cachedValue=function(){return this._value},z=$,t.RequireCachedValue=z,(Y||(Y={})).RandomGenerator=function(t){this.seed=t,this[0]=this},function(i){var t=(e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e);function e(t,e){this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e),this.onDestroyed=new i.Trigger}i.Asset=t;var o,r=(K(n,o=t),n.prototype.initialize=function(t){this.hint=t},n);function n(t,e,i,r){e=o.call(this,t,e)||this;return e.width=i,e.height=r,e}i.ImageAsset=r;var a,r=(K(s,a=r),s.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},s.prototype.stop=function(){this.getPlayer().stop()},s.prototype.destroy=function(){this._system=void 0,a.prototype.destroy.call(this)},s);function s(t,e,i,r,o,n,s){r=a.call(this,t,e,i,r)||this;return r.realWidth=0,r.realHeight=0,r._system=o,r._loop=n,r._useRealSize=s,r}i.VideoAsset=r;var h,r=(K(c,h=t),c.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t},c.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},c.prototype.inUse=function(){return 0<this._system.findPlayers(this).length},c.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,h.prototype.destroy.call(this)},c);function c(t,e,i,r,o,n){e=h.call(this,t,e)||this;return e.duration=i,e.loop=o,e.hint=n,e._system=r,e.data=void 0,e}i.AudioAsset=r;var u,r=(K(l,u=t),l.prototype.destroy=function(){this.data=void 0,u.prototype.destroy.call(this)},l);function l(t,e){e=u.call(this,t,e)||this;return e.data=void 0,e}i.TextAsset=r;var d,t=(K(p,d=t),p.prototype.destroy=function(){this.script=void 0,d.prototype.destroy.call(this)},p);function p(){return null!==d&&d.apply(this,arguments)||this}i.ScriptAsset=t}(Y=Y||{}),s=Y=Y||{},n=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1},Z.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},Z.prototype.destroyed=function(){return void 0===this.game},Z.prototype.retryLoad=function(t){if(!this._loadings.hasOwnProperty(t.id))throw s.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var e=this._loadings[t.id];if(e.errorCount>Z.MAX_ERROR_COUNT){if(!this.configuration[t.id])return;throw s.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}e.loading||(e.loading=!0,t._load(this))},Z.prototype.globalAssetIds=function(){var t,e=[],i=this.configuration;for(t in i)i.hasOwnProperty(t)&&i[t].global&&e.push(t);return e},Z.prototype.requestAsset=function(t,e){var i,r="string"==typeof t?t:t.id,o=!1;return this._assets.hasOwnProperty(r)?(++this._refCounts[r],e._onAssetLoad(this._assets[r])):this._loadings.hasOwnProperty(r)?((i=this._loadings[r]).handlers.push(e),++this._refCounts[r],o=!0):(t=this._createAssetFor(t),i=new n(t,e),this._loadings[r]=i,this._refCounts[r]=1,o=!0,i.loading=!0,t._load(this)),o},Z.prototype.unrefAsset=function(t){t="string"==typeof t?t:t.id;0<--this._refCounts[t]||this._releaseAsset(t)},Z.prototype.requestAssets=function(t,e){for(var i=0,r=0,o=t.length;r<o;++r)this.requestAsset(t[r],e)&&++i;return i},Z.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},Z.prototype._normalize=function(t,e){var i,r={};if(!(t instanceof Object))throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(i in t)if(t.hasOwnProperty(i)){var o,n=Object.create(t[i]);if(!n.path)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+i);if(!n.virtualPath)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+i);if(!n.type)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+i);if("image"===n.type){if("number"!=typeof n.width)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+i);if("number"!=typeof n.height)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+i)}if("audio"===n.type&&(void 0===n.duration&&(n.duration=0),o=e[n.systemId],void 0===n.loop&&(n.loop=!!o&&!!o.loop),void 0===n.hint&&(n.hint=o?o.hint:{})),"video"===n.type&&!n.useRealSize){if("number"!=typeof n.width)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+i);if("number"!=typeof n.height)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+i);n.useRealSize=!1}n.global||(n.global=!1),r[i]=n}return r},Z.prototype._createAssetFor=function(t){var e,i,r;r="string"==typeof t?(e=t,i=this.configuration[e],this.configuration[e].path):(e=t.id,(i=t).uri);t=this.game.resourceFactory;if(!i)throw s.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+e);switch(i.type){case"image":var o=t.createImageAsset(e,r,i.width,i.height);return o.initialize(i.hint),o;case"audio":o=i.systemId?this.game.audio[i.systemId]:this.game.audio[this.game.defaultAudioSystemId];return t.createAudioAsset(e,r,i.duration,o,i.loop,i.hint);case"text":return t.createTextAsset(e,r);case"script":return t.createScriptAsset(e,r);case"video":return t.createVideoAsset(e,r,i.width,i.height,new s.VideoSystem,i.loop,i.useRealSize);default:throw s.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+i.type+" for asset ID: "+e)}},Z.prototype._releaseAsset=function(t){var e,i=this._assets[t]||this._loadings[t]&&this._loadings[t].asset;if(i)if(e=i.path,i.inUse())if(i instanceof s.AudioAsset)i._system.requestDestroy(i);else{if(!(i instanceof s.VideoAsset))throw s.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+i.id);i.destroy()}else i.destroy();delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]&&((t=this.configuration[t].virtualPath)&&this._liveAssetVirtualPathTable.hasOwnProperty(t)&&delete this._liveAssetVirtualPathTable[t],e&&this._liveAbsolutePathTable.hasOwnProperty(e)&&delete this._liveAbsolutePathTable[e])},Z.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},Z.prototype._onAssetError=function(t,e){if(!this.destroyed()&&!t.destroyed()){var i=this._loadings[t.id],r=i.handlers;i.loading=!1,++i.errorCount,i.errorCount>Z.MAX_ERROR_COUNT&&e.retriable&&(e=s.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,s.AssetLoadErrorType.RetryLimitExceeded,e)),e.retriable||delete this._loadings[t.id];for(var o=0;o<r.length;++o)r[o]._onAssetError(t,e,this)}},Z.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed()){var e=this._loadings[t.id];if(e.loading=!1,delete this._loadings[t.id],this._assets[t.id]=t,this.configuration[t.id]){var i=this.configuration[t.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(i)){if(this._liveAssetVirtualPathTable[i].path!==t.path)throw s.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[i]=t;this._liveAbsolutePathTable.hasOwnProperty(t.path)||(this._liveAbsolutePathTable[t.path]=i)}for(var r=e.handlers,o=0;o<r.length;++o)r[o]._onAssetLoad(t)}},Z.MAX_ERROR_COUNT=3,t=Z,s.AssetManager=t,function(u){u._require=function(t,e,i){var r=t._assetManager._liveAssetVirtualPathTable,o=t._assetManager._moduleMainScripts;if(-1===e.indexOf("/")&&t._assetManager._assets.hasOwnProperty(e)&&(a=t._assetManager._assets[e],c=t._assetManager._liveAbsolutePathTable[a.path]),/^\.\/|^\.\.\/|^\//.test(e)){if(i){if(!i._virtualDirname)throw u.ExceptionFactory.createAssertionError("g._require: require from DynamicAsset is not supported");c=u.PathUtil.resolvePath(i._virtualDirname,e)}else{if(!/^\.\//.test(e))throw u.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");c=e.substring(2)}if(t._scriptCaches.hasOwnProperty(c))return t._scriptCaches[c]._cachedValue();if(t._scriptCaches.hasOwnProperty(c+".js"))return t._scriptCaches[c+".js"]._cachedValue();a=(a=a||u.Util.findAssetByPathAsFile(c,r))||u.Util.findAssetByPathAsDirectory(c,r)}else if(o[e]&&(c=o[e],a=t._assetManager._liveAssetVirtualPathTable[c]),!a){var n=i?i.paths:[];n.push("node_modules");for(var s=0;s<n.length;++s){var a,h=n[s],c=u.PathUtil.resolvePath(h,e);if(a=u.Util.findAssetByPathAsFile(c,r))break;if(a=u.Util.findAssetByPathAsDirectory(c,r))break}}if(a){if(t._scriptCaches.hasOwnProperty(c))return t._scriptCaches[c]._cachedValue();if(a instanceof u.ScriptAsset){o=new u.ScriptAssetContext(t,a);return(t._scriptCaches[c]=o)._executeScript(i)}if(a instanceof u.TextAsset&&a&&".json"===u.PathUtil.resolveExtname(e))return(t._scriptCaches[c]=new u.RequireCachedValue(JSON.parse(a.data)))._cachedValue()}throw u.ExceptionFactory.createAssertionError("g._require: can not find module: "+e)};function t(e,t,i){var r=this,o=u.PathUtil.resolveDirname(i),n=(n=e._assetManager._liveAbsolutePathTable[i])?u.PathUtil.resolveDirname(n):void 0,s=Object.create(u,{game:{value:e,enumerable:!0},filename:{value:i,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=t,this.filename=i,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=n?u.PathUtil.makeNodeModulePaths(n):[],this._dirname=o,this._virtualDirname=n,this._g=s,this.require=function(t){return"g"===t?s:u._require(e,t,r)}}u.Module=t}(Y=Y||{}),a=Y=Y||{},Q.prototype._cachedValue=function(){if(!this._started)throw a.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},Q.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t).children.push(this._module),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0),this._module.exports},z=Q,a.ScriptAssetContext=z,t=Y=Y||{},tt.prototype.update=function(t,e,i,r,o,n,s){var a=o*Math.PI/180,h=Math.cos(a),o=Math.sin(a),a=h*i,i=o*i,o=o*r,r=h*r,t=t/2,e=e/2;this._matrix[0]=a,this._matrix[1]=i,this._matrix[2]=-o,this._matrix[3]=r,this._matrix[4]=-a*t+o*e+t+n,this._matrix[5]=-i*t-r*e+e+s},tt.prototype.updateWithAnchor=function(t,e,i,r,o,n,s,a,h){var c=o*Math.PI/180,u=Math.cos(c),o=Math.sin(c),c=u*i,i=o*i,o=o*r,r=u*r,t=a*t,e=h*e;this._matrix[0]=c,this._matrix[1]=i,this._matrix[2]=-o,this._matrix[3]=r,this._matrix[4]=-c*t+o*e+n,this._matrix[5]=-i*t-r*e+s},tt.prototype.updateByInverse=function(t,e,i,r,o,n,s){var a=o*Math.PI/180,h=Math.cos(a),c=Math.sin(a),o=h/i,a=c/r,i=c/i,r=h/r,t=t/2,e=e/2;this._matrix[0]=o,this._matrix[1]=-a,this._matrix[2]=i,this._matrix[3]=r,this._matrix[4]=-o*(t+n)-i*(e+s)+t,this._matrix[5]=a*(t+n)-r*(e+s)+e},tt.prototype.updateByInverseWithAnchor=function(t,e,i,r,o,n,s,a,h){var c=o*Math.PI/180,u=Math.cos(c),l=Math.sin(c),o=u/i,c=l/r,i=l/i,r=u/r,t=a*t,e=h*e;this._matrix[0]=o,this._matrix[1]=-c,this._matrix[2]=i,this._matrix[3]=r,this._matrix[4]=-o*n-i*s+t,this._matrix[5]=c*n-r*s+e},tt.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],o=e[1],n=e[2],t=e[3];e[0]=r*i[0]+n*i[1],e[1]=o*i[0]+t*i[1],e[2]=r*i[2]+n*i[3],e[3]=o*i[2]+t*i[3],e[4]=r*i[4]+n*i[5]+e[4],e[5]=o*i[4]+t*i[5]+e[5]},tt.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},tt.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},tt.prototype.clone=function(){return new tt(this)},tt.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},tt.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},tt.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},z=tt,t.PlainMatrix=z,u=Y=Y||{},(h=u.Util||(u.Util={})).distance=function(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))},h.distanceBetweenOffsets=function(t,e){return h.distance(t.x,t.y,e.x,e.y)},h.distanceBetweenAreas=function(t,e){return h.distance(t.x+t.width/2,t.y+t.height/2,e.x+e.width/2,e.y+e.height/2)},h.createMatrix=function(t,e,i,r,o,n,s){return void 0===t?new u.PlainMatrix:new u.PlainMatrix(t,e,i,r,o,n,s)},h.createSpriteFromE=function(t,e,i){var r=e.x,o=e.y,n=0,s=0,a=e.width,h=e.height,c=e.calculateBoundingRect(i);if(!c)throw u.ExceptionFactory.createAssertionError("Util#createSpriteFromE: camera must look e");return a=c.right-c.left,h=c.bottom-c.top,c.left<e.x&&(n=e.x-c.left),c.top<e.y&&(s=e.y-c.top),e.moveTo(n,s),e._matrix&&(e._matrix._modified=!0),n=t.game.resourceFactory.createSurface(Math.ceil(a),Math.ceil(h)),(s=n.renderer()).begin(),e.render(s,i),s.end(),(h=new u.Sprite({scene:t,src:n,width:a,height:h})).moveTo(c.left,c.top),e.moveTo(r,o),e._matrix&&(e._matrix._modified=!0),h},h.createSpriteFromScene=function(t,e,i){var r=t.game.resourceFactory.createSurface(Math.ceil(e.game.width),Math.ceil(e.game.height)),o=r.renderer();o.begin();for(var n=e.children,s=0;s<n.length;++s)n[s].render(o,i);return o.end(),new u.Sprite({scene:t,src:r,width:e.game.width,height:e.game.height})},h.asSurface=function(t){if(!t)return t;if(t instanceof u.Surface)return t;if(t instanceof u.ImageAsset)return t.asSurface();throw u.ExceptionFactory.createTypeMismatchError("Util#asSurface","ImageAsset|Surface",t)},h.findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},h.findAssetByPathAsDirectory=function(t,e){var i=t+"/package.json";if(e.hasOwnProperty(i)&&e[i]instanceof u.TextAsset){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){r=h.findAssetByPathAsFile(u.PathUtil.resolvePath(t,r.main),e);if(r)return r}}if(i=t+"/index.js",e.hasOwnProperty(i))return e[i]},h.charCodeAt=function(t,e){var i=t.charCodeAt(e);return 55296<=i&&i<=56319?i<<16|t.charCodeAt(e+1):56320<=i&&i<=57343?null:i},h.setupAnimatingHandler=function(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())},h.migrateAnimatingHandler=function(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())},c=Y=Y||{},(l=c.Collision||(c.Collision={})).intersect=function(t,e,i,r,o,n,s,a){return t<=o+s&&o<=t+i&&e<=n+a&&n<=e+r},l.intersectAreas=function(t,e){return l.intersect(t.x,t.y,t.width,t.height,e.x,e.y,e.width,e.height)},l.within=function(t,e,i,r,o){return void 0===o&&(o=1),o>=c.Util.distance(t,e,i,r)},l.withinAreas=function(t,e,i){return void 0===i&&(i=1),i>=c.Util.distanceBetweenAreas(t,e)},function(t){var e=(i.prototype.add=function(t,e){"function"==typeof t?this._handlers.push({func:t,owner:e,once:!1,name:void 0}):"number"==typeof(t=t).index?this._handlers.splice(t.index,0,{func:t.func,owner:t.owner,once:!1,name:t.name}):this._handlers.push({func:t.func,owner:t.owner,once:!1,name:t.name}),this.length=this._handlers.length},i.prototype.addOnce=function(t,e){"function"==typeof t?this._handlers.push({func:t,owner:e,once:!0,name:void 0}):"number"==typeof(t=t).index?this._handlers.splice(t.index,0,{func:t.func,owner:t.owner,once:!0,name:t.name}):this._handlers.push({func:t.func,owner:t.owner,once:!0,name:t.name}),this.length=this._handlers.length},i.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},i.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];!r.func.call(r.owner,t)&&!r.once||-1!==(r=this._handlers.indexOf(r))&&this._handlers.splice(r,1)}this._handlers&&(this.length=this._handlers.length)}},i.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},i.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var o=this._handlers[r];if(i.func===o.func&&i.owner===o.owner&&i.name===o.name)return this._handlers.splice(r,1),void--this.length}},i.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},i.prototype.destroy=function(){this._handlers=null,this.length=null},i.prototype.destroyed=function(){return null===this._handlers},i.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},i);function i(){this._handlers=[],this.length=0}t.Trigger=e;var o,e=(K(r,o=e),r.prototype.add=function(t,e){o.prototype.add.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},r.prototype.addOnce=function(t,e){o.prototype.addOnce.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},r.prototype.remove=function(t,e){o.prototype.remove.call(this,t,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},r.prototype.removeAll=function(t){o.prototype.removeAll.call(this,t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},r.prototype.destroy=function(){o.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},r.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},r);function r(t,e,i){var r=o.call(this)||this;return r.chain=t,r.filter=e,r.filterOwner=i,r._isActivated=!1,r}t.ChainTrigger=e}(Y=Y||{}),d=Y=Y||{},et.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},et.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},et.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},et.prototype.destroyed=function(){return void 0===this.elapsed},t=et,d.Timer=t,function(o){var r=(t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t);function t(t,e,i,r,o){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=o,this._timer.elapsed.add(this._fire,this)}o.TimerIdentifier=r;var e=(i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(t){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),t<0)throw o.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");t<1&&(t=1);for(var e=Math.min(1e3,t*this._fps),i=0;i<this._timers.length;++i)if(this._timers[i].interval===t&&this._timers[i]._scaledElapsed<e)return this._timers[i];var r=new o.Timer(t,this._fps);return this._timers.push(r),r},i.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(e<0)throw o.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(e,1),t.destroy(),!this._timers.length){if(!this._registered)throw o.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,e,i){e=this.createTimer(e),i=new r(e,t,i,this._onTimeoutFired,this);return this._identifiers.push(i),i},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,e,i){e=this.createTimer(e),i=new r(e,t,i);return this._identifiers.push(i),i},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw o.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(e,1);e=t._timer;t.destroy(),this.deleteTimer(e)},i.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw o.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(t.destroyed())throw o.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(e,1);e=t._timer;t.destroy(),this.deleteTimer(e)},i);function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}o.TimerManager=e}(Y=Y||{}),e=Y=Y||{},it.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},it.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},it.prototype.canHandleStopped=function(){return!0},it.prototype.changeVolume=function(t){this.volume=t},it.prototype._changeMuted=function(t){this._muted=t},it.prototype._changePlaybackRate=function(t){this._playbackRate=t},it.prototype._supportsPlaybackRate=function(){return!1},it.prototype._onVolumeChanged=function(){},z=it,e.AudioPlayer=z,function(i){var t=(Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||1<t||isNaN(t)||"number"!=typeof t)throw i.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw i.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);var e=this._playbackRate;this._playbackRate=t,this._playbackRate!==e&&this._onPlaybackRateChanged()},e);function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}i.AudioSystem=t;var r,o=(K(n,r=t),Object.defineProperty(n.prototype,"player",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),n.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},n.prototype.createPlayer=function(){return this.player},n.prototype.stopAll=function(){this._player&&this._player.stop()},n.prototype._reset=function(){r.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},n.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},n.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},n.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},n.prototype._onUnsupportedPlaybackRateChanged=function(){var t;1===this._playbackRate&&this._suppressingAudio&&(t=this._suppressingAudio,this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1))},n.prototype._onPlayerPlayed=function(t){if(t.player!==this._player)throw i.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player");t.player._supportsPlaybackRate()||1!==this._playbackRate&&(t.player._changeMuted(!0),this._suppressingAudio=t.audio)},n.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},n);function n(t,e){e=r.call(this,t,e)||this;return e._player=void 0,e._suppressingAudio=void 0,e}i.MusicAudioSystem=o;var s,t=(K(a,s=t),a.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},a.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},a.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},a.prototype._reset=function(){s.prototype._reset.call(this);for(var t=0;t<this.players.length;++t){var e=this.players[t];e.played.remove({owner:this,func:this._onPlayerPlayed}),e.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},a.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},a.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},a.prototype._onPlayerPlayed=function(t){t.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},a.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},a.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},a);function a(t,e){e=s.call(this,t,e)||this;return e.players=[],e}i.SoundAudioSystem=t}(Y=Y||{}),p=Y=Y||{},rt.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},rt.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},rt.prototype.changeVolume=function(t){this.volume=t},t=rt,p.VideoPlayer=t,(Y||(Y={})).VideoSystem=function(){},f=Y=Y||{},ot.prototype.moveTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw f.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof t?(this.x=t,this.y=e):(this.x=t.x,this.y=t.y)},ot.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},ot.prototype.resizeTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw f.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height)},ot.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},ot.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},ot.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},ot.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=f.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},ot.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},z=ot,f.Object2D=z,_=Y=Y||{},g=_.Object2D,K(nt,g),Object.defineProperty(nt.prototype,"update",{get:function(){return this._update||(this._update=new _.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"message",{get:function(){return this._message||(this._message=new _.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"pointDown",{get:function(){return this._pointDown||(this._pointDown=new _.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"pointUp",{get:function(){return this._pointUp||(this._pointUp=new _.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"pointMove",{get:function(){return this._pointMove||(this._pointMove=new _.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"targetCameras",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&((this._touchable=t)?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),nt.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&0<i.length)||e&&-1!==i.indexOf(e))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var r=(n=this.children).length,o=0;o<r;++o)n[o].render(t,e);t.translate(-this.x,-this.y)}else{if(t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children)for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);t.restore()}}},nt.prototype.renderSelf=function(t,e){return!0},nt.prototype.game=function(){return this.scene.game},nt.prototype.append=function(t){this.insertBefore(t,void 0)},nt.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},nt.prototype.remove=function(t){if(void 0!==t){var e=this.children?this.children.indexOf(t):-1;if(e<0)throw _.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),(t._touchable||t._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)}else this.parent.remove(this)},nt.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;0<=t;--t)this.children[t].destroy();if(0!==this.children.length)throw _.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},nt.prototype.destroyed=function(){return void 0===this.scene},nt.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},nt.prototype.shouldFindChildrenByPoint=function(t){return!0},nt.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var o=this._targetCameras;if(!(o&&0<o.length)||r&&-1!==o.indexOf(r)){o=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var n=this.children.length-1;0<=n;--n){var s=this.children[n];if(i||s._touchable||s._hasTouchableChildren){s=s.findPointSourceByPoint(t,e,i,r);if(s)return s}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},nt.prototype.visible=function(){return 1!=(1&this.state)},nt.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},nt.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},nt.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},nt.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var t={left:0,right:this.width,top:0,bottom:this.height},r=[{x:t.left,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.top},{x:t.right,y:t.bottom}],o=i.multiplyPoint(r[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},s=1;s<r.length;++s)o=i.multiplyPoint(r[s]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);if(void 0!==this.children)for(s=0;s<this.children.length;++s){var a=this.children[s]._calculateBoundingRect(i,e);a&&(n.left>a.left&&(n.left=a.left),n.right<a.right&&(n.right=a.right),n.top>a.top&&(n.top=a.top),n.bottom<a.bottom&&(n.bottom=a.bottom))}return n}},nt.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof nt&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},nt.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof nt&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},nt.prototype._isTargetOperation=function(t){return!(1&this.state)&&(t instanceof _.PointEvent&&(this._touchable&&t.target===this))},nt.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},t=nt,_.E=t,z=Y=Y||{},y=z.E,K(st,y),st.prototype.invalidate=function(){this.state&=-3,this.modified()},st.prototype.renderSelf=function(t,e){var i,r,o,n=st.PADDING;return this._renderedCamera!==e&&(this.state&=-3,this._renderedCamera=e),2&this.state||(this._cacheSize=this.calculateCacheSize(),i=Math.ceil(this._cacheSize.width)+2*n,o=Math.ceil(this._cacheSize.height)+2*n,(r=!this._cache||this._cache.width<i||this._cache.height<o)&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(i,o),this._renderer=this._cache.renderer()),(o=this._renderer).begin(),r||o.clear(),o.save(),o.translate(n,n),this.renderCache(o,e),o.restore(),this.state|=2,o.end()),this._cache&&0<this._cacheSize.width&&0<this._cacheSize.height&&(t.translate(-n,-n),this.renderSelfFromCache(t),t.translate(n,n)),this._shouldRenderChildren},st.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+st.PADDING,this._cacheSize.height+st.PADDING,0,0)},st.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,y.prototype.destroy.call(this)},st.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},st.PADDING=1,t=st,z.CacheableE=t,function(t){(n=t.StorageRegion||(t.StorageRegion={}))[n.Slots=1]="Slots",n[n.Scores=2]="Scores",n[n.Counts=3]="Counts",n[n.Values=4]="Values",(n=t.StorageOrder||(t.StorageOrder={}))[n.Asc=0]="Asc",n[n.Desc=1]="Desc",(n=t.StorageCondition||(t.StorageCondition={}))[n.Equal=1]="Equal",n[n.GreaterThan=2]="GreaterThan",n[n.LessThan=3]="LessThan",(n=t.StorageCountsOperation||(t.StorageCountsOperation={}))[n.Incr=1]="Incr",n[n.Decr=2]="Decr";var r=(e.prototype.get=function(t){if(void 0===this._values)return[];if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},e.prototype.getOne=function(t){t=this.get(t);if(t)return t[0]},e);function e(t,e){this._keys=t,this._values=e}t.StorageValueStore=r;var i=(o.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},o.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},o.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},o);function o(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new r(e),this._handler=void 0,this._valueStoreSerialization=i}t.StorageLoader=i;var n=(s.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},s.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},s.prototype._createLoader=function(t,e){return new i(this,t,e)},s.prototype._registerWrite=function(t){this._write=t},s.prototype._registerLoad=function(t){this._load=t},s);function s(t){this._game=t}t.Storage=n}(Y=Y||{}),function(h){var n,s,a=(t.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},t.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},t.prototype.destroyed=function(){return!this._scene},t.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},t.prototype._onAssetError=function(t,e,i){var r;this.destroyed()||this._scene.destroyed()||(r={asset:t,error:e,cancelRetry:!1},this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t))},t.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[t.id]=t,this._scene.assetLoaded.fire(t),this._scene.assetLoadCompleted.fire(t),this._assets.push(t),--this.waitingAssetsCount,this.waitingAssetsCount<0)throw h.ExceptionFactory.createAssertionError("SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount");0<this.waitingAssetsCount||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},t);function t(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}h.SceneAssetHolder=a,(e=n=h.SceneState||(h.SceneState={}))[e.Destroyed=0]="Destroyed",e[e.Standby=1]="Standby",e[e.Active=2]="Active",e[e.Deactive=3]="Deactive",e[e.BeforeDestroyed=4]="BeforeDestroyed",(e=s=h.SceneLoadState||(h.SceneLoadState={}))[e.Initial=0]="Initial",e[e.Ready=1]="Ready",e[e.ReadyFired=2]="ReadyFired",e[e.LoadedFired=3]="LoadedFired";var e=(i.prototype.modified=function(t){this.game.modified=!0},i.prototype.destroy=function(){this.state=n.BeforeDestroyed,this.stateChanged.fire(this.state);var t,e=this.game.db;for(t in e)e.hasOwnProperty(t)&&e[t].scene===this&&e[t].destroy();for(t in e=this.game._localDb)e.hasOwnProperty(t)&&e[t].scene===this&&e[t].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var i=0;i<this._assetHolders.length;++i)this._assetHolders[i].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=n.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},i.prototype.destroyed=function(){return void 0===this.game},i.prototype.createTimer=function(t){return this._timer.createTimer(t)},i.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},i.prototype.setInterval=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},i.prototype.clearInterval=function(t){this._timer.clearInterval(t)},i.prototype.setTimeout=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},i.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},i.prototype.isCurrentScene=function(){return this.game.scene()===this},i.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw h.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},i.prototype.end=function(){if(!this.isCurrentScene())throw h.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},i.prototype.register=function(t){this.game.register(t),t.scene=this},i.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},i.prototype.append=function(t){this.insertBefore(t,void 0)},i.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},i.prototype.remove=function(t){t=this.children.indexOf(t);-1!==t&&(this.children[t].parent=void 0,this.children.splice(t,1),this.modified(!0))},i.prototype.findPointSourceByPoint=function(t,e,i){var r=this.local!==h.LocalTickMode.NonLocal,o=this.children,n=void 0;i&&i instanceof h.Camera2D&&(n=i.getMatrix());for(var s=o.length-1;0<=s;--s){var a=o[s].findPointSourceByPoint(t,n,e,i);if(a)return a.local=a.target.local||r,a}return{target:void 0,point:void 0,local:r}},i.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},i.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},i.prototype.requestAssets=function(t,e){if(this._loadingState<s.ReadyFired)throw h.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");e=new a({scene:this,assetManager:this.game._assetManager,assetIds:t,handler:e});this._assetHolders.push(e),e.request()},i.prototype._activate=function(){this.state=n.Active,this.stateChanged.fire(this.state)},i.prototype._deactivate=function(){this.state=n.Deactive,this.stateChanged.fire(this.state)},i.prototype._needsLoading=function(){return 0<this._sceneAssetHolder.waitingAssetsCount||this._storageLoader&&!this._storageLoader._loaded},i.prototype._load=function(){var t;this._loaded||(this._loaded=!0,t=this._sceneAssetHolder.request(),this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady())},i.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},i.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},i.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},i.prototype._notifySceneReady=function(){this._loadingState=s.Ready,this.game._fireSceneReady(this)},i.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=s.ReadyFired},i.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=s.LoadedFired},i);function i(t){var e,i,r=t.game,o=t.assetIds;t.storageKeys?(this._storageLoader=r.storage._createLoader(t.storageKeys,t.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),e=void 0===t.local||!1===t.local?h.LocalTickMode.NonLocal:!0===t.local?h.LocalTickMode.FullLocal:t.local,i=void 0!==t.tickGenerationMode?t.tickGenerationMode:h.TickGenerationMode.ByClock,this.name=t.name,o=o||[],this.game=r,this.local=e,this.tickGenerationMode=i,this.loaded=new h.Trigger,this._ready=new h.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=s.Initial,this.update=new h.Trigger,this._timer=new h.TimerManager(this.update,this.game.fps),this.assetLoaded=new h.Trigger,this.assetLoadFailed=new h.Trigger,this.assetLoadCompleted=new h.Trigger,this.message=new h.Trigger,this.pointDownCapture=new h.Trigger,this.pointMoveCapture=new h.Trigger,this.pointUpCapture=new h.Trigger,this.operation=new h.Trigger,this.children=[],this.state=n.Standby,this.stateChanged=new h.Trigger,this._assetHolders=[],this._sceneAssetHolder=new a({scene:this,assetManager:this.game._assetManager,assetIds:o,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}h.Scene=e}(Y=Y||{}),m=Y=Y||{},v=m.Scene,K(at,v),at.prototype.destroy=function(){this._clearTargetScene(),v.prototype.destroy.call(this)},at.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,this._loadingState<m.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},at.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},at.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<m.SceneLoadState.Ready){var t="LoadingScene#end(): the target scene is in invalid state: "+(this._targetScene?m.SceneLoadState[this._targetScene._loadingState]:"(no scene)");throw m.ExceptionFactory.createAssertionError(t)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},at.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},at.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<m.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},at.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},at.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},z=at,m.LoadingScene=z,T=Y=Y||{},A=T.E,K(ht,A),ht.prototype.renderSelf=function(t,e){if(!this.children)return!1;var i,r;e&&(i=e,r=this._canceller,i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix));for(var o=this.children,n=0;n<o.length;++n)o[n].render(t,e);return e&&t.restore(),!1},x=ht,w=T.LoadingScene,K(ct,w),ct.prototype._onLoaded=function(){var t;return this.append(new x({scene:this,children:[new T.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:"rgba(0, 0, 0, 0.8)",children:[new T.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[t=new T.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),t.update.handle(this,this._onUpdateGuage),this._gauge=t,!0},ct.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},ct.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},ct.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},t=ct,T.DefaultLoadingScene=t,S=Y=Y||{},E=S.E,K(ut,E),ut.prototype._onUpdate=function(){this.modified()},ut.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},ut.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},ut.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},ut.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},ut.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,E.prototype.destroy.call(this)},ut.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=S.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(S.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},z=ut,S.Sprite=z,b=Y=Y||{},P=b.Sprite,K(lt,P),lt.createBySprite=function(t,e,i){var r=new lt({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return r.srcHeight=void 0===i?t.srcHeight:i,r.srcWidth=void 0===e?t.srcWidth:e,r},lt.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},lt.prototype.destroy=function(t){this.stop(),P.prototype.destroy.call(this,t)},lt.prototype.stop=function(){this._timer&&this._free()},lt.prototype.modified=function(t){this._modifiedSelf(t),P.prototype.modified.call(this,t)},lt.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},lt.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},lt.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},lt.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},t=lt,b.FrameSprite=t,function(t){var h;(i=h=t.EventType||(t.EventType={}))[i.Unknown=0]="Unknown",i[i.Join=1]="Join",i[i.Leave=2]="Leave",i[i.Timestamp=3]="Timestamp",i[i.Seed=4]="Seed",i[i.PointDown=5]="PointDown",i[i.PointMove=6]="PointMove",i[i.PointUp=7]="PointUp",i[i.Message=8]="Message",i[i.Operation=9]="Operation";var e=function(t,e,i,r,o,n){this.priority=n,this.local=o,this.player=r,this.pointerId=t,this.target=e,this.point=i};t.PointEvent=e;var s,i=(K(r,s=e),r);function r(t,e,i,r,o,n){n=s.call(this,t,e,i,r,o,n)||this;return n.type=h.PointDown,n}t.PointDownEvent=i;var c,i=(K(o,c=e),o);function o(t,e,i,r,o,n,s,a){a=c.call(this,t,e,i,n,s,a)||this;return a.type=h.PointUp,a.prevDelta=r,a.startDelta=o,a}t.PointUpEvent=i;var u,e=(K(n,u=e),n);function n(t,e,i,r,o,n,s,a){a=u.call(this,t,e,i,n,s,a)||this;return a.type=h.PointMove,a.prevDelta=r,a.startDelta=o,a}t.PointMoveEvent=e;e=function(t,e,i,r){this.type=h.Message,this.priority=r,this.local=i,this.player=e,this.data=t};t.MessageEvent=e;e=function(t,e,i,r,o){this.type=h.Operation,this.priority=o,this.local=r,this.player=i,this.code=t,this.data=e};t.OperationEvent=e;e=function(t,e,i){this.type=h.Join,this.priority=i,this.player=t,this.storageValues=e};t.JoinEvent=e;e=function(t,e){this.type=h.Leave,this.priority=e,this.player=t};t.LeaveEvent=e;e=function(t,e,i){this.type=h.Timestamp,this.priority=i,this.player=e,this.timestamp=t};t.TimestampEvent=e;e=function(t,e){this.type=h.Seed,this.priority=e,this.generator=t};t.SeedEvent=e}(Y=Y||{}),function(e){var i;(t=i=e.LogLevel||(e.LogLevel={}))[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Info=2]="Info",t[t.Debug=3]="Debug";var t=(r.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},r.prototype.destroyed=function(){return!this.game},r.prototype.error=function(t,e){this.logging.fire({game:this.game,level:i.Error,message:t,cause:e})},r.prototype.warn=function(t,e){this.logging.fire({game:this.game,level:i.Warn,message:t,cause:e})},r.prototype.info=function(t,e){this.logging.fire({game:this.game,level:i.Info,message:t,cause:e})},r.prototype.debug=function(t,e){this.logging.fire({game:this.game,level:i.Debug,message:t,cause:e})},r);function r(t){this.game=t,this.logging=new e.Trigger}e.Logger=t}(Y=Y||{}),k=Y=Y||{},Object.defineProperty(dt.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),dt.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},dt.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},dt.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},dt.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},dt.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var o=0;o<r.length;++o){var n=this._eventTriggerMap[r[o].type];n&&n.fire(r[o])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},dt.prototype.render=function(t){t=t||this.focusingCamera;for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},dt.prototype.findPointSource=function(t,e){return e=e||this.focusingCamera,this.scene().findPointSourceByPoint(t,!1,e)},dt.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(0<t.id)throw k.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.hasOwnProperty(String(t.id)))throw k.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb[t.id]=t}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw k.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.hasOwnProperty(String(t.id)))throw k.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db[t.id]=t}},dt.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},dt.prototype.leaveGame=function(){this._leaveGame()},dt.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},dt.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},dt.prototype._fireSceneLoaded=function(t){t._loadingState<k.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:t})},dt.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},dt.prototype._normalizeConfiguration=function(t){if(!t)throw k.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if("assets"in t||(t.assets={}),"fps"in t||(t.fps=30),"number"!=typeof t.fps)throw k.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw k.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw k.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw k.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},dt.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},dt.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},dt.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},dt.prototype._reset=function(t){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.randGen&&(this.random=t.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this.isSkipping=!1,this.skippingChanged.add(this._handleSkippingChanged,this),this.joinedPlayerIds=[],this.join.add(this._handleJoinEvent,this),this.leave.add(this._handleLeaveEvent,this),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new k.SurfaceAtlasSet({game:this}),"none"===this._configuration.defaultLoadingScene?this._defaultLoadingScene=new k.LoadingScene({game:this}):this._defaultLoadingScene=new k.DefaultLoadingScene({game:this})},dt.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},dt.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},dt.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw k.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},dt.prototype._updateEventTriggers=function(t){if(this.modified=!0,!t)return this._eventTriggerMap[k.EventType.Message]=void 0,this._eventTriggerMap[k.EventType.PointDown]=void 0,this._eventTriggerMap[k.EventType.PointMove]=void 0,this._eventTriggerMap[k.EventType.PointUp]=void 0,void(this._eventTriggerMap[k.EventType.Operation]=void 0);this._eventTriggerMap[k.EventType.Message]=t.message,this._eventTriggerMap[k.EventType.PointDown]=t.pointDownCapture,this._eventTriggerMap[k.EventType.PointMove]=t.pointMoveCapture,this._eventTriggerMap[k.EventType.PointUp]=t.pointUpCapture,this._eventTriggerMap[k.EventType.Operation]=t.operation,t._activate()},dt.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},dt.prototype._abortGame=function(){},dt.prototype._flushSceneChangeRequests=function(){do{var t=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var e=0;e<t.length;++e){var i=t[e];switch(i.type){case 0:var r=this.scene();r&&r._deactivate(),this._doPushScene(i.scene);break;case 1:this._doPopScene(i.preserveCurrent,!1),this._doPushScene(i.scene);break;case 2:this._doPopScene(i.preserveCurrent,!0);break;case 3:i.scene.destroyed()||i.scene._fireReady();break;case 4:i.scene.destroyed()||i.scene._fireLoaded();break;case 5:i.assetHolder.destroyed()||i.assetHolder.callHandler();break;default:throw k.ExceptionFactory.createAssertionError("Game#_flushSceneChangeRequests: unknown scene change request.")}}}while(0<this._sceneChangeRequests.length)},dt.prototype._handleSkippingChanged=function(t){this.isSkipping=t},dt.prototype._handleJoinEvent=function(t){-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},dt.prototype._handleLeaveEvent=function(e){this.joinedPlayerIds=this.joinedPlayerIds.filter(function(t){return t!==e.player.id})},dt.prototype._doPopScene=function(t,e){var i=this.scenes.pop();if(i===this._initialScene)throw k.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");t||i.destroy(),e&&this._sceneChanged.fire(this.scene())},dt.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,this._main){var t=k._require(this,this._main);if(!t||"function"!=typeof t)throw k.ExceptionFactory.createAssertionError("Game#_start: Entry point '"+this._main+"' not found.");t(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()}else{if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw k.ExceptionFactory.createAssertionError("Game#_start: global asset 'snapshotLoader' not found.");k._require(this,"snapshotLoader")(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw k.ExceptionFactory.createAssertionError("Game#_start: global asset 'mainScene' not found.");t=k._require(this,"mainScene")();this.pushScene(t),this._flushSceneChangeRequests()}this._started.fire()}},dt.prototype._doPushScene=function(t,e){if(e=e||(this.loadingScene||this._defaultLoadingScene),this.scenes.push(t),t._needsLoading()&&t._loadingState<k.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw k.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(e,this._defaultLoadingScene),e.reset(t)}else this._sceneChanged.fire(t),t._loaded||(t._load(),this._fireSceneLoaded(t));this.modified=!0},z=dt,k.Game=z,t=Y=Y||{},R=t.Object2D,K(pt,R),pt.deserialize=function(t,e){t.param.game=e;e=new pt(t.param);return e.id=t.id,e},pt.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},pt.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},pt.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},pt.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},z=pt,t.Camera2D=z,t=Y=Y||{},ft.prototype.draw=function(t,e){t=t.scene();if(t){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var i=t.children,r=0;r<i.length;++r)i[r].render(this,e);e&&this.restore(),this.restore(),this.end()}},ft.prototype.begin=function(){},ft.prototype.end=function(){},z=ft,t.Renderer=z,L=Y=Y||{},_t.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},_t.prototype.destroyed=function(){return!!this._destroyed},t=_t,L.Surface=t,M=Y=Y||{},C=M.CacheableE,K(gt,C),gt.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},gt.prototype.invalidate=function(){this._invalidateSelf(),C.prototype.invalidate.call(this)},gt.prototype.renderSelfFromCache=function(t){var e;switch(this.textAlign){case M.TextAlign.Center:e=this.widthAutoAdjust?this._overhangLeft:0;break;case M.TextAlign.Right:e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width+M.CacheableE.PADDING,this._cacheSize.height+M.CacheableE.PADDING,e,0)},gt.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=0<this.maxWidth&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,i=0;switch(this.textAlign){case M.TextAlign.Center:i=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case M.TextAlign.Right:i=this.width-(this._textWidth+this._overhangLeft)*e;break;default:i-=this._overhangLeft*e}t.translate(i,0),1!=e&&t.transform([e,0,0,1,0,0]),t.save();for(var r=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var n=this.glyphs[o],s=n.advanceWidth*r,a=n.code;n.isSurfaceValid||(n=this.font.glyphForCharacter(a))?(n.surface&&(t.save(),t.transform([r,0,0,r,0,0]),t.drawImage(n.surface,n.x,n.y,n.width,n.height,n.offsetX,n.offsetY),t.restore()),t.translate(s,0)):this._outputOfWarnLogWithNoGlyph(a,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation(M.CompositeOperation.SourceAtop),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},gt.prototype.destroy=function(){C.prototype.destroy.call(this)},gt.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,this.fontSize){for(var t=this.text.length-1,e=this.text.length-1;0<=e;--e){var i=M.Util.charCodeAt(this.text,e);if(i)if((n=this.font.glyphForCharacter(i))&&0!==n.width&&0!==n.advanceWidth){t=e;break}}for(var r=0,o=0<this.font.size?this.fontSize/this.font.size:0,e=0;e<=t;++e){var n,s,a=M.Util.charCodeAt(this.text,e);a&&((n=this.font.glyphForCharacter(a))?n.width<0||n.height<0||n.x<0||n.y<0||(this.glyphs.push(n),(s=0)===e&&(this._overhangLeft=Math.min(n.offsetX,0),s=-this._overhangLeft),e===t&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),s+=this._overhangRight),this._textWidth+=(n.advanceWidth+s)*o,r<(s=n.offsetY+n.height)&&(r=s)):this._outputOfWarnLogWithNoGlyph(a,"_invalidateSelf()"))}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=r*o}else this.height=0},gt.prototype._outputOfWarnLogWithNoGlyph=function(t,e){t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn("Label#"+e+": failed to get a glyph for '"+t+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},z=gt,M.Label=z,t=Y=Y||{},yt.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},z=yt,t.Glyph=z,O=Y=Y||{},F=O.E,K(mt,F),mt.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},t=mt,O.FilledRect=t,I=Y=Y||{},D=I.CacheableE,K(vt,D),Object.defineProperty(vt.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),vt.prototype.modified=function(t){t&&(this.state&=-3),D.prototype.modified.call(this)},vt.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},vt.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},vt.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,D.prototype.destroy.call(this)},vt.prototype._renderBackground=function(){var t;this.backgroundImage&&this.backgroundEffector?(t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height),this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)):this._bgSurface=void 0},vt.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},vt.prototype._initialize=function(){var t=void 0===this._padding?0:this._padding,e="number"==typeof t?{top:t,bottom:t,left:t,right:t}:this._padding;this._childrenArea={x:e.left,y:e.top,width:this.width-e.left-e.right,height:this.height-e.top-e.bottom};t=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=t.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=e},vt.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var e={left:0,right:this.width,top:0,bottom:this.height},r=[{x:e.left,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.top},{x:e.right,y:e.bottom}],o=i.multiplyPoint(r[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},s=1;s<r.length;++s)o=i.multiplyPoint(r[s]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);return n}},z=vt,I.Pane=z,G=Y=Y||{},Tt.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t)._code=this._code,this._handler.call(this._handlerOwner,e)},H=Tt,At.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},At.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},At.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},At.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},At.prototype._loadOperationPlugins=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];if(e.script){var i=G._require(this._game,e.script);if(i.isSupported()){var r=new i(this._game,this._viewInfo,e.option),i=e.code;if(this.plugins[i])throw new Error("Plugin#code conflicted for code: "+i);this.plugins[i]=r,e._plugin=r;i=new H(i,this.operated,this.operated.fire);r.operationTrigger.handle(i,i.onOperation)}}}},t=At,G.OperationPluginManager=t,U=Y=(Y=Y||{})||{},xt.prototype.measureText=function(t){for(var e,i=0,r=0,o=0,n=0;n<t.length;n++){var s=U.Util.charCodeAt(t,n);s&&(!(s=this.glyphForCharacter(s))||s.x<0||s.y<0||s.width<0||s.height<0||(0===n&&(r=-s.offsetX),i+=(e=s).advanceWidth))}return e&&(o=i+e.offsetX+e.width-e.advanceWidth),{width:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}},z=xt,U.Font=z,function(n){var s;(t=s=n.FontWeight||(n.FontWeight={}))[t.Normal=0]="Normal",t[t.Bold=1]="Bold";var a,t=(a=n.Font,K(e,a),e.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){this._atlasSet.getAtlas(r)._accessScore/=2}return e},e.prototype.asBitmapFont=function(t){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;t&&(e=n.Util.charCodeAt(t,0),this.glyphForCharacter(e));var r={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),t=i._glyphs[e],t={x:t.x,y:t.y,width:t.width,height:t.height,offsetX:t.offsetX,offsetY:t.offsetY,advanceWidth:t.advanceWidth};r[e]=t});var t=r[e],e=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new n.BitmapFont({src:e,map:r,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:t})},e.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},e.prototype.destroyed=function(){return this._destroyed},e);function e(t){var e=a.call(this)||this;if(e.fontFamily=t.fontFamily,e.size=t.size,e.hint="hint"in t?t.hint:{},e.fontColor="fontColor"in t?t.fontColor:"black",e.fontWeight="fontWeight"in t?t.fontWeight:s.Normal,e.strokeWidth="strokeWidth"in t?t.strokeWidth:0,e.strokeColor="strokeColor"in t?t.strokeColor:"black",e.strokeOnly="strokeOnly"in t&&t.strokeOnly,e._resourceFactory=t.game.resourceFactory,e._glyphFactory=e._resourceFactory.createGlyphFactory(e.fontFamily,e.size,e.hint.baselineHeight,e.fontColor,e.strokeWidth,e.strokeColor,e.strokeOnly,e.fontWeight),e._glyphs={},e._destroyed=!1,e._isSurfaceAtlasSetOwner=!1,t.surfaceAtlasSet?e._atlasSet=t.surfaceAtlasSet:t.hint?(e._isSurfaceAtlasSetOwner=!0,e._atlasSet=new n.SurfaceAtlasSet({game:t.game,hint:e.hint})):e._atlasSet=t.game.surfaceAtlasSet,e._atlasSet.addAtlas(),e.hint.presetChars)for(var i=0,r=e.hint.presetChars.length;i<r;i++){var o=n.Util.charCodeAt(e.hint.presetChars,i);o&&e.glyphForCharacter(o)}return e}n.DynamicFont=t}(Y=Y||{}),W=Y=Y||{},N=W.Font,K(wt,N),wt.prototype.glyphForCharacter=function(t){var e=this.map[t]||this.missingGlyph;if(!e)return null;var i=void 0===e.width?this.defaultGlyphWidth:e.width,r=void 0===e.height?this.defaultGlyphHeight:e.height,o=e.offsetX||0,n=e.offsetY||0,s=void 0===e.advanceWidth?i:e.advanceWidth,a=0===i||0===r?void 0:this.surface;return new W.Glyph(t,e.x,e.y,i,r,o,n,s,a,!0)},wt.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},wt.prototype.destroyed=function(){return!this.map},t=wt,W.BitmapFont=t,function(t){var s=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null};t.SurfaceAtlasSlot=s;var e=(i.prototype._acquireSurfaceAtlasSlot=function(t,e){t+=1,e+=1;var i=function(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,t,e);if(!i)return null;var r,o=i.width-t,n=i.height-e,o=o<=n?(r=new s(i.x+t,i.y,o,e),new s(i.x,i.y+e,i.width,n)):(r=new s(i.x,i.y+e,t,n),new s(i.x+t,i.y,o,i.height));r.prev=i.prev,r.next=o,null===r.prev?this._emptySurfaceAtlasSlotHead=r:r.prev.next=r,o.prev=r,o.next=i.next,o.next&&(o.next.prev=o);e=new s(i.x,i.y,t,e);return this._updateUsedRectangleAreaSize(e),e},i.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,t=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),t>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=t)},i.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},i.prototype.destroy=function(){this._surface.destroy()},i.prototype.destroyed=function(){return this._surface.destroyed()},i.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),t=i.renderer();return t.begin(),t.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),t.end(),i},i);function i(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new s(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}t.SurfaceAtlas=e;r.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t).surfaceAtlases,i=0;i<e.length;++i)e[i].destroy()},r.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var o=Number.MAX_VALUE,n=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=o&&(o=this._surfaceAtlases[s]._accessScore,n=s);var a=this._surfaceAtlases.splice(n,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(n,1)[0])}return{surfaceAtlases:e,glyphs:i}},r.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],o=r.addSurface(t);if(o)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=o.x,t.y=o.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},r.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var o=i[r];o.surface=null,o.isSurfaceValid=!1,o._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},r.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},r.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},r.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},r.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},r.prototype.changeMaxAtlasNum=function(t){this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum&&(t=this._surfaceAtlases.length-this._maxAtlasNum,this._deleteAtlas(t))},r.prototype.getAtlasSize=function(){return this._atlasSize},r.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},r.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},r.prototype.destroyed=function(){return void 0===this._surfaceAtlases},r.INITIAL_MAX_SURFACEATLAS_NUM=10,e=r;function r(t){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=t.game.resourceFactory,this._currentAtlasIndex=0;t=t.hint||{};this._maxAtlasNum=t.maxAtlasNum||r.INITIAL_MAX_SURFACEATLAS_NUM,t.initialAtlasWidth=t.initialAtlasWidth||512,t.initialAtlasHeight=t.initialAtlasHeight||512,t.maxAtlasWidth=t.maxAtlasWidth||512,t.maxAtlasHeight=t.maxAtlasHeight||512,this._atlasSize=(t=t,{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))})}t.SurfaceAtlasSet=e}(Y=Y||{}),z=Y=Y||{},St.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t,e=this._game.audio;for(t in e)e.hasOwnProperty(t)&&e[t]._reset()},St.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e,i=this._game.audio;for(e in i)i.hasOwnProperty(e)&&i[e]._setMuted(t)}},St.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e,i=this._game.audio;for(e in i)i.hasOwnProperty(e)&&i[e]._setPlaybackRate(t)}},t=St,z.AudioSystemManager=t,(z=(z=Y=Y||{}).CompositeOperation||(z.CompositeOperation={}))[z.SourceOver=0]="SourceOver",z[z.SourceAtop=1]="SourceAtop",z[z.Lighter=2]="Lighter",z[z.Copy=3]="Copy",z[z.ExperimentalSourceIn=4]="ExperimentalSourceIn",z[z.ExperimentalSourceOut=5]="ExperimentalSourceOut",z[z.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",z[z.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",z[z.DestinationOut=8]="DestinationOut",z[z.DestinationOver=9]="DestinationOver",z[z.Xor=10]="Xor",(B=Y=Y||{}).GlyphFactory=Et,(t=(t=Y=Y||{}).LocalTickMode||(t.LocalTickMode={}))[t.NonLocal=0]="NonLocal",t[t.FullLocal=1]="FullLocal",t[t.InterpolateLocal=2]="InterpolateLocal",z=Y=Y||{},bt.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var o=this._surface.renderer();o.begin(),r||o.clear();for(var n=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,r=e-this.borderWidth.right,e=this.borderWidth.top,i=i-this.borderWidth.bottom,u=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],l=[{x:0,y:0},{x:r,y:0},{x:0,y:i},{x:r,y:i}],d=0,d=0;d<u.length;++d){var p=u[d];o.save(),o.translate(l[d].x,l[d].y),o.drawImage(t,p.x,p.y,p.width,p.height,0,0),o.restore()}var f=[{x:n,y:0,width:s-n,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:n,y:h,width:s-n,height:this.borderWidth.bottom}],_=[{x:c,y:0,width:r-c,height:this.borderWidth.top},{x:0,y:e,width:this.borderWidth.left,height:i-e},{x:r,y:e,width:this.borderWidth.right,height:i-e},{x:c,y:i,width:r-c,height:this.borderWidth.bottom}];for(d=0;d<f.length;++d){var g=f[d],y=_[d];o.save(),o.translate(y.x,y.y),o.transform([y.width/g.width,0,0,y.height/g.height,0,0]),o.drawImage(t,g.x,g.y,g.width,g.height,0,0),o.restore()}s-=n,h-=a,r-=c,i-=e;return o.save(),o.translate(c,e),o.transform([r/s,0,0,i/h,0,0]),o.drawImage(t,n,a,s,h,0,0),o.restore(),o.end(),this._surface},t=bt,z.NinePatchSurfaceEffector=t,j=Y=Y||{},(V=j.PathUtil||(j.PathUtil={})).resolvePath=function(t,e){function i(t){t=t.split("/");return""===t[t.length-1]&&t.pop(),t}if(""===e)return t;for(var r=i((t=V.splitPath(t)).path).concat(i(e)),o=[],n=0;n<r.length;++n){var s=r[n];switch(s){case"..":var a=o.pop();if(void 0===a||""===a||"."===a)throw j.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===o.length&&o.push(".");break;case"":o=[""];break;default:o.push(s)}}return t.host+o.join("/")},V.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},V.resolveExtname=function(t){for(var e=t.length-1;0<=e;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""},V.makeNodeModulePaths=function(t){var e=V.splitPath(t),i=e.host;"/"===(t=e.path)[t.length-1]&&(t=t.slice(0,t.length-1));for(var r,o=t.split("/"),n=0<(t=o.indexOf("node_modules"))?t-1:0,s=[],a=o.length-1;n<=a;--a){"node_modules"!==o[a]&&((r=o.slice(0,a+1)).push("node_modules"),r=r.join("/"),s.push(i+r))}return s},V.addExtname=function(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)},V.splitPath=function(t){var e="",i=t.indexOf("//");return 0<=i?t=0<=(i=t.indexOf("/",i+2))?(e=t.slice(0,i),t.slice(i)):(e=t,"/"):e="",{host:e,path:t}},(z=(z=Y=Y||{}).FontFamily||(z.FontFamily={}))[z.SansSerif=0]="SansSerif",z[z.Serif=1]="Serif",z[z.Monospace=2]="Monospace",function(r){var i;(t=i=r.TextBaseline||(r.TextBaseline={}))[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Alphabetic=2]="Alphabetic",t[t.Bottom=3]="Bottom";var o,t=(o=r.E,K(e,o),e.prototype.renderSelf=function(t,e){if(this.text){var i;switch(this.textAlign){case r.TextAlign.Right:i=this.width;break;case r.TextAlign.Center:i=this.width/2;break;default:i=0}t.drawSystemText(this.text,i,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},e);function e(t){var e=o.call(this,t)||this;return e.text=t.text,e.fontSize=t.fontSize,e.textAlign="textAlign"in t?t.textAlign:r.TextAlign.Left,e.textBaseline="textBaseline"in t?t.textBaseline:i.Alphabetic,e.maxWidth=t.maxWidth,e.textColor="textColor"in t?t.textColor:"black",e.fontFamily="fontFamily"in t?t.fontFamily:r.FontFamily.SansSerif,e.strokeWidth="strokeWidth"in t?t.strokeWidth:0,e.strokeColor="strokeColor"in t?t.strokeColor:"black",e.strokeOnly="strokeOnly"in t&&t.strokeOnly,e}r.SystemLabel=t}(Y=Y||{}),(t=(t=Y=Y||{}).TextAlign||(t.TextAlign={}))[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",(z=(z=Y=Y||{}).TickGenerationMode||(z.TickGenerationMode={}))[z.ByClock=0]="ByClock",z[z.Manual=1]="Manual",t=Y=Y||{},Pt.deserialize=function(t){var e=new Pt(0);return e._state0U=t._state0U,e._state0L=t._state0L,e._state1U=t._state1U,e._state1L=t._state1L,e},Pt.prototype.initState=function(t){var e=1812433253;t=e*(t^t>>30)+1,t=e*((this._state0U=t)^t>>30)+2,t=e*((this._state0L=t)^t>>30)+3,t=e*((this._state1U=t)^t>>30)+4,this._state1L=t},Pt.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L,o=0,n=0;o=(t^=o=t<<23|(-512&e)>>>9)^(this._state0U=i),n=(e^=n=e<<23)^(this._state0L=r);o^=t>>>17,n^=e>>>17|(131071&t)<<15;o^=i>>>26,n^=r>>>26|(67108863&i)<<6,this._state1U=o;r=((this._state1L=n)>>>0)+(r>>>0);return[o+i+(r/2>>>31)>>>0,r>>>0]},Pt.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},Pt.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},Pt.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},z=Pt,t.Xorshift=z,q=Y=Y||{},X=q.RandomGenerator,K(kt,X),kt.deserialize=function(t){return new kt(t._seed,t._xorshift)},kt.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},kt.prototype.generate=function(){return this._xorshift.random()},kt.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},z=kt,q.XorshiftRandomGenerator=z,(Y||(Y={})).ShaderProgram=function(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms},Rt.exports=Y}).call(this)},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],4:[function(t,e,i){e.exports=t("./lib/index")},{"./lib/index":27}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Clock=void 0;var r=t("@akashic/akashic-engine"),t=(o.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},o.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},o.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},o.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;for(var t=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,r=t,o={deltaTime:e,interrupt:!1};0<r&&this.running&&!o.interrupt;)--r,this.frameTrigger.fire(o),o.deltaTime=0;return i-=(t-r)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=i,this._waitTime-i},o.prototype._updateWaitTimes=function(t,e){t*=e;this._waitTime=1e3/t,this._waitTimeDoubled=Math.max(2e3/t|0,1),this._waitTimeMax=Math.max(e*(1e3*this._maxFramePerOnce/t)|0,1),this._skipFrameWaitTime=this._waitTime*o.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*e},o.ANTICIPATE_RATE=.8,o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,o);function o(t){this.fps=t.fps,this.scaleFactor=t.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=t.platform,this._maxFramePerOnce=t.maxFramePerOnce,this._deltaTimeBrokenThreshold=t.deltaTimeBrokenThreshold||o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,t.frameHandler&&this.frameTrigger.add(t.frameHandler,t.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}i.Clock=t},{"@akashic/akashic-engine":1}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventBuffer=void 0;t("@akashic/akashic-pdi");var r=t("@akashic/akashic-engine"),o=t("./PointEventResolver"),t=(a.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError("EventBuffer.isEventLocal")}},a.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=3&t.defaultEventPriority)},a.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},a.prototype.onEvent=function(t){a.isEventLocal(t)?this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(t):(this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(t),this._isSender&&(null==t[1]&&(t[1]=this._defaultEventPriority),this._amflow.sendEvent(t)))},a.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},a.prototype.addEventDirect=function(t){if(a.isEventLocal(t))return!this._isLocalReceiver||this._isDiscarder?void 0:void this._localBuffer.push(t);this._isReceiver&&!this._isDiscarder&&(0===t[0]||1===t[0]?this._joinLeaveBuffer:this._buffer).push(t),this._isSender&&(null==t[1]&&(t[1]=this._defaultEventPriority),this._amflow.sendEvent(t))},a.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},a.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},a.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},a.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},a.prototype.removeFilter=function(t){if(this._filters)if(t)for(var e=this._filters.length-1;0<=e;--e)this._filters[e].func===t&&this._filters.splice(e,1);else this._filters=null},a.prototype.processEvents=function(t){var e=this._unfilteredLocalEvents,i=this._unfilteredEvents;this._unfilteredLocalEvents=[];var r=e;if(!t&&0<i.length&&(r=0<r.length?r.concat(i):i,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var n=this._filters[o];(0<r.length||n.handleEmpty)&&(r=this._filters[o].func(r)||[])}for(o=0;o<r.length;++o){var s=r[o];(a.isEventLocal(s)?this._localBuffer:0===s[0]||1===s[0]?this._joinLeaveBuffer:this._buffer).push(s)}},a);function a(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new o.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}i.EventBuffer=t},{"./PointEventResolver":17,"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventConverter=void 0;var _=t("@akashic/akashic-engine"),t=(r.prototype.toGameEvent=function(t){var e,i,r,o,n,s,a=t[0],h=t[1],c=t[2],u=this._playerTable[c]||{id:c};switch(a){case 0:u={id:c,name:t[3]},this._playerTable[c]=u;var l,d,p=void 0;return t[4]&&(l=[],d=[],t[4].map(function(t){l.push(t.readKey),d.push(t.values)}),p=new _.StorageValueStore(l,d)),new _.JoinEvent(u,p,h);case 1:return delete this._playerTable[u.id],new _.LeaveEvent(u,h);case 2:return p=t[3],new _.TimestampEvent(p,u,h);case 32:return s=t[4],new _.MessageEvent(t[3],u,s,h);case 33:return s=t[7],e=t[3],r=null==(i=t[6])?void 0:(0<=i?this._game.db:this._game._localDb)[i],o={x:t[4],y:t[5]},new _.PointDownEvent(e,r,o,u,s,h);case 34:return s=t[11],e=t[3],r=null==(i=t[10])?void 0:(0<=i?this._game.db:this._game._localDb)[i],o={x:t[4],y:t[5]},f={x:t[6],y:t[7]},n={x:t[8],y:t[9]},new _.PointMoveEvent(e,r,o,n,f,u,s,h);case 35:return s=t[11],e=t[3],r=null==(i=t[10])?void 0:(0<=i?this._game.db:this._game._localDb)[i],o={x:t[4],y:t[5]},f={x:t[6],y:t[7]},n={x:t[8],y:t[9]},new _.PointUpEvent(e,r,o,n,f,u,s,h);case 64:s=t[5];var f=t[3],t=t[4],t=this._game._decodeOperationPluginOperation(f,t);return new _.OperationEvent(f,t,u,s,h);default:throw _.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},r.prototype.toPlaylogEvent=function(t,e){var i=t.priority;switch(t.type){case _.EventType.Join:case _.EventType.Leave:throw _.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+_.EventType[t.type]);case _.EventType.Timestamp:return[2,i,(e?t:this._game).player.id,t.timestamp];case _.EventType.PointDown:var r=t.target?t.target.id:null;return[33,i,(e?t:this._game).player.id,t.pointerId,t.point.x,t.point.y,r,!!t.local];case _.EventType.PointMove:return r=t.target?t.target.id:null,[34,i,(e?t:this._game).player.id,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,r,!!t.local];case _.EventType.PointUp:return r=t.target?t.target.id:null,[35,i,(e?t:this._game).player.id,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,r,!!t.local];case _.EventType.Message:return[32,i,(e?t:this._game).player.id,t.data,!!t.local];case _.EventType.Operation:return[64,i,(e?t:this._game).player.id,t.code,t.data,!!t.local];default:throw _.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},r.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?3&t.priority:0,e,t._code,t.data,!!t.local]},r);function r(t){this._game=t.game,this._playerTable={}}i.EventConverter=t},{"@akashic/akashic-engine":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.Active=0]="Active",o[o.Passive=1]="Passive",i.default=r},{}],10:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.Game=void 0;var n,s=t("@akashic/akashic-engine"),o=(n=s.Game,o(a,n),a.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},a.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},a.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},a.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},a.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},a.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},a.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},a.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},a.prototype.getIsSkipAware=function(){return this._isSkipAware},a.prototype.setIsSkipAware=function(t){this._isSkipAware=t},a.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},a.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},a.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==s.TickGenerationMode.Manual)throw s.ExceptionFactory.createAssertionError("Game#raiseTick(): tickGenerationMode for the current scene is not Manual.");this.raiseTickTrigger.fire(t)},a.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},a.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},a.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},a.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},a.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},a.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,n.prototype._destroy.call(this)},a.prototype._restartWithSnapshot=function(t){var e,i=t.data;this._eventFilterFuncs.removeFilter(),null!=i.seed?(e=new s.XorshiftRandomGenerator(i.seed),this._reset({age:t.frame,randGen:e}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})):(e=new s.XorshiftRandomGenerator(0,i.randGenSer),this._reset({age:t.frame,randGen:e}),this._loadAndStart({snapshot:i.gameSnapshot}))},a.prototype._leaveGame=function(){},a.prototype._abortGame=function(){this.abortTrigger.fire()},a.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},a.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},a);function a(t){var e=n.call(this,t.configuration,t.resourceFactory,t.assetBase,t.player.id,t.operationPluginViewInfo)||this;return e.agePassedTrigger=new s.Trigger,e.targetTimeReachedTrigger=new s.Trigger,e.skippingChangedTrigger=new s.Trigger,e.abortTrigger=new s.Trigger,e.player=t.player,e.raiseEventTrigger=new s.Trigger,e.raiseTickTrigger=new s.Trigger,e.snapshotTrigger=new s.Trigger,e.isSnapshotSaver=!!t.isSnapshotSaver,e._getCurrentTimeFunc=null,e._eventFilterFuncs=null,e._notifyPassedAgeTable={},e._notifiesTargetTimeReached=!1,e._isSkipAware=!1,e._gameArgs=t.gameArgs,e._globalGameArgs=t.globalGameArgs,e.skippingChangedTrigger.add(e._onSkippingChanged,e),e}i.Game=o},{"@akashic/akashic-engine":1}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameDriver=void 0;var s=t("es6-promise"),l=t("@akashic/akashic-engine"),d=t("./ExecutionMode"),p=t("./Game"),f=t("./EventBuffer"),_=t("./GameLoop"),r=t("./PdiUtil"),o="GAME_DESTROYED",t=(n.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},n.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){t?e(t):(r&&i._gameLoop.start(),e())})},n.prototype.startGame=function(){this._gameLoop?this._gameLoop.start():this.errorTrigger.fire(new Error("Not initialized"))},n.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},n.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},n.prototype.getPermission=function(){return this._permission},n.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},n.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},n.prototype.getHidden=function(){return this._hidden},n.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,o=this._platform,n=o.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==n.renderer()}),o.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(o.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},n.prototype.doInitialize=function(i){var r=this,t=new s.Promise(function(t,e){if(r._gameLoop&&r._gameLoop.running)return e(new Error("Game is running. Must be stopped."));r._gameLoop&&i.loopConfiguration&&r._gameLoop.setLoopConfiguration(i.loopConfiguration),null!=i.hidden&&(r._hidden=i.hidden,r._game&&r._game._setMuted(i.hidden)),t()}).then(function(){return r._assertLive(),r._doSetDriverConfiguration(i.driverConfiguration)});return i.configurationUrl?t.then(function(){return r._assertLive(),r._loadConfiguration(i.configurationUrl,i.assetBase,i.configurationBase)}).then(function(t){return r._assertLive(),r._createGame(t,r._player,i)}):t},n.prototype.destroy=function(){var i=this;return new s.Promise(function(t,e){i.stopGame(),i._game&&(i._game._destroy(),i._game=null),i.errorTrigger.destroy(),i.errorTrigger=null,i.configurationLoadedTrigger.destroy(),i.configurationLoadedTrigger=null,i.gameCreatedTrigger.destroy(),i.gameCreatedTrigger=null,i._platform.destroy?i._platform.destroy():i._platform.setRendererRequirement(void 0),i._platform=null,i._loadConfigurationFunc=null,i._player=null,i._rendererRequirement=null,i._playId=null,i._gameLoop=null,i._eventBuffer=null,i._openedAmflow=!1,i._playToken=null,i._permission=null,i._hidden=!1,i._destroyed=!0,t()})},n.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return s.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===d.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===d.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=s.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)})),i.then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=3&e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},n.prototype._doCloseAmflow=function(){var r=this;return new s.Promise(function(e,i){if(!r._openedAmflow)return e();r._platform.amflow.close(function(t){r._openedAmflow=!1;t=r._getCallbackError(t);if(t)return i(t);e()})})},n.prototype._doOpenAmflow=function(r){var o=this;return void 0===r?s.Promise.resolve():this._doCloseAmflow().then(function(){return o._assertLive(),new s.Promise(function(e,i){if(null===r)return e();o._platform.amflow.open(r,function(t){t=o._getCallbackError(t);if(t)return i(t);o._openedAmflow=!0,o._playId=r,o._game&&o._updateGamePlayId(o._game),e()})})})},n.prototype._doAuthenticate=function(o){var n=this;return null==o?s.Promise.resolve():new s.Promise(function(i,r){n._platform.amflow.authenticate(o,function(t,e){t=n._getCallbackError(t);if(t)return r(t);n._playToken=o,n._permission=e,n._game&&(n._game.isSnapshotSaver=n._permission.writeTick),i()})})},n.prototype._loadConfiguration=function(t,e,o){var n=this;return new s.Promise(function(i,r){n._loadConfigurationFunc(t,e,o,function(t,e){t=n._getCallbackError(t);if(t)return r(t);n.configurationLoadedTrigger.fire(e),i(e)})})},n.prototype._putZerothStartPoint=function(r){var o=this;return new s.Promise(function(e,i){var t={frame:0,timestamp:r.startedAt,data:r};o._platform.amflow.putStartPoint(t,function(t){t=o._getCallbackError(t);if(t)return i(t);e()})})},n.prototype._getZerothStartPointData=function(){var o=this;return new s.Promise(function(i,r){o._platform.amflow.getStartPoint({frame:0},function(t,e){t=o._getCallbackError(t);if(t)return r(t);e=e.data;if("number"!=typeof e.seed)return r(new Error("GameDriver#_getRandomSeed: No seed found."));i(e)})})},n.prototype._createGame=function(a,h,c){var u=this,t=c.driverConfiguration.executionMode===d.default.Active&&this._permission.writeTick?this._putZerothStartPoint({seed:Date.now(),globalArgs:c.globalGameArgs,fps:a.fps,startedAt:Date.now()}):s.Promise.resolve();return(t=t.then(function(){return u._assertLive(),u._getZerothStartPointData()})).then(function(t){u._assertLive();var e=u._platform,i=c.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:d.default.Active},r=t.seed,o=c.gameArgs,n=t.globalArgs,s=t.startedAt,t={primarySurfaceWidth:a.width,primarySurfaceHeight:a.height,rendererCandidates:a.renderers};e.setRendererRequirement(t);o=new p.Game({configuration:a,player:h,resourceFactory:e.getResourceFactory(),assetBase:c.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:e.getOperationPluginViewInfo?e.getOperationPluginViewInfo():null,gameArgs:o,globalGameArgs:n}),n=new f.EventBuffer({game:o,amflow:e.amflow});n.setMode(i.eventBufferMode),e.setPlatformEventHandler(n),o.setEventFilterFuncs({addFilter:n.addFilter.bind(n),removeFilter:n.removeFilter.bind(n)}),o.renderers.push(e.getPrimarySurface().renderer());s=new _.GameLoop({game:o,amflow:e.amflow,platform:e,executionMode:i.executionMode,eventBuffer:n,configuration:c.loopConfiguration,startedAt:s,profiler:c.profiler});s.rawTargetTimeReachedTrigger.add(o._onRawTargetTimeReached,o),o.setCurrentTimeFunc(s.getCurrentTime.bind(s)),o._reset({age:0,randGen:new l.XorshiftRandomGenerator(r)}),u._updateGamePlayId(o),u._hidden&&o._setMuted(!0),o.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){t=u._getCallbackError(t);t&&u.errorTrigger.fire(t)})}),u._game=o,u._eventBuffer=n,u._gameLoop=s,u._rendererRequirement=t,u.gameCreatedTrigger.fire(o),u._game._loadAndStart({args:c.gameArgs||void 0})})},n.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},n.prototype._assertLive=function(){if(this._destroyed)throw new Error(o)},n.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(o):null)},n);function n(t){this.errorTrigger=new l.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new l.Trigger,this.gameCreatedTrigger=new l.Trigger,this._platform=t.platform,this._loadConfigurationFunc=r.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}i.GameDriver=t},{"./EventBuffer":6,"./ExecutionMode":9,"./Game":10,"./GameLoop":12,"./PdiUtil":16,"@akashic/akashic-engine":1,"es6-promise":83}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameLoop=void 0;var _=t("@akashic/akashic-engine"),r=t("./constants"),g=t("./LoopMode"),o=t("./LoopRenderMode"),n=t("./ExecutionMode"),s=t("./Clock"),a=t("./ProfilerClock"),h=t("./EventConverter"),c=t("./TickController"),t=(u.prototype.start=function(){this.running=!0,this._clock.start()},u.prototype.stop=function(){this._clock.stop(),this.running=!1},u.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},u.prototype.getExecutionMode=function(){return this._executionMode},u.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},u.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},u.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},u.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},u.prototype.getCurrentTime=function(){return this._currentTime},u.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},u.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},u.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},u.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:_.LocalTickMode.FullLocal,t=t?t.tickGenerationMode:_.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==t)switch(this._sceneLocalMode=e,this._sceneTickMode=t,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case _.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case _.LocalTickMode.NonLocal:case _.LocalTickMode.InterpolateLocal:t===_.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+e))}},u.prototype._onLocalFrame=function(){this._doLocalTick()},u.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var o=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,o&&this._handleSceneChange()},u.prototype._onFrame=function(t){var e,i,r;this._loopMode===g.default.Replay&&this._targetTimeFunc?(i=(e=this._targetTimeFunc())+this._realTargetTimeOffset,r=this._currentTime,this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)):this._onFrameNormal(t)},u.prototype._onFrameForTimedReplay=function(t,e){var i=!1,r=this._game,o=(t-this._currentTime)/this._frameTime;if((o>this._jumpTryThreshold||o<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),o<=0)this._skipping&&this._stopSkipping();else{this._skipping||(o>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var n=0;n<this._skipTicksAtOnce;++n){var s=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),s<t&&this._doLocalTick());break}var a=this._tickBuffer.readNextTickTime();if(null==a&&(a=s),t<s){if(!(a<=t))break;s=t}else if(s<a){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=a){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}s=a,this._omittedTickDuration+=a-this._currentTime}this._currentTime=s;var a=this._tickBuffer.consume(),s=-1,h=this._eventBuffer.readLocalEvents();if(h)for(var c=0,u=h.length;c<u;++c)r.events.push(this._eventConverter.toGameEvent(h[c]));if("number"==typeof a)s=a,i=r.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{s=a[0];var l=a[1];if(l)for(c=0,u=l.length;c<u;++c)r.events.push(this._eventConverter.toGameEvent(l[c]));i=r.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,r._notifyPassedAgeTable[s]&&r.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()}},u.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&this._doLocalTick();else{var r,o=this._tickBuffer.currentAge,n=this._loopMode===g.default.Realtime?(r=this._tickBuffer.knownLatestAge+1)-o:null===this._targetAge?(r=null,1):this._targetAge===o?(r=this._targetAge=null,1):(r=this._targetAge)-o;if((n>this._jumpTryThreshold||n<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<o&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=r,this._amflow.getStartPoint({frame:r},this._onGotStartPoint_bound)),n<=0)return 0===n&&(0===o&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(n>this._skipThreshold||0===o)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var s=!this._skipping&&n<=this._delayIgnoreThreshold?1:Math.min(n,this._skipTicksAtOnce),a=0;a<s;++a){var h=this._currentTime+this._frameTime,c=this._tickBuffer.readNextTickTime();if(null!=c&&h<c){if(!(this._loopMode===g.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode!==_.LocalTickMode.InterpolateLocal)break;this._doLocalTick();continue}h=Math.ceil(c/this._frameTime)*this._frameTime,this._omittedTickDuration+=h-this._currentTime}this._currentTime=h;c=this._tickBuffer.consume(),h=-1;if(null==c){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var u=this._eventBuffer.readLocalEvents();if(u)for(var l=0,d=u.length;l<d;++l)i.events.push(this._eventConverter.toGameEvent(u[l]));if("number"==typeof c)h=c,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{h=c[0];var p=c[1];if(p)for(var f=0,d=p.length;f<d;++f)i.events.push(this._eventConverter.toGameEvent(p[f]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[h]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&r-this._tickBuffer.currentAge<1&&this._stopSkipping()}},u.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==g.default.FrameByFrame&&this._stopWaitingNextTick()},u.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},u.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)this.errorTrigger.fire(t);else{if(this._targetTimeFunc&&this._loopMode!==g.default.Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(r<=i&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{i=this._loopMode===g.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===i||i<e.frame)return;r=this._tickBuffer.currentAge;if(r<=i&&e.frame<r+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()}},u.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},u.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===_.LocalTickMode.FullLocal)},u.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t){case o.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case o.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+t))}},u.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&0<t.scenes.length&&t.render()},u.prototype._onGameRaiseEvent=function(t){t=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(t)},u.prototype._onGameRaiseTick=function(t){if(this._executionMode===n.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},u.prototype._onGameOperationPluginOperated=function(t){t=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(t)},u.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},u.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},u.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},u);function u(t){this.errorTrigger=new _.Trigger,this.rawTargetTimeReachedTrigger=new _.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||r.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||r.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||r.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||r.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||r.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||r.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:o.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new a.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new s.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new c.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new h.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}i.GameLoop=t},{"./Clock":5,"./EventConverter":7,"./ExecutionMode":9,"./LoopMode":14,"./LoopRenderMode":15,"./ProfilerClock":18,"./TickController":21,"./constants":26,"@akashic/akashic-engine":1}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.JoinResolver=i.JoinLeaveRequest=void 0;var r=t("@akashic/akashic-engine"),o=(n.prototype._onGotStorageData=function(t,e){this.resolved=!0,t?this.joinResolver.errorTrigger.fire(t):this.pev[4]=e},n);function n(t,e,i,r){this.joinResolver=e,0===(this.pev=t)[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}i.JoinLeaveRequest=o;s.prototype.request=function(t){this._requested.push(new o(t,this,this._amflow,this._keysForJoin))},s.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},s.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t=s;function s(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}i.JoinResolver=t},{"@akashic/akashic-engine":1}],14:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.Realtime=0]="Realtime",o[o.Replay=1]="Replay",o[o.FrameByFrame=2]="FrameByFrame",i.default=r},{}],15:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.AfterRawFrame=0]="AfterRawFrame",o[o.None=1]="None",i.default=r},{}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PdiUtil=void 0;var a,h=t("es6-promise"),c=t("@akashic/akashic-engine");(a=i.PdiUtil||(i.PdiUtil={})).makeLoadConfigurationFunc=function(t){function n(i,r,o,n){t.loadGameConfiguration(i,function(t,e){if(t)n(t,null);else{try{e=a._resolveConfigurationBasePath(e,null!=r?r:c.PathUtil.resolveDirname(i))}catch(t){return void n(t,null)}e.definitions?(t=e.definitions.map(function(t){return"string"!=typeof t?s(null!=o?c.PathUtil.resolvePath(o,t.url):t.url,t.basePath,o):s(null!=o?c.PathUtil.resolvePath(o,t):t,void 0,o)}),h.Promise.all(t).then(function(t){return n(null,t.reduce(a._mergeGameConfiguration))}).catch(function(t){return n(t,null)})):n(null,e)}})}function s(t,e,o){return new h.Promise(function(i,r){n(t,e,o,function(t,e){t?r(t):i(e)})})}return n},a._resolveConfigurationBasePath=function(t,e){function i(t,e){var i=c.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw c.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: invalid path: "+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&"path"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw c.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: asset ID already exists: "+t);r[t]={type:/\.json$/i.test(t)?"text":"script",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t},a._mergeObject=function(t,e){for(var i=Object.keys(e),r=0,o=i.length;r<o;++r){var n=i[r],s=e[n];if(typeof s==typeof t[n])switch(typeof s){case"string":case"number":case"boolean":t[n]=s;break;case"object":null==s?t[n]=s:Array.isArray(s)?t[n]=t[n].concat(s):a._mergeObject(t[n],s);break;default:throw new Error("PdiUtil._mergeObject(): unknown type")}else t[n]=s}return t},a._mergeGameConfiguration=function(t,e){return a._mergeObject(t,e)}},{"@akashic/akashic-engine":1,"es6-promise":83}],17:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PointEventResolver=void 0;var r=(o.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point||t.offset,o=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:o,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};o=[33,2,e.id,t.identifier,r.x,r.y,o];return i.local&&o.push(i.local),o},o.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},o={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,o);r=[34,2,e.id,t.identifier,i.point.x,i.point.y,o.x,o.y,r.x,r.y,i.targetId];return i.local&&r.push(i.local),r},o.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},o={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,o),delete this._pointEventMap[t.identifier];r=[35,2,e.id,t.identifier,i.point.x,i.point.y,o.x,o.y,r.x,r.y,i.targetId];return i.local&&r.push(i.local),r},o.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},o);function o(t){this._game=t.game,this._pointEventMap={}}i.PointEventResolver=r},{}],18:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.ProfilerClock=void 0;var n,t=t("./Clock"),o=(n=t.Clock,o(s,n),s.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;this._profiler.timeEnd(1),this._profiler.time(1);var t=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,r=t,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,r-1);0<r&&this.running&&!o.interrupt;)--r,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return i-=(t-r)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush(),this._waitTime-i},s);function s(t){var e=n.call(this,t)||this;return e._profiler=t.profiler,e}i.ProfilerClock=o},{"./Clock":5}],19:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.StorageResolver=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),t=(n.prototype.setExecutionMode=function(t){var e,i;this._executionMode!==t&&(this._executionMode=t,e=this._tickBuffer,i=this._tickGenerator,t===o.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this)))},n.prototype._onGotStorageOnTick=function(t){var e,i=t.age,r=t.storageData,o=this._unresolvedLoaders[i];o?(delete this._unresolvedLoaders[i],e=i,t=r.map(function(t){return t.values}),o._onLoaded(t,e)):this._unresolvedStorages[i]=r},n.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===o.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));i=this._unresolvedStorages[r];i?(delete this._unresolvedStorages[r],t=r,i=i.map(function(t){return t.values}),e._onLoaded(i,t)):this._unresolvedLoaders[r]=e},n.prototype._putStorage=function(t,e,i){this._executionMode===o.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},n.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},n.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},n);function n(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}i.StorageResolver=t},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],20:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickBuffer=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),t=(n.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},n.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},n.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},n.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},n.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},n.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),0<e.ticks.length&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},n.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t!==e.start)return this._dropUntil(this.currentAge),this.readNextTickTime();if(0===e.ticks.length)return null;e=e.ticks[0];if(e[0]!==t)return null;var i=e[1];if(!i)return null;for(var r=0;r<i.length;++r)if(2===i[r][0]){var o=i[r][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o}return null},n.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===o.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},n.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;0<=r;--r){if(e>=(o=this._tickRanges[r]).start)break}var o,n=this._tickRanges[r+1];r<0?this._tickRanges.unshift(this._createTickRangeFromTick(t)):e===(o=this._tickRanges[r]).end?(++o.end,t[1]&&o.ticks.push(t)):e>o.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t)),this._nearestAbsentAge===e&&(++this._nearestAbsentAge,n&&this._nearestAbsentAge===n.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},n.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],o=e,n=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);for(var s=0,a=this._tickRanges.length,s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var c,t=s;for(0<s&&(--s,c=this._tickRanges[s].end,e<c&&(e=c));s<a;++s){h=this._tickRanges[s];if(i<=h.end)break}if(s<a&&((c=this._tickRanges[s].start)<i&&(i=c)),i<=e)return{start:e,end:e,ticks:[]};r=r||[],o===e&&n===i||(r=r.filter(function(t){t=t[0];return e<=t&&t<i}));for(var u=0;u<r.length;++u){var l=r[u];l[2]&&this.gotStorageTrigger.fire({age:l[0],storageData:l[2]})}o={start:e,end:i,ticks:r},n=Math.max(0,s-t);return this._tickRanges.splice(t,n,o),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),o},n.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===o.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},n.prototype._onTicks=function(t,e){if(t)throw new Error;e?(t=this.currentAge===this._nearestAbsentAge,e=this.addTickList(e),t&&e.start<=this.currentAge&&this.currentAge<e.end&&this.gotNextTickTrigger.fire(),e.ticks.length||this.gotNoTickTrigger.fire()):this.gotNoTickTrigger.fire()},n.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},n.prototype._dropUntil=function(t){for(var e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},n.prototype._createTickRangeFromTick=function(t){var e=t[0],e={start:e,end:e+1,ticks:[]};return t[1]&&e.ticks.push(t),e},n.DEFAULT_PREFETCH_THRESHOLD=1800,n.DEFAULT_SIZE_REQUEST_ONCE=9e3,n);function n(t){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=t.amflow,this._prefetchThreshold=t.prefetchThreshold||n.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=t.sizeRequestOnce||n.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=t.executionMode,this._startedAt=t.startedAt||0,this._oldTimestampThreshold=null!=t.startedAt?t.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}i.TickBuffer=t},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickController=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),n=t("./TickBuffer"),s=t("./TickGenerator"),a=t("./StorageResolver"),t=(h.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},h.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},h.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},h.prototype.setNextAge=function(t){this._generator.setNextAge(t)},h.prototype.forceGenerateTick=function(){this._generator.forceNext()},h.prototype.getBuffer=function(){return this._buffer},h.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},h.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},h.prototype._stopTriggerOnTick=function(){this.stopTick()},h.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===o.default.Active;this._generator.startStopGenerate(t)},h.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},h);function h(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new n.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}i.TickController=t},{"./ExecutionMode":9,"./StorageResolver":19,"./TickBuffer":20,"./TickGenerator":22,"@akashic/akashic-engine":1}],22:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickGenerator=void 0;var r=t("@akashic/akashic-engine"),o=t("./JoinResolver"),t=(n.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);r=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,r])}},n.prototype.forceNext=function(){var t;this._waitingStorage?this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage.")):(t=this._generatingTick,this._generatingTick=!0,this.next(),this._generatingTick=t)},n.prototype.startStopGenerate=function(t){this._generatingTick=t},n.prototype.startTick=function(){this._generatingTick=!0},n.prototype.stopTick=function(){this._generatingTick=!1},n.prototype.setNextAge=function(t){this._waitingStorage?this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage.")):this._nextAge=t},n.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError("TickGenerator#requestStorageTick(): Unsupported: multiple storage request");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},n.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},n.prototype._onGotStorageData=function(t,e){this._waitingStorage=!1,t?this.errorTrigger.fire(t):(this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e}))},n);function n(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._eventBuffer=t.eventBuffer,this._joinResolver=new o.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}i.TickGenerator=t},{"./JoinResolver":13,"@akashic/akashic-engine":1}],23:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i._cloneDeep=i.MemoryAmflowClient=void 0;var r=(o.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},o.prototype.open=function(t,e){var i=this;setTimeout(function(){t===i._playId?e(null):e(new Error("MemoryAmflowClient#open: unknown playId"))},0)},o.prototype.close=function(t){setTimeout(function(){t(null)},0)},o.prototype.authenticate=function(t,e){setTimeout(function(){switch(t){case o.TOKEN_ACTIVE:e(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case o.TOKEN_PASSIVE:e(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:e(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},o.prototype.sendTick=function(e){if(e=n(e),this._tickList){if(this._tickList[0]<=e[0]&&e[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=e[0]}else this._tickList=[e[0],e[0],[]];(e[1]||e[2])&&(e[1]&&(e[1]=e[1].filter(function(t){return!(8&t[1])})),this._tickList[2].push(e)),this._tickHandlers.forEach(function(t){return t(e)})},o.prototype.onTick=function(t){this._tickHandlers.push(t)},o.prototype.offTick=function(e){this._tickHandlers=this._tickHandlers.filter(function(t){return t!==e})},o.prototype.sendEvent=function(e){e=n(e),0!==this._eventHandlers.length?this._eventHandlers.forEach(function(t){return t(e)}):this._events.push(e)},o.prototype.onEvent=function(t){var i=this;this._eventHandlers.push(t),0<this._events.length&&(this._events.forEach(function(e){i._eventHandlers.forEach(function(t){return t(e)})}),this._events=[])},o.prototype.offEvent=function(e){this._eventHandlers=this._eventHandlers.filter(function(t){return t!==e})},o.prototype.getTickList=function(t,e,i){if(this._tickList){if("number"!=typeof t||"number"!=typeof e||"function"!=typeof i){if("function"==typeof e)return void e(new Error("not implemented"));throw new Error("not implemented")}var r=Math.max(t,this._tickList[0]),o=Math.min(e,this._tickList[1]),e=this._tickList[2].filter(function(t){t=t[0];return r<=t&&t<=o}),n=[r,o,e];setTimeout(function(){return i(null,n)},0)}else setTimeout(function(){return i(null,null)},0)},o.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},o.prototype.getStartPoint=function(s,a){var h=this;setTimeout(function(){if(h._startPoints&&0!==h._startPoints.length){var t=0;if(null!=s.frame)for(var e=h._startPoints[0].frame,i=1;i<h._startPoints.length;++i){var r=h._startPoints[i].frame;r<=s.frame&&e<r&&(e=r,t=i)}else for(var o=h._startPoints[0].timestamp,i=1;i<h._startPoints.length;++i){var n=h._startPoints[i].timestamp;n<=s.timestamp&&o<n&&(o=n,t=i)}a(null,h._startPoints[t])}else a(new Error("no startpoint"))},0)},o.prototype.putStorageData=function(t,e,i,r){var o=this;setTimeout(function(){try{o._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},o.prototype.getStorageData=function(e,i){var r=this;setTimeout(function(){try{var t=r._getStorageDataSyncFunc(e);i(null,t)}catch(t){i(t)}},0)},o.prototype.dropAfter=function(e){var i,t;this._tickList&&(i=this._tickList[0],t=this._tickList[1],e<=i?(this._tickList=null,this._startPoints=[]):e<=t&&(this._tickList[1]=e-1,this._tickList[2]=this._tickList[2].filter(function(t){t=t[0];return i<=t&&t<=e-1}),this._startPoints=this._startPoints.filter(function(t){return t.frame<e})))},o.TOKEN_ACTIVE="mamfc-token:active",o.TOKEN_PASSIVE="mamfc-token:passive",o);function o(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}function n(i){return i&&"object"==typeof i?Array.isArray(i)?i.map(n):Object.keys(i).reduce(function(t,e){return t[e]=n(i[e]),t},{}):i}i.MemoryAmflowClient=r,i._cloneDeep=n},{}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ReplayAmflowProxy=void 0;var r=(o.prototype.dropAfter=function(e){var t,i,r;this._tickList&&(t=this._tickList[0],i=this._tickList[1],r=this._tickList[2],e<=t?(this._tickList=null,this._startPoints=[]):e<=i&&(this._tickList[1]=e-1,this._tickList[2]=this._sliceTicks(r,i,e-1),this._startPoints=this._startPoints.filter(function(t){return t.frame<e})))},o.prototype.open=function(t,e){this._amflow.open(t,e)},o.prototype.close=function(t){this._amflow.close(t)},o.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},o.prototype.sendTick=function(t){this._amflow.sendTick(t)},o.prototype.onTick=function(t){this._amflow.onTick(t)},o.prototype.offTick=function(t){this._amflow.offTick(t)},o.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},o.prototype.onEvent=function(t){this._amflow.onEvent(t)},o.prototype.offEvent=function(t){this._amflow.offEvent(t)},o.prototype.getTickList=function(t,e,o){var n=this;if("number"!=typeof t||"number"!=typeof e||"function"!=typeof o){if("function"==typeof e)return void e(new Error("not implemented"));throw new Error("not implemented")}var s,a,h,c,u,l=t,d=e;this._tickList?(s=this._tickList[0],a=this._tickList[1],h=this._tickList[2],u=s<=d&&d<=a,(c=s<=l&&l<=a)&&u?setTimeout(function(){o(null,[l,d,n._sliceTicks(h,l,d)])},0):this._amflow.getTickList(l,d,function(t,e){var i,r;t?o(t):e?c||u?c?(i=n._sliceTicks(h,l,d).concat(e[2]||[]),o(null,[l,e[1],i])):(i=(e[2]||[]).concat(n._sliceTicks(h,l,d)),o(null,[e[0],d,i])):d<s||a<l?o(null,e):(i=(i=e[2])?(r=n._sliceTicks(i,l,s-1),t=n._sliceTicks(i,a+1,d),r.concat(h,t)):h,o(null,[l,d,i])):o(null,c||u?c?[l,a,n._sliceTicks(h,l,d)]:[s,d,n._sliceTicks(h,l,d)]:d<s||a<l?e:[s,a,n._sliceTicks(h,l,d)])})):this._amflow.getTickList(l,d,o)},o.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},o.prototype.getStartPoint=function(t,i){var r=this,o=0;if(0<this._startPoints.length)if(null!=t.frame)for(var e=this._startPoints[0].frame,n=1;n<this._startPoints.length;++n){var s=this._startPoints[n].frame;s<=t.frame&&e<s&&(e=s,o=n)}else for(var a=this._startPoints[0].timestamp,n=1;n<this._startPoints.length;++n){var h=this._startPoints[n].timestamp;h<=t.timestamp&&a<h&&(a=h,o=n)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,e){t?i(t):c<e.frame?i(null,e):i(null,r._startPoints[o])}):setTimeout(function(){i(null,r._startPoints[o])},0)},o.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},o.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},o.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){t=t[0];return e<=t&&t<=i})},o);function o(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleProfiler=void 0;var r=t("@akashic/akashic-engine"),t=(o.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},o.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},o.prototype.flush=function(){var t=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=t),this._beforeFlushTime+this._interval<t&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=t),this._values[1].length>this._limit)for(var e in this._values)this._values.hasOwnProperty(e)&&(this._values[e]=this._values[e].slice(-o.BACKUP_MARGIN))},o.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},o.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},o.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},o.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,o=0,n=0,s=Number.MAX_VALUE,a=this._values[t].length-1;0<=a&&!(0<o&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;n<h&&(n=h),h<s&&(s=h),r+=h,++o}return{ave:r/o,max:n,min:s}},o.prototype._getCurrentTime=function(){return+new Date},o.DEFAULT_INTERVAL=1e3,o.DEFAULT_LIMIT=1e3,o.BACKUP_MARGIN=100,o);function o(t){this._interval=null!=t.interval?t.interval:o.DEFAULT_INTERVAL,null!=t.limit?this._limit=t.limit>=o.DEFAULT_LIMIT?t.limit:o.DEFAULT_LIMIT:this._limit=o.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,t.getValueHandler&&this._calculateProfilerValueTrigger.add(t.getValueHandler,t.getValueHandlerOwner),this._reset()}i.SimpleProfiler=t},{"@akashic/akashic-engine":1}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_POLLING_TICK_THRESHOLD=i.DEFAULT_JUMP_IGNORE_THRESHOLD=i.DEFAULT_JUMP_TRY_THRESHOLD=i.DEFAULT_SKIP_THRESHOLD=i.DEFAULT_SKIP_TICKS_AT_ONCE=i.DEFAULT_DELAY_IGNORE_THRESHOLD=void 0,i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleProfiler=i.MemoryAmflowClient=i.ReplayAmflowProxy=i.Game=i.GameDriver=i.ExecutionMode=i.LoopRenderMode=i.LoopMode=i.EventIndex=void 0,o(t("./constants"),i);o=t("./EventIndex");i.EventIndex=o;o=t("./LoopMode");i.LoopMode=o.default;o=t("./LoopRenderMode");i.LoopRenderMode=o.default;o=t("./ExecutionMode");i.ExecutionMode=o.default;var n=t("./GameDriver");Object.defineProperty(i,"GameDriver",{enumerable:!0,get:function(){return n.GameDriver}});var s=t("./Game");Object.defineProperty(i,"Game",{enumerable:!0,get:function(){return s.Game}});var a=t("./auxiliary/ReplayAmflowProxy");Object.defineProperty(i,"ReplayAmflowProxy",{enumerable:!0,get:function(){return a.ReplayAmflowProxy}});var h=t("./auxiliary/MemoryAmflowClient");Object.defineProperty(i,"MemoryAmflowClient",{enumerable:!0,get:function(){return h.MemoryAmflowClient}});var c=t("./auxiliary/SimpleProfiler");Object.defineProperty(i,"SimpleProfiler",{enumerable:!0,get:function(){return c.SimpleProfiler}})},{"./EventIndex":8,"./ExecutionMode":9,"./Game":10,"./GameDriver":11,"./LoopMode":14,"./LoopRenderMode":15,"./auxiliary/MemoryAmflowClient":23,"./auxiliary/ReplayAmflowProxy":24,"./auxiliary/SimpleProfiler":25,"./constants":26}],28:[function(t,e,i){e.exports=t("./lib/full/index")},{"./lib/full/index":63}],29:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioManager=void 0;var r=(o.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},o.prototype.removeAudioAsset=function(t){t=this.audioAssets.indexOf(t);-1===t&&this.audioAssets.splice(t,1)},o.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},o.prototype.getMasterVolume=function(){return this._masterVolume},o);function o(){this.audioAssets=[],this._masterVolume=1}i.AudioManager=r},{}],30:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ContainerController=void 0;var r=t("@akashic/akashic-engine"),o=t("./InputHandlerLayer"),t=(n.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},n.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},n.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},n.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},n.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},n.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},n.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,t=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new o.InputHandlerLayer({width:e,height:i,disablePreventDefault:t}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},n.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},n);function n(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}i.ContainerController=t},{"./InputHandlerLayer":31,"@akashic/akashic-engine":1}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandlerLayer=void 0;var r=t("@akashic/akashic-engine"),o=t("./handler/TouchHandler"),t=(n.prototype.enablePointerEvent=function(){var e=this;this._inputHandler=new o.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(t){e.pointEventTrigger.fire(t)}),this._inputHandler.start()},n.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},n.prototype.setOffset=function(t){t="position:relative; left:"+t.x+"px; top:"+t.y+"px";this._inputHandler.inputView.setAttribute("style",t)},n.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},n.prototype._createInputView=function(t,e){var i=document.createElement("div");return i.setAttribute("tabindex","1"),i.className="input-handler",i.setAttribute("style","display:inline-block; outline:none;"),i.style.width=t+"px",i.style.height=e+"px",i},n);function n(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}i.InputHandlerLayer=t},{"./handler/TouchHandler":62,"@akashic/akashic-engine":1}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Platform=void 0;var r=t("./RafLooper"),o=t("./ResourceFactory"),n=t("./ContainerController"),s=t("./plugin/AudioPluginManager"),a=t("./AudioManager"),h=t("./plugin/AudioPluginRegistry"),c=t("./asset/XHRTextAsset"),t=(u.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},u.prototype.loadGameConfiguration=function(t,i){var e=new c.XHRTextAsset("(game.json)",t);e._load({_onAssetLoad:function(t){i(null,JSON.parse(e.data))},_onAssetError:function(t,e){i(e,null)}})},u.prototype.getResourceFactory=function(){return this._resourceFactory},u.prototype.setRendererRequirement=function(t){t?(this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)):this.containerController&&this.containerController.unloadView()},u.prototype.getPrimarySurface=function(){return this.containerController.surface},u.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},u.prototype.createLooper=function(t){return new r.RafLooper(t)},u.prototype.sendToExternal=function(t,e){},u.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},u.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},u.prototype.notifyViewMoved=function(){},u.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},u.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},u.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},u);function u(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new o.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new n.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}i.Platform=t},{"./AudioManager":29,"./ContainerController":30,"./RafLooper":33,"./ResourceFactory":34,"./asset/XHRTextAsset":39,"./plugin/AudioPluginManager":64,"./plugin/AudioPluginRegistry":65}],33:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RafLooper=void 0;var r=(o.prototype.start=function(){var e=this,i=function(t){null!=e._timerId&&(e._timerId=requestAnimationFrame(i),e._fun(t-e._prev),e._prev=t)};this._timerId=requestAnimationFrame(function(t){e._timerId=requestAnimationFrame(i),e._fun(0),e._prev=t})},o.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},o);function o(t){this._fun=t,this._timerId=void 0,this._prev=0}i.RafLooper=r},{}],34:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.ResourceFactory=void 0;var n,s=t("@akashic/akashic-engine"),a=t("./asset/HTMLImageAsset"),h=t("./asset/HTMLVideoAsset"),c=t("./asset/XHRTextAsset"),u=t("./asset/XHRScriptAsset"),l=t("./canvas/GlyphFactory"),d=t("./canvas/shims/SurfaceFactory"),o=(n=s.ResourceFactory,o(p,n),p.prototype.createAudioAsset=function(t,e,i,r,o,n){n=this._audioPluginManager.getActivePlugin().createAsset(t,e,i,r,o,n);return n.onDestroyed&&(this._audioManager.registerAudioAsset(n),n.onDestroyed.add(this._onAudioAssetDestroyed,this)),n},p.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},p.prototype.createImageAsset=function(t,e,i,r){return new a.HTMLImageAsset(t,e,i,r)},p.prototype.createVideoAsset=function(t,e,i,r,o,n,s){return new h.HTMLVideoAsset(t,e,i,r,o,n,s)},p.prototype.createTextAsset=function(t,e){return new c.XHRTextAsset(t,e)},p.prototype.createScriptAsset=function(t,e){return new u.XHRScriptAsset(t,e)},p.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},p.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},p.prototype.createGlyphFactory=function(t,e,i,r,o,n,s,a){return new l.GlyphFactory(t,e,i,r,o,n,s,a)},p.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},p);function p(t){var e=n.call(this)||this;return e._audioPluginManager=t.audioPluginManager,e._audioManager=t.audioManager,e._platform=t.platform,e._surfaceFactory=new d.SurfaceFactory,e}i.ResourceFactory=o},{"./asset/HTMLImageAsset":35,"./asset/HTMLVideoAsset":36,"./asset/XHRScriptAsset":38,"./asset/XHRTextAsset":39,"./canvas/GlyphFactory":42,"./canvas/shims/SurfaceFactory":48,"@akashic/akashic-engine":1}],35:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLImageAsset=i.ImageAssetSurface=void 0;var n,s=t("@akashic/akashic-engine"),a=(n=s.Surface,o(h,n),h.prototype.renderer=function(){throw s.ExceptionFactory.createAssertionError("ImageAssetSurface cannot be rendered.")},h.prototype.isPlaying=function(){return!1},h);function h(t,e,i){return n.call(this,t,e,i)||this}i.ImageAssetSurface=a;var c,o=(c=s.ImageAsset,o(u,c),u.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,c.prototype.destroy.call(this)},u.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,s.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},u.prototype.asSurface=function(){if(!this.data)throw s.ExceptionFactory.createAssertionError("ImageAssetImpl#asSurface: not yet loaded.");return this._surface||(this._surface=new a(this.width,this.height,this.data),this._surface)},u);function u(t,e,i,r){r=c.call(this,t,e,i,r)||this;return r.data=void 0,r._surface=void 0,r}i.HTMLImageAsset=o},{"@akashic/akashic-engine":1}],36:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLVideoAsset=void 0;var n,s=t("@akashic/akashic-engine"),a=t("./HTMLVideoPlayer"),h=(n=s.Surface,o(c,n),c.prototype.renderer=function(){throw s.ExceptionFactory.createAssertionError("VideoAssetSurface cannot be rendered.")},c.prototype.isPlaying=function(){return!1},c);function c(t,e,i){return n.call(this,t,e,i,!0)||this}var u,o=(u=s.VideoAsset,o(l,u),l.prototype.inUse=function(){return!1},l.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},l.prototype.getPlayer=function(){return this._player},l.prototype.asSurface=function(){return this._surface},l);function l(t,e,i,r,o,n,s){s=u.call(this,t,e,i,r,o,n,s)||this;return s._player=new a.HTMLVideoPlayer,s._surface=new h(i,r,null),s}i.HTMLVideoAsset=o},{"./HTMLVideoPlayer":37,"@akashic/akashic-engine":1}],37:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLVideoPlayer=void 0;var n,t=t("@akashic/akashic-engine"),o=(n=t.VideoPlayer,o(s,n),s.prototype.play=function(t){},s.prototype.stop=function(){},s.prototype.changeVolume=function(t){},s);function s(t){t=n.call(this,t)||this;return t.isDummy=!0,t}i.HTMLVideoPlayer=o},{"@akashic/akashic-engine":1}],38:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.XHRScriptAsset=void 0;var n,s=t("@akashic/akashic-engine"),a=t("../utils/XHRLoader"),o=(n=s.ScriptAsset,o(h,n),h.prototype._load=function(i){var r=this;(new a.XHRLoader).get(this.path,function(t,e){t?i._onAssetError(r,t):(r.script=e+"\n",i._onAssetLoad(r))})},h.prototype.execute=function(t){return this._wrap()(t),t.module.exports},h.prototype._wrap=function(){return new Function("g",h.PRE_SCRIPT+this.script+h.POST_SCRIPT)},h.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",h.POST_SCRIPT="\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",h);function h(t,e){e=n.call(this,t,e)||this;return e.script=void 0,e}i.XHRScriptAsset=o},{"../utils/XHRLoader":82,"@akashic/akashic-engine":1}],39:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.XHRTextAsset=void 0;var n,s=t("@akashic/akashic-engine"),a=t("../utils/XHRLoader"),o=(n=s.TextAsset,o(h,n),h.prototype._load=function(i){var r=this;(new a.XHRLoader).get(this.path,function(t,e){t?i._onAssetError(r,t):(r.data=e,i._onAssetLoad(r))})},h);function h(t,e){e=n.call(this,t,e)||this;return e.data=void 0,e}i.XHRTextAsset=o},{"../utils/XHRLoader":82,"@akashic/akashic-engine":1}],40:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AffineTransformer=void 0;var r=(o.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},o.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},o.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],o=t[2]*e[0]+t[3]*e[2],n=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],t=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=o,e[3]=n,e[4]=s,e[5]=t,this},o.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},o.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},o);function o(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}i.AffineTransformer=r},{}],41:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasSurface=void 0;var n,t=t("@akashic/akashic-engine"),o=(n=t.Surface,o(s,n),s.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,n.prototype.destroy.call(this)},s.prototype.getHTMLElement=function(){return this.canvas},s.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},s);function s(t,e){var i=this,r=document.createElement("canvas"),i=n.call(this,t,e,r)||this;return r.width=t,r.height=e,i.canvas=r,i._renderer=void 0,i}i.CanvasSurface=o},{"@akashic/akashic-engine":1}],42:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.GlyphFactory=void 0;var g=t("@akashic/akashic-engine"),y=t("./context2d/Context2DSurface");function n(t,e,i,r,o,n,s,a,h,c,u,l){var d=e<m._environmentMinimumFontSize?e/m._environmentMinimumFontSize:1,p=Math.ceil((e+2*o)*d),f=Math.ceil((e+2*n)*d),_=new y.Context2DSurface(p,f),p=_.canvas,f=p.getContext("2d"),t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),l=l===g.FontWeight.Bold?"bold ":"";f.save(),f.font=l+e+"px "+i,f.textAlign="left",f.textBaseline="alphabetic",f.lineJoin="bevel",1!=d&&f.scale(d,d),0<h&&(f.lineWidth=h,f.strokeStyle=c,f.strokeText(t,o,n+r)),u||(f.fillStyle=a,f.fillText(t,o,n+r));t=f.measureText(t).width;return f.restore(),{surface:_,advanceWidth:t,imageData:s?f.getImageData(0,0,p.width,p.height):void 0}}function h(t){switch(t){case g.FontFamily.Monospace:return"monospace";case g.FontFamily.Serif:return"serif";default:return"sans-serif"}}var s=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function c(t){return-1!==s.indexOf(t)?t:'"'+t+'"'}var u,m=(u=g.GlyphFactory,o(l,u),l.prototype.create=function(t){var e,i,r=this._glyphAreas[t];return r||((r=function(t){for(var e=t.width,i=t.height,r=0,o=0,n=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0){0!==t.data[n+3]&&(h<e&&(e=h),r<h&&(r=h),s<i&&(i=s),o<s&&(o=s)),n+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:o-i+1}}((e=n(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)).imageData)).advanceWidth=e.advanceWidth,this._glyphAreas[t]=r),0===(i=r).width||0===i.height?(e&&e.surface.destroy(),new g.Glyph(t,0,0,0,0,0,0,r.advanceWidth,void 0,!0)):(e=e||n(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),new g.Glyph(t,r.x,r.y,r.width,r.height,r.x-this._marginW,r.y-this._marginH,r.advanceWidth,e.surface,!0))},l.prototype.measureMinimumFontSize=function(){var t,e=1,i=document.createElement("canvas").getContext("2d");i.textAlign="left",i.textBaseline="alphabetic",i.lineJoin="bevel",i.font=e+"px sans-serif";for(var r=i.measureText("M").width;t=r,e+=1,i.font=e+"px sans-serif",t===(r=i.measureText("M").width)||50<e;);return e},l);function l(t,e,i,r,o,n,s,a){a=u.call(this,t,e,i,r,o,n,s,a)||this;a._glyphAreas={},a._cssFontFamily="number"==typeof(t=t)?h(t):"string"==typeof t?c(t):t.map(function(t){return("string"==typeof t?c:h)(t)}).join(",");t=h(g.FontFamily.SansSerif);return-1===a._cssFontFamily.indexOf(t)&&(a._cssFontFamily+=","+t),a._marginW=Math.ceil(.3*a.fontSize+a.strokeWidth/2),a._marginH=Math.ceil(.3*a.fontSize+a.strokeWidth/2),void 0===l._environmentMinimumFontSize&&(l._environmentMinimumFontSize=a.measureMinimumFontSize()),a}i.GlyphFactory=m},{"./context2d/Context2DSurface":47,"@akashic/akashic-engine":1}],43:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RenderingHelper=void 0,(i=i.RenderingHelper||(i.RenderingHelper={})).toPowerOfTwo=function(t){if(0==(t&t-1))return t;for(var e=1;e<t;)e*=2;return e},i.clamp=function(t){return Math.min(Math.max(t,0),1)},i.usedWebGL=function(t){var e=!1;return t&&0<t.length&&(e="webgl"===t[0]),e}},{}],44:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasRenderingState=void 0;var r=t("../AffineTransformer"),t=function(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer)};i.CanvasRenderingState=t},{"../AffineTransformer":40}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasSurfaceContext=void 0;var r=t("./CanvasRenderingState"),t=(Object.defineProperty(o.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!1,configurable:!0}),o.prototype.getCanvasRenderingContext2D=function(){return this._context},o.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},o.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},o.prototype.restore=function(){this.popState()},o.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},o.prototype.drawImage=function(t,e,i,r,o,n,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,o,n,s,a,h)},o.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},o.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},o.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},o.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},o.prototype.transform=function(t,e,i,r,o,n){this.currentState().transformer.transform([t,e,i,r,o,n]),this._modifiedTransform=!0},o.prototype.setTransform=function(t,e,i,r,o,n){this.currentState().transformer.setTransform([t,e,i,r,o,n]),this._modifiedTransform=!0},o.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},o.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},o.prototype.putImageData=function(t,e,i,r,o,n,s){this._context.putImageData(t,e,i,r,o,n,s)},o.prototype.prerender=function(){var t=this.currentState();t.fillStyle!==this._currentFillStyle&&(this._context.fillStyle=t.fillStyle,this._currentFillStyle=t.fillStyle),t.globalAlpha!==this._currentGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._currentGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._currentGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._currentGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform&&(t=t.transformer,this._context.setTransform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this._modifiedTransform=!1)},o.prototype.pushState=function(t){this._stateStack.push(t)},o.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0)},o.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},o);function o(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;t=new r.CanvasRenderingState;this._currentFillStyle=t.fillStyle,this._currentGlobalAlpha=t.globalAlpha,this._currentGlobalCompositeOperation=t.globalCompositeOperation,this.pushState(t)}i.CanvasSurfaceContext=t},{"./CanvasRenderingState":44}],46:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.Context2DRenderer=void 0;var n,g=t("@akashic/akashic-engine"),o=(n=g.Renderer,o(s,n),s.prototype.begin=function(){n.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},s.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),n.prototype.end.call(this)},s.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},s.prototype.drawImage=function(t,e,i,r,o,n,s){this.context.drawImage(t._drawable,e,i,r,o,n,s,r,o)},s.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},s.prototype.drawSystemText=function(t,e,i,r,o,n,s,a,h,c,u,l){var d,p,f,_=this.canvasRenderingContext2D;switch(this.context.prerender(),_.save(),h){case g.FontFamily.Monospace:d="monospace";break;case g.FontFamily.Serif:d="serif";break;default:d="sans-serif"}switch(_.font=o+"px "+d,n){case g.TextAlign.Right:p="right";break;case g.TextAlign.Center:p="center";break;default:p="left"}switch(_.textAlign=p,s){case g.TextBaseline.Top:f="top";break;case g.TextBaseline.Middle:f="middle";break;case g.TextBaseline.Bottom:f="bottom";break;default:f="alphabetic"}_.textBaseline=f,_.lineJoin="bevel",0<c&&(_.lineWidth=c,_.strokeStyle=u,void 0===r?_.strokeText(t,e,i):_.strokeText(t,e,i,r)),l||(_.fillStyle=a,_.fillText(t,e,i,r)),_.restore()},s.prototype.translate=function(t,e){this.context.translate(t,e)},s.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},s.prototype.opacity=function(t){this.context.globalAlpha*=t},s.prototype.save=function(){this.context.save()},s.prototype.restore=function(){this.context.restore()},s.prototype.fillRect=function(t,e,i,r,o){this.context.fillStyle=o,this.context.fillRect(t,e,i,r)},s.prototype.setCompositeOperation=function(t){var e;switch(t){case g.CompositeOperation.SourceAtop:e="source-atop";break;case g.CompositeOperation.Lighter:e="lighter";break;case g.CompositeOperation.Copy:e="copy";break;case g.CompositeOperation.ExperimentalSourceIn:e="source-in";break;case g.CompositeOperation.ExperimentalSourceOut:e="source-out";break;case g.CompositeOperation.ExperimentalDestinationAtop:e="destination-atop";break;case g.CompositeOperation.ExperimentalDestinationIn:e="destination-in";break;case g.CompositeOperation.DestinationOut:e="destination-out";break;case g.CompositeOperation.DestinationOver:e="destination-over";break;case g.CompositeOperation.Xor:e="xor";break;default:e="source-over"}this.context.globalCompositeOperation=e},s.prototype.setOpacity=function(t){this.context.globalAlpha=t},s.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},s.prototype.setShaderProgram=function(t){throw g.ExceptionFactory.createAssertionError("Context2DRenderer#setShaderProgram() is not implemented")},s.prototype.isSupportedShaderProgram=function(){return!1},s.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},s.prototype._putImageData=function(t,e,i,r,o,n,s){void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,o,n,s)},s);function s(t){var e=n.call(this)||this;return e.surface=t,e.context=t.context(),e.canvasRenderingContext2D=e.context.getCanvasRenderingContext2D(),e}i.Context2DRenderer=o},{"@akashic/akashic-engine":1}],47:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.Context2DSurface=void 0;var n,s=t("./Context2DRenderer"),a=t("./CanvasSurfaceContext"),t=t("../CanvasSurface"),o=(n=t.CanvasSurface,o(h,n),h.prototype.context=function(){return this._context||(this._context=new a.CanvasSurfaceContext(this.canvas.getContext("2d"))),this._context},h.prototype.renderer=function(){return this._renderer||(this._renderer=new s.Context2DRenderer(this)),this._renderer},h.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},h.prototype.isPlaying=function(){return!1},h);function h(){return null!==n&&n.apply(this,arguments)||this}i.Context2DSurface=o},{"../CanvasSurface":41,"./CanvasSurfaceContext":45,"./Context2DRenderer":46}],48:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceFactory=void 0;var r=t("../RenderingHelper"),o=t("../context2d/Context2DSurface"),n=t("../webgl/WebGLSharedObject"),t=(s.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new n.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new o.Context2DSurface(t,e)},s.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new o.Context2DSurface(t,e)},s);function s(){}i.SurfaceFactory=t},{"../RenderingHelper":43,"../context2d/Context2DSurface":47,"../webgl/WebGLSharedObject":57}],49:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLBackSurface=void 0;var n,s=t("./WebGLBackSurfaceRenderer"),t=t("./WebGLPrimarySurface"),o=(n=t.WebGLPrimarySurface,o(a,n),a.prototype.renderer=function(){return this._renderer||(this._renderer=new s.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},a.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,n.prototype.destroy.call(this)},a);function a(){return null!==n&&n.apply(this,arguments)||this}i.WebGLBackSurface=o},{"./WebGLBackSurfaceRenderer":50,"./WebGLPrimarySurface":52}],50:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLBackSurfaceRenderer=void 0;var n,s=t("./WebGLRenderer"),a=t("./WebGLRenderingState"),o=(n=s.WebGLRenderer,o(h,n),h.prototype.begin=function(){n.prototype.begin.call(this),this.save();var t=new a.WebGLRenderingState(this.currentState()),e=t.transformer.matrix;e[1]*=-1,e[3]*=-1,e[5]=-e[5]+this._renderTarget.height,this.currentState().copyFrom(t),this._shared.pushRenderTarget(this._renderTarget)},h.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),n.prototype.end.call(this)},h);function h(t,e){e=n.call(this,e,e.createRenderTarget(t.width,t.height))||this;return t._drawable={texture:e._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:t.width,textureHeight:t.height},e}i.WebGLBackSurfaceRenderer=o},{"./WebGLRenderer":54,"./WebGLRenderingState":55}],51:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLColor=void 0;var r,o=t("../RenderingHelper");(r=i.WebGLColor||(i.WebGLColor={})).colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},r.get=function(t){return(t="string"==typeof t?r._toColor(t):[t[0],t[1],t[2],t[3]])[3]=o.RenderingHelper.clamp(t[3]),t[0]=o.RenderingHelper.clamp(t[0])*t[3],t[1]=o.RenderingHelper.clamp(t[1])*t[3],t[2]=o.RenderingHelper.clamp(t[2])*t[3],t},r._hsl2rgb=function(t){var e=t[0]%360,i=t[1],r=50<t[2]?100-t[2]:t[2],o=t[3],t=r+r*i,i=r-r*i;return e<60?[t,e/60*(t-i)+i,i,o]:e<120?[(120-e)/60*(t-i)+i,t,i,o]:e<180?[i,t,(e-120)/60*(t-i)+i,o]:e<240?[i,(240-e)/60*(t-i)+i,t,o]:e<300?[(e-240)/60*(t-i)+i,i,t,o]:[t,i,(360-e)/60*(t-i)+i,o]},r._toColor=function(t){var e=t.toUpperCase().replace(/\s+/g,"");if(t=r.colorMap[e])return t;if(e.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(e.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(e.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(e.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(e.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return r._hsl2rgb([parseInt(RegExp.$1,10),o.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),o.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(e.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return r._hsl2rgb([parseInt(RegExp.$1,10),o.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),o.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+e)}},{"../RenderingHelper":43}],52:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLPrimarySurface=void 0;var n,s=t("../CanvasSurface"),a=t("./WebGLPrimarySurfaceRenderer"),o=(n=s.CanvasSurface,o(h,n),h.prototype.renderer=function(){return this._renderer||(this._renderer=new a.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},h.prototype.changePhysicalScale=function(t,e){t=Math.ceil(this.width*t),e=Math.ceil(this.height*e);this.canvas.width=t,this.canvas.height=e,this.renderer().changeViewportSize(t,e)},h.prototype.isPlaying=function(){return!1},h);function h(t,e,i){i=n.call(this,e,i)||this;return i.canvas.style.position="absolute",i._shared=t,i}i.WebGLPrimarySurface=o},{"../CanvasSurface":41,"./WebGLPrimarySurfaceRenderer":53}],53:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLPrimarySurfaceRenderer=void 0;var n,t=t("./WebGLRenderer"),o=(n=t.WebGLRenderer,o(s,n),s.prototype.begin=function(){n.prototype.begin.call(this),this._shared.begin()},s);function s(t,e){e=n.call(this,t,e)||this;return e._shared.pushRenderTarget(e._renderTarget),e}i.WebGLPrimarySurfaceRenderer=o},{"./WebGLRenderer":54}],54:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRenderer=void 0;var n,a=t("@akashic/akashic-engine"),s=t("./WebGLColor"),h=t("./WebGLRenderingState"),o=(n=a.Renderer,o(c,n),c.prototype.clear=function(){this._shared.clear()},c.prototype.end=function(){this._shared.end()},c.prototype.save=function(){this._pushState()},c.prototype.restore=function(){this._popState()},c.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},c.prototype.transform=function(t){this.currentState().transformer.transform(t)},c.prototype.opacity=function(t){this.currentState().globalAlpha*=t},c.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},c.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},c.prototype.fillRect=function(t,e,i,r,o){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,s.WebGLColor.get(o))},c.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},c.prototype.drawImage=function(t,e,i,r,o,n,s){if(!t._drawable)throw a.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw a.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,n,s,this._whiteColor)},c.prototype.drawSystemText=function(t,e,i,r,o,n,s,a,h,c,u,l){},c.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},c.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},c.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},c.prototype.isSupportedShaderProgram=function(){return!0},c.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},c.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},c.prototype._getImageData=function(){throw a.ExceptionFactory.createAssertionError("WebGLRenderer#_getImageData() is not implemented")},c.prototype._putImageData=function(t,e,i,r,o,n,s){throw a.ExceptionFactory.createAssertionError("WebGLRenderer#_putImageData() is not implemented")},c.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},c.prototype._popState=function(){if(!(0<this._stateStackPointer))throw a.ExceptionFactory.createAssertionError("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},c.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},c.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new h.WebGLRenderingState)}},c.DEFAULT_CAPACITY=16,c);function c(t,e){var i=n.call(this)||this;return i._stateStack=[],i._stateStackPointer=0,i._capacity=0,i._reallocation(c.DEFAULT_CAPACITY),i._whiteColor=[1,1,1,1],i._shared=t,i._renderTarget=e,i}i.WebGLRenderer=o},{"./WebGLColor":51,"./WebGLRenderingState":55,"@akashic/akashic-engine":1}],55:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRenderingState=void 0;var r=t("@akashic/akashic-engine"),o=t("../AffineTransformer"),t=(n.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},n);function n(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new o.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new o.AffineTransformer,this.shaderProgram=null)}i.WebGLRenderingState=t},{"../AffineTransformer":40,"@akashic/akashic-engine":1}],56:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLShaderProgram=void 0;var a=t("@akashic/akashic-engine"),t=(o._makeShader=function(t,e,i){e=t.createShader(e);if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;i=t.getShaderInfoLog(e);throw t.deleteShader(e),new Error(i)},o._makeShaderProgram=function(t,e,i){var r=t.createProgram(),e=o._makeShader(t,t.VERTEX_SHADER,e);t.attachShader(r,e),t.deleteShader(e);i=o._makeShader(t,t.FRAGMENT_SHADER,i);if(t.attachShader(r,i),t.deleteShader(i),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS))return r;i=t.getProgramInfoLog(r);throw t.deleteProgram(r),new Error(i)},o.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},o.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},o.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},o.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},o.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;!e.isArray&&i===e.beforeValue||(e.update(e.loc,i),e.beforeValue=i)}},o.prototype.initializeUniforms=function(){var o=this,n=[],s=this._uniforms;null!=s&&Object.keys(s).forEach(function(t){var e=s[t].type,i=!("number"==typeof s[t].value);!i||"int"!==e&&"float"!==e||(e+="_v");var r=o._uniformSetterTable[e];if(!r)throw a.ExceptionFactory.createAssertionError("WebGLShaderProgram#initializeUniforms: Uniform type '"+e+"' is not supported.");n.push({name:t,update:r,beforeValue:null,isArray:i,loc:o._context.getUniformLocation(o.program,t)})}),this._uniformCaches=n},o.prototype.use=function(){this._context.useProgram(this.program)},o.prototype.unuse=function(){this._context.useProgram(null)},o.prototype.destroy=function(){this._context.deleteProgram(this.program)},o.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},o.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},o.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},o.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},o.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},o.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},o.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},o.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},o.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},o.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},o.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},o.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},o.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},o._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",o._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",o);function o(t,e,i){var r=o._DEFAULT_VERTEX_SHADER,e=e||o._DEFAULT_FRAGMENT_SHADER,e=o._makeShaderProgram(t,r,e);this.program=e,this._context=t,this._aVertex=t.getAttribLocation(this.program,"aVertex"),this._uColor=t.getUniformLocation(this.program,"uColor"),this._uAlpha=t.getUniformLocation(this.program,"uAlpha"),this._uSampler=t.getUniformLocation(this.program,"uSampler"),this._uniforms=i,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}i.WebGLShaderProgram=t},{"@akashic/akashic-engine":1}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLSharedObject=void 0;var o=t("@akashic/akashic-engine"),r=t("./WebGLShaderProgram"),n=t("./WebGLTextureAtlas"),s=t("./WebGLPrimarySurface"),a=t("./WebGLBackSurface"),t=(h.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},h.prototype.getPrimarySurface=function(){return this._surface},h.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},h.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},h.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},h.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},h.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},h.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},h.prototype.draw=function(t,e,i,r,o,n,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit(),l=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==l&&(this._commit(),this._currentShaderProgram=l,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation&&(this._currentCompositeOperation=t.globalCompositeOperation,this._commit(),d=this._compositeOps[this._currentCompositeOperation],this._context.blendFunc(d[0],d[1]));var c=1/e.textureWidth,u=1/e.textureHeight,l=e.textureOffsetX,h=e.textureOffsetY,d=c*(l+i+o),e=u*(h+r+n),i=c*(l+i),r=u*(h+r);this._register(this._transformVertex(s,a,o,n,t.transformer),[i,r,d,r,d,e,i,r,d,e,i,e])},h.prototype.end=function(){if(this._commit(),0<this._deleteRequestedTargets.length){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},h.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},h.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},h.prototype.assignTexture=function(t,e,i,r){if(this._context.bindTexture(this._context.TEXTURE_2D,r),t instanceof HTMLVideoElement)throw o.ExceptionFactory.createAssertionError("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},h.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},h.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},h.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},h.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},h.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,o,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var n=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:o}},h.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},h.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},h.prototype.getContext=function(){return this._context},h.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},h.prototype.initializeShaderProgram=function(t){var e;return t&&(t._program||((e=new r.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms)).initializeUniforms(),t._program=e)),t},h.prototype._init=function(){var t=new r.WebGLShaderProgram(this._context);this._textureAtlas=new n.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=o.CompositeOperation.SourceOver,this._currentShaderProgram=t,this._defaultShaderProgram=t,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=((t={})[o.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[o.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[o.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[o.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[o.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[o.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[o.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[o.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[o.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[o.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[o.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);t=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(t[0],t[1])},h.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},h.prototype._transformVertex=function(t,e,i,r,o){var n=this.getCurrentRenderTarget(),s=2/n.width,a=-2/n.height,h=o.matrix,n=s*i*h[0],o=a*i*h[1],i=s*r*h[2],r=a*r*h[3],s=s*(t*h[0]+e*h[2]+h[4])-1,h=a*(t*h[1]+e*h[3]+h[5])+1;return[s,h,n+s,o+h,n+i+s,o+r+h,s,h,n+i+s,o+r+h,i+s,r+h]},h.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},h.prototype._commit=function(){0<this._numSprites&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},h);function h(t,e){t=new s.WebGLPrimarySurface(this,t,e),e=t.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!e)throw o.ExceptionFactory.createAssertionError("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=t,this._context=e,this._init()}i.WebGLSharedObject=t},{"./WebGLBackSurface":49,"./WebGLPrimarySurface":52,"./WebGLShaderProgram":56,"./WebGLTextureAtlas":58,"@akashic/akashic-engine":1}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLTextureAtlas=void 0;var n=t("./WebGLTextureMap"),s=t("../RenderingHelper"),t=(a.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},a.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},a.prototype.makeTextureForSurface=function(t,e){var i=e._drawable;if(i&&!i.texture){var r=i.width,o=i.height;if(a.TEXTURE_SIZE<=r||a.TEXTURE_SIZE<=o){var n=s.RenderingHelper.toPowerOfTwo(i.width),r=s.RenderingHelper.toPowerOfTwo(i.height);return n===i.width&&r===i.height||((o=document.createElement("canvas")).width=n,o.height=r,(o=o.getContext("2d")).globalCompositeOperation="copy",o.drawImage(i,0,0),i=o.getImageData(0,0,n,r)),e._drawable.texture=t.makeTexture(i),e._drawable.textureOffsetX=0,e._drawable.textureOffsetY=0,e._drawable.textureWidth=n,void(e._drawable.textureHeight=r)}this._assign(t,e,this._maps)}},a.prototype._assign=function(t,e,i){for(var r,o=0;o<i.length;++o)if(r=i[(o+this._insertPos)%i.length].insert(e))return this._register(t,r,e._drawable),void(this._insertPos=o);r=null,i.length>=a.TEXTURE_COUNT&&(r=i.shift(),t.disposeTexture(r.texture),r.dispose(),t.clearTexture(this.emptyTexturePixels,a.TEXTURE_SIZE,a.TEXTURE_SIZE,r.texture)),r=r||new n.WebGLTextureMap(t.makeTextureRaw(a.TEXTURE_SIZE,a.TEXTURE_SIZE),0,0,a.TEXTURE_SIZE,a.TEXTURE_SIZE),i.push(r),r=r.insert(e),this._register(t,r,e._drawable)},a.prototype._register=function(t,e,i){i.texture=e.texture,i.textureOffsetX=e.offsetX,i.textureOffsetY=e.offsetY,i.textureWidth=a.TEXTURE_SIZE,i.textureHeight=a.TEXTURE_SIZE,t.assignTexture(i,e.offsetX,e.offsetY,e.texture)},a.TEXTURE_SIZE=1024,a.TEXTURE_COUNT=16,a);function a(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(a.TEXTURE_SIZE*a.TEXTURE_SIZE*4)}i.WebGLTextureAtlas=t},{"../RenderingHelper":43,"./WebGLTextureMap":59}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLTextureMap=void 0;var r=(n.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},n.prototype.capacity=function(){return this._width*this._height},n.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,t=t.width*t.height;return this._left&&(t+=this._left.area()),this._right&&(t+=this._right.area()),t},n.prototype.occupancy=function(){return this.area()/this.capacity()},n.prototype.insert=function(t){var e=t._drawable,i=e.width+n.TEXTURE_MARGIN,e=e.height+n.TEXTURE_MARGIN;if(this._surface){if(this._left){var r=this._left.insert(t);if(r)return r}if(this._right){var o=this._right.insert(t);if(o)return o}return null}if(this._width<i||this._height<e)return null;r=this._width-i,o=this._height-e;return r<=o?(this._left=new n(this.texture,this.offsetX+i,this.offsetY,r,e),this._right=new n(this.texture,this.offsetX,this.offsetY+e,this._width,o)):(this._left=new n(this.texture,this.offsetX,this.offsetY+e,i,o),this._right=new n(this.texture,this.offsetX+i,this.offsetY,r,this._height)),this._surface=t,this},n.TEXTURE_MARGIN=1,n);function n(t,e,i,r,o){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=o}i.WebGLTextureMap=r},{}],60:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputAbstractHandler=void 0;var r=t("@akashic/akashic-engine"),t=(t("@akashic/akashic-pdi"),o.isSupported=function(){return!1},o.prototype.start=function(){throw new Error("This method is abstract")},o.prototype.stop=function(){throw new Error("This method is abstract")},o.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},o.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},o.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},o.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},o.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},o.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},o.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},o);function o(t,e){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===o.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=t,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!e,this.pointTrigger=new r.Trigger}i.InputAbstractHandler=t},{"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],61:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.MouseHandler=void 0;var n,t=t("./InputAbstractHandler"),o=(n=t.InputAbstractHandler,o(s,n),s.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1)},s.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1)},s);function s(t,e){var i=n.call(this,t,e)||this;return i.onMouseDown=function(t){0===t.button&&(i.pointDown(1,i.getOffsetPositionFromInputView(t)),window.addEventListener("mousemove",i.onMouseMove,!1),window.addEventListener("mouseup",i.onMouseUp,!1),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},i.onMouseMove=function(t){i.pointMove(1,i.getOffsetPositionFromInputView(t)),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},i.onMouseUp=function(t){i.pointUp(1,i.getOffsetPositionFromInputView(t)),window.removeEventListener("mousemove",i.onMouseMove,!1),window.removeEventListener("mouseup",i.onMouseUp,!1),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},i}i.MouseHandler=o},{"./InputAbstractHandler":60}],62:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.TouchHandler=void 0;var s,t=t("./MouseHandler"),o=(s=t.MouseHandler,o(n,s),n.prototype.start=function(){s.prototype.start.call(this),this.inputView.addEventListener("touchstart",this.onTouchDown),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchUp)},n.prototype.stop=function(){s.prototype.stop.call(this),this.inputView.removeEventListener("touchstart",this.onTouchDown),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchUp)},n);function n(t,e){var n=s.call(this,t,e)||this;return n.onTouchDown=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointDown(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n.onTouchMove=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointMove(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n.onTouchUp=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointUp(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n}i.TouchHandler=o},{"./MouseHandler":61}],63:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlugin=i.PostMessageAudioPlugin=i.WebAudioPlugin=i.HTMLAudioPlugin=i.AudioPluginRegistry=i.g=i.ResourceFactory=i.Platform=void 0;var r=t("./Platform");Object.defineProperty(i,"Platform",{enumerable:!0,get:function(){return r.Platform}});var o=t("./ResourceFactory");Object.defineProperty(i,"ResourceFactory",{enumerable:!0,get:function(){return o.ResourceFactory}});var n=t("@akashic/akashic-engine");i.g=n;var s=t("./plugin/AudioPluginRegistry");Object.defineProperty(i,"AudioPluginRegistry",{enumerable:!0,get:function(){return s.AudioPluginRegistry}});var a=t("./plugin/AudioPluginManager");Object.defineProperty(i,"AudioPluginManager",{enumerable:!0,get:function(){return a.AudioPluginManager}});var h=t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin");Object.defineProperty(i,"HTMLAudioPlugin",{enumerable:!0,get:function(){return h.HTMLAudioPlugin}});var c=t("./plugin/WebAudioPlugin/WebAudioPlugin");Object.defineProperty(i,"WebAudioPlugin",{enumerable:!0,get:function(){return c.WebAudioPlugin}});var u=t("./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin");Object.defineProperty(i,"PostMessageAudioPlugin",{enumerable:!0,get:function(){return u.PostMessageAudioPlugin}});var l=t("./plugin/ProxyAudioPlugin/ProxyAudioPlugin");Object.defineProperty(i,"ProxyAudioPlugin",{enumerable:!0,get:function(){return l.ProxyAudioPlugin}})},{"./Platform":32,"./ResourceFactory":34,"./plugin/AudioPluginManager":64,"./plugin/AudioPluginRegistry":65,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":69,"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin":72,"./plugin/ProxyAudioPlugin/ProxyAudioPlugin":76,"./plugin/WebAudioPlugin/WebAudioPlugin":81,"@akashic/akashic-engine":1}],64:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPluginManager=void 0;var r=(o.prototype.getActivePlugin=function(){return this._activePlugin},o.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;r=r;if(r.isSupported())return this._activePlugin=new r,!0}return!1},o);function o(){this._activePlugin=null}i.AudioPluginManager=r},{}],65:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPluginRegistry=void 0;var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],66:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioAsset=void 0;var n,h=t("@akashic/akashic-engine"),o=(n=h.AudioAsset,o(c,n),c.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);function e(t,e){o.autoplay=!1,o.preload="none",o.src=t,i._attachAll(o,e),o.preload="auto",s(o,e),o.load()}var r,o=new Audio,n={success:function(){i._detachAll(o,n),i.data=o,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(o,n),i.data=o,t._onAssetError(i,h.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(i._intervalId)}},s=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():(++i._intervalCount,600===i._intervalCount&&e.error())},100)},a=this.path.indexOf("?");".aac"!==(0<=a?this.path.substring(0,a):this.path).slice(-4)||-1===c.supportedFormats.indexOf("mp4")?e(this.path,n):(r={success:n.success,error:function(){i._detachAll(o,r),window.clearInterval(i._intervalId),i.path=h.PathUtil.addExtname(i.originalPath,"mp4"),e(i.path,n)}},e(this.path,r))},c.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},c.prototype._assetPathFilter=function(t){return-1!==c.supportedFormats.indexOf("ogg")?h.PathUtil.addExtname(t,"ogg"):-1!==c.supportedFormats.indexOf("aac")?h.PathUtil.addExtname(t,"aac"):null},c.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},c.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},c);function c(){return null!==n&&n.apply(this,arguments)||this}i.HTMLAudioAsset=o},{"@akashic/akashic-engine":1}],67:[function(t,e,i){"use strict";var r,o=0,n=[];function s(){a(),document.removeEventListener("keydown",s),document.removeEventListener("mousedown",s),document.removeEventListener("touchend",s)}function a(){o=2,n.forEach(function(t){return t.play()}),n=[]}(r||(r={})).setupChromeMEIWorkaround=function(t){function e(){switch(o){case 0:case 1:a()}o=2,clearTimeout(i)}switch(o){case 0:t.addEventListener("play",e,!0);var i=setTimeout(function(){switch(t.removeEventListener("play",e),o){case 0:n.push(t),o=1,document.addEventListener("keydown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("touchend",s,!0);break;case 1:n.push(t);break;case 2:t.play()}},100);break;case 1:n.push(t)}},e.exports=r},{}],68:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioPlayer=void 0;var n,s=t("@akashic/akashic-engine"),a=t("./HTMLAudioAutoplayHelper"),o=(n=s.AudioPlayer,o(h,n),h.prototype.play=function(t){this.currentAudio&&this.stop();var e=t.cloneElement();e?(a.setupChromeMEIWorkaround(e),e.volume=this._calculateVolume(),e.play().catch(function(t){}),e.loop=t.loop,e.addEventListener("ended",this._endedEventHandler,!1),e.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=e):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration),n.prototype.play.call(this,t)},h.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null))),n.prototype.stop.call(this)},h.prototype.changeVolume=function(t){n.prototype.changeVolume.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype._changeMuted=function(t){n.prototype._changeMuted.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),n.prototype.stop.call(this)},h.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},h.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},h.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e){var i=n.call(this,t)||this;return i._manager=e,i._endedEventHandler=function(){i._onAudioEnded()},i._onPlayEventHandler=function(){i._onPlayEvent()},i._dummyDurationWaitTimer=null,i}i.HTMLAudioPlayer=o},{"./HTMLAudioAutoplayHelper":67,"@akashic/akashic-engine":1}],69:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioPlugin=void 0;var s=t("./HTMLAudioAsset"),r=t("./HTMLAudioPlayer"),t=(o.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(o.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,s.HTMLAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),o.prototype.createAsset=function(t,e,i,r,o,n){return new s.HTMLAudioAsset(t,e,i,r,o,n)},o.prototype.createPlayer=function(t,e){return new r.HTMLAudioPlayer(t,e)},o.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},o);function o(){this._supportedFormats=this._detectSupportedFormats(),s.HTMLAudioAsset.supportedFormats=this.supportedFormats}i.HTMLAudioPlugin=t},{"./HTMLAudioAsset":66,"./HTMLAudioPlayer":68}],70:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageAudioAsset=void 0;var n,s=t("@akashic/akashic-engine"),a=t("./PostMessageAudioPlugin"),o=(n=s.AudioAsset,o(h,n),h.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};a.PostMessageAudioPlugin.send("akashic:AudioAsset#_load",i),setTimeout(function(){return t._onAssetLoad(e)})},h.prototype.destroy=function(){a.PostMessageAudioPlugin.send("akashic:AudioAsset#destroy",{id:this.id}),n.prototype.destroy.call(this)},h);function h(){return null!==n&&n.apply(this,arguments)||this}i.PostMessageAudioAsset=o},{"./PostMessageAudioPlugin":72,"@akashic/akashic-engine":1}],71:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageAudioPlayer=void 0;var n,s=t("@akashic/akashic-engine"),a=t("./PostMessageAudioPlugin"),o=(n=s.AudioPlayer,o(h,n),h.prototype.play=function(t){a.PostMessageAudioPlugin.send("akashic:AudioPlayer#play",{id:this.id,assetId:t.id})},h.prototype.stop=function(){a.PostMessageAudioPlugin.send("akashic:AudioPlayer#stop",{id:this.id})},h.prototype.changeVolume=function(t){n.prototype.changeVolume.call(this,t),a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},h.prototype._changeMuted=function(t){n.prototype._changeMuted.call(this,t),a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},h.prototype._changePlaybackRate=function(t){n.prototype._changePlaybackRate.call(this,t),a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changePlaybackRate",{id:this.id,rate:t})},h.prototype.notifyMasterVolumeChanged=function(){a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},h.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e,i){t=n.call(this,t)||this;return t._manager=e,t.id=i,a.PostMessageAudioPlugin.send("akashic:AudioPlayer#new",{id:i}),t}i.PostMessageAudioPlayer=o},{"./PostMessageAudioPlugin":72,"@akashic/akashic-engine":1}],72:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageAudioPlugin=void 0;var r,s=t("./PostMessageAudioAsset"),o=t("./PostMessageAudioPlayer"),n=t("./PostMessageHandler"),t=(a.isSupported=function(){return"undefined"!=typeof window&&!!window.postMessage},a.initialize=function(t,e){return(r=new n.PostMessageHandler(t,e)).start(),r},a.send=function(t,e){r.send({type:t,parameters:e})},a.prototype.createAsset=function(t,e,i,r,o,n){return new s.PostMessageAudioAsset(t,e,i,r,o,n)},a.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,""+this._playerIdx++)},a);function a(){this.supportedFormats=void 0,this._playerIdx=0}i.PostMessageAudioPlugin=t},{"./PostMessageAudioAsset":70,"./PostMessageAudioPlayer":71,"./PostMessageHandler":73}],73:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageHandler=void 0;var r=t("@akashic/akashic-engine"),t=(o.prototype.start=function(){window.addEventListener("message",this.onMessage_bound)},o.prototype.stop=function(){window.removeEventListener("message",this.onMessage_bound)},o.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},o.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},o);function o(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}i.PostMessageHandler=t},{"@akashic/akashic-engine":1}],74:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioAsset=void 0;var a,n=t("@akashic/akashic-engine"),o=(a=n.AudioAsset,o(s,a),s.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),a.prototype.destroy.call(this)},s.prototype._load=function(e){var i=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(t){t?e._onAssetError(i,n.ExceptionFactory.createAssetLoadError(t)):e._onAssetLoad(i)})},s.prototype._assetPathFilter=function(t){return t},s);function s(t,e,i,r,o,n,s){s=a.call(this,e,i,r,o,n,s)||this;return s._handlerSet=t,s}i.ProxyAudioAsset=o},{"@akashic/akashic-engine":1}],75:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlayer=void 0;var n,t=t("@akashic/akashic-engine"),o=(n=t.AudioPlayer,o(s,n),s.prototype.changeVolume=function(t){n.prototype.changeVolume.call(this,t),this._notifyVolumeToHandler()},s.prototype._changeMuted=function(t){n.prototype._changeMuted.call(this,t),this._notifyVolumeToHandler()},s.prototype.play=function(t){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap"+s._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:t.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),n.prototype.play.call(this,t)},s.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),n.prototype.stop.call(this)},s.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},s.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},s.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},s._audioPlayerIdCounter=0,s);function s(t,e,i){e=n.call(this,e)||this;return e._audioPlayerId=null,e._handlerSet=t,e._manager=i,e}i.ProxyAudioPlayer=o},{"@akashic/akashic-engine":1}],76:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlugin=void 0;var s=t("./ProxyAudioAsset"),r=t("./ProxyAudioPlayer"),t=(o.isSupported=function(){return!0},o.prototype.createAsset=function(t,e,i,r,o,n){return new s.ProxyAudioAsset(this._handlerSet,t,e,i,r,o,n)},o.prototype.createPlayer=function(t,e){return new r.ProxyAudioPlayer(this._handlerSet,t,e)},o);function o(t){this.supportedFormats=[],this._handlerSet=t}i.ProxyAudioPlugin=t},{"./ProxyAudioAsset":74,"./ProxyAudioPlayer":75}],77:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioAsset=void 0;var n,h=t("@akashic/akashic-engine"),c=t("../../utils/XHRLoader"),u=t("./WebAudioHelper"),o=(n=h.AudioAsset,o(s,n),s.prototype._load=function(e){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return e._onAssetLoad(i)},0);function r(t){i.data=t,e._onAssetLoad(i)}function o(){e._onAssetError(i,h.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))}function n(t){u.getAudioContext().decodeAudioData(t,r,o)}function s(t,i,r){a.getArrayBuffer(t,function(t,e){t?r(t):i(e)})}var a=new c.XHRLoader,t=this.path.indexOf("?");".aac"!==(0<=t?this.path.substring(0,t):this.path).slice(-4)?s(this.path,n,o):s(this.path,n,function(t){var e=h.PathUtil.addExtname(i.originalPath,"mp4");s(e,function(t){i.path=e,n(t)},o)})},s.prototype._assetPathFilter=function(t){return-1!==s.supportedFormats.indexOf("ogg")?h.PathUtil.addExtname(t,"ogg"):-1!==s.supportedFormats.indexOf("aac")?h.PathUtil.addExtname(t,"aac"):null},s.supportedFormats=[],s);function s(){return null!==n&&n.apply(this,arguments)||this}i.WebAudioAsset=o},{"../../utils/XHRLoader":82,"./WebAudioHelper":79,"@akashic/akashic-engine":1}],78:[function(t,e,i){"use strict";var r,o=t("./WebAudioHelper");function n(){o.getAudioContext().resume(),document.removeEventListener("keydown",n),document.removeEventListener("mousedown",n),document.removeEventListener("touchend",n)}(r||(r={})).setupChromeMEIWorkaround=function(){var t,e,i=o.getAudioContext();i&&"function"!=typeof i.resume||(t=o.createGainNode(i),(e=i.createOscillator()).type="sawtooth",e.frequency.value=440,e.connect(t),e.start(0),i=i.state,e.disconnect(),"running"!==i&&(document.addEventListener("keydown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchend",n,!0)))},e.exports=r},{"./WebAudioHelper":79}],79:[function(t,e,i){"use strict";var r,o,n=window.AudioContext||window.webkitAudioContext;(o=r=r||{}).getAudioContext=function(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var t=window.__akashic__.audioContext;return t instanceof n||(t=window.__akashic__.audioContext=new n,o._workAroundSafari()),t},o.createGainNode=function(t){return t.createGain?t.createGain():t.createGainNode()},o.createBufferNode=function(t){return(t=t.createBufferSource()).start||(t.start=t.noteOn,t.stop=t.noteOff),t},o._workAroundSafari=function(){document.addEventListener("touchstart",function t(){document.removeEventListener("touchstart",t),o.getAudioContext().createBufferSource().start(0)},!0)},e.exports=r},{}],80:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioPlayer=void 0;var n,s=t("@akashic/akashic-engine"),a=t("./WebAudioHelper"),o=(n=s.AudioPlayer,o(h,n),h.prototype.changeVolume=function(t){n.prototype.changeVolume.call(this,t),this._gainNode.gain.value=this._calculateVolume()},h.prototype._changeMuted=function(t){n.prototype._changeMuted.call(this,t),this._gainNode.gain.value=this._calculateVolume()},h.prototype.play=function(t){var e;this.currentAudio&&this.stop(),t.data?((e=a.createBufferNode(this._audioContext)).loop=t.loop,e.buffer=t.data,this._gainNode.gain.value=this._calculateVolume(),e.connect(this._gainNode),this._sourceNode=e,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration),n.prototype.play.call(this,t)},h.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0)),n.prototype.stop.call(this)},h.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},h.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),n.prototype.stop.call(this)},h.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},h.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e){var i=n.call(this,t)||this;return i._audioContext=a.getAudioContext(),i._manager=e,i._gainNode=a.createGainNode(i._audioContext),i._gainNode.connect(i._audioContext.destination),i._sourceNode=void 0,i._dummyDurationWaitTimer=null,i._endedEventHandler=function(){i._onAudioEnded()},i}i.WebAudioPlayer=o},{"./WebAudioHelper":79,"@akashic/akashic-engine":1}],81:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioPlugin=void 0;var s=t("./WebAudioAsset"),r=t("./WebAudioPlayer"),o=t("./WebAudioAutoplayHelper"),t=(n.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(n.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,s.WebAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),n.prototype.createAsset=function(t,e,i,r,o,n){return new s.WebAudioAsset(t,e,i,r,o,n)},n.prototype.createPlayer=function(t,e){return new r.WebAudioPlayer(t,e)},n.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},n);function n(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}i.WebAudioPlugin=t},{"./WebAudioAsset":77,"./WebAudioAutoplayHelper":78,"./WebAudioPlayer":80}],82:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.XHRLoader=void 0;var o=t("@akashic/akashic-engine"),t=(r.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},r.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},r.prototype._getRequestObject=function(e,i){var r=new XMLHttpRequest;r.open("GET",e.url,!0),r.responseType=e.responseType,r.timeout=this.timeout,r.addEventListener("timeout",function(){i(o.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),r.addEventListener("load",function(){var t;200<=r.status&&r.status<300?(t="text"===e.responseType?r.responseText:r.response,i(null,t)):i(o.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.addEventListener("error",function(){i(o.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.send()},r);function r(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}i.XHRLoader=t},{"@akashic/akashic-engine":1}],83:[function(B,i,r){(function(W,N){var t,e;t=this,e=function(){"use strict";function h(t){return"function"==typeof t}var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,e=void 0,o=void 0,s=function(t,e){l[r]=t,l[r+1]=e,2===(r+=2)&&(o?o(d):y())};var t="undefined"!=typeof window?window:void 0,n=t||{},a=n.MutationObserver||n.WebKitMutationObserver,c="undefined"==typeof self&&void 0!==W&&"[object process]"==={}.toString.call(W),n="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function u(){var t=setTimeout;return function(){return t(d,1)}}var l=new Array(1e3);function d(){for(var t=0;t<r;t+=2){(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0}r=0}var p,f,_,g,y=void 0;function m(t,e){var i=this,r=new this.constructor(A);void 0===r[T]&&I(r);var o,n=i._state;return n?(o=arguments[n-1],s(function(){return O(n,r,o,i._result)})):M(i,r,t,e),r}function v(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(A);return P(e,t),e}y=c?function(){return W.nextTick(d)}:a?(f=0,_=new a(d),g=document.createTextNode(""),_.observe(g,{characterData:!0}),function(){g.data=f=++f%2}):n?((p=new MessageChannel).port1.onmessage=d,function(){return p.port2.postMessage(0)}):(void 0===t&&"function"==typeof B?function(){try{var t=Function("return this")().require("vertx");return void 0!==(e=t.runOnLoop||t.runOnContext)?function(){e(d)}:u()}catch(t){return u()}}:u)();var T=Math.random().toString(36).substring(2);function A(){}var x=void 0,w=1,S=2;function E(t,r,o){s(function(e){var i=!1,t=function(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}(o,r,function(t){i||(i=!0,(r!==t?P:R)(e,t))},function(t){i||(i=!0,L(e,t))},e._label);!i&&t&&(i=!0,L(e,t))},t)}function b(t,e,i){var r,o;e.constructor===t.constructor&&i===m&&e.constructor.resolve===v?(r=t,(o=e)._state===w?R(r,o._result):o._state===S?L(r,o._result):M(o,void 0,function(t){return P(r,t)},function(t){return L(r,t)})):void 0!==i&&h(i)?E(t,e,i):R(t,e)}function P(e,t){if(e===t)L(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(r=t),null===r||"object"!=o&&"function"!=o)R(e,t);else{var i=void 0;try{i=t.then}catch(t){return void L(e,t)}b(e,t,i)}var r,o}function k(t){t._onerror&&t._onerror(t._result),C(t)}function R(t,e){t._state===x&&(t._result=e,t._state=w,0!==t._subscribers.length&&s(C,t))}function L(t,e){t._state===x&&(t._state=S,t._result=e,s(k,t))}function M(t,e,i,r){var o=t._subscribers,n=o.length;t._onerror=null,o[n]=e,o[n+w]=i,o[n+S]=r,0===n&&t._state&&s(C,t)}function C(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r,o=void 0,n=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+i],r?O(i,r,o,n):o(n);t._subscribers.length=0}}function O(t,e,i,r){var o=h(i),n=void 0,s=void 0,a=!0;if(o){try{n=i(r)}catch(t){a=!1,s=t}if(e===n)return void L(e,new TypeError("A promises callback cannot return that same promise."))}else n=r;e._state!==x||(o&&a?P(e,n):!1===a?L(e,s):t===w?R(e,n):t===S&&L(e,n))}var F=0;function I(t){t[T]=F++,t._state=void 0,t._result=void 0,t._subscribers=[]}var D=(G.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},G.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===v){var o,n=void 0,s=void 0,a=!1;try{n=e.then}catch(t){a=!0,s=t}n===m&&e._state!==x?this._settledAt(e._state,t,e._result):"function"!=typeof n?(this._remaining--,this._result[t]=e):i===H?(o=new i(A),a?L(o,s):b(o,e,n),this._willSettleAt(o,t)):this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},G.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===x&&(this._remaining--,t===S?L(r,i):this._result[e]=i),0===this._remaining&&R(r,this._result)},G.prototype._willSettleAt=function(t,e){var i=this;M(t,void 0,function(t){return i._settledAt(w,e,t)},function(t){return i._settledAt(S,e,t)})},G);function G(t,e){this._instanceConstructor=t,this.promise=new t(A),this.promise[T]||I(this.promise),i(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&R(this.promise,this._result))):L(this.promise,new Error("Array Methods must be provided an Array"))}var H=(U.prototype.catch=function(t){return this.then(null,t)},U.prototype.finally=function(e){var i=this.constructor;return h(e)?this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):this.then(e,e)},U);function U(t){this[T]=F++,this._result=this._state=void 0,this._subscribers=[],A!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof U?function(e,t){try{t(function(t){P(e,t)},function(t){L(e,t)})}catch(t){L(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return H.prototype.then=m,H.all=function(t){return new D(this,t).promise},H.race=function(o){var n=this;return i(o)?new n(function(t,e){for(var i=o.length,r=0;r<i;r++)n.resolve(o[r]).then(t,e)}):new n(function(t,e){return e(new TypeError("You must pass an array to race."))})},H.resolve=v,H.reject=function(t){var e=new this(A);return L(e,t),e},H._setScheduler=function(t){o=t},H._setAsap=function(t){s=t},H._asap=s,H.polyfill=function(){var t=void 0;if(void 0!==N)t=N;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=H},H.Promise=H},"object"==typeof r&&void 0!==i?i.exports=e():t.ES6Promise=e()}).call(this,B("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:84}],84:[function(t,e,i){var r,o,e=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(t){r=n}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var h,c=[],u=!1,l=-1;function d(){u&&h&&(u=!1,h.length?c=h.concat(c):l=-1,c.length&&p())}function p(){if(!u){var t=a(d);u=!0;for(var e=c.length;e;){for(h=c,c=[];++l<e;)h&&h[l].run();l=-1,e=c.length}h=null,u=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function _(){}e.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=_,e.addListener=_,e.once=_,e.off=_,e.removeListener=_,e.removeAllListeners=_,e.emit=_,e.prependListener=_,e.prependOnceListener=_,e.listeners=function(t){return[]},e.binding=function(t){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(t){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],85:[function(t,e,i){e.exports={gameDriver:t("@akashic/game-driver"),akashicEngine:t("@akashic/akashic-engine"),pdiBrowser:t("@akashic/pdi-browser")}},{"@akashic/akashic-engine":1,"@akashic/game-driver":4,"@akashic/pdi-browser":28}]},{},[85])(85)});

	window.engineFiles=engineFilesV2_1_47,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){return"@akashic/akashic-engine"!==i?this.call(this,i):engineFiles.akashicEngine}}();

</script>

<script>
if (! ("optionProps" in window)) {
	window.optionProps = {};
}
window.optionProps.magnify = true

window.g = require("@akashic/akashic-engine");
</script>
<script>
if (! ("gLocalAssetContainer" in window)) {
	window.gLocalAssetContainer = {};
}

if (! ("__akashic__" in window)) {
	window.__akashic__ = {};
}


	
		window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 800,%0A%09%22height%22: 450,%0A%09%22fps%22: 30,%0A%09%22main%22: %22./script/main.js%22,%0A%09%22assets%22: {%0A%09%09%22main%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/main.js%22,%0A%09%09%09%22global%22: true%0A%09%09}%0A%09},%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %222%22%0A%09},%0A%09%22globalScripts%22: [%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/BodyType.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/Box2D.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/Box2DOptions.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/index.js%22,%0A%09%09%22node_modules/box2dweb/box2d.js%22%0A%09],%0A%09%22moduleMainScripts%22: {%0A%09%09%22@akashic-extension/akashic-box2d%22: %22node_modules/@akashic-extension/akashic-box2d/lib/index.js%22,%0A%09%09%22box2dweb%22: %22node_modules/box2dweb/box2d.js%22%0A%09}%0A}";
	

	
		window.gLocalAssetContainer["main"] = function(g) {
			!function(e,t){"use strict";var d=e("@akashic-extension/akashic-box2d"),r=d.Box2DWeb.Common.Math.b2Mat22,e={gravity:[0,9.8],scale:50,sleep:!0},c=new d.Box2D(e),s={appear:{width:+e.scale,height:+e.scale,cssColor:"crimson"},physics:{body:c.createBodyDef({type:d.BodyType.Dynamic}),fixture:c.createFixtureDef({density:1,friction:.5,restitution:.3,shape:c.createRectShape(+e.scale,+e.scale)})}},y={appear:{width:.3*e.scale,height:g.game.height,cssColor:"royalblue"},physics:{body:c.createBodyDef({type:d.BodyType.Static}),fixture:c.createFixtureDef({density:1,friction:.3,restitution:.7,shape:c.createRectShape(.3*e.scale,g.game.height)})}},l={appear:{width:g.game.width,height:.3*e.scale,cssColor:"royalblue"},physics:{body:c.createBodyDef({type:d.BodyType.Static}),fixture:c.createFixtureDef({density:1,friction:.3,restitution:.7,shape:c.createRectShape(g.game.width,.3*e.scale)})}};function h(e,t){var i=new g.FilledRect({scene:e,width:t.appear.width,height:t.appear.height,cssColor:t.appear.cssColor});return e.append(i),c.createBody(i,t.physics.body,t.physics.fixture)}function p(e){return c.vec2(e.width/2,e.height/2)}t.exports=function(){var n=new g.Scene({game:g.game});n.loaded.add(function(){var e=h(n,y),t=c.vec2(0,0);t.Add(p(e.entity)),e.b2body.SetPosition(t);e=h(n,y),t=c.vec2(g.game.width-e.entity.width,0);t.Add(p(e.entity)),e.b2body.SetPosition(t);e=h(n,l),t=c.vec2(0,g.game.height-e.entity.height);t.Add(p(e.entity)),e.b2body.SetPosition(t);e=h(n,l),t=c.vec2(0,0);t.Add(p(e.entity)),e.b2body.SetPosition(t);var i,o=h(n,s);o.b2body.SetPosition(p(g.game)),o.entity.touchable=!0;var a=null;o.entity.pointDown.add(function(e){null!==a&&(c.world.DestroyJoint(a),a=null),(i=c.vec2(e.point.x,e.point.y)).Subtract(p(o.entity)),i.MulM(r.FromAngle(o.b2body.GetAngle())),i.Add(o.b2body.GetPosition());e=new d.Box2DWeb.Dynamics.Joints.b2MouseJointDef;e.bodyA=c.world.GetGroundBody(),e.bodyB=o.b2body,e.collideConnected=!0,e.maxForce=1e3*o.b2body.GetMass(),e.target=i,a=c.world.CreateJoint(e),o.entity.cssColor="teal",o.entity.modified()}),o.entity.pointMove.add(function(e){i.Add(c.vec2(e.prevDelta.x,e.prevDelta.y)),a.SetTarget(i)}),o.entity.pointUp.add(function(){c.world.DestroyJoint(a),a=null,o.entity.cssColor="crimson",o.entity.modified()}),n.update.add(function(){c.step(1/g.game.fps)})}),g.game.pushScene(n)}}((g.module.exports,g.module.require),g.module,(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/BodyType.js"] = function(g) {
			!function(e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i=i("box2dweb");(e=e.BodyType||(e.BodyType={}))[e.Static=i.Dynamics.b2Body.b2_staticBody]="Static",e[e.Kinematic=i.Dynamics.b2Body.b2_kinematicBody]="Kinematic",e[e.Dynamic=i.Dynamics.b2Body.b2_dynamicBody]="Dynamic"}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/Box2D.js"] = function(g) {
			!function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("box2dweb"),i=t("./BodyType"),t=(o.prototype.createBody=function(e,t,i){for(var r=0;r<this.bodies.length;r++)if(this.bodies[r].entity===e)return;for(var o=Array.isArray(i)?i:[i],r=0;r<o.length;r++)if(!o[r].shape)throw new Error("Missing parameter: shape");for(var a=this.world.CreateBody(t),r=0;r<o.length;r++)a.CreateFixture(o[r]);t=null!=t.userData?t.userData:e.id;a.SetUserData(t),a.SetPositionAndAngle(this.vec2(e.x+e.width/2,e.y+e.height/2),this.radian(e.angle));t={entity:e,b2body:a};return this.bodies.push(t),t},o.prototype.removeBody=function(e){this.world.DestroyBody(e.b2body);e=this.bodies.indexOf(e);-1!==e&&this.bodies.splice(e,1)},o.prototype.destroy=function(){this.world=void 0,this.bodies=void 0,this.scale=void 0},o.prototype.destroyed=function(){return void 0===this.world},o.prototype.step=function(e,t,i){t=null!=t?t:10,i=null!=i?i:10,this.world.Step(e,t,i);for(var r=0;r<this.bodies.length;++r){var o,a=this.bodies[r].b2body,n=this.bodies[r].entity;n.destroyed()||a.IsAwake()&&(o=a.GetPosition(),n.x=o.x*this.scale-n.width/2,n.y=o.y*this.scale-n.height/2,n.angle=this.degree(a.GetAngle()),n.modified())}},o.prototype.isContact=function(e,t,i){var r=i.GetFixtureA().GetBody().GetUserData(),i=i.GetFixtureB().GetBody().GetUserData();return e.b2body.GetUserData()===r&&t.b2body.GetUserData()===i||e.b2body.GetUserData()===i&&t.b2body.GetUserData()===r},o.prototype.createRectShape=function(e,t){var i=new r.Collision.Shapes.b2PolygonShape;return i.SetAsBox(e/(2*this.scale),t/(2*this.scale)),i},o.prototype.createCircleShape=function(e){return new r.Collision.Shapes.b2CircleShape(e/2/this.scale)},o.prototype.createPolygonShape=function(e){var t=new r.Collision.Shapes.b2PolygonShape;return t.SetAsArray(e,e.length),t},o.prototype.createFixtureDef=function(e){var t=new r.Dynamics.b2FixtureDef;t.density=null!=e.density?e.density:0,t.friction=null!=e.friction?e.friction:.2,t.restitution=null!=e.restitution?e.restitution:0,t.shape=e.shape;e=e.filter||{};return t.filter.categoryBits=null!=e.categoryBits?e.categoryBits:1,t.filter.maskBits=null!=e.maskBits?e.maskBits:65535,t.filter.groupIndex=null!=e.groupIndex?e.groupIndex:0,t},o.prototype.createBodyDef=function(e){var t=new r.Dynamics.b2BodyDef;return t.type=null!=e.type?e.type:i.BodyType.Static,t.userData=e.userData,t.angularDamping=null!=e.angularDamping?e.angularDamping:0,t.angularVelocity=null!=e.angularVelocity?e.angularVelocity:0,t.linearDamping=null!=e.linearDamping?e.linearDamping:0,t.linearVelocity=null!=e.linearVelocity?e.linearVelocity:this.vec2(0,0),t.inertiaScale=null!=e.inertiaScale?e.inertiaScale:1,t.active=null==e.active||e.active,t.allowSleep=null==e.allowSleep||e.allowSleep,t.awake=null==e.awake||e.awake,t.bullet=null==e.bullet||e.bullet,t.fixedRotation=null!=e.fixedRotation&&e.fixedRotation,t},o.prototype.degree=function(e){return 180*e/Math.PI},o.prototype.radian=function(e){return e*Math.PI/180},o.prototype.vec2=function(e,t){return new r.Common.Math.b2Vec2(e/this.scale,t/this.scale)},o);function o(e){if(!e.gravity)throw new Error("Missing parameter: gravity");if(!e.scale)throw new Error("Missing parameter: scale");var t=null==e.sleep||e.sleep;this.world=new r.Dynamics.b2World(new r.Common.Math.b2Vec2(e.gravity[0],e.gravity[1]),t),this.bodies=[],this.scale=e.scale}e.Box2D=t}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/Box2DOptions.js"] = function(g) {
			!function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/index.js"] = function(g) {
			!function(e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=o("box2dweb");e.Box2DWeb=d;d=o("./Box2D");e.Box2D=d.Box2D;d=o("./BodyType");e.BodyType=d.BodyType;o=o("./Box2DOptions");e.Box2DOptions=o}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["node_modules/box2dweb/box2d.js"] = function(g) {
			!function(t){"use strict";var e,P={};function n(){}(N=P).inherit=function(t,i){var o=t;n.prototype=i.prototype,t.prototype=new n,t.prototype.constructor=o},N.generateCallback=function(t,i){return function(){i.apply(t,arguments)}},N.NVector=function(t){t===e&&(t=0);for(var i=new Array(t||0),o=0;o<t;++o)i[o]=0;return i},N.is=function(t,i){return null!==t&&(i instanceof Function&&t instanceof i||!(t.constructor.__implements==e||!t.constructor.__implements[i]))},N.parseUInt=function(t){return Math.abs(parseInt(t))};var o,s,r,D,S,i,a,g,x,l,m,B,c,h,b,_,p,y,u,f,d,v,M,C,A,w,V,I,G,L,J,F,R,T,k,z,N,E,j,q=Array,O=P.NVector;function U(){U.b2AABB.apply(this,arguments)}function K(){K.b2Bound.apply(this,arguments)}function W(){W.b2BoundValues.apply(this,arguments),this.constructor===W&&this.b2BoundValues.apply(this,arguments)}function X(){X.b2Collision.apply(this,arguments)}function Z(){Z.b2ContactID.apply(this,arguments),this.constructor===Z&&this.b2ContactID.apply(this,arguments)}function H(){H.b2ContactPoint.apply(this,arguments)}function Y(){Y.b2Distance.apply(this,arguments)}function Q(){Q.b2DistanceInput.apply(this,arguments)}function $(){$.b2DistanceOutput.apply(this,arguments)}function tt(){tt.b2DistanceProxy.apply(this,arguments)}function it(){it.b2DynamicTree.apply(this,arguments),this.constructor===it&&this.b2DynamicTree.apply(this,arguments)}function ot(){ot.b2DynamicTreeBroadPhase.apply(this,arguments)}function et(){et.b2DynamicTreeNode.apply(this,arguments)}function nt(){nt.b2DynamicTreePair.apply(this,arguments)}function st(){st.b2Manifold.apply(this,arguments),this.constructor===st&&this.b2Manifold.apply(this,arguments)}function rt(){rt.b2ManifoldPoint.apply(this,arguments),this.constructor===rt&&this.b2ManifoldPoint.apply(this,arguments)}function at(){at.b2Point.apply(this,arguments)}function lt(){lt.b2RayCastInput.apply(this,arguments),this.constructor===lt&&this.b2RayCastInput.apply(this,arguments)}function mt(){mt.b2RayCastOutput.apply(this,arguments)}function ct(){ct.b2Segment.apply(this,arguments)}function ht(){ht.b2SeparationFunction.apply(this,arguments)}function _t(){_t.b2Simplex.apply(this,arguments),this.constructor===_t&&this.b2Simplex.apply(this,arguments)}function pt(){pt.b2SimplexCache.apply(this,arguments)}function yt(){yt.b2SimplexVertex.apply(this,arguments)}function ut(){ut.b2TimeOfImpact.apply(this,arguments)}function xt(){xt.b2TOIInput.apply(this,arguments)}function ft(){ft.b2WorldManifold.apply(this,arguments),this.constructor===ft&&this.b2WorldManifold.apply(this,arguments)}function dt(){dt.ClipVertex.apply(this,arguments)}function bt(){bt.Features.apply(this,arguments)}function vt(){vt.b2CircleShape.apply(this,arguments),this.constructor===vt&&this.b2CircleShape.apply(this,arguments)}function Ct(){Ct.b2EdgeChainDef.apply(this,arguments),this.constructor===Ct&&this.b2EdgeChainDef.apply(this,arguments)}function At(){At.b2EdgeShape.apply(this,arguments),this.constructor===At&&this.b2EdgeShape.apply(this,arguments)}function St(){St.b2MassData.apply(this,arguments)}function gt(){gt.b2PolygonShape.apply(this,arguments),this.constructor===gt&&this.b2PolygonShape.apply(this,arguments)}function wt(){wt.b2Shape.apply(this,arguments),this.constructor===wt&&this.b2Shape.apply(this,arguments)}function Dt(){Dt.b2Color.apply(this,arguments),this.constructor===Dt&&this.b2Color.apply(this,arguments)}function Bt(){Bt.b2Settings.apply(this,arguments)}function Mt(){Mt.b2Mat22.apply(this,arguments),this.constructor===Mt&&this.b2Mat22.apply(this,arguments)}function Vt(){Vt.b2Mat33.apply(this,arguments),this.constructor===Vt&&this.b2Mat33.apply(this,arguments)}function It(){It.b2Math.apply(this,arguments)}function Gt(){Gt.b2Sweep.apply(this,arguments)}function Lt(){Lt.b2Transform.apply(this,arguments),this.constructor===Lt&&this.b2Transform.apply(this,arguments)}function Jt(){Jt.b2Vec2.apply(this,arguments),this.constructor===Jt&&this.b2Vec2.apply(this,arguments)}function Ft(){Ft.b2Vec3.apply(this,arguments),this.constructor===Ft&&this.b2Vec3.apply(this,arguments)}function Pt(){Pt.b2Body.apply(this,arguments),this.constructor===Pt&&this.b2Body.apply(this,arguments)}function Rt(){Rt.b2BodyDef.apply(this,arguments),this.constructor===Rt&&this.b2BodyDef.apply(this,arguments)}function Tt(){Tt.b2ContactFilter.apply(this,arguments)}function kt(){kt.b2ContactImpulse.apply(this,arguments)}function zt(){zt.b2ContactListener.apply(this,arguments)}function Nt(){Nt.b2ContactManager.apply(this,arguments),this.constructor===Nt&&this.b2ContactManager.apply(this,arguments)}function Et(){Et.b2DebugDraw.apply(this,arguments),this.constructor===Et&&this.b2DebugDraw.apply(this,arguments)}function jt(){jt.b2DestructionListener.apply(this,arguments)}function Ut(){Ut.b2FilterData.apply(this,arguments)}function qt(){qt.b2Fixture.apply(this,arguments),this.constructor===qt&&this.b2Fixture.apply(this,arguments)}function Ot(){Ot.b2FixtureDef.apply(this,arguments),this.constructor===Ot&&this.b2FixtureDef.apply(this,arguments)}function Kt(){Kt.b2Island.apply(this,arguments),this.constructor===Kt&&this.b2Island.apply(this,arguments)}function Wt(){Wt.b2TimeStep.apply(this,arguments)}function Xt(){Xt.b2World.apply(this,arguments),this.constructor===Xt&&this.b2World.apply(this,arguments)}function Zt(){Zt.b2CircleContact.apply(this,arguments)}function Ht(){Ht.b2Contact.apply(this,arguments),this.constructor===Ht&&this.b2Contact.apply(this,arguments)}function Yt(){Yt.b2ContactConstraint.apply(this,arguments),this.constructor===Yt&&this.b2ContactConstraint.apply(this,arguments)}function Qt(){Qt.b2ContactConstraintPoint.apply(this,arguments)}function $t(){$t.b2ContactEdge.apply(this,arguments)}function ti(){ti.b2ContactFactory.apply(this,arguments),this.constructor===ti&&this.b2ContactFactory.apply(this,arguments)}function ii(){ii.b2ContactRegister.apply(this,arguments)}function oi(){oi.b2ContactResult.apply(this,arguments)}function ei(){ei.b2ContactSolver.apply(this,arguments),this.constructor===ei&&this.b2ContactSolver.apply(this,arguments)}function ni(){ni.b2EdgeAndCircleContact.apply(this,arguments)}function si(){si.b2NullContact.apply(this,arguments),this.constructor===si&&this.b2NullContact.apply(this,arguments)}function ri(){ri.b2PolyAndCircleContact.apply(this,arguments)}function ai(){ai.b2PolyAndEdgeContact.apply(this,arguments)}function li(){li.b2PolygonContact.apply(this,arguments)}function mi(){mi.b2PositionSolverManifold.apply(this,arguments),this.constructor===mi&&this.b2PositionSolverManifold.apply(this,arguments)}function ci(){ci.b2BuoyancyController.apply(this,arguments)}function hi(){hi.b2ConstantAccelController.apply(this,arguments)}function _i(){_i.b2ConstantForceController.apply(this,arguments)}function pi(){pi.b2Controller.apply(this,arguments)}function yi(){yi.b2ControllerEdge.apply(this,arguments)}function ui(){ui.b2GravityController.apply(this,arguments)}function xi(){xi.b2TensorDampingController.apply(this,arguments)}function fi(){fi.b2DistanceJoint.apply(this,arguments),this.constructor===fi&&this.b2DistanceJoint.apply(this,arguments)}function di(){di.b2DistanceJointDef.apply(this,arguments),this.constructor===di&&this.b2DistanceJointDef.apply(this,arguments)}function bi(){bi.b2FrictionJoint.apply(this,arguments),this.constructor===bi&&this.b2FrictionJoint.apply(this,arguments)}function vi(){vi.b2FrictionJointDef.apply(this,arguments),this.constructor===vi&&this.b2FrictionJointDef.apply(this,arguments)}function Ci(){Ci.b2GearJoint.apply(this,arguments),this.constructor===Ci&&this.b2GearJoint.apply(this,arguments)}function Ai(){Ai.b2GearJointDef.apply(this,arguments),this.constructor===Ai&&this.b2GearJointDef.apply(this,arguments)}function Si(){Si.b2Jacobian.apply(this,arguments)}function gi(){gi.b2Joint.apply(this,arguments),this.constructor===gi&&this.b2Joint.apply(this,arguments)}function wi(){wi.b2JointDef.apply(this,arguments),this.constructor===wi&&this.b2JointDef.apply(this,arguments)}function Di(){Di.b2JointEdge.apply(this,arguments)}function Bi(){Bi.b2LineJoint.apply(this,arguments),this.constructor===Bi&&this.b2LineJoint.apply(this,arguments)}function Mi(){Mi.b2LineJointDef.apply(this,arguments),this.constructor===Mi&&this.b2LineJointDef.apply(this,arguments)}function Vi(){Vi.b2MouseJoint.apply(this,arguments),this.constructor===Vi&&this.b2MouseJoint.apply(this,arguments)}function Ii(){Ii.b2MouseJointDef.apply(this,arguments),this.constructor===Ii&&this.b2MouseJointDef.apply(this,arguments)}function Gi(){Gi.b2PrismaticJoint.apply(this,arguments),this.constructor===Gi&&this.b2PrismaticJoint.apply(this,arguments)}function Li(){Li.b2PrismaticJointDef.apply(this,arguments),this.constructor===Li&&this.b2PrismaticJointDef.apply(this,arguments)}function Ji(){Ji.b2PulleyJoint.apply(this,arguments),this.constructor===Ji&&this.b2PulleyJoint.apply(this,arguments)}function Fi(){Fi.b2PulleyJointDef.apply(this,arguments),this.constructor===Fi&&this.b2PulleyJointDef.apply(this,arguments)}function Pi(){Pi.b2RevoluteJoint.apply(this,arguments),this.constructor===Pi&&this.b2RevoluteJoint.apply(this,arguments)}function Ri(){Ri.b2RevoluteJointDef.apply(this,arguments),this.constructor===Ri&&this.b2RevoluteJointDef.apply(this,arguments)}function Ti(){Ti.b2WeldJoint.apply(this,arguments),this.constructor===Ti&&this.b2WeldJoint.apply(this,arguments)}function ki(){ki.b2WeldJointDef.apply(this,arguments),this.constructor===ki&&this.b2WeldJointDef.apply(this,arguments)}for(void 0===P&&(P={}),void 0===P.Collision&&(P.Collision={}),void 0===P.Collision.Shapes&&(P.Collision.Shapes={}),void 0===P.Common&&(P.Common={}),void 0===P.Common.Math&&(P.Common.Math={}),void 0===P.Dynamics&&(P.Dynamics={}),void 0===P.Dynamics.Contacts&&(P.Dynamics.Contacts={}),void 0===P.Dynamics.Controllers&&(P.Dynamics.Controllers={}),void 0===P.Dynamics.Joints&&(P.Dynamics.Joints={}),P.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",P.Collision.b2AABB=U,P.Collision.b2Bound=K,P.Collision.b2BoundValues=W,P.Collision.b2Collision=X,P.Collision.b2ContactID=Z,P.Collision.b2ContactPoint=H,P.Collision.b2Distance=Y,P.Collision.b2DistanceInput=Q,P.Collision.b2DistanceOutput=$,P.Collision.b2DistanceProxy=tt,P.Collision.b2DynamicTree=it,P.Collision.b2DynamicTreeBroadPhase=ot,P.Collision.b2DynamicTreeNode=et,P.Collision.b2DynamicTreePair=nt,P.Collision.b2Manifold=st,P.Collision.b2ManifoldPoint=rt,P.Collision.b2Point=at,P.Collision.b2RayCastInput=lt,P.Collision.b2RayCastOutput=mt,P.Collision.b2Segment=ct,P.Collision.b2SeparationFunction=ht,P.Collision.b2Simplex=_t,P.Collision.b2SimplexCache=pt,P.Collision.b2SimplexVertex=yt,P.Collision.b2TimeOfImpact=ut,P.Collision.b2TOIInput=xt,P.Collision.b2WorldManifold=ft,P.Collision.ClipVertex=dt,P.Collision.Features=bt,P.Collision.Shapes.b2CircleShape=vt,P.Collision.Shapes.b2EdgeChainDef=Ct,P.Collision.Shapes.b2EdgeShape=At,P.Collision.Shapes.b2MassData=St,P.Collision.Shapes.b2PolygonShape=gt,P.Collision.Shapes.b2Shape=wt,P.Common.b2internal="Box2D.Common.b2internal",P.Common.b2Color=Dt,P.Common.b2Settings=Bt,P.Common.Math.b2Mat22=Mt,P.Common.Math.b2Mat33=Vt,P.Common.Math.b2Math=It,P.Common.Math.b2Sweep=Gt,P.Common.Math.b2Transform=Lt,P.Common.Math.b2Vec2=Jt,P.Common.Math.b2Vec3=Ft,P.Dynamics.b2Body=Pt,P.Dynamics.b2BodyDef=Rt,P.Dynamics.b2ContactFilter=Tt,P.Dynamics.b2ContactImpulse=kt,P.Dynamics.b2ContactListener=zt,P.Dynamics.b2ContactManager=Nt,P.Dynamics.b2DebugDraw=Et,P.Dynamics.b2DestructionListener=jt,P.Dynamics.b2FilterData=Ut,P.Dynamics.b2Fixture=qt,P.Dynamics.b2FixtureDef=Ot,P.Dynamics.b2Island=Kt,P.Dynamics.b2TimeStep=Wt,P.Dynamics.b2World=Xt,P.Dynamics.Contacts.b2CircleContact=Zt,P.Dynamics.Contacts.b2Contact=Ht,P.Dynamics.Contacts.b2ContactConstraint=Yt,P.Dynamics.Contacts.b2ContactConstraintPoint=Qt,P.Dynamics.Contacts.b2ContactEdge=$t,P.Dynamics.Contacts.b2ContactFactory=ti,P.Dynamics.Contacts.b2ContactRegister=ii,P.Dynamics.Contacts.b2ContactResult=oi,P.Dynamics.Contacts.b2ContactSolver=ei,P.Dynamics.Contacts.b2EdgeAndCircleContact=ni,P.Dynamics.Contacts.b2NullContact=si,P.Dynamics.Contacts.b2PolyAndCircleContact=ri,P.Dynamics.Contacts.b2PolyAndEdgeContact=ai,P.Dynamics.Contacts.b2PolygonContact=li,P.Dynamics.Contacts.b2PositionSolverManifold=mi,P.Dynamics.Controllers.b2BuoyancyController=ci,P.Dynamics.Controllers.b2ConstantAccelController=hi,P.Dynamics.Controllers.b2ConstantForceController=_i,P.Dynamics.Controllers.b2Controller=pi,P.Dynamics.Controllers.b2ControllerEdge=yi,P.Dynamics.Controllers.b2GravityController=ui,P.Dynamics.Controllers.b2TensorDampingController=xi,P.Dynamics.Joints.b2DistanceJoint=fi,P.Dynamics.Joints.b2DistanceJointDef=di,P.Dynamics.Joints.b2FrictionJoint=bi,P.Dynamics.Joints.b2FrictionJointDef=vi,P.Dynamics.Joints.b2GearJoint=Ci,P.Dynamics.Joints.b2GearJointDef=Ai,P.Dynamics.Joints.b2Jacobian=Si,P.Dynamics.Joints.b2Joint=gi,P.Dynamics.Joints.b2JointDef=wi,P.Dynamics.Joints.b2JointEdge=Di,P.Dynamics.Joints.b2LineJoint=Bi,P.Dynamics.Joints.b2LineJointDef=Mi,P.Dynamics.Joints.b2MouseJoint=Vi,P.Dynamics.Joints.b2MouseJointDef=Ii,P.Dynamics.Joints.b2PrismaticJoint=Gi,P.Dynamics.Joints.b2PrismaticJointDef=Li,P.Dynamics.Joints.b2PulleyJoint=Ji,P.Dynamics.Joints.b2PulleyJointDef=Fi,P.Dynamics.Joints.b2RevoluteJoint=Pi,P.Dynamics.Joints.b2RevoluteJointDef=Ri,P.Dynamics.Joints.b2WeldJoint=Ti,P.Dynamics.Joints.b2WeldJointDef=ki,P.postDefs=[],o=P.Collision.Shapes.b2CircleShape,P.Collision.Shapes.b2EdgeChainDef,P.Collision.Shapes.b2EdgeShape,P.Collision.Shapes.b2MassData,s=P.Collision.Shapes.b2PolygonShape,r=P.Collision.Shapes.b2Shape,P.Common.b2Color,P.Common.b2internal,D=P.Common.b2Settings,P.Common.Math.b2Mat22,P.Common.Math.b2Mat33,S=P.Common.Math.b2Math,i=P.Common.Math.b2Sweep,a=P.Common.Math.b2Transform,g=P.Common.Math.b2Vec2,P.Common.Math.b2Vec3,x=P.Collision.b2AABB,l=P.Collision.b2Bound,m=P.Collision.b2BoundValues,B=P.Collision.b2Collision,c=P.Collision.b2ContactID,h=P.Collision.b2ContactPoint,b=P.Collision.b2Distance,_=P.Collision.b2DistanceInput,p=P.Collision.b2DistanceOutput,y=P.Collision.b2DistanceProxy,u=P.Collision.b2DynamicTree,f=P.Collision.b2DynamicTreeBroadPhase,d=P.Collision.b2DynamicTreeNode,v=P.Collision.b2DynamicTreePair,M=P.Collision.b2Manifold,C=P.Collision.b2ManifoldPoint,A=P.Collision.b2Point,w=P.Collision.b2RayCastInput,V=P.Collision.b2RayCastOutput,I=P.Collision.b2Segment,G=P.Collision.b2SeparationFunction,L=P.Collision.b2Simplex,J=P.Collision.b2SimplexCache,F=P.Collision.b2SimplexVertex,R=P.Collision.b2TimeOfImpact,T=P.Collision.b2TOIInput,E=P.Collision.b2WorldManifold,k=P.Collision.ClipVertex,z=P.Collision.Features,N=P.Collision.IBroadPhase,x.b2AABB=function(){this.lowerBound=new g,this.upperBound=new g},x.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,i=this.upperBound.y-this.lowerBound.y;return 0<=t&&0<=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},x.prototype.GetCenter=function(){return new g((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},x.prototype.GetExtents=function(){return new g((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},x.prototype.Contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},x.prototype.RayCast=function(t,i){var o=-Number.MAX_VALUE,e=Number.MAX_VALUE,n=i.p1.x,s=i.p1.y,r=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y,l=Math.abs(r),m=Math.abs(a),c=t.normal,h=0,_=0,p=0,y=0,i=0;if(l<Number.MIN_VALUE){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else if(h=1/r,_=(this.lowerBound.x-n)*h,i=-1,(p=(this.upperBound.x-n)*h)<_&&(y=_,_=p,p=y,i=1),o<_&&(c.x=i,c.y=0,o=_),(e=Math.min(e,p))<o)return!1;if(m<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else if(h=1/a,_=(this.lowerBound.y-s)*h,i=-1,(p=(this.upperBound.y-s)*h)<_&&(y=_,_=p,p=y,i=1),o<_&&(c.y=i,c.x=0,o=_),(e=Math.min(e,p))<o)return!1;return t.fraction=o,!0},x.prototype.TestOverlap=function(t){var i=t.lowerBound.x-this.upperBound.x,o=t.lowerBound.y-this.upperBound.y,e=this.lowerBound.x-t.upperBound.x,t=this.lowerBound.y-t.upperBound.y;return!(0<i||0<o)&&!(0<e||0<t)},x.Combine=function(t,i){var o=new x;return o.Combine(t,i),o},x.prototype.Combine=function(t,i){this.lowerBound.x=Math.min(t.lowerBound.x,i.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,i.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,i.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,i.upperBound.y)},l.b2Bound=function(){},l.prototype.IsLower=function(){return 0==(1&this.value)},l.prototype.IsUpper=function(){return 1==(1&this.value)},l.prototype.Swap=function(t){var i=this.value,o=this.proxy,e=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=i,t.proxy=o,t.stabbingCount=e},m.b2BoundValues=function(){},m.prototype.b2BoundValues=function(){this.lowerValues=new O,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new O,this.upperValues[0]=0,this.upperValues[1]=0},B.b2Collision=function(){},B.ClipSegmentToLine=function(t,i,o,e){void 0===e&&(e=0);var n,s=0,r=(n=i[0]).v,a=(n=i[1]).v,l=o.x*r.x+o.y*r.y-e,o=o.x*a.x+o.y*a.y-e;return l<=0&&t[s++].Set(i[0]),o<=0&&t[s++].Set(i[1]),l*o<0&&(e=l/(l-o),(o=(n=t[s]).v).x=r.x+e*(a.x-r.x),o.y=r.y+e*(a.y-r.y),n=t[s],i=0<l?i[0]:i[1],n.id=i.id,++s),s},B.EdgeSeparation=function(t,i,o,e,n){void 0===o&&(o=0);parseInt(t.m_vertexCount);for(var s=t.m_vertices,r=t.m_normals,a=parseInt(e.m_vertexCount),l=e.m_vertices,t=i.R,m=r[o],e=t.col1.x*m.x+t.col2.x*m.y,r=t.col1.y*m.x+t.col2.y*m.y,c=(t=n.R).col1.x*e+t.col1.y*r,h=t.col2.x*e+t.col2.y*r,_=0,p=Number.MAX_VALUE,y=0;y<a;++y){var u=(m=l[y]).x*c+m.y*h;u<p&&(p=u,_=y)}m=s[o],t=i.R;s=i.position.x+(t.col1.x*m.x+t.col2.x*m.y),o=i.position.y+(t.col1.y*m.x+t.col2.y*m.y);m=l[_],t=n.R;i=n.position.x+(t.col1.x*m.x+t.col2.x*m.y),t=n.position.y+(t.col1.y*m.x+t.col2.y*m.y);return(i-=s)*e+(t-=o)*r},B.FindMaxSeparation=function(t,i,o,e,n){var s=parseInt(i.m_vertexCount),r=i.m_normals,a=n.R,l=e.m_centroid,m=n.position.x+(a.col1.x*l.x+a.col2.x*l.y),c=n.position.y+(a.col1.y*l.x+a.col2.y*l.y);a=o.R,l=i.m_centroid,m-=o.position.x+(a.col1.x*l.x+a.col2.x*l.y),c-=o.position.y+(a.col1.y*l.x+a.col2.y*l.y);for(var h=m*o.R.col1.x+c*o.R.col1.y,_=m*o.R.col2.x+c*o.R.col2.y,p=0,y=-Number.MAX_VALUE,u=0;u<s;++u){var x=(l=r[u]).x*h+l.y*_;y<x&&(y=x,p=u)}var f=B.EdgeSeparation(i,o,p,e,n),d=parseInt(0<=p-1?p-1:s-1),a=B.EdgeSeparation(i,o,d,e,n),m=parseInt(p+1<s?p+1:0),c=B.EdgeSeparation(i,o,m,e,n),b=0,v=0,C=0;if(f<a&&c<a)C=-1,b=d,v=a;else{if(!(f<c))return t[0]=p,f;C=1,b=m,v=c}for(;p=-1==C?0<=b-1?b-1:s-1:b+1<s?b+1:0,v<(f=B.EdgeSeparation(i,o,p,e,n));)b=p,v=f;return t[0]=b,v},B.FindIncidentEdge=function(t,i,o,e,n,s){void 0===e&&(e=0);parseInt(i.m_vertexCount);for(var r=i.m_normals,a=parseInt(n.m_vertexCount),l=n.m_vertices,m=n.m_normals,i=o.R,c=r[e],h=i.col1.x*c.x+i.col2.x*c.y,_=i.col1.y*c.x+i.col2.y*c.y,n=(i=s.R).col1.x*h+i.col1.y*_,_=i.col2.x*h+i.col2.y*_,h=n,p=0,y=Number.MAX_VALUE,u=0;u<a;++u){var x=h*(c=m[u]).x+_*c.y;x<y&&(y=x,p=u)}o=parseInt(p),r=parseInt(o+1<a?o+1:0),n=t[0];c=l[o],i=s.R,n.v.x=s.position.x+(i.col1.x*c.x+i.col2.x*c.y),n.v.y=s.position.y+(i.col1.y*c.x+i.col2.y*c.y),n.id.features.referenceEdge=e,n.id.features.incidentEdge=o,n.id.features.incidentVertex=0,n=t[1],c=l[r],i=s.R,n.v.x=s.position.x+(i.col1.x*c.x+i.col2.x*c.y),n.v.y=s.position.y+(i.col1.y*c.x+i.col2.y*c.y),n.id.features.referenceEdge=e,n.id.features.incidentEdge=r,n.id.features.incidentVertex=1},B.MakeClipPointVector=function(){var t=new q(2);return t[0]=new k,t[1]=new k,t},B.CollidePolygons=function(t,i,o,e,n){t.m_pointCount=0;var s=i.m_radius+e.m_radius,r=0;B.s_edgeAO[0]=0;var a=B.FindMaxSeparation(B.s_edgeAO,i,o,e,n),r=B.s_edgeAO[0];if(!(s<a)){B.s_edgeBO[0]=0;var l=B.FindMaxSeparation(B.s_edgeBO,e,n,i,o),m=B.s_edgeBO[0];if(!(s<l)){var c,h,_=0,p=0,p=.98*a+.001<l?(u=e,y=i,c=n,h=o,_=m,t.m_type=M.e_faceB,1):(u=i,y=e,c=o,h=n,_=r,t.m_type=M.e_faceA,0),m=B.s_incidentEdge;B.FindIncidentEdge(m,u,c,_,y,h);i=parseInt(u.m_vertexCount),e=u.m_vertices,o=e[_],n=_+1<i?e[parseInt(_+1)]:e[0],r=B.s_localTangent;r.Set(n.x-o.x,n.y-o.y),r.Normalize();var y=B.s_localNormal;y.x=r.y,y.y=-r.x;var u=B.s_planePoint;u.Set(.5*(o.x+n.x),.5*(o.y+n.y));i=B.s_tangent;A=c.R,i.x=A.col1.x*r.x+A.col2.x*r.y,i.y=A.col1.y*r.x+A.col2.y*r.y;_=B.s_tangent2;_.x=-i.x,_.y=-i.y;var x=B.s_normal;x.x=i.y,x.y=-i.x;e=B.s_v11,r=B.s_v12;e.x=c.position.x+(A.col1.x*o.x+A.col2.x*o.y),e.y=c.position.y+(A.col1.y*o.x+A.col2.y*o.y),r.x=c.position.x+(A.col1.x*n.x+A.col2.x*n.y),r.y=c.position.y+(A.col1.y*n.x+A.col2.y*n.y);var f=x.x*e.x+x.y*e.y,n=-i.x*e.x-i.y*e.y+s,e=i.x*r.x+i.y*r.y+s,r=B.s_clipPoints1,d=B.s_clipPoints2;if(!(B.ClipSegmentToLine(r,m,_,n)<2||B.ClipSegmentToLine(d,r,i,e)<2)){t.m_localPlaneNormal.SetV(y),t.m_localPoint.SetV(u);for(var b=0,v=0;v<D.b2_maxManifoldPoints;++v){var C,A,S,g,w=d[v];x.x*w.v.x+x.y*w.v.y-f<=s&&(C=t.m_points[b],A=h.R,S=w.v.x-h.position.x,g=w.v.y-h.position.y,C.m_localPoint.x=S*A.col1.x+g*A.col1.y,C.m_localPoint.y=S*A.col2.x+g*A.col2.y,C.m_id.Set(w.id),C.m_id.features.flip=p,++b)}t.m_pointCount=b}}}},B.CollideCircles=function(t,i,o,e,n){t.m_pointCount=0,r=o.R,a=i.m_p;var s=o.position.x+(r.col1.x*a.x+r.col2.x*a.y),o=o.position.y+(r.col1.y*a.x+r.col2.y*a.y),r=n.R,a=e.m_p,s=n.position.x+(r.col1.x*a.x+r.col2.x*a.y)-s,o=n.position.y+(r.col1.y*a.x+r.col2.y*a.y)-o,s=s*s+o*o,o=i.m_radius+e.m_radius;o*o<s||(t.m_type=M.e_circles,t.m_localPoint.SetV(i.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0)},B.CollidePolygonAndCircle=function(t,i,o,e,n){for(var s=t.m_pointCount=0,r=n.R,a=e.m_p,l=n.position.x+(r.col1.x*a.x+r.col2.x*a.y),n=n.position.y+(r.col1.y*a.x+r.col2.y*a.y),s=l-o.position.x,m=n-o.position.y,c=s*(r=o.R).col1.x+m*r.col1.y,h=s*r.col2.x+m*r.col2.y,_=0,p=-Number.MAX_VALUE,y=i.m_radius+e.m_radius,u=parseInt(i.m_vertexCount),x=i.m_vertices,f=i.m_normals,d=0;d<u;++d){s=c-(a=x[d]).x,m=h-a.y;var b=(a=f[d]).x*s+a.y*m;if(y<b)return;p<b&&(p=b,_=d)}l=parseInt(_),n=parseInt(l+1<u?l+1:0),o=x[l],r=x[n];if(p<Number.MIN_VALUE)return t.m_pointCount=1,t.m_type=M.e_faceA,t.m_localPlaneNormal.SetV(f[_]),t.m_localPoint.x=.5*(o.x+r.x),t.m_localPoint.y=.5*(o.y+r.y),t.m_points[0].m_localPoint.SetV(e.m_p),void(t.m_points[0].m_id.key=0);i=(c-o.x)*(r.x-o.x)+(h-o.y)*(r.y-o.y),n=(c-r.x)*(o.x-r.x)+(h-r.y)*(o.y-r.y);i<=0?(c-o.x)*(c-o.x)+(h-o.y)*(h-o.y)>y*y||(t.m_pointCount=1,t.m_type=M.e_faceA,t.m_localPlaneNormal.x=c-o.x,t.m_localPlaneNormal.y=h-o.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(o),t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0):n<=0?(c-r.x)*(c-r.x)+(h-r.y)*(h-r.y)>y*y||(t.m_pointCount=1,t.m_type=M.e_faceA,t.m_localPlaneNormal.x=c-r.x,t.m_localPlaneNormal.y=h-r.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(r),t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0):(n=.5*(o.x+r.x),r=.5*(o.y+r.y),y<(p=(c-n)*f[l].x+(h-r)*f[l].y)||(t.m_pointCount=1,t.m_type=M.e_faceA,t.m_localPlaneNormal.x=f[l].x,t.m_localPlaneNormal.y=f[l].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(n,r),t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0))},B.TestOverlap=function(t,i){var o=i.lowerBound,e=t.upperBound,n=o.x-e.x,s=o.y-e.y,o=t.lowerBound,e=i.upperBound,i=o.x-e.x,e=o.y-e.y;return!(0<n||0<s)&&!(0<i||0<e)},P.postDefs.push(function(){P.Collision.b2Collision.s_incidentEdge=B.MakeClipPointVector(),P.Collision.b2Collision.s_clipPoints1=B.MakeClipPointVector(),P.Collision.b2Collision.s_clipPoints2=B.MakeClipPointVector(),P.Collision.b2Collision.s_edgeAO=new O(1),P.Collision.b2Collision.s_edgeBO=new O(1),P.Collision.b2Collision.s_localTangent=new g,P.Collision.b2Collision.s_localNormal=new g,P.Collision.b2Collision.s_planePoint=new g,P.Collision.b2Collision.s_normal=new g,P.Collision.b2Collision.s_tangent=new g,P.Collision.b2Collision.s_tangent2=new g,P.Collision.b2Collision.s_v11=new g,P.Collision.b2Collision.s_v12=new g,P.Collision.b2Collision.b2CollidePolyTempVec=new g,P.Collision.b2Collision.b2_nullFeature=255}),c.b2ContactID=function(){this.features=new z},c.prototype.b2ContactID=function(){this.features._m_id=this},c.prototype.Set=function(t){this.key=t._key},c.prototype.Copy=function(){var t=new c;return t.key=this.key,t},Object.defineProperty(c.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(c.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),h.b2ContactPoint=function(){this.position=new g,this.velocity=new g,this.normal=new g,this.id=new c},b.b2Distance=function(){},b.Distance=function(t,i,o){++b.b2_gjkCalls;var e=o.proxyA,n=o.proxyB,s=o.transformA,r=o.transformB,a=b.s_simplex;a.ReadCache(i,e,s,n,r);for(var l,m,c,h=a.m_vertices,_=b.s_saveA,p=b.s_saveB,y=(a.GetClosestPoint().LengthSquared(),0),u=0;u<20;){for(l=a.m_count,y=0;y<l;y++)_[y]=h[y].indexA,p[y]=h[y].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3();break;default:D.b2Assert(!1)}if(3==a.m_count)break;(m=a.GetClosestPoint()).LengthSquared();var x=a.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var f=h[a.m_count];f.indexA=e.GetSupport(S.MulTMV(s.R,x.GetNegative())),f.wA=S.MulX(s,e.GetVertex(f.indexA)),f.indexB=n.GetSupport(S.MulTMV(r.R,x)),f.wB=S.MulX(r,n.GetVertex(f.indexB)),f.w=S.SubtractVV(f.wB,f.wA),++u,++b.b2_gjkIters;for(var d=!1,y=0;y<l;y++)if(f.indexA==_[y]&&f.indexB==p[y]){d=!0;break}if(d)break;++a.m_count}b.b2_gjkMaxIters=S.Max(b.b2_gjkMaxIters,u),a.GetWitnessPoints(t.pointA,t.pointB),t.distance=S.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=u,a.WriteCache(i),o.useRadii&&(c=e.m_radius,i=n.m_radius,t.distance>c+i&&t.distance>Number.MIN_VALUE?(t.distance-=c+i,(o=S.SubtractVV(t.pointB,t.pointA)).Normalize(),t.pointA.x+=c*o.x,t.pointA.y+=c*o.y,t.pointB.x-=i*o.x,t.pointB.y-=i*o.y):((m=new g).x=.5*(t.pointA.x+t.pointB.x),m.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=m.x,t.pointA.y=t.pointB.y=m.y,t.distance=0))},P.postDefs.push(function(){P.Collision.b2Distance.s_simplex=new L,P.Collision.b2Distance.s_saveA=new O(3),P.Collision.b2Distance.s_saveB=new O(3)}),_.b2DistanceInput=function(){},p.b2DistanceOutput=function(){this.pointA=new g,this.pointB=new g},y.b2DistanceProxy=function(){},y.prototype.Set=function(t){switch(t.GetType()){case r.e_circleShape:var i=t instanceof o?t:null;this.m_vertices=new q(1,!0),this.m_vertices[0]=i.m_p,this.m_count=1,this.m_radius=i.m_radius;break;case r.e_polygonShape:t=t instanceof s?t:null;this.m_vertices=t.m_vertices,this.m_count=t.m_vertexCount,this.m_radius=t.m_radius;break;default:D.b2Assert(!1)}},y.prototype.GetSupport=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_count;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;o<n&&(i=e,o=n)}return i},y.prototype.GetSupportVertex=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_count;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;o<n&&(i=e,o=n)}return this.m_vertices[i]},y.prototype.GetVertexCount=function(){return this.m_count},y.prototype.GetVertex=function(t){return void 0===t&&(t=0),D.b2Assert(0<=t&&t<this.m_count),this.m_vertices[t]},u.b2DynamicTree=function(){},u.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},u.prototype.CreateProxy=function(t,i){var o=this.AllocateNode(),e=D.b2_aabbExtension,n=D.b2_aabbExtension;return o.aabb.lowerBound.x=t.lowerBound.x-e,o.aabb.lowerBound.y=t.lowerBound.y-n,o.aabb.upperBound.x=t.upperBound.x+e,o.aabb.upperBound.y=t.upperBound.y+n,o.userData=i,this.InsertLeaf(o),o},u.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},u.prototype.MoveProxy=function(t,i,o){if(D.b2Assert(t.IsLeaf()),t.aabb.Contains(i))return!1;this.RemoveLeaf(t);var e=D.b2_aabbExtension+D.b2_aabbMultiplier*(0<o.x?o.x:-o.x),o=D.b2_aabbExtension+D.b2_aabbMultiplier*(0<o.y?o.y:-o.y);return t.aabb.lowerBound.x=i.lowerBound.x-e,t.aabb.lowerBound.y=i.lowerBound.y-o,t.aabb.upperBound.x=i.upperBound.x+e,t.aabb.upperBound.y=i.upperBound.y+o,this.InsertLeaf(t),!0},u.prototype.Rebalance=function(t){if(void 0===t&&(t=0),null!=this.m_root)for(var i=0;i<t;i++){for(var o=this.m_root,e=0;0==o.IsLeaf();)o=this.m_path>>e&1?o.child2:o.child1,e=e+1&31;++this.m_path,this.RemoveLeaf(o),this.InsertLeaf(o)}},u.prototype.GetFatAABB=function(t){return t.aabb},u.prototype.GetUserData=function(t){return t.userData},u.prototype.Query=function(t,i){if(null!=this.m_root){var o=new q,e=0;for(o[e++]=this.m_root;0<e;){var n=o[--e];if(n.aabb.TestOverlap(i))if(n.IsLeaf()){if(!t(n))return}else o[e++]=n.child1,o[e++]=n.child2}}},u.prototype.RayCast=function(t,i){if(null!=this.m_root){var o=i.p1,e=i.p2,n=S.SubtractVV(o,e);n.Normalize();var s=S.CrossFV(1,n),r=S.AbsV(s),a=i.maxFraction,l=new x,m=o.x+a*(e.x-o.x),c=o.y+a*(e.y-o.y);l.lowerBound.x=Math.min(o.x,m),l.lowerBound.y=Math.min(o.y,c),l.upperBound.x=Math.max(o.x,m),l.upperBound.y=Math.max(o.y,c);var h=new q,_=0;for(h[_++]=this.m_root;0<_;){var p=h[--_];if(0!=p.aabb.TestOverlap(l)){var y=p.aabb.GetCenter(),u=p.aabb.GetExtents();if(!(0<Math.abs(s.x*(o.x-y.x)+s.y*(o.y-y.y))-r.x*u.x-r.y*u.y))if(p.IsLeaf()){u=new w;if(u.p1=i.p1,u.p2=i.p2,u.maxFraction=i.maxFraction,0==(a=t(u,p)))return;0<a&&(m=o.x+a*(e.x-o.x),c=o.y+a*(e.y-o.y),l.lowerBound.x=Math.min(o.x,m),l.lowerBound.y=Math.min(o.y,c),l.upperBound.x=Math.max(o.x,m),l.upperBound.y=Math.max(o.y,c))}else h[_++]=p.child1,h[_++]=p.child2}}}},u.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new d},u.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},u.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);var i=t.aabb.GetCenter();if(0==(n=this.m_root).IsLeaf())do{var o=n.child1,e=n.child2,n=Math.abs((o.aabb.lowerBound.x+o.aabb.upperBound.x)/2-i.x)+Math.abs((o.aabb.lowerBound.y+o.aabb.upperBound.y)/2-i.y)<Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-i.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-i.y)?o:e}while(0==n.IsLeaf());var s=n.parent,r=this.AllocateNode();if(r.parent=s,r.userData=null,r.aabb.Combine(t.aabb,n.aabb),s)for(n.parent.child1==n?s.child1=r:s.child2=r,r.child1=n,r.child2=t,n.parent=r,t.parent=r;!s.aabb.Contains(r.aabb)&&(s.aabb.Combine(s.child1.aabb,s.child2.aabb),s=(r=s).parent););else r.child1=n,r.child2=t,n.parent=r,t.parent=r,this.m_root=r},u.prototype.RemoveLeaf=function(t){if(t!=this.m_root){var i=t.parent,o=i.parent,t=i.child1==t?i.child2:i.child1;if(o)for(o.child1==i?o.child1=t:o.child2=t,t.parent=o,this.FreeNode(i);o;){var e=o.aabb;if(o.aabb=x.Combine(o.child1.aabb,o.child2.aabb),e.Contains(o.aabb))break;o=o.parent}else(this.m_root=t).parent=null,this.FreeNode(i)}else this.m_root=null},f.b2DynamicTreeBroadPhase=function(){this.m_tree=new u,this.m_moveBuffer=new q,this.m_pairBuffer=new q,this.m_pairCount=0},f.prototype.CreateProxy=function(t,i){i=this.m_tree.CreateProxy(t,i);return++this.m_proxyCount,this.BufferMove(i),i},f.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},f.prototype.MoveProxy=function(t,i,o){this.m_tree.MoveProxy(t,i,o)&&this.BufferMove(t)},f.prototype.TestOverlap=function(t,i){t=this.m_tree.GetFatAABB(t),i=this.m_tree.GetFatAABB(i);return t.TestOverlap(i)},f.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},f.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},f.prototype.GetProxyCount=function(){return this.m_proxyCount},f.prototype.UpdatePairs=function(t){var o,e=this,i=e.m_pairCount=0;function n(t){if(t==o)return!0;e.m_pairCount==e.m_pairBuffer.length&&(e.m_pairBuffer[e.m_pairCount]=new v);var i=e.m_pairBuffer[e.m_pairCount];return i.proxyA=t<o?t:o,i.proxyB=o<=t?t:o,++e.m_pairCount,!0}for(i=0;i<e.m_moveBuffer.length;++i){o=e.m_moveBuffer[i];var s=e.m_tree.GetFatAABB(o);e.m_tree.Query(n,s)}for(i=e.m_moveBuffer.length=0;i<e.m_pairCount;){var r=e.m_pairBuffer[i];for(t(e.m_tree.GetUserData(r.proxyA),e.m_tree.GetUserData(r.proxyB)),++i;i<e.m_pairCount;){var a=e.m_pairBuffer[i];if(a.proxyA!=r.proxyA||a.proxyB!=r.proxyB)break;++i}}},f.prototype.Query=function(t,i){this.m_tree.Query(t,i)},f.prototype.RayCast=function(t,i){this.m_tree.RayCast(t,i)},f.prototype.Validate=function(){},f.prototype.Rebalance=function(t){void 0===t&&(t=0),this.m_tree.Rebalance(t)},f.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},f.prototype.UnBufferMove=function(t){t=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(t,1)},f.prototype.ComparePairs=function(t,i){return 0},f.__implements={},f.__implements[N]=!0,d.b2DynamicTreeNode=function(){this.aabb=new x},d.prototype.IsLeaf=function(){return null==this.child1},v.b2DynamicTreePair=function(){},M.b2Manifold=function(){this.m_pointCount=0},M.prototype.b2Manifold=function(){this.m_points=new q(D.b2_maxManifoldPoints);for(var t=0;t<D.b2_maxManifoldPoints;t++)this.m_points[t]=new C;this.m_localPlaneNormal=new g,this.m_localPoint=new g},M.prototype.Reset=function(){for(var t=0;t<D.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof C?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},M.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var i=0;i<D.b2_maxManifoldPoints;i++)(this.m_points[i]instanceof C?this.m_points[i]:null).Set(t.m_points[i]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},M.prototype.Copy=function(){var t=new M;return t.Set(this),t},P.postDefs.push(function(){P.Collision.b2Manifold.e_circles=1,P.Collision.b2Manifold.e_faceA=2,P.Collision.b2Manifold.e_faceB=4}),C.b2ManifoldPoint=function(){this.m_localPoint=new g,this.m_id=new c},C.prototype.b2ManifoldPoint=function(){this.Reset()},C.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},C.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},A.b2Point=function(){this.p=new g},A.prototype.Support=function(t,i,o){return void 0===i&&(i=0),void 0===o&&(o=0),this.p},A.prototype.GetFirstVertex=function(t){return this.p},w.b2RayCastInput=function(){this.p1=new g,this.p2=new g},w.prototype.b2RayCastInput=function(t,i,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===o&&(o=1),t&&this.p1.SetV(t),i&&this.p2.SetV(i),this.maxFraction=o},V.b2RayCastOutput=function(){this.normal=new g},I.b2Segment=function(){this.p1=new g,this.p2=new g},I.prototype.TestSegment=function(t,i,o,e){void 0===e&&(e=0);var n=o.p1,s=o.p2.x-n.x,r=o.p2.y-n.y,a=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y,m=-a,c=100*Number.MIN_VALUE,h=-(s*l+r*m);if(c<h){o=n.x-this.p1.x,a=n.y-this.p1.y,n=o*l+a*m;if(0<=n&&n<=e*h){o=-s*a+r*o;if(-c*h<=o&&o<=h*(1+c)){n/=h;h=Math.sqrt(l*l+m*m);return l/=h,m/=h,t[0]=n,i.Set(l,m),!0}}}return!1},I.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},I.prototype.ExtendForward=function(t){var i=this.p2.x-this.p1.x,o=this.p2.y-this.p1.y,t=Math.min(0<i?(t.upperBound.x-this.p1.x)/i:i<0?(t.lowerBound.x-this.p1.x)/i:Number.POSITIVE_INFINITY,0<o?(t.upperBound.y-this.p1.y)/o:o<0?(t.lowerBound.y-this.p1.y)/o:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+i*t,this.p2.y=this.p1.y+o*t},I.prototype.ExtendBackward=function(t){var i=-this.p2.x+this.p1.x,o=-this.p2.y+this.p1.y,t=Math.min(0<i?(t.upperBound.x-this.p2.x)/i:i<0?(t.lowerBound.x-this.p2.x)/i:Number.POSITIVE_INFINITY,0<o?(t.upperBound.y-this.p2.y)/o:o<0?(t.lowerBound.y-this.p2.y)/o:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+i*t,this.p1.y=this.p2.y+o*t},G.b2SeparationFunction=function(){this.m_localPoint=new g,this.m_axis=new g},G.prototype.Initialize=function(t,i,o,e,n){this.m_proxyA=i,this.m_proxyB=e;var s,r,a,l,m,c,h=parseInt(t.count);D.b2Assert(0<h&&h<3);var _,p,y,u,x=0,f=0,d=0,b=0,v=0,C=0,A=0;1==h?(this.m_type=G.e_points,s=this.m_proxyA.GetVertex(t.indexA[0]),l=this.m_proxyB.GetVertex(t.indexB[0]),p=s,_=o.R,x=o.position.x+(_.col1.x*p.x+_.col2.x*p.y),f=o.position.y+(_.col1.y*p.x+_.col2.y*p.y),p=l,_=n.R,d=n.position.x+(_.col1.x*p.x+_.col2.x*p.y),b=n.position.y+(_.col1.y*p.x+_.col2.y*p.y),this.m_axis.x=d-x,this.m_axis.y=b-f,this.m_axis.Normalize()):t.indexB[0]==t.indexB[1]?(this.m_type=G.e_faceA,r=this.m_proxyA.GetVertex(t.indexA[0]),a=this.m_proxyA.GetVertex(t.indexA[1]),l=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(r.x+a.x),this.m_localPoint.y=.5*(r.y+a.y),this.m_axis=S.CrossVF(S.SubtractVV(a,r),1),this.m_axis.Normalize(),p=this.m_axis,v=(_=o.R).col1.x*p.x+_.col2.x*p.y,C=_.col1.y*p.x+_.col2.y*p.y,p=this.m_localPoint,_=o.R,x=o.position.x+(_.col1.x*p.x+_.col2.x*p.y),f=o.position.y+(_.col1.y*p.x+_.col2.y*p.y),p=l,_=n.R,(A=((d=n.position.x+(_.col1.x*p.x+_.col2.x*p.y))-x)*v+((b=n.position.y+(_.col1.y*p.x+_.col2.y*p.y))-f)*C)<0&&this.m_axis.NegativeSelf()):t.indexA[0]==t.indexA[0]?(this.m_type=G.e_faceB,m=this.m_proxyB.GetVertex(t.indexB[0]),c=this.m_proxyB.GetVertex(t.indexB[1]),s=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(m.x+c.x),this.m_localPoint.y=.5*(m.y+c.y),this.m_axis=S.CrossVF(S.SubtractVV(c,m),1),this.m_axis.Normalize(),p=this.m_axis,v=(_=n.R).col1.x*p.x+_.col2.x*p.y,C=_.col1.y*p.x+_.col2.y*p.y,p=this.m_localPoint,_=n.R,d=n.position.x+(_.col1.x*p.x+_.col2.x*p.y),b=n.position.y+(_.col1.y*p.x+_.col2.y*p.y),p=s,_=o.R,(A=((x=o.position.x+(_.col1.x*p.x+_.col2.x*p.y))-d)*v+((f=o.position.y+(_.col1.y*p.x+_.col2.y*p.y))-b)*C)<0&&this.m_axis.NegativeSelf()):(r=this.m_proxyA.GetVertex(t.indexA[0]),a=this.m_proxyA.GetVertex(t.indexA[1]),m=this.m_proxyB.GetVertex(t.indexB[0]),c=this.m_proxyB.GetVertex(t.indexB[1]),S.MulX(o,s),y=S.MulMV(o.R,S.SubtractVV(a,r)),S.MulX(n,l),u=S.MulMV(n.R,S.SubtractVV(c,m)),i=y.x*y.x+y.y*y.y,e=u.x*u.x+u.y*u.y,h=S.SubtractVV(u,y),t=y.x*h.x+y.y*h.y,h=u.x*h.x+u.y*h.y,(A=0)!=(u=i*e-(y=y.x*u.x+y.y*u.y)*y)&&(A=S.Clamp((y*h-t*e)/u,0,1)),(y*A+h)/e<0&&(A=S.Clamp((y-t)/i,0,1)),(s=new g).x=r.x+A*(a.x-r.x),s.y=r.y+A*(a.y-r.y),(l=new g).x=m.x+A*(c.x-m.x),l.y=m.y+A*(c.y-m.y),0==A||1==A?(this.m_type=G.e_faceB,this.m_axis=S.CrossVF(S.SubtractVV(c,m),1),this.m_axis.Normalize(),this.m_localPoint=l,p=this.m_axis,v=(_=n.R).col1.x*p.x+_.col2.x*p.y,C=_.col1.y*p.x+_.col2.y*p.y,p=this.m_localPoint,_=n.R,d=n.position.x+(_.col1.x*p.x+_.col2.x*p.y),b=n.position.y+(_.col1.y*p.x+_.col2.y*p.y),p=s,_=o.R,x=o.position.x+(_.col1.x*p.x+_.col2.x*p.y),f=o.position.y+(_.col1.y*p.x+_.col2.y*p.y)):(this.m_type=G.e_faceA,this.m_axis=S.CrossVF(S.SubtractVV(a,r),1),this.m_localPoint=s,p=this.m_axis,v=(_=o.R).col1.x*p.x+_.col2.x*p.y,C=_.col1.y*p.x+_.col2.y*p.y,p=this.m_localPoint,_=o.R,x=o.position.x+(_.col1.x*p.x+_.col2.x*p.y),f=o.position.y+(_.col1.y*p.x+_.col2.y*p.y),p=l,_=n.R,d=n.position.x+(_.col1.x*p.x+_.col2.x*p.y),b=n.position.y+(_.col1.y*p.x+_.col2.y*p.y)),A<0&&this.m_axis.NegativeSelf())},G.prototype.Evaluate=function(t,i){var o,e,n,s,r,a,l;switch(this.m_type){case G.e_points:return o=S.MulTMV(t.R,this.m_axis),e=S.MulTMV(i.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(o),s=this.m_proxyB.GetSupportVertex(e),r=S.MulX(t,n),((a=S.MulX(i,s)).x-r.x)*this.m_axis.x+(a.y-r.y)*this.m_axis.y;case G.e_faceA:return l=S.MulMV(t.R,this.m_axis),r=S.MulX(t,this.m_localPoint),e=S.MulTMV(i.R,l.GetNegative()),s=this.m_proxyB.GetSupportVertex(e),((a=S.MulX(i,s)).x-r.x)*l.x+(a.y-r.y)*l.y;case G.e_faceB:return l=S.MulMV(i.R,this.m_axis),a=S.MulX(i,this.m_localPoint),o=S.MulTMV(t.R,l.GetNegative()),n=this.m_proxyA.GetSupportVertex(o),((r=S.MulX(t,n)).x-a.x)*l.x+(r.y-a.y)*l.y;default:return D.b2Assert(!1),0}},P.postDefs.push(function(){P.Collision.b2SeparationFunction.e_points=1,P.Collision.b2SeparationFunction.e_faceA=2,P.Collision.b2SeparationFunction.e_faceB=4}),L.b2Simplex=function(){this.m_v1=new F,this.m_v2=new F,this.m_v3=new F,this.m_vertices=new q(3)},L.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},L.prototype.ReadCache=function(t,i,o,e,n){var s,r;D.b2Assert(0<=t.count&&t.count<=3),this.m_count=t.count;for(var a,l,m=this.m_vertices,c=0;c<this.m_count;c++){var h=m[c];h.indexA=t.indexA[c],h.indexB=t.indexB[c],s=i.GetVertex(h.indexA),r=e.GetVertex(h.indexB),h.wA=S.MulX(o,s),h.wB=S.MulX(n,r),h.w=S.SubtractVV(h.wB,h.wA),h.a=0}1<this.m_count&&(a=t.metric,((l=this.GetMetric())<.5*a||2*a<l||l<Number.MIN_VALUE)&&(this.m_count=0)),0==this.m_count&&((h=m[0]).indexA=0,h.indexB=0,s=i.GetVertex(0),r=e.GetVertex(0),h.wA=S.MulX(o,s),h.wB=S.MulX(n,r),h.w=S.SubtractVV(h.wB,h.wA),this.m_count=1)},L.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=P.parseUInt(this.m_count);for(var i=this.m_vertices,o=0;o<this.m_count;o++)t.indexA[o]=P.parseUInt(i[o].indexA),t.indexB[o]=P.parseUInt(i[o].indexB)},L.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=S.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<S.CrossVV(t,this.m_v1.w.GetNegative())?S.CrossFV(1,t):S.CrossVF(t,1);default:return D.b2Assert(!1),new g}},L.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return D.b2Assert(!1),new g;case 1:return this.m_v1.w;case 2:return new g(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return D.b2Assert(!1),new g}},L.prototype.GetWitnessPoints=function(t,i){switch(this.m_count){case 0:D.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),i.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,i.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,i.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:i.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,i.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:D.b2Assert(!1)}},L.prototype.GetMetric=function(){switch(this.m_count){case 0:return D.b2Assert(!1),0;case 1:return 0;case 2:return S.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return S.CrossVV(S.SubtractVV(this.m_v2.w,this.m_v1.w),S.SubtractVV(this.m_v3.w,this.m_v1.w));default:return D.b2Assert(!1),0}},L.prototype.Solve2=function(){var t=this.m_v1.w,i=this.m_v2.w,o=S.SubtractVV(i,t),t=-(t.x*o.x+t.y*o.y);if(t<=0)return this.m_v1.a=1,void(this.m_count=1);i=i.x*o.x+i.y*o.y;if(i<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);o=1/(i+t);this.m_v1.a=i*o,this.m_v2.a=t*o,this.m_count=2},L.prototype.Solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,o=this.m_v3.w,e=S.SubtractVV(i,t),n=S.Dot(t,e),s=S.Dot(i,e),r=-n,a=S.SubtractVV(o,t),l=S.Dot(t,a),m=S.Dot(o,a),c=-l,n=S.SubtractVV(o,i),l=S.Dot(i,n),n=S.Dot(o,n),l=-l,e=S.CrossVV(e,a),a=e*S.CrossVV(i,o),o=e*S.CrossVV(o,t),i=e*S.CrossVV(t,i);if(r<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<s&&0<r&&i<=0){var h=1/(s+r);return this.m_v1.a=s*h,this.m_v2.a=r*h,void(this.m_count=2)}if(0<m&&0<c&&o<=0){h=1/(m+c);return this.m_v1.a=m*h,this.m_v3.a=c*h,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(s<=0&&l<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(m<=0&&n<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(0<n&&0<l&&a<=0){var _=1/(n+l);return this.m_v2.a=n*_,this.m_v3.a=l*_,this.m_count=2,void this.m_v1.Set(this.m_v3)}_=1/(a+o+i);this.m_v1.a=a*_,this.m_v2.a=o*_,this.m_v3.a=i*_,this.m_count=3},J.b2SimplexCache=function(){this.indexA=new O(3),this.indexB=new O(3)},F.b2SimplexVertex=function(){},F.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},R.b2TimeOfImpact=function(){},R.TimeOfImpact=function(t){++R.b2_toiCalls;var i=t.proxyA,o=t.proxyB,e=t.sweepA,n=t.sweepB;D.b2Assert(e.t0==n.t0),D.b2Assert(1-e.t0>Number.MIN_VALUE);var s=i.m_radius+o.m_radius,r=t.tolerance,a=0,l=0,m=0;for(R.s_cache.count=0,R.s_distanceInput.useRadii=!1;;){if(e.GetTransform(R.s_xfA,a),n.GetTransform(R.s_xfB,a),R.s_distanceInput.proxyA=i,R.s_distanceInput.proxyB=o,R.s_distanceInput.transformA=R.s_xfA,R.s_distanceInput.transformB=R.s_xfB,b.Distance(R.s_distanceOutput,R.s_cache,R.s_distanceInput),R.s_distanceOutput.distance<=0){a=1;break}R.s_fcn.Initialize(R.s_cache,i,R.s_xfA,o,R.s_xfB);var c=R.s_fcn.Evaluate(R.s_xfA,R.s_xfB);if(c<=0){a=1;break}if(0==l&&(m=s<c?S.Max(s-r,.75*s):S.Max(c-r,.02*s)),c-m<.5*r){if(0!=l)break;a=1;break}var h=a,_=a,p=1,y=c;e.GetTransform(R.s_xfA,p),n.GetTransform(R.s_xfB,p);var u=R.s_fcn.Evaluate(R.s_xfA,R.s_xfB);if(m<=u){a=1;break}for(var x=0;;){var f=0,f=1&x?_+(m-y)*(p-_)/(u-y):.5*(_+p);e.GetTransform(R.s_xfA,f),n.GetTransform(R.s_xfB,f);var d=R.s_fcn.Evaluate(R.s_xfA,R.s_xfB);if(S.Abs(d-m)<.025*r){h=f;break}if(m<d?(_=f,y=d):(p=f,u=d),++x,++R.b2_toiRootIters,50==x)break}if(R.b2_toiMaxRootIters=S.Max(R.b2_toiMaxRootIters,x),h<(1+100*Number.MIN_VALUE)*a)break;if(a=h,l++,++R.b2_toiIters,1e3==l)break}return R.b2_toiMaxIters=S.Max(R.b2_toiMaxIters,l),a},P.postDefs.push(function(){P.Collision.b2TimeOfImpact.b2_toiCalls=0,P.Collision.b2TimeOfImpact.b2_toiIters=0,P.Collision.b2TimeOfImpact.b2_toiMaxIters=0,P.Collision.b2TimeOfImpact.b2_toiRootIters=0,P.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,P.Collision.b2TimeOfImpact.s_cache=new J,P.Collision.b2TimeOfImpact.s_distanceInput=new _,P.Collision.b2TimeOfImpact.s_xfA=new a,P.Collision.b2TimeOfImpact.s_xfB=new a,P.Collision.b2TimeOfImpact.s_fcn=new G,P.Collision.b2TimeOfImpact.s_distanceOutput=new p}),T.b2TOIInput=function(){this.proxyA=new y,this.proxyB=new y,this.sweepA=new i,this.sweepB=new i},E.b2WorldManifold=function(){this.m_normal=new g},E.prototype.b2WorldManifold=function(){this.m_points=new q(D.b2_maxManifoldPoints);for(var t=0;t<D.b2_maxManifoldPoints;t++)this.m_points[t]=new g},E.prototype.Initialize=function(t,i,o,e,n){if(void 0===o&&(o=0),void 0===n&&(n=0),0!=t.m_pointCount){var s=0,r=0,a=0,l=0,m=0,c=0,h=0;switch(t.m_type){case M.e_circles:y=i.R,u=t.m_localPoint;var _=i.position.x+y.col1.x*u.x+y.col2.x*u.y,p=i.position.y+y.col1.y*u.x+y.col2.y*u.y,y=e.R,u=t.m_points[0].m_localPoint,x=e.position.x+y.col1.x*u.x+y.col2.x*u.y,f=e.position.y+y.col1.y*u.x+y.col2.y*u.y,d=x-_,b=f-p,v=d*d+b*b;v>Number.MIN_VALUE*Number.MIN_VALUE?(v=Math.sqrt(v),this.m_normal.x=d/v,this.m_normal.y=b/v):(this.m_normal.x=1,this.m_normal.y=0);_=_+o*this.m_normal.x,p=p+o*this.m_normal.y,x=x-n*this.m_normal.x,f=f-n*this.m_normal.y;this.m_points[0].x=.5*(_+x),this.m_points[0].y=.5*(p+f);break;case M.e_faceA:for(y=i.R,u=t.m_localPlaneNormal,r=y.col1.x*u.x+y.col2.x*u.y,a=y.col1.y*u.x+y.col2.y*u.y,y=i.R,u=t.m_localPoint,l=i.position.x+y.col1.x*u.x+y.col2.x*u.y,m=i.position.y+y.col1.y*u.x+y.col2.y*u.y,this.m_normal.x=r,this.m_normal.y=a,s=0;s<t.m_pointCount;s++)y=e.R,u=t.m_points[s].m_localPoint,c=e.position.x+y.col1.x*u.x+y.col2.x*u.y,h=e.position.y+y.col1.y*u.x+y.col2.y*u.y,this.m_points[s].x=c+.5*(o-(c-l)*r-(h-m)*a-n)*r,this.m_points[s].y=h+.5*(o-(c-l)*r-(h-m)*a-n)*a;break;case M.e_faceB:for(y=e.R,u=t.m_localPlaneNormal,r=y.col1.x*u.x+y.col2.x*u.y,a=y.col1.y*u.x+y.col2.y*u.y,y=e.R,u=t.m_localPoint,l=e.position.x+y.col1.x*u.x+y.col2.x*u.y,m=e.position.y+y.col1.y*u.x+y.col2.y*u.y,this.m_normal.x=-r,this.m_normal.y=-a,s=0;s<t.m_pointCount;s++)y=i.R,u=t.m_points[s].m_localPoint,c=i.position.x+y.col1.x*u.x+y.col2.x*u.y,h=i.position.y+y.col1.y*u.x+y.col2.y*u.y,this.m_points[s].x=c+.5*(n-(c-l)*r-(h-m)*a-o)*r,this.m_points[s].y=h+.5*(n-(c-l)*r-(h-m)*a-o)*a}}},k.ClipVertex=function(){this.v=new g,this.id=new c},k.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},z.Features=function(){},Object.defineProperty(z.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(z.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._referenceEdge=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(z.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(z.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(z.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(z.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(z.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(z.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}}),function(){P.Common.b2Color,P.Common.b2internal;var s=P.Common.b2Settings,i=P.Collision.Shapes.b2CircleShape,t=P.Collision.Shapes.b2EdgeChainDef,o=P.Collision.Shapes.b2EdgeShape,A=P.Collision.Shapes.b2MassData,r=P.Collision.Shapes.b2PolygonShape,e=P.Collision.Shapes.b2Shape,n=P.Common.Math.b2Mat22,S=(P.Common.Math.b2Mat33,P.Common.Math.b2Math),a=(P.Common.Math.b2Sweep,P.Common.Math.b2Transform),g=P.Common.Math.b2Vec2,l=(P.Common.Math.b2Vec3,P.Dynamics.b2Body,P.Dynamics.b2BodyDef,P.Dynamics.b2ContactFilter,P.Dynamics.b2ContactImpulse,P.Dynamics.b2ContactListener,P.Dynamics.b2ContactManager,P.Dynamics.b2DebugDraw,P.Dynamics.b2DestructionListener,P.Dynamics.b2FilterData,P.Dynamics.b2Fixture,P.Dynamics.b2FixtureDef,P.Dynamics.b2Island,P.Dynamics.b2TimeStep,P.Dynamics.b2World,P.Collision.b2AABB,P.Collision.b2Bound,P.Collision.b2BoundValues,P.Collision.b2Collision,P.Collision.b2ContactID,P.Collision.b2ContactPoint,P.Collision.b2Distance),m=P.Collision.b2DistanceInput,c=P.Collision.b2DistanceOutput,h=P.Collision.b2DistanceProxy,_=(P.Collision.b2DynamicTree,P.Collision.b2DynamicTreeBroadPhase,P.Collision.b2DynamicTreeNode,P.Collision.b2DynamicTreePair,P.Collision.b2Manifold,P.Collision.b2ManifoldPoint,P.Collision.b2Point,P.Collision.b2RayCastInput,P.Collision.b2RayCastOutput,P.Collision.b2Segment,P.Collision.b2SeparationFunction,P.Collision.b2Simplex,P.Collision.b2SimplexCache);P.Collision.b2SimplexVertex,P.Collision.b2TimeOfImpact,P.Collision.b2TOIInput,P.Collision.b2WorldManifold,P.Collision.ClipVertex,P.Collision.Features,P.Collision.IBroadPhase;P.inherit(i,P.Collision.Shapes.b2Shape),i.prototype.__super=P.Collision.Shapes.b2Shape.prototype,i.b2CircleShape=function(){P.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new g},i.prototype.Copy=function(){var t=new i;return t.Set(this),t},i.prototype.Set=function(t){this.__super.Set.call(this,t),P.is(t,i)&&(t=t instanceof i?t:null,this.m_p.SetV(t.m_p))},i.prototype.TestPoint=function(t,i){var o=t.R,e=t.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),o=t.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);return(e=i.x-e)*e+(o=i.y-o)*o<=this.m_radius*this.m_radius},i.prototype.RayCast=function(t,i,o){var e=o.R,n=o.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),s=o.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),r=i.p1.x-n,a=i.p1.y-s,l=r*r+a*a-this.m_radius*this.m_radius,o=i.p2.x-i.p1.x,e=i.p2.y-i.p1.y,n=r*o+a*e,s=o*o+e*e,l=n*n-s*l;if(l<0||s<Number.MIN_VALUE)return!1;l=-(n+Math.sqrt(l));return 0<=l&&l<=i.maxFraction*s&&(l/=s,t.fraction=l,t.normal.x=r+l*o,t.normal.y=a+l*e,t.normal.Normalize(),!0)},i.prototype.ComputeAABB=function(t,i){var o=i.R,e=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),o=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);t.lowerBound.Set(e-this.m_radius,o-this.m_radius),t.upperBound.Set(e+this.m_radius,o+this.m_radius)},i.prototype.ComputeMass=function(t,i){void 0===i&&(i=0),t.mass=i*s.b2_pi*this.m_radius*this.m_radius,t.center.SetV(this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},i.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var n=S.MulX(o,this.m_p),s=-(S.Dot(t,n)-i);if(s<-this.m_radius+Number.MIN_VALUE)return 0;if(s>this.m_radius)return e.SetV(n),Math.PI*this.m_radius*this.m_radius;o=this.m_radius*this.m_radius,i=s*s,s=o*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(o-i),i=-2/3*Math.pow(o-i,1.5)/s;return e.x=n.x+t.x*i,e.y=n.y+t.y*i,s},i.prototype.GetLocalPosition=function(){return this.m_p},i.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},i.prototype.GetRadius=function(){return this.m_radius},i.prototype.SetRadius=function(t){void 0===t&&(t=0),this.m_radius=t},i.prototype.b2CircleShape=function(t){void 0===t&&(t=0),this.__super.b2Shape.call(this),this.m_type=e.e_circleShape,this.m_radius=t},t.b2EdgeChainDef=function(){},t.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},P.inherit(o,P.Collision.Shapes.b2Shape),o.prototype.__super=P.Collision.Shapes.b2Shape.prototype,o.b2EdgeShape=function(){P.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new g,this.m_v1=new g,this.m_v2=new g,this.m_coreV1=new g,this.m_coreV2=new g,this.m_normal=new g,this.m_direction=new g,this.m_cornerDir1=new g,this.m_cornerDir2=new g},o.prototype.TestPoint=function(t,i){return!1},o.prototype.RayCast=function(t,i,o){var e=i.p2.x-i.p1.x,n=i.p2.y-i.p1.y,s=o.R,r=o.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),a=o.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),l=o.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-a,m=-(o.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-r),c=100*Number.MIN_VALUE,o=-(e*l+n*m);if(c<o){s=i.p1.x-r,r=i.p1.y-a,a=s*l+r*m;if(0<=a&&a<=i.maxFraction*o){s=-e*r+n*s;if(-c*o<=s&&s<=o*(1+c)){a/=o,t.fraction=a;a=Math.sqrt(l*l+m*m);return t.normal.x=l/a,t.normal.y=m/a,!0}}}return!1},o.prototype.ComputeAABB=function(t,i){var o=i.R,e=i.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),n=i.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),s=i.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y),o=i.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y);e<s?(t.lowerBound.x=e,t.upperBound.x=s):(t.lowerBound.x=s,t.upperBound.x=e),n<o?(t.lowerBound.y=n,t.upperBound.y=o):(t.lowerBound.y=o,t.upperBound.y=n)},o.prototype.ComputeMass=function(t,i){void 0===i&&(i=0),t.mass=0,t.center.SetV(this.m_v1),t.I=0},o.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var n=new g(t.x*i,t.y*i),s=S.MulX(o,this.m_v1),r=S.MulX(o,this.m_v2),o=S.Dot(t,s)-i,i=S.Dot(t,r)-i;if(0<o){if(0<i)return 0;s.x=-i/(o-i)*s.x+o/(o-i)*r.x,s.y=-i/(o-i)*s.y+o/(o-i)*r.y}else 0<i&&(r.x=-i/(o-i)*s.x+o/(o-i)*r.x,r.y=-i/(o-i)*s.y+o/(o-i)*r.y);return e.x=(n.x+s.x+r.x)/3,e.y=(n.y+s.y+r.y)/3,.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))},o.prototype.GetLength=function(){return this.m_length},o.prototype.GetVertex1=function(){return this.m_v1},o.prototype.GetVertex2=function(){return this.m_v2},o.prototype.GetCoreVertex1=function(){return this.m_coreV1},o.prototype.GetCoreVertex2=function(){return this.m_coreV2},o.prototype.GetNormalVector=function(){return this.m_normal},o.prototype.GetDirectionVector=function(){return this.m_direction},o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},o.prototype.GetFirstVertex=function(t){var i=t.R;return new g(t.position.x+(i.col1.x*this.m_coreV1.x+i.col2.x*this.m_coreV1.y),t.position.y+(i.col1.y*this.m_coreV1.x+i.col2.y*this.m_coreV1.y))},o.prototype.GetNextEdge=function(){return this.m_nextEdge},o.prototype.GetPrevEdge=function(){return this.m_prevEdge},o.prototype.Support=function(t,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var e=t.R,n=t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),s=t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y),r=t.position.x+(e.col1.x*this.m_coreV2.x+e.col2.x*this.m_coreV2.y),e=t.position.y+(e.col1.y*this.m_coreV2.x+e.col2.y*this.m_coreV2.y);return r*i+e*o<n*i+s*o?(this.s_supportVec.x=n,this.s_supportVec.y=s):(this.s_supportVec.x=r,this.s_supportVec.y=e),this.s_supportVec},o.prototype.b2EdgeShape=function(t,i){this.__super.b2Shape.call(this),this.m_type=e.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=t,this.m_v2=i,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-s.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-s.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-s.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-s.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},o.prototype.SetPrevEdge=function(t,i,o,e){this.m_prevEdge=t,this.m_coreV1=i,this.m_cornerDir1=o,this.m_cornerConvex1=e},o.prototype.SetNextEdge=function(t,i,o,e){this.m_nextEdge=t,this.m_coreV2=i,this.m_cornerDir2=o,this.m_cornerConvex2=e},A.b2MassData=function(){this.mass=0,this.center=new g(0,0),this.I=0},P.inherit(r,P.Collision.Shapes.b2Shape),r.prototype.__super=P.Collision.Shapes.b2Shape.prototype,r.b2PolygonShape=function(){P.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},r.prototype.Copy=function(){var t=new r;return t.Set(this),t},r.prototype.Set=function(t){if(this.__super.Set.call(this,t),P.is(t,r)){var i=t instanceof r?t:null;this.m_centroid.SetV(i.m_centroid),this.m_vertexCount=i.m_vertexCount,this.Reserve(this.m_vertexCount);for(var o=0;o<this.m_vertexCount;o++)this.m_vertices[o].SetV(i.m_vertices[o]),this.m_normals[o].SetV(i.m_normals[o])}},r.prototype.SetAsArray=function(t,i){void 0===i&&(i=0);for(var o,e=new q,n=0,n=0;n<t.length;++n)o=t[n],e.push(o);this.SetAsVector(e,i)},r.AsArray=function(t,i){void 0===i&&(i=0);var o=new r;return o.SetAsArray(t,i),o},r.prototype.SetAsVector=function(t,i){void 0===i&&(i=0),0==i&&(i=t.length),s.b2Assert(2<=i),this.m_vertexCount=i,this.Reserve(i);for(var o=0,o=0;o<this.m_vertexCount;o++)this.m_vertices[o].SetV(t[o]);for(o=0;o<this.m_vertexCount;++o){var e=parseInt(o),n=parseInt(o+1<this.m_vertexCount?o+1:0),e=S.SubtractVV(this.m_vertices[n],this.m_vertices[e]);s.b2Assert(e.LengthSquared()>Number.MIN_VALUE),this.m_normals[o].SetV(S.CrossVF(e,1)),this.m_normals[o].Normalize()}this.m_centroid=r.ComputeCentroid(this.m_vertices,this.m_vertexCount)},r.AsVector=function(t,i){void 0===i&&(i=0);var o=new r;return o.SetAsVector(t,i),o},r.prototype.SetAsBox=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-i),this.m_vertices[1].Set(t,-i),this.m_vertices[2].Set(t,i),this.m_vertices[3].Set(-t,i),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},r.AsBox=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0);var o=new r;return o.SetAsBox(t,i),o},r.prototype.SetAsOrientedBox=function(t,i,o,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=null),void 0===e&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-i),this.m_vertices[1].Set(t,-i),this.m_vertices[2].Set(t,i),this.m_vertices[3].Set(-t,i),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=o;var n=new a;n.position=o,n.R.Set(e);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=S.MulX(n,this.m_vertices[s]),this.m_normals[s]=S.MulMV(n.R,this.m_normals[s])},r.AsOrientedBox=function(t,i,o,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=null),void 0===e&&(e=0);var n=new r;return n.SetAsOrientedBox(t,i,o,e),n},r.prototype.SetAsEdge=function(t,i){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(i),this.m_centroid.x=.5*(t.x+i.x),this.m_centroid.y=.5*(t.y+i.y),this.m_normals[0]=S.CrossVF(S.SubtractVV(i,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},r.AsEdge=function(t,i){var o=new r;return o.SetAsEdge(t,i),o},r.prototype.TestPoint=function(t,i){for(var o,e=t.R,n=i.x-t.position.x,s=i.y-t.position.y,r=n*e.col1.x+s*e.col1.y,a=n*e.col2.x+s*e.col2.y,l=0;l<this.m_vertexCount;++l){n=r-(o=this.m_vertices[l]).x,s=a-o.y;if(0<(o=this.m_normals[l]).x*n+o.y*s)return!1}return!0},r.prototype.RayCast=function(t,i,o){var e,n=0,s=i.maxFraction,r=i.p1.x-o.position.x,a=i.p1.y-o.position.y,l=o.R,m=r*l.col1.x+a*l.col1.y,c=r*l.col2.x+a*l.col2.y;r=i.p2.x-o.position.x,a=i.p2.y-o.position.y;for(var h=r*(l=o.R).col1.x+a*l.col1.y-m,_=r*l.col2.x+a*l.col2.y-c,p=parseInt(-1),y=0;y<this.m_vertexCount;++y){r=(e=this.m_vertices[y]).x-m,a=e.y-c;var u=(e=this.m_normals[y]).x*r+e.y*a,x=e.x*h+e.y*_;if(0==x){if(u<0)return!1}else x<0&&u<n*x?(n=u/x,p=y):0<x&&u<s*x&&(s=u/x);if(s<n-Number.MIN_VALUE)return!1}return 0<=p&&(t.fraction=n,l=o.R,e=this.m_normals[p],t.normal.x=l.col1.x*e.x+l.col2.x*e.y,t.normal.y=l.col1.y*e.x+l.col2.y*e.y,!0)},r.prototype.ComputeAABB=function(t,i){for(var o=i.R,e=this.m_vertices[0],n=m=i.position.x+(o.col1.x*e.x+o.col2.x*e.y),s=c=i.position.y+(o.col1.y*e.x+o.col2.y*e.y),r=1;r<this.m_vertexCount;++r){e=this.m_vertices[r];var a=i.position.x+(o.col1.x*e.x+o.col2.x*e.y),l=i.position.y+(o.col1.y*e.x+o.col2.y*e.y),m=m<a?m:a,c=c<l?c:l,n=a<n?n:a,s=l<s?s:l}t.lowerBound.x=m-this.m_radius,t.lowerBound.y=c-this.m_radius,t.upperBound.x=n+this.m_radius,t.upperBound.y=s+this.m_radius},r.prototype.ComputeMass=function(t,i){if(void 0===i&&(i=0),2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,void(t.I=0);for(var o=0,e=0,n=0,s=0,r=0;r<this.m_vertexCount;++r){var a=this.m_vertices[r],l=r+1<this.m_vertexCount?this.m_vertices[parseInt(r+1)]:this.m_vertices[0],m=+a.x,c=+a.y,h=+l.x,_=+l.y,p=m*_-c*h,y=.5*p;n+=y,o+=1/3*y*(0+a.x+l.x),e+=1/3*y*(0+a.y+l.y);s+=p*(1/3*(.25*(m*m+h*m+h*h)+(0*m+0*h))+0+(1/3*(.25*(c*c+_*c+_*_)+(0*c+0*_))+0))}t.mass=i*n,o*=1/n,e*=1/n,t.center.Set(o,e),t.I=i*s},r.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);for(var n=S.MulTMV(o.R,t),s=i-S.Dot(t,o.position),r=new O,a=0,l=parseInt(-1),m=parseInt(-1),c=!1,h=0,h=0;h<this.m_vertexCount;++h){r[h]=S.Dot(n,this.m_vertices[h])-s;var _=r[h]<-Number.MIN_VALUE;0<h&&(_?c||(l=h-1,a++):c&&(m=h-1,a++)),c=_}switch(a){case 0:if(c){var p=new A;return this.ComputeMass(p,1),e.SetV(S.MulX(o,p.center)),p.mass}return 0;case 1:-1==l?l=this.m_vertexCount-1:m=this.m_vertexCount-1}var y,i=parseInt((l+1)%this.m_vertexCount),u=parseInt((m+1)%this.m_vertexCount),t=(0-r[l])/(r[i]-r[l]),p=(0-r[m])/(r[u]-r[m]),x=new g(this.m_vertices[l].x*(1-t)+this.m_vertices[i].x*t,this.m_vertices[l].y*(1-t)+this.m_vertices[i].y*t),f=new g(this.m_vertices[m].x*(1-p)+this.m_vertices[u].x*p,this.m_vertices[m].y*(1-p)+this.m_vertices[u].y*p),d=0,b=new g,v=this.m_vertices[i];for(h=i;h!=u;){y=(h=(h+1)%this.m_vertexCount)==u?f:this.m_vertices[h];var C=.5*((v.x-x.x)*(y.y-x.y)-(v.y-x.y)*(y.x-x.x));d+=C,b.x+=C*(x.x+v.x+y.x)/3,b.y+=C*(x.y+v.y+y.y)/3,v=y}return b.Multiply(1/d),e.SetV(S.MulX(o,b)),d},r.prototype.GetVertexCount=function(){return this.m_vertexCount},r.prototype.GetVertices=function(){return this.m_vertices},r.prototype.GetNormals=function(){return this.m_normals},r.prototype.GetSupport=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_vertexCount;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;o<n&&(i=e,o=n)}return i},r.prototype.GetSupportVertex=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_vertexCount;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;o<n&&(i=e,o=n)}return this.m_vertices[i]},r.prototype.Validate=function(){return!1},r.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=e.e_polygonShape,this.m_centroid=new g,this.m_vertices=new q,this.m_normals=new q},r.prototype.Reserve=function(t){void 0===t&&(t=0);for(var i=parseInt(this.m_vertices.length);i<t;i++)this.m_vertices[i]=new g,this.m_normals[i]=new g},r.ComputeCentroid=function(t,i){void 0===i&&(i=0);for(var o=new g,e=0,n=0;n<i;++n){var s=t[n],r=n+1<i?t[parseInt(n+1)]:t[0],a=+s.x,l=+s.y,m=+r.x,m=.5*(a*+r.y-l*m);e+=m,o.x+=1/3*m*(0+s.x+r.x),o.y+=1/3*m*(0+s.y+r.y)}return o.x*=1/e,o.y*=1/e,o},r.ComputeOBB=function(t,i,o){void 0===o&&(o=0);for(var e=0,n=new q(o+1),e=0;e<o;++e)n[e]=i[e];n[o]=n[0];var s=Number.MAX_VALUE;for(e=1;e<=o;++e){for(var r=n[parseInt(e-1)],a=n[e].x-r.x,l=n[e].y-r.y,m=Math.sqrt(a*a+l*l),c=-(l/=m),h=a/=m,_=Number.MAX_VALUE,p=Number.MAX_VALUE,y=-Number.MAX_VALUE,u=-Number.MAX_VALUE,x=0;x<o;++x){var f=n[x].x-r.x,d=n[x].y-r.y,b=a*f+l*d,d=c*f+h*d;b<_&&(_=b),d<p&&(p=d),y<b&&(y=b),u<d&&(u=d)}var v,C=(y-_)*(u-p);C<.95*s&&(s=C,t.R.col1.x=a,t.R.col1.y=l,t.R.col2.x=c,t.R.col2.y=h,v=.5*(_+y),m=.5*(p+u),C=t.R,t.center.x=r.x+(C.col1.x*v+C.col2.x*m),t.center.y=r.y+(C.col1.y*v+C.col2.y*m),t.extents.x=.5*(y-_),t.extents.y=.5*(u-p))}},P.postDefs.push(function(){P.Collision.Shapes.b2PolygonShape.s_mat=new n}),e.b2Shape=function(){},e.prototype.Copy=function(){return null},e.prototype.Set=function(t){this.m_radius=t.m_radius},e.prototype.GetType=function(){return this.m_type},e.prototype.TestPoint=function(t,i){return!1},e.prototype.RayCast=function(t,i,o){return!1},e.prototype.ComputeAABB=function(t,i){},e.prototype.ComputeMass=function(t,i){void 0===i&&(i=0)},e.prototype.ComputeSubmergedArea=function(t,i,o,e){return void 0===i&&(i=0),0},e.TestOverlap=function(t,i,o,e){var n=new m;n.proxyA=new h,n.proxyA.Set(t),n.proxyB=new h,n.proxyB.Set(o),n.transformA=i,n.transformB=e,n.useRadii=!0;i=new _;i.count=0;e=new c;return l.Distance(e,i,n),e.distance<10*Number.MIN_VALUE},e.prototype.b2Shape=function(){this.m_type=e.e_unknownShape,this.m_radius=s.b2_linearSlop},P.postDefs.push(function(){P.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),P.Collision.Shapes.b2Shape.e_circleShape=0,P.Collision.Shapes.b2Shape.e_polygonShape=1,P.Collision.Shapes.b2Shape.e_edgeShape=2,P.Collision.Shapes.b2Shape.e_shapeTypeCount=3,P.Collision.Shapes.b2Shape.e_hitCollide=1,P.Collision.Shapes.b2Shape.e_missCollide=0,P.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=P.Common.b2Color,i=(P.Common.b2internal,P.Common.b2Settings),e=(P.Common.Math.b2Mat22,P.Common.Math.b2Mat33,P.Common.Math.b2Math);P.Common.Math.b2Sweep,P.Common.Math.b2Transform,P.Common.Math.b2Vec2,P.Common.Math.b2Vec3;t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this._r=P.parseUInt(255*e.Clamp(t,0,1)),this._g=P.parseUInt(255*e.Clamp(i,0,1)),this._b=P.parseUInt(255*e.Clamp(o,0,1))},t.prototype.Set=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this._r=P.parseUInt(255*e.Clamp(t,0,1)),this._g=P.parseUInt(255*e.Clamp(i,0,1)),this._b=P.parseUInt(255*e.Clamp(o,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._r=P.parseUInt(255*e.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._g=P.parseUInt(255*e.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._b=P.parseUInt(255*e.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),i.b2Settings=function(){},i.b2MixFriction=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),Math.sqrt(t*i)},i.b2MixRestitution=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),i<t?t:i},i.b2Assert=function(t){if(!t)throw"Assertion Failed"},P.postDefs.push(function(){P.Common.b2Settings.VERSION="2.1alpha",P.Common.b2Settings.USHRT_MAX=65535,P.Common.b2Settings.b2_pi=Math.PI,P.Common.b2Settings.b2_maxManifoldPoints=2,P.Common.b2Settings.b2_aabbExtension=.1,P.Common.b2Settings.b2_aabbMultiplier=2,P.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop,P.Common.b2Settings.b2_linearSlop=.005,P.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi,P.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop,P.Common.b2Settings.b2_maxTOIContactsPerIsland=32,P.Common.b2Settings.b2_maxTOIJointsPerIsland=32,P.Common.b2Settings.b2_velocityThreshold=1,P.Common.b2Settings.b2_maxLinearCorrection=.2,P.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi,P.Common.b2Settings.b2_maxTranslation=2,P.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation,P.Common.b2Settings.b2_maxRotation=.5*i.b2_pi,P.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation,P.Common.b2Settings.b2_contactBaumgarte=.2,P.Common.b2Settings.b2_timeToSleep=.5,P.Common.b2Settings.b2_linearSleepTolerance=.01,P.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})}(),function(){P.Collision.b2AABB,P.Common.b2Color,P.Common.b2internal,P.Common.b2Settings;var e=P.Common.Math.b2Mat22,t=P.Common.Math.b2Mat33,n=P.Common.Math.b2Math,i=P.Common.Math.b2Sweep,o=P.Common.Math.b2Transform,s=P.Common.Math.b2Vec2,r=P.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new s,this.col2=new s},e.prototype.b2Mat22=function(){this.SetIdentity()},e.FromAngle=function(t){void 0===t&&(t=0);var i=new e;return i.Set(t),i},e.FromVV=function(t,i){var o=new e;return o.SetVV(t,i),o},e.prototype.Set=function(t){void 0===t&&(t=0);var i=Math.cos(t),t=Math.sin(t);this.col1.x=i,this.col2.x=-t,this.col1.y=t,this.col2.y=i},e.prototype.SetVV=function(t,i){this.col1.SetV(t),this.col2.SetV(i)},e.prototype.Copy=function(){var t=new e;return t.SetM(this),t},e.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},e.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},e.prototype.GetInverse=function(t){var i=this.col1.x,o=this.col2.x,e=this.col1.y,n=this.col2.y,s=i*n-o*e;return 0!=s&&(s=1/s),t.col1.x=s*n,t.col2.x=-s*o,t.col1.y=-s*e,t.col2.y=s*i,t},e.prototype.Solve=function(t,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var e=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=e*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*i-n*o),t.y=a*(e*o-s*i),t},e.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},t.b2Mat33=function(){this.col1=new r,this.col2=new r,this.col3=new r},t.prototype.b2Mat33=function(t,i,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===o&&(o=null),t||i||o?(this.col1.SetV(t),this.col2.SetV(i),this.col3.SetV(o)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},t.prototype.SetVVV=function(t,i,o){this.col1.SetV(t),this.col2.SetV(i),this.col3.SetV(o)},t.prototype.Copy=function(){return new t(this.col1,this.col2,this.col3)},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},t.prototype.Solve22=function(t,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var e=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=e*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*i-n*o),t.y=a*(e*o-s*i),t},t.prototype.Solve33=function(t,i,o,e){void 0===i&&(i=0),void 0===o&&(o=0),void 0===e&&(e=0);var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,l=this.col2.y,m=this.col2.z,c=this.col3.x,h=this.col3.y,_=this.col3.z,p=n*(l*_-m*h)+s*(m*c-a*_)+r*(a*h-l*c);return 0!=p&&(p=1/p),t.x=p*(i*(l*_-m*h)+o*(m*c-a*_)+e*(a*h-l*c)),t.y=p*(n*(o*_-e*h)+s*(e*c-i*_)+r*(i*h-o*c)),t.z=p*(n*(l*e-m*o)+s*(m*i-a*e)+r*(a*o-l*i)),t},n.b2Math=function(){},n.IsValid=function(t){return void 0===t&&(t=0),isFinite(t)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.CrossVV=function(t,i){return t.x*i.y-t.y*i.x},n.CrossVF=function(t,i){return void 0===i&&(i=0),new s(i*t.y,-i*t.x)},n.CrossFV=function(t,i){return void 0===t&&(t=0),new s(-t*i.y,t*i.x)},n.MulMV=function(t,i){return new s(t.col1.x*i.x+t.col2.x*i.y,t.col1.y*i.x+t.col2.y*i.y)},n.MulTMV=function(t,i){return new s(n.Dot(i,t.col1),n.Dot(i,t.col2))},n.MulX=function(t,i){i=n.MulMV(t.R,i);return i.x+=t.position.x,i.y+=t.position.y,i},n.MulXT=function(t,i){var o=n.SubtractVV(i,t.position),i=o.x*t.R.col1.x+o.y*t.R.col1.y;return o.y=o.x*t.R.col2.x+o.y*t.R.col2.y,o.x=i,o},n.AddVV=function(t,i){return new s(t.x+i.x,t.y+i.y)},n.SubtractVV=function(t,i){return new s(t.x-i.x,t.y-i.y)},n.Distance=function(t,i){var o=t.x-i.x,i=t.y-i.y;return Math.sqrt(o*o+i*i)},n.DistanceSquared=function(t,i){var o=t.x-i.x,i=t.y-i.y;return o*o+i*i},n.MulFV=function(t,i){return void 0===t&&(t=0),new s(t*i.x,t*i.y)},n.AddMM=function(t,i){return e.FromVV(n.AddVV(t.col1,i.col1),n.AddVV(t.col2,i.col2))},n.MulMM=function(t,i){return e.FromVV(n.MulMV(t,i.col1),n.MulMV(t,i.col2))},n.MulTMM=function(t,i){var o=new s(n.Dot(t.col1,i.col1),n.Dot(t.col2,i.col1)),i=new s(n.Dot(t.col1,i.col2),n.Dot(t.col2,i.col2));return e.FromVV(o,i)},n.Abs=function(t){return void 0===t&&(t=0),0<t?t:-t},n.AbsV=function(t){return new s(n.Abs(t.x),n.Abs(t.y))},n.AbsM=function(t){return e.FromVV(n.AbsV(t.col1),n.AbsV(t.col2))},n.Min=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),t<i?t:i},n.MinV=function(t,i){return new s(n.Min(t.x,i.x),n.Min(t.y,i.y))},n.Max=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),i<t?t:i},n.MaxV=function(t,i){return new s(n.Max(t.x,i.x),n.Max(t.y,i.y))},n.Clamp=function(t,i,o){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),t<i?i:o<t?o:t},n.ClampV=function(t,i,o){return n.MaxV(i,n.MinV(t,o))},n.Swap=function(t,i){var o=t[0];t[0]=i[0],i[0]=o},n.Random=function(){return 2*Math.random()-1},n.RandomRange=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),(i-t)*Math.random()+t},n.NextPowerOfTwo=function(t){return void 0===t&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1},n.IsPowerOfTwo=function(t){return void 0===t&&(t=0),0<t&&0==(t&t-1)},P.postDefs.push(function(){P.Common.Math.b2Math.b2Vec2_zero=new s(0,0),P.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new s(1,0),new s(0,1)),P.Common.Math.b2Math.b2Transform_identity=new o(n.b2Vec2_zero,n.b2Mat22_identity)}),i.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},i.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},i.prototype.Copy=function(){var t=new i;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},i.prototype.GetTransform=function(t,i){void 0===i&&(i=0),t.position.x=(1-i)*this.c0.x+i*this.c.x,t.position.y=(1-i)*this.c0.y+i*this.c.y;i=(1-i)*this.a0+i*this.a;t.R.Set(i);i=t.R;t.position.x-=i.col1.x*this.localCenter.x+i.col2.x*this.localCenter.y,t.position.y-=i.col1.y*this.localCenter.x+i.col2.y*this.localCenter.y},i.prototype.Advance=function(t){var i;void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE&&(i=(t-this.t0)/(1-this.t0),this.c0.x=(1-i)*this.c0.x+i*this.c.x,this.c0.y=(1-i)*this.c0.y+i*this.c.y,this.a0=(1-i)*this.a0+i*this.a,this.t0=t)},o.b2Transform=function(){this.position=new s,this.R=new e},o.prototype.b2Transform=function(t,i){void 0===t&&(t=null),void 0===i&&(i=null),t&&(this.position.SetV(t),this.R.SetM(i))},o.prototype.Initialize=function(t,i){this.position.SetV(t),this.R.SetM(i)},o.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},o.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},o.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},s.prototype.SetZero=function(){this.x=0,this.y=0},s.prototype.Set=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),new s(t,i)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},s.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t},s.prototype.MulM=function(t){var i=this.x;this.x=t.col1.x*i+t.col2.x*this.y,this.y=t.col1.y*i+t.col2.y*this.y},s.prototype.MulTM=function(t){var i=n.Dot(this,t.col1);this.y=n.Dot(this,t.col2),this.x=i},s.prototype.CrossVF=function(t){void 0===t&&(t=0);var i=this.x;this.x=t*this.y,this.y=-t*i},s.prototype.CrossFV=function(t){void 0===t&&(t=0);var i=this.x;this.x=-t*this.y,this.y=t*i},s.prototype.MinV=function(t){this.x=(this.x<t.x?this:t).x,this.y=(this.y<t.y?this:t).y},s.prototype.MaxV=function(t){this.x=(this.x>t.x?this:t).x,this.y=(this.y>t.y?this:t).y},s.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE)return 0;var i=1/t;return this.x*=i,this.y*=i,t},s.prototype.IsValid=function(){return n.IsValid(this.x)&&n.IsValid(this.y)},r.b2Vec3=function(){},r.prototype.b2Vec3=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.x=t,this.y=i,this.z=o},r.prototype.SetZero=function(){this.x=this.y=this.z=0},r.prototype.Set=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.x=t,this.y=i,this.z=o},r.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},r.prototype.Copy=function(){return new r(this.x,this.y,this.z)},r.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},r.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},r.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){P.Dynamics.Controllers.b2ControllerEdge,P.Common.Math.b2Mat22,P.Common.Math.b2Mat33;var y=P.Common.Math.b2Math,t=P.Common.Math.b2Sweep,s=P.Common.Math.b2Transform,u=P.Common.Math.b2Vec2,x=(P.Common.Math.b2Vec3,P.Common.b2Color),C=(P.Common.b2internal,P.Common.b2Settings),f=P.Collision.b2AABB,i=(P.Collision.b2Bound,P.Collision.b2BoundValues,P.Collision.b2Collision,P.Collision.b2ContactID,P.Collision.b2ContactPoint),o=(P.Collision.b2Distance,P.Collision.b2DistanceInput,P.Collision.b2DistanceOutput,P.Collision.b2DistanceProxy,P.Collision.b2DynamicTree,P.Collision.b2DynamicTreeBroadPhase),e=(P.Collision.b2DynamicTreeNode,P.Collision.b2DynamicTreePair,P.Collision.b2Manifold,P.Collision.b2ManifoldPoint,P.Collision.b2Point,P.Collision.b2RayCastInput),m=P.Collision.b2RayCastOutput,c=(P.Collision.b2Segment,P.Collision.b2SeparationFunction,P.Collision.b2Simplex,P.Collision.b2SimplexCache,P.Collision.b2SimplexVertex,P.Collision.b2TimeOfImpact,P.Collision.b2TOIInput,P.Collision.b2WorldManifold,P.Collision.ClipVertex,P.Collision.Features,P.Collision.IBroadPhase,P.Collision.Shapes.b2CircleShape),h=(P.Collision.Shapes.b2EdgeChainDef,P.Collision.Shapes.b2EdgeShape),n=P.Collision.Shapes.b2MassData,_=P.Collision.Shapes.b2PolygonShape,p=P.Collision.Shapes.b2Shape,A=P.Dynamics.b2Body,r=P.Dynamics.b2BodyDef,a=P.Dynamics.b2ContactFilter,l=P.Dynamics.b2ContactImpulse,d=P.Dynamics.b2ContactListener,b=P.Dynamics.b2ContactManager,v=P.Dynamics.b2DebugDraw,S=P.Dynamics.b2DestructionListener,g=P.Dynamics.b2FilterData,w=P.Dynamics.b2Fixture,D=P.Dynamics.b2FixtureDef,B=P.Dynamics.b2Island,M=P.Dynamics.b2TimeStep,V=P.Dynamics.b2World,I=(P.Dynamics.Contacts.b2CircleContact,P.Dynamics.Contacts.b2Contact),G=(P.Dynamics.Contacts.b2ContactConstraint,P.Dynamics.Contacts.b2ContactConstraintPoint,P.Dynamics.Contacts.b2ContactEdge,P.Dynamics.Contacts.b2ContactFactory),L=(P.Dynamics.Contacts.b2ContactRegister,P.Dynamics.Contacts.b2ContactResult,P.Dynamics.Contacts.b2ContactSolver),J=(P.Dynamics.Contacts.b2EdgeAndCircleContact,P.Dynamics.Contacts.b2NullContact,P.Dynamics.Contacts.b2PolyAndCircleContact,P.Dynamics.Contacts.b2PolyAndEdgeContact,P.Dynamics.Contacts.b2PolygonContact,P.Dynamics.Contacts.b2PositionSolverManifold,P.Dynamics.Controllers.b2Controller,P.Dynamics.Joints.b2DistanceJoint,P.Dynamics.Joints.b2DistanceJointDef,P.Dynamics.Joints.b2FrictionJoint,P.Dynamics.Joints.b2FrictionJointDef,P.Dynamics.Joints.b2GearJoint,P.Dynamics.Joints.b2GearJointDef,P.Dynamics.Joints.b2Jacobian,P.Dynamics.Joints.b2Joint),F=(P.Dynamics.Joints.b2JointDef,P.Dynamics.Joints.b2JointEdge,P.Dynamics.Joints.b2LineJoint,P.Dynamics.Joints.b2LineJointDef,P.Dynamics.Joints.b2MouseJoint,P.Dynamics.Joints.b2MouseJointDef,P.Dynamics.Joints.b2PrismaticJoint,P.Dynamics.Joints.b2PrismaticJointDef,P.Dynamics.Joints.b2PulleyJoint);P.Dynamics.Joints.b2PulleyJointDef,P.Dynamics.Joints.b2RevoluteJoint,P.Dynamics.Joints.b2RevoluteJointDef,P.Dynamics.Joints.b2WeldJoint,P.Dynamics.Joints.b2WeldJointDef;A.b2Body=function(){this.m_xf=new s,this.m_sweep=new t,this.m_linearVelocity=new u,this.m_force=new u},A.prototype.connectEdges=function(t,i,o){void 0===o&&(o=0);var e=Math.atan2(i.GetDirectionVector().y,i.GetDirectionVector().x),n=Math.tan(.5*(e-o)),s=y.MulFV(n,i.GetDirectionVector()),s=y.SubtractVV(s,i.GetNormalVector());s=y.MulFV(C.b2_toiSlop,s),s=y.AddVV(s,i.GetVertex1());o=y.AddVV(t.GetDirectionVector(),i.GetDirectionVector());o.Normalize();n=0<y.Dot(t.GetDirectionVector(),i.GetNormalVector());return t.SetNextEdge(i,s,o,n),i.SetPrevEdge(t,s,o,n),e},A.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var i=new w;return i.Create(this,this.m_xf,t),this.m_flags&A.e_activeFlag&&(t=this.m_world.m_contactManager.m_broadPhase,i.CreateProxy(t,this.m_xf)),i.m_next=this.m_fixtureList,this.m_fixtureList=i,++this.m_fixtureCount,i.m_body=this,0<i.m_density&&this.ResetMassData(),this.m_world.m_flags|=V.e_newFixture,i},A.prototype.CreateFixture2=function(t,i){void 0===i&&(i=0);var o=new D;return o.shape=t,o.density=i,this.CreateFixture(o)},A.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var i=this.m_fixtureList,o=null;null!=i;){if(i==t){o?o.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=(o=i).m_next}for(var e,n=this.m_contactList;n;){var s=n.contact,n=n.next,r=s.GetFixtureA(),a=s.GetFixtureB();t!=r&&t!=a||this.m_world.m_contactManager.Destroy(s)}this.m_flags&A.e_activeFlag&&(e=this.m_world.m_contactManager.m_broadPhase,t.DestroyProxy(e)),t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},A.prototype.SetPositionAndAngle=function(t,i){if(void 0===i&&(i=0),1!=this.m_world.IsLocked()){this.m_xf.R.Set(i),this.m_xf.position.SetV(t);var o=this.m_xf.R,t=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*t.x+o.col2.x*t.y,this.m_sweep.c.y=o.col1.y*t.x+o.col2.y*t.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=i;for(var e=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(e,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},A.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},A.prototype.GetTransform=function(){return this.m_xf},A.prototype.GetPosition=function(){return this.m_xf.position},A.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},A.prototype.GetAngle=function(){return this.m_sweep.a},A.prototype.SetAngle=function(t){void 0===t&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},A.prototype.GetWorldCenter=function(){return this.m_sweep.c},A.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},A.prototype.SetLinearVelocity=function(t){this.m_type!=A.b2_staticBody&&this.m_linearVelocity.SetV(t)},A.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},A.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=A.b2_staticBody&&(this.m_angularVelocity=t)},A.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},A.prototype.GetDefinition=function(){var t=new r;return t.type=this.GetType(),t.allowSleep=(this.m_flags&A.e_allowSleepFlag)==A.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&A.e_fixedRotationFlag)==A.e_fixedRotationFlag,t.bullet=(this.m_flags&A.e_bulletFlag)==A.e_bulletFlag,t.awake=(this.m_flags&A.e_awakeFlag)==A.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},A.prototype.ApplyForce=function(t,i){this.m_type==A.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x)},A.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==A.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=t)},A.prototype.ApplyImpulse=function(t,i){this.m_type==A.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x))},A.prototype.Split=function(t){for(var i,o=this.GetLinearVelocity().Copy(),e=this.GetAngularVelocity(),n=this.GetWorldCenter(),s=this,r=this.m_world.CreateBody(this.GetDefinition()),a=s.m_fixtureList;a;)var l,a=t(a)?(l=a.m_next,i?i.m_next=l:s.m_fixtureList=l,s.m_fixtureCount--,a.m_next=r.m_fixtureList,r.m_fixtureList=a,r.m_fixtureCount++,a.m_body=r,l):(i=a).m_next;s.ResetMassData(),r.ResetMassData();var m=s.GetWorldCenter(),c=r.GetWorldCenter(),m=y.AddVV(o,y.CrossFV(e,y.SubtractVV(m,n))),n=y.AddVV(o,y.CrossFV(e,y.SubtractVV(c,n)));return s.SetLinearVelocity(m),r.SetLinearVelocity(n),s.SetAngularVelocity(e),r.SetAngularVelocity(e),s.SynchronizeFixtures(),r.SynchronizeFixtures(),r},A.prototype.Merge=function(t){for(var i=t.m_fixtureList;i;){var o=i.m_next;t.m_fixtureCount--,i.m_next=this.m_fixtureList,this.m_fixtureList=i,this.m_fixtureCount++,i.m_body=e,i=o}(void 0).m_fixtureCount=0;var e=t;this.GetWorldCenter(),e.GetWorldCenter(),this.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),this.GetAngularVelocity(),e.GetAngularVelocity();this.ResetMassData(),this.SynchronizeFixtures()},A.prototype.GetMass=function(){return this.m_mass},A.prototype.GetInertia=function(){return this.m_I},A.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},A.prototype.SetMassData=function(t){var i;C.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==A.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&0==(this.m_flags&A.e_fixedRotationFlag)&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I),i=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(y.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-i.x))},A.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=A.b2_staticBody&&this.m_type!=A.b2_kinematicBody){for(var t,i=u.Make(0,0),o=this.m_fixtureList;o;o=o.m_next){0!=o.m_density&&(t=o.GetMassData(),this.m_mass+=t.mass,i.x+=t.center.x*t.mass,i.y+=t.center.y*t.mass,this.m_I+=t.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,i.x*=this.m_invMass,i.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&0==(this.m_flags&A.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(i.x*i.x+i.y*i.y),this.m_I*=this.m_inertiaScale,C.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i),this.m_sweep.c0.SetV(y.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-e.x)}},A.prototype.GetWorldPoint=function(t){var i=this.m_xf.R,t=new u(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);return t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,t},A.prototype.GetWorldVector=function(t){return y.MulMV(this.m_xf.R,t)},A.prototype.GetLocalPoint=function(t){return y.MulXT(this.m_xf,t)},A.prototype.GetLocalVector=function(t){return y.MulTMV(this.m_xf.R,t)},A.prototype.GetLinearVelocityFromWorldPoint=function(t){return new u(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},A.prototype.GetLinearVelocityFromLocalPoint=function(t){var i=this.m_xf.R,t=new u(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);return t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,new u(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},A.prototype.GetLinearDamping=function(){return this.m_linearDamping},A.prototype.SetLinearDamping=function(t){void 0===t&&(t=0),this.m_linearDamping=t},A.prototype.GetAngularDamping=function(){return this.m_angularDamping},A.prototype.SetAngularDamping=function(t){void 0===t&&(t=0),this.m_angularDamping=t},A.prototype.SetType=function(t){if(void 0===t&&(t=0),this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==A.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;i=i.next)i.contact.FlagForFiltering()}},A.prototype.GetType=function(){return this.m_type},A.prototype.SetBullet=function(t){t?this.m_flags|=A.e_bulletFlag:this.m_flags&=~A.e_bulletFlag},A.prototype.IsBullet=function(){return(this.m_flags&A.e_bulletFlag)==A.e_bulletFlag},A.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=A.e_allowSleepFlag:(this.m_flags&=~A.e_allowSleepFlag,this.SetAwake(!0))},A.prototype.SetAwake=function(t){t?(this.m_flags|=A.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~A.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},A.prototype.IsAwake=function(){return(this.m_flags&A.e_awakeFlag)==A.e_awakeFlag},A.prototype.SetFixedRotation=function(t){t?this.m_flags|=A.e_fixedRotationFlag:this.m_flags&=~A.e_fixedRotationFlag,this.ResetMassData()},A.prototype.IsFixedRotation=function(){return(this.m_flags&A.e_fixedRotationFlag)==A.e_fixedRotationFlag},A.prototype.SetActive=function(t){var i,o;if(t!=this.IsActive())if(t)for(this.m_flags|=A.e_activeFlag,i=this.m_world.m_contactManager.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.CreateProxy(i,this.m_xf);else{for(this.m_flags&=~A.e_activeFlag,i=this.m_world.m_contactManager.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.DestroyProxy(i);for(var e=this.m_contactList;e;){var n=e,e=e.next;this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}},A.prototype.IsActive=function(){return(this.m_flags&A.e_activeFlag)==A.e_activeFlag},A.prototype.IsSleepingAllowed=function(){return(this.m_flags&A.e_allowSleepFlag)==A.e_allowSleepFlag},A.prototype.GetFixtureList=function(){return this.m_fixtureList},A.prototype.GetJointList=function(){return this.m_jointList},A.prototype.GetControllerList=function(){return this.m_controllerList},A.prototype.GetContactList=function(){return this.m_contactList},A.prototype.GetNext=function(){return this.m_next},A.prototype.GetUserData=function(){return this.m_userData},A.prototype.SetUserData=function(t){this.m_userData=t},A.prototype.GetWorld=function(){return this.m_world},A.prototype.b2Body=function(t,i){this.m_flags=0,t.bullet&&(this.m_flags|=A.e_bulletFlag),t.fixedRotation&&(this.m_flags|=A.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=A.e_allowSleepFlag),t.awake&&(this.m_flags|=A.e_awakeFlag),t.active&&(this.m_flags|=A.e_activeFlag),this.m_world=i,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var o=this.m_xf.R,i=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*i.x+o.col2.x*i.y,this.m_sweep.c.y=o.col1.y*i.x+o.col2.y*i.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==A.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},A.prototype.SynchronizeFixtures=function(){var t=A.s_xf1;t.R.Set(this.m_sweep.a0);var i=t.R,o=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(i.col1.x*o.x+i.col2.x*o.y),t.position.y=this.m_sweep.c0.y-(i.col1.y*o.x+i.col2.y*o.y);for(var e=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(e,t,this.m_xf)},A.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,i=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*i.x+t.col2.x*i.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*i.x+t.col2.y*i.y)},A.prototype.ShouldCollide=function(t){if(this.m_type!=A.b2_dynamicBody&&t.m_type!=A.b2_dynamicBody)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&0==i.joint.m_collideConnected)return!1;return!0},A.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},P.postDefs.push(function(){P.Dynamics.b2Body.s_xf1=new s,P.Dynamics.b2Body.e_islandFlag=1,P.Dynamics.b2Body.e_awakeFlag=2,P.Dynamics.b2Body.e_allowSleepFlag=4,P.Dynamics.b2Body.e_bulletFlag=8,P.Dynamics.b2Body.e_fixedRotationFlag=16,P.Dynamics.b2Body.e_activeFlag=32,P.Dynamics.b2Body.b2_staticBody=0,P.Dynamics.b2Body.b2_kinematicBody=1,P.Dynamics.b2Body.b2_dynamicBody=2}),r.b2BodyDef=function(){this.position=new u,this.linearVelocity=new u},r.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=A.b2_staticBody,this.active=!0,this.inertiaScale=1},a.b2ContactFilter=function(){},a.prototype.ShouldCollide=function(t,i){t=t.GetFilterData(),i=i.GetFilterData();return t.groupIndex==i.groupIndex&&0!=t.groupIndex?0<t.groupIndex:0!=(t.maskBits&i.categoryBits)&&0!=(t.categoryBits&i.maskBits)},a.prototype.RayCollide=function(t,i){return!t||this.ShouldCollide(t instanceof w?t:null,i)},P.postDefs.push(function(){P.Dynamics.b2ContactFilter.b2_defaultFilter=new a}),l.b2ContactImpulse=function(){this.normalImpulses=new O(C.b2_maxManifoldPoints),this.tangentImpulses=new O(C.b2_maxManifoldPoints)},d.b2ContactListener=function(){},d.prototype.BeginContact=function(t){},d.prototype.EndContact=function(t){},d.prototype.PreSolve=function(t,i){},d.prototype.PostSolve=function(t,i){},P.postDefs.push(function(){P.Dynamics.b2ContactListener.b2_defaultListener=new d}),b.b2ContactManager=function(){},b.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=a.b2_defaultFilter,this.m_contactListener=d.b2_defaultListener,this.m_contactFactory=new G(this.m_allocator),this.m_broadPhase=new o},b.prototype.AddPair=function(t,i){var o=i instanceof w?i:null;if((n=(e=t instanceof w?t:null).GetBody())!=(i=o.GetBody())){for(var e,n,s=i.GetContactList();s;){if(s.other==n){var r=s.contact.GetFixtureA(),a=s.contact.GetFixtureB();if(r==e&&a==o)return;if(r==o&&a==e)return}s=s.next}0!=i.ShouldCollide(n)&&0!=this.m_contactFilter.ShouldCollide(e,o)&&(e=(t=this.m_contactFactory.Create(e,o)).GetFixtureA(),o=t.GetFixtureB(),n=e.m_body,i=o.m_body,t.m_prev=null,t.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=t),((this.m_world.m_contactList=t).m_nodeA.contact=t).m_nodeA.other=i,t.m_nodeA.prev=null,t.m_nodeA.next=n.m_contactList,null!=n.m_contactList&&(n.m_contactList.prev=t.m_nodeA),n.m_contactList=t.m_nodeA,(t.m_nodeB.contact=t).m_nodeB.other=n,t.m_nodeB.prev=null,t.m_nodeB.next=i.m_contactList,null!=i.m_contactList&&(i.m_contactList.prev=t.m_nodeB),i.m_contactList=t.m_nodeB,++this.m_world.m_contactCount)}},b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(P.generateCallback(this,this.AddPair))},b.prototype.Destroy=function(t){var i=t.GetFixtureA(),o=t.GetFixtureB(),i=i.GetBody(),o=o.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==i.m_contactList&&(i.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==o.m_contactList&&(o.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},b.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var i=t.GetFixtureA(),o=t.GetFixtureB(),e=i.GetBody(),n=o.GetBody();if(0!=e.IsAwake()||0!=n.IsAwake()){if(t.m_flags&I.e_filterFlag){if(0==n.ShouldCollide(e)){var s=t,t=s.GetNext();this.Destroy(s);continue}if(0==this.m_contactFilter.ShouldCollide(i,o)){t=(s=t).GetNext(),this.Destroy(s);continue}t.m_flags&=~I.e_filterFlag}i=i.m_proxy,o=o.m_proxy;0!=this.m_broadPhase.TestOverlap(i,o)?(t.Update(this.m_contactListener),t=t.GetNext()):(t=(s=t).GetNext(),this.Destroy(s))}else t=t.GetNext()}},P.postDefs.push(function(){P.Dynamics.b2ContactManager.s_evalCP=new i}),v.b2DebugDraw=function(){},v.prototype.b2DebugDraw=function(){},v.prototype.SetFlags=function(t){void 0===t&&(t=0)},v.prototype.GetFlags=function(){},v.prototype.AppendFlags=function(t){void 0===t&&(t=0)},v.prototype.ClearFlags=function(t){void 0===t&&(t=0)},v.prototype.SetSprite=function(t){},v.prototype.GetSprite=function(){},v.prototype.SetDrawScale=function(t){void 0===t&&(t=0)},v.prototype.GetDrawScale=function(){},v.prototype.SetLineThickness=function(t){void 0===t&&(t=0)},v.prototype.GetLineThickness=function(){},v.prototype.SetAlpha=function(t){void 0===t&&(t=0)},v.prototype.GetAlpha=function(){},v.prototype.SetFillAlpha=function(t){void 0===t&&(t=0)},v.prototype.GetFillAlpha=function(){},v.prototype.SetXFormScale=function(t){void 0===t&&(t=0)},v.prototype.GetXFormScale=function(){},v.prototype.DrawPolygon=function(t,i,o){void 0===i&&(i=0)},v.prototype.DrawSolidPolygon=function(t,i,o){void 0===i&&(i=0)},v.prototype.DrawCircle=function(t,i,o){void 0===i&&(i=0)},v.prototype.DrawSolidCircle=function(t,i,o,e){void 0===i&&(i=0)},v.prototype.DrawSegment=function(t,i,o){},v.prototype.DrawTransform=function(t){},P.postDefs.push(function(){P.Dynamics.b2DebugDraw.e_shapeBit=1,P.Dynamics.b2DebugDraw.e_jointBit=2,P.Dynamics.b2DebugDraw.e_aabbBit=4,P.Dynamics.b2DebugDraw.e_pairBit=8,P.Dynamics.b2DebugDraw.e_centerOfMassBit=16,P.Dynamics.b2DebugDraw.e_controllerBit=32}),S.b2DestructionListener=function(){},S.prototype.SayGoodbyeJoint=function(t){},S.prototype.SayGoodbyeFixture=function(t){},g.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},g.prototype.Copy=function(){var t=new g;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},w.b2Fixture=function(){this.m_filter=new g},w.prototype.GetType=function(){return this.m_shape.GetType()},w.prototype.GetShape=function(){return this.m_shape},w.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var i=this.m_body.GetContactList();i;){var o=i.contact,e=o.GetFixtureA(),n=o.GetFixtureB();e!=this&&n!=this||o.SetSensor(e.IsSensor()||n.IsSensor()),i=i.next}},w.prototype.IsSensor=function(){return this.m_isSensor},w.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body)for(var i=this.m_body.GetContactList();i;){var o=i.contact,e=o.GetFixtureA(),n=o.GetFixtureB();e!=this&&n!=this||o.FlagForFiltering(),i=i.next}},w.prototype.GetFilterData=function(){return this.m_filter.Copy()},w.prototype.GetBody=function(){return this.m_body},w.prototype.GetNext=function(){return this.m_next},w.prototype.GetUserData=function(){return this.m_userData},w.prototype.SetUserData=function(t){this.m_userData=t},w.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},w.prototype.RayCast=function(t,i){return this.m_shape.RayCast(t,i,this.m_body.GetTransform())},w.prototype.GetMassData=function(t){return void 0===t&&(t=null),null==t&&(t=new n),this.m_shape.ComputeMass(t,this.m_density),t},w.prototype.SetDensity=function(t){void 0===t&&(t=0),this.m_density=t},w.prototype.GetDensity=function(){return this.m_density},w.prototype.GetFriction=function(){return this.m_friction},w.prototype.SetFriction=function(t){void 0===t&&(t=0),this.m_friction=t},w.prototype.GetRestitution=function(){return this.m_restitution},w.prototype.SetRestitution=function(t){void 0===t&&(t=0),this.m_restitution=t},w.prototype.GetAABB=function(){return this.m_aabb},w.prototype.b2Fixture=function(){this.m_aabb=new f,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},w.prototype.Create=function(t,i,o){this.m_userData=o.userData,this.m_friction=o.friction,this.m_restitution=o.restitution,this.m_body=t,this.m_next=null,this.m_filter=o.filter.Copy(),this.m_isSensor=o.isSensor,this.m_shape=o.shape.Copy(),this.m_density=o.density},w.prototype.Destroy=function(){this.m_shape=null},w.prototype.CreateProxy=function(t,i){this.m_shape.ComputeAABB(this.m_aabb,i),this.m_proxy=t.CreateProxy(this.m_aabb,this)},w.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},w.prototype.Synchronize=function(t,i,o){var e,n;this.m_proxy&&(e=new f,n=new f,this.m_shape.ComputeAABB(e,i),this.m_shape.ComputeAABB(n,o),this.m_aabb.Combine(e,n),i=y.SubtractVV(o.position,i.position),t.MoveProxy(this.m_proxy,this.m_aabb,i))},D.b2FixtureDef=function(){this.filter=new g},D.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},B.b2Island=function(){},B.prototype.b2Island=function(){this.m_bodies=new q,this.m_contacts=new q,this.m_joints=new q},B.prototype.Initialize=function(t,i,o,e,n,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0);var r=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=i,this.m_jointCapacity=o,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=e,this.m_listener=n,this.m_contactSolver=s,r=this.m_bodies.length;r<t;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;r<i;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;r<o;r++)this.m_joints[r]=null},B.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},B.prototype.Solve=function(t,i,o){var e,n=0,s=0;for(n=0;n<this.m_bodyCount;++n)(e=this.m_bodies[n]).GetType()==A.b2_dynamicBody&&(e.m_linearVelocity.x+=t.dt*(i.x+e.m_invMass*e.m_force.x),e.m_linearVelocity.y+=t.dt*(i.y+e.m_invMass*e.m_force.y),e.m_angularVelocity+=t.dt*e.m_invI*e.m_torque,e.m_linearVelocity.Multiply(y.Clamp(1-t.dt*e.m_linearDamping,0,1)),e.m_angularVelocity*=y.Clamp(1-t.dt*e.m_angularDamping,0,1));this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var r,a=this.m_contactSolver;for(a.InitVelocityConstraints(t),n=0;n<this.m_jointCount;++n)this.m_joints[n].InitVelocityConstraints(t);for(n=0;n<t.velocityIterations;++n){for(s=0;s<this.m_jointCount;++s)this.m_joints[s].SolveVelocityConstraints(t);a.SolveVelocityConstraints()}for(n=0;n<this.m_jointCount;++n)this.m_joints[n].FinalizeVelocityConstraints();for(a.FinalizeVelocityConstraints(),n=0;n<this.m_bodyCount;++n){(e=this.m_bodies[n]).GetType()!=A.b2_staticBody&&((r=t.dt*e.m_linearVelocity.x)*r+(r=t.dt*e.m_linearVelocity.y)*r>C.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=C.b2_maxTranslation*t.inv_dt,e.m_linearVelocity.y*=C.b2_maxTranslation*t.inv_dt),(r=t.dt*e.m_angularVelocity)*r>C.b2_maxRotationSquared&&(e.m_angularVelocity<0?e.m_angularVelocity=-C.b2_maxRotation*t.inv_dt:e.m_angularVelocity=C.b2_maxRotation*t.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=t.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=t.dt*e.m_linearVelocity.y,e.m_sweep.a+=t.dt*e.m_angularVelocity,e.SynchronizeTransform())}for(n=0;n<t.positionIterations;++n){for(var l=a.SolvePositionConstraints(C.b2_contactBaumgarte),m=!0,s=0;s<this.m_jointCount;++s)var c=this.m_joints[s].SolvePositionConstraints(C.b2_contactBaumgarte),m=m&&c;if(l&&m)break}if(this.Report(a.m_constraints),o){for(var h=Number.MAX_VALUE,_=C.b2_linearSleepTolerance*C.b2_linearSleepTolerance,p=C.b2_angularSleepTolerance*C.b2_angularSleepTolerance,n=0;n<this.m_bodyCount;++n)(e=this.m_bodies[n]).GetType()!=A.b2_staticBody&&(0==(e.m_flags&A.e_allowSleepFlag)&&(h=e.m_sleepTime=0),h=0==(e.m_flags&A.e_allowSleepFlag)||e.m_angularVelocity*e.m_angularVelocity>p||y.Dot(e.m_linearVelocity,e.m_linearVelocity)>_?e.m_sleepTime=0:(e.m_sleepTime+=t.dt,y.Min(h,e.m_sleepTime)));if(h>=C.b2_timeToSleep)for(n=0;n<this.m_bodyCount;++n)(e=this.m_bodies[n]).SetAwake(!1)}},B.prototype.SolveTOI=function(t){var i=0,o=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);for(var e=this.m_contactSolver,i=0;i<this.m_jointCount;++i)this.m_joints[i].InitVelocityConstraints(t);for(i=0;i<t.velocityIterations;++i)for(e.SolveVelocityConstraints(),o=0;o<this.m_jointCount;++o)this.m_joints[o].SolveVelocityConstraints(t);for(i=0;i<this.m_bodyCount;++i){var n,s=this.m_bodies[i];s.GetType()!=A.b2_staticBody&&((n=t.dt*s.m_linearVelocity.x)*n+(n=t.dt*s.m_linearVelocity.y)*n>C.b2_maxTranslationSquared&&(s.m_linearVelocity.Normalize(),s.m_linearVelocity.x*=C.b2_maxTranslation*t.inv_dt,s.m_linearVelocity.y*=C.b2_maxTranslation*t.inv_dt),(n=t.dt*s.m_angularVelocity)*n>C.b2_maxRotationSquared&&(s.m_angularVelocity<0?s.m_angularVelocity=-C.b2_maxRotation*t.inv_dt:s.m_angularVelocity=C.b2_maxRotation*t.inv_dt),s.m_sweep.c0.SetV(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_sweep.c.x+=t.dt*s.m_linearVelocity.x,s.m_sweep.c.y+=t.dt*s.m_linearVelocity.y,s.m_sweep.a+=t.dt*s.m_angularVelocity,s.SynchronizeTransform())}for(i=0;i<t.positionIterations;++i){for(var r=e.SolvePositionConstraints(.75),a=!0,o=0;o<this.m_jointCount;++o)var l=this.m_joints[o].SolvePositionConstraints(C.b2_contactBaumgarte),a=a&&l;if(r&&a)break}this.Report(e.m_constraints)},B.prototype.Report=function(t){if(null!=this.m_listener)for(var i=0;i<this.m_contactCount;++i){for(var o=this.m_contacts[i],e=t[i],n=0;n<e.pointCount;++n)B.s_impulse.normalImpulses[n]=e.points[n].normalImpulse,B.s_impulse.tangentImpulses[n]=e.points[n].tangentImpulse;this.m_listener.PostSolve(o,B.s_impulse)}},B.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},B.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},B.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},P.postDefs.push(function(){P.Dynamics.b2Island.s_impulse=new l}),M.b2TimeStep=function(){},M.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},V.b2World=function(){this.s_stack=new q,this.m_contactManager=new b,this.m_contactSolver=new L,this.m_island=new B},V.prototype.b2World=function(t,i){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,V.m_warmStarting=!0,V.m_continuousPhysics=!0,this.m_allowSleep=i,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;t=new r;this.m_groundBody=this.CreateBody(t)},V.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},V.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},V.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},V.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},V.prototype.SetBroadPhase=function(t){var i=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var o=this.m_bodyList;o;o=o.m_next)for(var e=o.m_fixtureList;e;e=e.m_next)e.m_proxy=t.CreateProxy(i.GetFatAABB(e.m_proxy),e)},V.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},V.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},V.prototype.CreateBody=function(t){if(1==this.IsLocked())return null;t=new A(t,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},V.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var i=t.m_jointList;i;){var o=i,i=i.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(o.joint),this.DestroyJoint(o.joint)}for(var e=t.m_controllerList;e;){var n=e,e=e.nextController;n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var r=s,s=s.next;this.m_contactManager.Destroy(r.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a,a=a.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxy(this.m_contactManager.m_broadPhase),l.Destroy()}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},V.prototype.CreateJoint=function(t){var i=J.Create(t,null);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,(i.m_edgeA.joint=i).m_edgeA.other=i.m_bodyB,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,(i.m_edgeB.joint=i).m_edgeB.other=i.m_bodyA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var o=t.bodyA,e=t.bodyB;if(0==t.collideConnected)for(var n=e.GetContactList();n;)n.other==o&&n.contact.FlagForFiltering(),n=n.next;return i},V.prototype.DestroyJoint=function(t){var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var o=t.m_bodyA,e=t.m_bodyB;if(o.SetAwake(!0),e.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==o.m_jointList&&(o.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==e.m_jointList&&(e.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,J.Destroy(t,null),--this.m_jointCount,0==i)for(var n=e.GetContactList();n;)n.other==o&&n.contact.FlagForFiltering(),n=n.next},V.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,((this.m_controllerList=t).m_world=this).m_controllerCount++,t},V.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},V.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},V.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},V.prototype.SetWarmStarting=function(t){V.m_warmStarting=t},V.prototype.SetContinuousPhysics=function(t){V.m_continuousPhysics=t},V.prototype.GetBodyCount=function(){return this.m_bodyCount},V.prototype.GetJointCount=function(){return this.m_jointCount},V.prototype.GetContactCount=function(){return this.m_contactCount},V.prototype.SetGravity=function(t){this.m_gravity=t},V.prototype.GetGravity=function(){return this.m_gravity},V.prototype.GetGroundBody=function(){return this.m_groundBody},V.prototype.Step=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.m_flags&V.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~V.e_newFixture),this.m_flags|=V.e_locked;var e=V.s_timestep2;e.dt=t,e.velocityIterations=i,e.positionIterations=o,e.inv_dt=0<t?1/t:0,e.dtRatio=this.m_inv_dt0*t,e.warmStarting=V.m_warmStarting,this.m_contactManager.Collide(),0<e.dt&&this.Solve(e),V.m_continuousPhysics&&0<e.dt&&this.SolveTOI(e),0<e.dt&&(this.m_inv_dt0=e.inv_dt),this.m_flags&=~V.e_locked},V.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},V.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,i,o,e,n,s,r=this.m_debugDraw.GetFlags(),a=(new u,new u,new u,new f,new f,[new u,new u,new u,new u]),l=new x(0,0,0);if(r&v.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(s=t.m_xf,i=t.GetFixtureList();i;i=i.m_next)o=i.GetShape(),0==t.IsActive()?l.Set(.5,.5,.3):t.GetType()==A.b2_staticBody?l.Set(.5,.9,.5):t.GetType()==A.b2_kinematicBody?l.Set(.5,.5,.9):0==t.IsAwake()?l.Set(.6,.6,.6):l.Set(.9,.7,.7),this.DrawShape(o,s,l);if(r&v.e_jointBit)for(e=this.m_jointList;e;e=e.m_next)this.DrawJoint(e);if(r&v.e_controllerBit)for(var m=this.m_controllerList;m;m=m.m_next)m.Draw(this.m_debugDraw);if(r&v.e_pairBit){l.Set(.3,.9,.9);for(var c=this.m_contactManager.m_contactList;c;c=c.GetNext()){var h=c.GetFixtureA(),_=c.GetFixtureB(),h=h.GetAABB().GetCenter(),_=_.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(h,_,l)}}if(r&v.e_aabbBit)for(n=this.m_contactManager.m_broadPhase,a=[new u,new u,new u,new u],t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(i=t.GetFixtureList();i;i=i.GetNext()){var p=n.GetFatAABB(i.m_proxy);a[0].Set(p.lowerBound.x,p.lowerBound.y),a[1].Set(p.upperBound.x,p.lowerBound.y),a[2].Set(p.upperBound.x,p.upperBound.y),a[3].Set(p.lowerBound.x,p.upperBound.y),this.m_debugDraw.DrawPolygon(a,4,l)}if(r&v.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)(s=V.s_xf).R=t.m_xf.R,s.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(s)}},V.prototype.QueryAABB=function(i,t){var o=this.m_contactManager.m_broadPhase;o.Query(function(t){return i(o.GetUserData(t))},t)},V.prototype.QueryShape=function(i,o,e){void 0===e&&(e=null),null==e&&(e=new s).SetIdentity();var n=this.m_contactManager.m_broadPhase;var t=new f;o.ComputeAABB(t,e),n.Query(function(t){return t=n.GetUserData(t)instanceof w?n.GetUserData(t):null,!p.TestOverlap(o,e,t.GetShape(),t.GetBody().GetTransform())||i(t)},t)},V.prototype.QueryPoint=function(i,o){var e=this.m_contactManager.m_broadPhase;var t=new f;t.lowerBound.Set(o.x-C.b2_linearSlop,o.y-C.b2_linearSlop),t.upperBound.Set(o.x+C.b2_linearSlop,o.y+C.b2_linearSlop),e.Query(function(t){return!(t=e.GetUserData(t)instanceof w?e.GetUserData(t):null).TestPoint(o)||i(t)},t)},V.prototype.RayCast=function(n,s,r){var a=this.m_contactManager.m_broadPhase,l=new m;var t=new e(s,r);a.RayCast(function(t,i){var o=a.GetUserData(i),e=o instanceof w?o:null;if(e.RayCast(l,t)){i=l.fraction,o=new u((1-i)*s.x+i*r.x,(1-i)*s.y+i*r.y);return n(e,o,l.normal,i)}return t.maxFraction},t)},V.prototype.RayCastOne=function(t,i){var n;return this.RayCast(function(t,i,o,e){return void 0===e&&(e=0),n=t,e},t,i),n},V.prototype.RayCastAll=function(t,i){var n=new q;return this.RayCast(function(t,i,o,e){return void 0===e&&(e=0),n[n.length]=t,1},t,i),n},V.prototype.GetBodyList=function(){return this.m_bodyList},V.prototype.GetJointList=function(){return this.m_jointList},V.prototype.GetContactList=function(){return this.m_contactList},V.prototype.IsLocked=function(){return 0<(this.m_flags&V.e_locked)},V.prototype.Solve=function(t){for(var i,o=this.m_controllerList;o;o=o.m_next)o.Step(t);var e=this.m_island;for(e.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~A.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~I.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var r=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&A.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=A.b2_staticBody){e.Clear();var l=0;for((r[l++]=a).m_flags|=A.e_islandFlag;0<l;)if(i=r[--l],e.AddBody(i),0==i.IsAwake()&&i.SetAwake(!0),i.GetType()!=A.b2_staticBody){for(var m,c=i.m_contactList;c;c=c.next)c.contact.m_flags&I.e_islandFlag||1!=c.contact.IsSensor()&&0!=c.contact.IsEnabled()&&0!=c.contact.IsTouching()&&(e.AddContact(c.contact),c.contact.m_flags|=I.e_islandFlag,(m=c.other).m_flags&A.e_islandFlag||((r[l++]=m).m_flags|=A.e_islandFlag));for(var h=i.m_jointList;h;h=h.next)1!=h.joint.m_islandFlag&&0!=(m=h.other).IsActive()&&(e.AddJoint(h.joint),h.joint.m_islandFlag=!0,m.m_flags&A.e_islandFlag||((r[l++]=m).m_flags|=A.e_islandFlag))}e.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;_<e.m_bodyCount;++_)(i=e.m_bodies[_]).GetType()==A.b2_staticBody&&(i.m_flags&=~A.e_islandFlag)}for(_=0;_<r.length&&r[_];++_)r[_]=null;for(i=this.m_bodyList;i;i=i.m_next)0!=i.IsAwake()&&0!=i.IsActive()&&i.GetType()!=A.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},V.prototype.SolveTOI=function(t){var i,o,e,n,s,r,a=this.m_island;a.Initialize(this.m_bodyCount,C.b2_maxTOIContactsPerIsland,C.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(var l=V.s_queue,m=this.m_bodyList;m;m=m.m_next)m.m_flags&=~A.e_islandFlag,m.m_sweep.t0=0;for(_=this.m_contactList;_;_=_.m_next)_.m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){for(var c=null,h=1,_=this.m_contactList;_;_=_.m_next)if(1!=_.IsSensor()&&0!=_.IsEnabled()&&0!=_.IsContinuous()){var p=1;if(_.m_flags&I.e_toiFlag)p=_.m_toi;else{if(i=_.m_fixtureA,o=_.m_fixtureB,e=i.m_body,n=o.m_body,!(e.GetType()==A.b2_dynamicBody&&0!=e.IsAwake()||n.GetType()==A.b2_dynamicBody&&0!=n.IsAwake()))continue;var y=e.m_sweep.t0;e.m_sweep.t0<n.m_sweep.t0?(y=n.m_sweep.t0,e.m_sweep.Advance(y)):n.m_sweep.t0<e.m_sweep.t0&&(y=e.m_sweep.t0,n.m_sweep.Advance(y)),p=_.ComputeTOI(e.m_sweep,n.m_sweep),C.b2Assert(0<=p&&p<=1),0<p&&p<1&&1<(p=(1-p)*y+p)&&(p=1),_.m_toi=p,_.m_flags|=I.e_toiFlag}Number.MIN_VALUE<p&&p<h&&(c=_,h=p)}if(null==c||1-100*Number.MIN_VALUE<h)break;if(i=c.m_fixtureA,o=c.m_fixtureB,e=i.m_body,n=o.m_body,V.s_backupA.Set(e.m_sweep),V.s_backupB.Set(n.m_sweep),e.Advance(h),n.Advance(h),c.Update(this.m_contactManager.m_contactListener),c.m_flags&=~I.e_toiFlag,1!=c.IsSensor()&&0!=c.IsEnabled()){if(0!=c.IsTouching()){var u=e;u.GetType()!=A.b2_dynamicBody&&(u=n),a.Clear();var x,f=0,d=0;for((l[f+d++]=u).m_flags|=A.e_islandFlag;0<d;)if(m=l[f++],--d,a.AddBody(m),0==m.IsAwake()&&m.SetAwake(!0),m.GetType()==A.b2_dynamicBody){for(s=m.m_contactList;s&&a.m_contactCount!=a.m_contactCapacity;s=s.next){s.contact.m_flags&I.e_islandFlag||1!=s.contact.IsSensor()&&0!=s.contact.IsEnabled()&&0!=s.contact.IsTouching()&&(a.AddContact(s.contact),s.contact.m_flags|=I.e_islandFlag,(x=s.other).m_flags&A.e_islandFlag||(x.GetType()!=A.b2_staticBody&&(x.Advance(h),x.SetAwake(!0)),l[f+d]=x,++d,x.m_flags|=A.e_islandFlag))}for(var b=m.m_jointList;b;b=b.next)a.m_jointCount!=a.m_jointCapacity&&1!=b.joint.m_islandFlag&&0!=(x=b.other).IsActive()&&(a.AddJoint(b.joint),b.joint.m_islandFlag=!0,x.m_flags&A.e_islandFlag||(x.GetType()!=A.b2_staticBody&&(x.Advance(h),x.SetAwake(!0)),l[f+d]=x,++d,x.m_flags|=A.e_islandFlag))}u=V.s_timestep;u.warmStarting=!1,u.dt=(1-h)*t.dt,u.inv_dt=1/u.dt,u.dtRatio=0,u.velocityIterations=t.velocityIterations,u.positionIterations=t.positionIterations,a.SolveTOI(u);for(var v=0,v=0;v<a.m_bodyCount;++v)if((m=a.m_bodies[v]).m_flags&=~A.e_islandFlag,0!=m.IsAwake()&&m.GetType()==A.b2_dynamicBody)for(m.SynchronizeFixtures(),s=m.m_contactList;s;s=s.next)s.contact.m_flags&=~I.e_toiFlag;for(v=0;v<a.m_contactCount;++v)(_=a.m_contacts[v]).m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(v=0;v<a.m_jointCount;++v)(r=a.m_joints[v]).m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else e.m_sweep.Set(V.s_backupA),n.m_sweep.Set(V.s_backupB),e.SynchronizeTransform(),n.SynchronizeTransform()}},V.prototype.DrawJoint=function(t){var i=t.GetBodyA(),o=t.GetBodyB(),e=i.m_xf,n=o.m_xf,s=e.position,r=n.position,a=t.GetAnchorA(),l=t.GetAnchorB(),e=V.s_jointColor;switch(t.m_type){case J.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,e);break;case J.e_pulleyJoint:n=t instanceof F?t:null,t=n.GetGroundAnchorA(),n=n.GetGroundAnchorB();this.m_debugDraw.DrawSegment(t,a,e),this.m_debugDraw.DrawSegment(n,l,e),this.m_debugDraw.DrawSegment(t,n,e);break;case J.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,e);break;default:i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,e),this.m_debugDraw.DrawSegment(a,l,e),o!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,l,e)}},V.prototype.DrawShape=function(t,i,o){switch(t.m_type){case p.e_circleShape:var e=t instanceof c?t:null,n=y.MulX(i,e.m_p),s=e.m_radius,e=i.R.col1;this.m_debugDraw.DrawSolidCircle(n,s,e,o);break;case p.e_polygonShape:for(var r=0,e=t instanceof _?t:null,a=parseInt(e.GetVertexCount()),l=e.GetVertices(),m=new q(a),r=0;r<a;++r)m[r]=y.MulX(i,l[r]);this.m_debugDraw.DrawSolidPolygon(m,a,o);break;case p.e_edgeShape:t=t instanceof h?t:null;this.m_debugDraw.DrawSegment(y.MulX(i,t.GetVertex1()),y.MulX(i,t.GetVertex2()),o)}},P.postDefs.push(function(){P.Dynamics.b2World.s_timestep2=new M,P.Dynamics.b2World.s_xf=new s,P.Dynamics.b2World.s_backupA=new t,P.Dynamics.b2World.s_backupB=new t,P.Dynamics.b2World.s_timestep=new M,P.Dynamics.b2World.s_queue=new q,P.Dynamics.b2World.s_jointColor=new x(.5,.8,.8),P.Dynamics.b2World.e_newFixture=1,P.Dynamics.b2World.e_locked=2})}(),function(){var o=P.Collision.Shapes.b2CircleShape,e=(P.Collision.Shapes.b2EdgeChainDef,P.Collision.Shapes.b2EdgeShape),n=(P.Collision.Shapes.b2MassData,P.Collision.Shapes.b2PolygonShape),u=P.Collision.Shapes.b2Shape,s=P.Dynamics.Contacts.b2CircleContact,x=P.Dynamics.Contacts.b2Contact,R=P.Dynamics.Contacts.b2ContactConstraint,i=P.Dynamics.Contacts.b2ContactConstraintPoint,t=P.Dynamics.Contacts.b2ContactEdge,r=P.Dynamics.Contacts.b2ContactFactory,a=P.Dynamics.Contacts.b2ContactRegister,l=P.Dynamics.Contacts.b2ContactResult,T=P.Dynamics.Contacts.b2ContactSolver,m=P.Dynamics.Contacts.b2EdgeAndCircleContact,c=P.Dynamics.Contacts.b2NullContact,h=P.Dynamics.Contacts.b2PolyAndCircleContact,_=P.Dynamics.Contacts.b2PolyAndEdgeContact,p=P.Dynamics.Contacts.b2PolygonContact,y=P.Dynamics.Contacts.b2PositionSolverManifold,f=P.Dynamics.b2Body,d=(P.Dynamics.b2BodyDef,P.Dynamics.b2ContactFilter,P.Dynamics.b2ContactImpulse,P.Dynamics.b2ContactListener,P.Dynamics.b2ContactManager,P.Dynamics.b2DebugDraw,P.Dynamics.b2DestructionListener,P.Dynamics.b2FilterData,P.Dynamics.b2Fixture,P.Dynamics.b2FixtureDef,P.Dynamics.b2Island,P.Dynamics.b2TimeStep),k=(P.Dynamics.b2World,P.Common.b2Color,P.Common.b2internal,P.Common.b2Settings),b=P.Common.Math.b2Mat22,U=(P.Common.Math.b2Mat33,P.Common.Math.b2Math),v=(P.Common.Math.b2Sweep,P.Common.Math.b2Transform,P.Common.Math.b2Vec2),C=(P.Common.Math.b2Vec3,P.Collision.b2AABB,P.Collision.b2Bound,P.Collision.b2BoundValues,P.Collision.b2Collision),A=P.Collision.b2ContactID,S=(P.Collision.b2ContactPoint,P.Collision.b2Distance,P.Collision.b2DistanceInput,P.Collision.b2DistanceOutput,P.Collision.b2DistanceProxy,P.Collision.b2DynamicTree,P.Collision.b2DynamicTreeBroadPhase,P.Collision.b2DynamicTreeNode,P.Collision.b2DynamicTreePair,P.Collision.b2Manifold),g=(P.Collision.b2ManifoldPoint,P.Collision.b2Point,P.Collision.b2RayCastInput,P.Collision.b2RayCastOutput,P.Collision.b2Segment,P.Collision.b2SeparationFunction,P.Collision.b2Simplex,P.Collision.b2SimplexCache,P.Collision.b2SimplexVertex,P.Collision.b2TimeOfImpact),w=P.Collision.b2TOIInput,D=P.Collision.b2WorldManifold;P.Collision.ClipVertex,P.Collision.Features,P.Collision.IBroadPhase;P.inherit(s,P.Dynamics.Contacts.b2Contact),s.prototype.__super=P.Dynamics.Contacts.b2Contact.prototype,s.b2CircleContact=function(){P.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},s.Create=function(t){return new s},s.Destroy=function(t,i){},s.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},s.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();C.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof o?this.m_fixtureB.GetShape():null,i.m_xf)},x.b2Contact=function(){this.m_nodeA=new t,this.m_nodeB=new t,this.m_manifold=new S,this.m_oldManifold=new S},x.prototype.GetManifold=function(){return this.m_manifold},x.prototype.GetWorldManifold=function(t){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,i.GetTransform(),e.m_radius,o.GetTransform(),n.m_radius)},x.prototype.IsTouching=function(){return(this.m_flags&x.e_touchingFlag)==x.e_touchingFlag},x.prototype.IsContinuous=function(){return(this.m_flags&x.e_continuousFlag)==x.e_continuousFlag},x.prototype.SetSensor=function(t){t?this.m_flags|=x.e_sensorFlag:this.m_flags&=~x.e_sensorFlag},x.prototype.IsSensor=function(){return(this.m_flags&x.e_sensorFlag)==x.e_sensorFlag},x.prototype.SetEnabled=function(t){t?this.m_flags|=x.e_enabledFlag:this.m_flags&=~x.e_enabledFlag},x.prototype.IsEnabled=function(){return(this.m_flags&x.e_enabledFlag)==x.e_enabledFlag},x.prototype.GetNext=function(){return this.m_next},x.prototype.GetFixtureA=function(){return this.m_fixtureA},x.prototype.GetFixtureB=function(){return this.m_fixtureB},x.prototype.FlagForFiltering=function(){this.m_flags|=x.e_filterFlag},x.prototype.b2Contact=function(){},x.prototype.Reset=function(t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),this.m_flags=x.e_enabledFlag,!t||!i)return this.m_fixtureA=null,void(this.m_fixtureB=null);(t.IsSensor()||i.IsSensor())&&(this.m_flags|=x.e_sensorFlag);var o=t.GetBody(),e=i.GetBody();(o.GetType()!=f.b2_dynamicBody||o.IsBullet()||e.GetType()!=f.b2_dynamicBody||e.IsBullet())&&(this.m_flags|=x.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=i,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},x.prototype.Update=function(t){var i=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=i,this.m_flags|=x.e_enabledFlag;var o,e,n,s=!1,r=(this.m_flags&x.e_touchingFlag)==x.e_touchingFlag,a=this.m_fixtureA.m_body,l=this.m_fixtureB.m_body,m=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&x.e_sensorFlag){m&&(o=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape(),n=a.GetTransform(),i=l.GetTransform(),s=u.TestOverlap(o,n,e,i)),this.m_manifold.m_pointCount=0}else{if(a.GetType()!=f.b2_dynamicBody||a.IsBullet()||l.GetType()!=f.b2_dynamicBody||l.IsBullet()?this.m_flags|=x.e_continuousFlag:this.m_flags&=~x.e_continuousFlag,m){this.Evaluate(),s=0<this.m_manifold.m_pointCount;for(var c=0;c<this.m_manifold.m_pointCount;++c){var h=this.m_manifold.m_points[c];h.m_normalImpulse=0,h.m_tangentImpulse=0;for(var _=h.m_id,p=0;p<this.m_oldManifold.m_pointCount;++p){var y=this.m_oldManifold.m_points[p];if(y.m_id.key==_.key){h.m_normalImpulse=y.m_normalImpulse,h.m_tangentImpulse=y.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;s!=r&&(a.SetAwake(!0),l.SetAwake(!0))}s?this.m_flags|=x.e_touchingFlag:this.m_flags&=~x.e_touchingFlag,0==r&&1==s&&t.BeginContact(this),1==r&&0==s&&t.EndContact(this),0==(this.m_flags&x.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)},x.prototype.Evaluate=function(){},x.prototype.ComputeTOI=function(t,i){return x.s_input.proxyA.Set(this.m_fixtureA.GetShape()),x.s_input.proxyB.Set(this.m_fixtureB.GetShape()),x.s_input.sweepA=t,x.s_input.sweepB=i,x.s_input.tolerance=k.b2_linearSlop,g.TimeOfImpact(x.s_input)},P.postDefs.push(function(){P.Dynamics.Contacts.b2Contact.e_sensorFlag=1,P.Dynamics.Contacts.b2Contact.e_continuousFlag=2,P.Dynamics.Contacts.b2Contact.e_islandFlag=4,P.Dynamics.Contacts.b2Contact.e_toiFlag=8,P.Dynamics.Contacts.b2Contact.e_touchingFlag=16,P.Dynamics.Contacts.b2Contact.e_enabledFlag=32,P.Dynamics.Contacts.b2Contact.e_filterFlag=64,P.Dynamics.Contacts.b2Contact.s_input=new w}),R.b2ContactConstraint=function(){this.localPlaneNormal=new v,this.localPoint=new v,this.normal=new v,this.normalMass=new b,this.K=new b},R.prototype.b2ContactConstraint=function(){this.points=new q(k.b2_maxManifoldPoints);for(var t=0;t<k.b2_maxManifoldPoints;t++)this.points[t]=new i},i.b2ContactConstraintPoint=function(){this.localPoint=new v,this.rA=new v,this.rB=new v},t.b2ContactEdge=function(){},r.b2ContactFactory=function(){},r.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},r.prototype.AddType=function(t,i,o,e){void 0===o&&(o=0),void 0===e&&(e=0),this.m_registers[o][e].createFcn=t,this.m_registers[o][e].destroyFcn=i,this.m_registers[o][e].primary=!0,o!=e&&(this.m_registers[e][o].createFcn=t,this.m_registers[e][o].destroyFcn=i,this.m_registers[e][o].primary=!1)},r.prototype.InitializeRegisters=function(){this.m_registers=new q(u.e_shapeTypeCount);for(var t=0;t<u.e_shapeTypeCount;t++){this.m_registers[t]=new q(u.e_shapeTypeCount);for(var i=0;i<u.e_shapeTypeCount;i++)this.m_registers[t][i]=new a}this.AddType(s.Create,s.Destroy,u.e_circleShape,u.e_circleShape),this.AddType(h.Create,h.Destroy,u.e_polygonShape,u.e_circleShape),this.AddType(p.Create,p.Destroy,u.e_polygonShape,u.e_polygonShape),this.AddType(m.Create,m.Destroy,u.e_edgeShape,u.e_circleShape),this.AddType(_.Create,_.Destroy,u.e_polygonShape,u.e_edgeShape)},r.prototype.Create=function(t,i){var o,e=parseInt(t.GetType()),n=parseInt(i.GetType()),e=this.m_registers[e][n];if(e.pool)return o=e.pool,e.pool=o.m_next,e.poolCount--,o.Reset(t,i),o;n=e.createFcn;return null!=n?(e.primary?(o=n(this.m_allocator)).Reset(t,i):(o=n(this.m_allocator)).Reset(i,t),o):null},r.prototype.Destroy=function(t){0<t.m_manifold.m_pointCount&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var i=parseInt(t.m_fixtureA.GetType()),o=parseInt(t.m_fixtureB.GetType()),o=this.m_registers[i][o];o.poolCount++,t.m_next=o.pool,o.pool=t,(0,o.destroyFcn)(t,this.m_allocator)},a.b2ContactRegister=function(){},l.b2ContactResult=function(){this.position=new v,this.normal=new v,this.id=new A},T.b2ContactSolver=function(){this.m_step=new d,this.m_constraints=new q},T.prototype.b2ContactSolver=function(){},T.prototype.Initialize=function(t,i,o,e){void 0===o&&(o=0),this.m_step.Set(t),this.m_allocator=e;var n=0;for(this.m_constraintCount=o;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new R;for(n=0;n<o;++n){var s=(w=i[n]).m_fixtureA,r=w.m_fixtureB,a=s.m_shape,l=r.m_shape,m=a.m_radius,c=l.m_radius,h=s.m_body,_=r.m_body,p=w.GetManifold(),y=k.b2MixFriction(s.GetFriction(),r.GetFriction()),u=k.b2MixRestitution(s.GetRestitution(),r.GetRestitution()),x=h.m_linearVelocity.x,f=h.m_linearVelocity.y,d=_.m_linearVelocity.x,b=_.m_linearVelocity.y,v=h.m_angularVelocity,C=_.m_angularVelocity;k.b2Assert(0<p.m_pointCount),T.s_worldManifold.Initialize(p,h.m_xf,m,_.m_xf,c);var A=T.s_worldManifold.m_normal.x,S=T.s_worldManifold.m_normal.y,g=this.m_constraints[n];g.bodyA=h,g.bodyB=_,g.manifold=p,g.normal.x=A,g.normal.y=S,g.pointCount=p.m_pointCount,g.friction=y,g.restitution=u,g.localPlaneNormal.x=p.m_localPlaneNormal.x,g.localPlaneNormal.y=p.m_localPlaneNormal.y,g.localPoint.x=p.m_localPoint.x,g.localPoint.y=p.m_localPoint.y,g.radius=m+c,g.type=p.m_type;for(var w,D,B=0;B<g.pointCount;++B){var M=p.m_points[B],V=g.points[B];V.normalImpulse=M.m_normalImpulse,V.tangentImpulse=M.m_tangentImpulse,V.localPoint.SetV(M.m_localPoint);var I=V.rA.x=T.s_worldManifold.m_points[B].x-h.m_sweep.c.x,G=V.rA.y=T.s_worldManifold.m_points[B].y-h.m_sweep.c.y,L=V.rB.x=T.s_worldManifold.m_points[B].x-_.m_sweep.c.x,J=V.rB.y=T.s_worldManifold.m_points[B].y-_.m_sweep.c.y,F=I*S-G*A,P=L*S-J*A;F*=F,P*=P;M=h.m_invMass+_.m_invMass+h.m_invI*F+_.m_invI*P;V.normalMass=1/M;M=h.m_mass*h.m_invMass+_.m_mass*_.m_invMass;M+=h.m_mass*h.m_invI*F+_.m_mass*_.m_invI*P,V.equalizedMass=1/M;P=-A,M=I*P-G*S,P=L*P-J*S;M*=M,P*=P;P=h.m_invMass+_.m_invMass+h.m_invI*M+_.m_invI*P;V.tangentMass=1/P,V.velocityBias=0;G=d+-C*J-x- -v*G,I=b+C*L-f-v*I,I=g.normal.x*G+g.normal.y*I;I<-k.b2_velocityThreshold&&(V.velocityBias+=-g.restitution*I)}2==g.pointCount&&(D=g.points[0],a=g.points[1],l=h.m_invMass,w=h.m_invI,s=_.m_invMass,r=_.m_invI,(m=l+s+w*(y=D.rA.x*S-D.rA.y*A)*y+r*(u=D.rB.x*S-D.rB.y*A)*u)*m<100*(m*(a=l+s+w*(c=a.rA.x*S-a.rA.y*A)*c+r*(D=a.rB.x*S-a.rB.y*A)*D)-(D=l+s+w*y*c+r*u*D)*D)?(g.K.col1.Set(m,D),g.K.col2.Set(D,a),g.K.GetInverse(g.normalMass)):g.pointCount=1)}},T.prototype.InitVelocityConstraints=function(t){for(var i=0;i<this.m_constraintCount;++i){var o=this.m_constraints[i],e=o.bodyA,n=o.bodyB,s=e.m_invMass,r=e.m_invI,a=n.m_invMass,l=n.m_invI,m=o.normal.x,c=o.normal.y,h=c,_=-m,p=0,y=0;if(t.warmStarting)for(y=o.pointCount,p=0;p<y;++p){var u=o.points[p];u.normalImpulse*=t.dtRatio,u.tangentImpulse*=t.dtRatio;var x=u.normalImpulse*m+u.tangentImpulse*h,f=u.normalImpulse*c+u.tangentImpulse*_;e.m_angularVelocity-=r*(u.rA.x*f-u.rA.y*x),e.m_linearVelocity.x-=s*x,e.m_linearVelocity.y-=s*f,n.m_angularVelocity+=l*(u.rB.x*f-u.rB.y*x),n.m_linearVelocity.x+=a*x,n.m_linearVelocity.y+=a*f}else for(y=o.pointCount,p=0;p<y;++p){var d=o.points[p];d.normalImpulse=0,d.tangentImpulse=0}}},T.prototype.SolveVelocityConstraints=function(){for(var t,i,o,e,n=0,s=0,r=0,a=0,l=0,m=0,c=0,h=0,_=0,p=0,y=0,u=0;u<this.m_constraintCount;++u){for(var x=this.m_constraints[u],f=x.bodyA,d=x.bodyB,b=f.m_angularVelocity,v=d.m_angularVelocity,C=f.m_linearVelocity,A=d.m_linearVelocity,S=f.m_invMass,g=f.m_invI,w=d.m_invMass,D=d.m_invI,B=x.normal.x,M=x.normal.y,V=M,I=-B,G=x.friction,n=0;n<x.pointCount;n++)t=x.points[n],o=(A.x-v*t.rB.y-C.x+b*t.rA.y)*V+(A.y+v*t.rB.x-C.y-b*t.rA.x)*I,s=t.tangentMass*-o,e=G*t.normalImpulse,a=(s=(r=U.Clamp(t.tangentImpulse+s,-e,e))-t.tangentImpulse)*V,l=s*I,C.x-=S*a,C.y-=S*l,b-=g*(t.rA.x*l-t.rA.y*a),A.x+=w*a,A.y+=w*l,v+=D*(t.rB.x*l-t.rB.y*a),t.tangentImpulse=r;parseInt(x.pointCount);if(1==x.pointCount)t=x.points[0],i=(A.x+-v*t.rB.y-C.x- -b*t.rA.y)*B+(A.y+v*t.rB.x-C.y-b*t.rA.x)*M,s=-t.normalMass*(i-t.velocityBias),a=(s=(r=0<(r=t.normalImpulse+s)?r:0)-t.normalImpulse)*B,l=s*M,C.x-=S*a,C.y-=S*l,b-=g*(t.rA.x*l-t.rA.y*a),A.x+=w*a,A.y+=w*l,v+=D*(t.rB.x*l-t.rB.y*a),t.normalImpulse=r;else{var L,J=x.points[0],F=x.points[1],P=J.normalImpulse,R=F.normalImpulse,T=(A.x-v*J.rB.y-C.x+b*J.rA.y)*B+(A.y+v*J.rB.x-C.y-b*J.rA.x)*M,k=(A.x-v*F.rB.y-C.x+b*F.rA.y)*B+(A.y+v*F.rB.x-C.y-b*F.rA.x)*M,z=T-J.velocityBias,N=k-F.velocityBias;z-=(L=x.K).col1.x*P+L.col2.x*R,N-=L.col1.y*P+L.col2.y*R;for(;;){var E=-((L=x.normalMass).col1.x*z+L.col2.x*N),j=-(L.col1.y*z+L.col2.y*N);if(0<=E&&0<=j){h=(m=E-P)*B,_=m*M,p=(c=j-R)*B,y=c*M,C.x-=S*(h+p),C.y-=S*(_+y),b-=g*(J.rA.x*_-J.rA.y*h+F.rA.x*y-F.rA.y*p),A.x+=w*(h+p),A.y+=w*(_+y),v+=D*(J.rB.x*_-J.rB.y*h+F.rB.x*y-F.rB.y*p),J.normalImpulse=E,F.normalImpulse=j;break}if(E=-J.normalMass*z,T=j=0,k=x.K.col1.y*E+N,0<=E&&0<=k){h=(m=E-P)*B,_=m*M,p=(c=j-R)*B,y=c*M,C.x-=S*(h+p),C.y-=S*(_+y),b-=g*(J.rA.x*_-J.rA.y*h+F.rA.x*y-F.rA.y*p),A.x+=w*(h+p),A.y+=w*(_+y),v+=D*(J.rB.x*_-J.rB.y*h+F.rB.x*y-F.rB.y*p),J.normalImpulse=E,F.normalImpulse=j;break}if(E=0,j=-F.normalMass*N,T=x.K.col2.x*j+z,(k=0)<=j&&0<=T){h=(m=E-P)*B,_=m*M,p=(c=j-R)*B,y=c*M,C.x-=S*(h+p),C.y-=S*(_+y),b-=g*(J.rA.x*_-J.rA.y*h+F.rA.x*y-F.rA.y*p),A.x+=w*(h+p),A.y+=w*(_+y),v+=D*(J.rB.x*_-J.rB.y*h+F.rB.x*y-F.rB.y*p),J.normalImpulse=E,F.normalImpulse=j;break}if(k=N,(j=E=0)<=(T=z)&&0<=k){h=(m=E-P)*B,_=m*M,p=(c=j-R)*B,y=c*M,C.x-=S*(h+p),C.y-=S*(_+y),b-=g*(J.rA.x*_-J.rA.y*h+F.rA.x*y-F.rA.y*p),A.x+=w*(h+p),A.y+=w*(_+y),v+=D*(J.rB.x*_-J.rB.y*h+F.rB.x*y-F.rB.y*p),J.normalImpulse=E,F.normalImpulse=j;break}break}}f.m_angularVelocity=b,d.m_angularVelocity=v}},T.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var i=this.m_constraints[t],o=i.manifold,e=0;e<i.pointCount;++e){var n=o.m_points[e],s=i.points[e];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},T.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var i=0,o=0;o<this.m_constraintCount;o++){var e=this.m_constraints[o],n=e.bodyA,s=e.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,l=s.m_mass*s.m_invMass,m=s.m_mass*s.m_invI;T.s_psm.Initialize(e);for(var c=T.s_psm.m_normal,h=0;h<e.pointCount;h++){var _=e.points[h],p=T.s_psm.m_points[h],y=T.s_psm.m_separations[h],u=p.x-n.m_sweep.c.x,x=p.y-n.m_sweep.c.y,f=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y,i=i<y?i:y,y=U.Clamp(t*(y+k.b2_linearSlop),-k.b2_maxLinearCorrection,0),_=-_.equalizedMass*y,y=_*c.x,_=_*c.y;n.m_sweep.c.x-=r*y,n.m_sweep.c.y-=r*_,n.m_sweep.a-=a*(u*_-x*y),n.SynchronizeTransform(),s.m_sweep.c.x+=l*y,s.m_sweep.c.y+=l*_,s.m_sweep.a+=m*(f*_-p*y),s.SynchronizeTransform()}}return i>-1.5*k.b2_linearSlop},P.postDefs.push(function(){P.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new D,P.Dynamics.Contacts.b2ContactSolver.s_psm=new y}),P.inherit(m,P.Dynamics.Contacts.b2Contact),m.prototype.__super=P.Dynamics.Contacts.b2Contact.prototype,m.b2EdgeAndCircleContact=function(){P.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(t){return new m},m.Destroy=function(t,i){},m.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},m.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof o?this.m_fixtureB.GetShape():null,i.m_xf)},m.prototype.b2CollideEdgeAndCircle=function(t,i,o,e,n){},P.inherit(c,P.Dynamics.Contacts.b2Contact),c.prototype.__super=P.Dynamics.Contacts.b2Contact.prototype,c.b2NullContact=function(){P.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},c.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},c.prototype.Evaluate=function(){},P.inherit(h,P.Dynamics.Contacts.b2Contact),h.prototype.__super=P.Dynamics.Contacts.b2Contact.prototype,h.b2PolyAndCircleContact=function(){P.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},h.Create=function(t){return new h},h.Destroy=function(t,i){},h.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i),k.b2Assert(t.GetType()==u.e_polygonShape),k.b2Assert(i.GetType()==u.e_circleShape)},h.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body;C.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof o?this.m_fixtureB.GetShape():null,i.m_xf)},P.inherit(_,P.Dynamics.Contacts.b2Contact),_.prototype.__super=P.Dynamics.Contacts.b2Contact.prototype,_.b2PolyAndEdgeContact=function(){P.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},_.Create=function(t){return new _},_.Destroy=function(t,i){},_.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i),k.b2Assert(t.GetType()==u.e_polygonShape),k.b2Assert(i.GetType()==u.e_edgeShape)},_.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,i.m_xf)},_.prototype.b2CollidePolyAndEdge=function(t,i,o,e,n){},P.inherit(p,P.Dynamics.Contacts.b2Contact),p.prototype.__super=P.Dynamics.Contacts.b2Contact.prototype,p.b2PolygonContact=function(){P.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(t){return new p},p.Destroy=function(t,i){},p.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},p.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();C.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,i.m_xf)},y.b2PositionSolverManifold=function(){},y.prototype.b2PositionSolverManifold=function(){this.m_normal=new v,this.m_separations=new O(k.b2_maxManifoldPoints),this.m_points=new q(k.b2_maxManifoldPoints);for(var t=0;t<k.b2_maxManifoldPoints;t++)this.m_points[t]=new v},y.prototype.Initialize=function(t){k.b2Assert(0<t.pointCount);var i=0,o=0,e=0,n=0,s=0;switch(t.type){case S.e_circles:l=t.bodyA.m_xf.R,m=t.localPoint;var r=t.bodyA.m_xf.position.x+(l.col1.x*m.x+l.col2.x*m.y),a=t.bodyA.m_xf.position.y+(l.col1.y*m.x+l.col2.y*m.y),l=t.bodyB.m_xf.R,m=t.points[0].localPoint,c=t.bodyB.m_xf.position.x+(l.col1.x*m.x+l.col2.x*m.y),h=t.bodyB.m_xf.position.y+(l.col1.y*m.x+l.col2.y*m.y),_=c-r,p=h-a,y=_*_+p*p;y>Number.MIN_VALUE*Number.MIN_VALUE?(y=Math.sqrt(y),this.m_normal.x=_/y,this.m_normal.y=p/y):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(r+c),this.m_points[0].y=.5*(a+h),this.m_separations[0]=_*this.m_normal.x+p*this.m_normal.y-t.radius;break;case S.e_faceA:for(l=t.bodyA.m_xf.R,m=t.localPlaneNormal,this.m_normal.x=l.col1.x*m.x+l.col2.x*m.y,this.m_normal.y=l.col1.y*m.x+l.col2.y*m.y,l=t.bodyA.m_xf.R,m=t.localPoint,n=t.bodyA.m_xf.position.x+(l.col1.x*m.x+l.col2.x*m.y),s=t.bodyA.m_xf.position.y+(l.col1.y*m.x+l.col2.y*m.y),l=t.bodyB.m_xf.R,i=0;i<t.pointCount;++i)m=t.points[i].localPoint,o=t.bodyB.m_xf.position.x+(l.col1.x*m.x+l.col2.x*m.y),e=t.bodyB.m_xf.position.y+(l.col1.y*m.x+l.col2.y*m.y),this.m_separations[i]=(o-n)*this.m_normal.x+(e-s)*this.m_normal.y-t.radius,this.m_points[i].x=o,this.m_points[i].y=e;break;case S.e_faceB:for(l=t.bodyB.m_xf.R,m=t.localPlaneNormal,this.m_normal.x=l.col1.x*m.x+l.col2.x*m.y,this.m_normal.y=l.col1.y*m.x+l.col2.y*m.y,l=t.bodyB.m_xf.R,m=t.localPoint,n=t.bodyB.m_xf.position.x+(l.col1.x*m.x+l.col2.x*m.y),s=t.bodyB.m_xf.position.y+(l.col1.y*m.x+l.col2.y*m.y),l=t.bodyA.m_xf.R,i=0;i<t.pointCount;++i)m=t.points[i].localPoint,o=t.bodyA.m_xf.position.x+(l.col1.x*m.x+l.col2.x*m.y),e=t.bodyA.m_xf.position.y+(l.col1.y*m.x+l.col2.y*m.y),this.m_separations[i]=(o-n)*this.m_normal.x+(e-s)*this.m_normal.y-t.radius,this.m_points[i].Set(o,e);this.m_normal.x*=-1,this.m_normal.y*=-1}},P.postDefs.push(function(){P.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new v,P.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new v})}(),function(){P.Dynamics.b2Body,P.Dynamics.b2BodyDef,P.Dynamics.b2ContactFilter,P.Dynamics.b2ContactImpulse,P.Dynamics.b2ContactListener,P.Dynamics.b2ContactManager,P.Dynamics.b2DebugDraw,P.Dynamics.b2DestructionListener,P.Dynamics.b2FilterData,P.Dynamics.b2Fixture,P.Dynamics.b2FixtureDef,P.Dynamics.b2Island,P.Dynamics.b2TimeStep,P.Dynamics.b2World;var t=P.Common.Math.b2Mat22,s=(P.Common.Math.b2Mat33,P.Common.Math.b2Math),_=(P.Common.Math.b2Sweep,P.Common.Math.b2Transform,P.Common.Math.b2Vec2),n=(P.Common.Math.b2Vec3,P.Common.b2Color),i=(P.Common.b2internal,P.Common.b2Settings,P.Collision.Shapes.b2CircleShape,P.Collision.Shapes.b2EdgeChainDef,P.Collision.Shapes.b2EdgeShape,P.Collision.Shapes.b2MassData,P.Collision.Shapes.b2PolygonShape,P.Collision.Shapes.b2Shape,P.Dynamics.Controllers.b2BuoyancyController),o=P.Dynamics.Controllers.b2ConstantAccelController,e=P.Dynamics.Controllers.b2ConstantForceController,r=P.Dynamics.Controllers.b2Controller,a=P.Dynamics.Controllers.b2ControllerEdge,l=P.Dynamics.Controllers.b2GravityController,m=P.Dynamics.Controllers.b2TensorDampingController;P.inherit(i,P.Dynamics.Controllers.b2Controller),i.prototype.__super=P.Dynamics.Controllers.b2Controller.prototype,i.b2BuoyancyController=function(){P.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new _(0,-1),this.offset=0,this.density=0,this.velocity=new _(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},i.prototype.Step=function(t){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var i=this.m_bodyList;i;i=i.nextBody){var o=i.body;if(0!=o.IsAwake()){for(var e,n=new _,s=new _,r=0,a=0,l=o.GetFixtureList();l;l=l.GetNext()){var m=new _,c=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,o.GetTransform(),m);r+=c,n.x+=c*m.x,n.y+=c*m.y;var h=0;a+=c*(h=(this.useDensity,1)),s.x+=c*m.x*h,s.y+=c*m.y*h}n.x/=r,n.y/=r,s.x/=a,s.y/=a,r<Number.MIN_VALUE||((e=this.gravity.GetNegative()).Multiply(this.density*r),o.ApplyForce(e,s),(e=o.GetLinearVelocityFromWorldPoint(n)).Subtract(this.velocity),e.Multiply(-this.linearDrag*r),o.ApplyForce(e,n),o.ApplyTorque(-o.GetInertia()/o.GetMass()*r*o.GetAngularVelocity()*this.angularDrag))}}}},i.prototype.Draw=function(t){var i=new _,o=new _;i.x=this.normal.x*this.offset+1e3*this.normal.y,i.y=this.normal.y*this.offset-1e3*this.normal.x,o.x=this.normal.x*this.offset-1e3*this.normal.y,o.y=this.normal.y*this.offset+1e3*this.normal.x;var e=new n(0,0,1);t.DrawSegment(i,o,e)},P.inherit(o,P.Dynamics.Controllers.b2Controller),o.prototype.__super=P.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantAccelController=function(){P.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new _(0,0)},o.prototype.Step=function(t){for(var i=new _(this.A.x*t.dt,this.A.y*t.dt),o=this.m_bodyList;o;o=o.nextBody){var e=o.body;e.IsAwake()&&e.SetLinearVelocity(new _(e.GetLinearVelocity().x+i.x,e.GetLinearVelocity().y+i.y))}},P.inherit(e,P.Dynamics.Controllers.b2Controller),e.prototype.__super=P.Dynamics.Controllers.b2Controller.prototype,e.b2ConstantForceController=function(){P.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new _(0,0)},e.prototype.Step=function(t){for(var i=this.m_bodyList;i;i=i.nextBody){var o=i.body;o.IsAwake()&&o.ApplyForce(this.F,o.GetWorldCenter())}},r.b2Controller=function(){},r.prototype.Step=function(t){},r.prototype.Draw=function(t){},r.prototype.AddBody=function(t){var i=new a;i.controller=this,i.body=t,i.nextBody=this.m_bodyList,i.prevBody=null,(this.m_bodyList=i).nextBody&&(i.nextBody.prevBody=i),this.m_bodyCount++,i.nextController=t.m_controllerList,i.prevController=null,(t.m_controllerList=i).nextController&&(i.nextController.prevController=i),t.m_controllerCount++},r.prototype.RemoveBody=function(t){for(var i=t.m_controllerList;i&&i.controller!=this;)i=i.nextController;i.prevBody&&(i.prevBody.nextBody=i.nextBody),i.nextBody&&(i.nextBody.prevBody=i.prevBody),i.nextController&&(i.nextController.prevController=i.prevController),i.prevController&&(i.prevController.nextController=i.nextController),this.m_bodyList==i&&(this.m_bodyList=i.nextBody),t.m_controllerList==i&&(t.m_controllerList=i.nextController),t.m_controllerCount--,this.m_bodyCount--},r.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},r.prototype.GetNext=function(){return this.m_next},r.prototype.GetWorld=function(){return this.m_world},r.prototype.GetBodyList=function(){return this.m_bodyList},a.b2ControllerEdge=function(){},P.inherit(l,P.Dynamics.Controllers.b2Controller),l.prototype.__super=P.Dynamics.Controllers.b2Controller.prototype,l.b2GravityController=function(){P.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},l.prototype.Step=function(t){var i=null,o=null,e=null,n=0,s=null,r=null,a=null,l=0,m=0,c=0,h=null;if(this.invSqr)for(i=this.m_bodyList;i;i=i.nextBody)for(e=(o=i.body).GetWorldCenter(),n=o.GetMass(),s=this.m_bodyList;s!=i;s=s.nextBody)(c=(l=(a=(r=s.body).GetWorldCenter()).x-e.x)*l+(m=a.y-e.y)*m)<Number.MIN_VALUE||((h=new _(l,m)).Multiply(this.G/c/Math.sqrt(c)*n*r.GetMass()),o.IsAwake()&&o.ApplyForce(h,e),h.Multiply(-1),r.IsAwake()&&r.ApplyForce(h,a));else for(i=this.m_bodyList;i;i=i.nextBody)for(e=(o=i.body).GetWorldCenter(),n=o.GetMass(),s=this.m_bodyList;s!=i;s=s.nextBody)(c=(l=(a=(r=s.body).GetWorldCenter()).x-e.x)*l+(m=a.y-e.y)*m)<Number.MIN_VALUE||((h=new _(l,m)).Multiply(this.G/c*n*r.GetMass()),o.IsAwake()&&o.ApplyForce(h,e),h.Multiply(-1),r.IsAwake()&&r.ApplyForce(h,a))},P.inherit(m,P.Dynamics.Controllers.b2Controller),m.prototype.__super=P.Dynamics.Controllers.b2Controller.prototype,m.b2TensorDampingController=function(){P.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},m.prototype.SetAxisAligned=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-i,this.maxTimestep=0<t||0<i?1/Math.max(t,i):0},m.prototype.Step=function(t){var i=t.dt;if(!(i<=Number.MIN_VALUE)){i>this.maxTimestep&&0<this.maxTimestep&&(i=this.maxTimestep);for(var o=this.m_bodyList;o;o=o.nextBody){var e,n=o.body;n.IsAwake()&&(e=n.GetWorldVector(s.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity()))),n.SetLinearVelocity(new _(n.GetLinearVelocity().x+e.x*i,n.GetLinearVelocity().y+e.y*i)))}}}}(),function(){P.Common.b2Color,P.Common.b2internal;var S=P.Common.b2Settings,g=P.Common.Math.b2Mat22,i=P.Common.Math.b2Mat33,w=P.Common.Math.b2Math,D=(P.Common.Math.b2Sweep,P.Common.Math.b2Transform,P.Common.Math.b2Vec2),B=P.Common.Math.b2Vec3,e=P.Dynamics.Joints.b2DistanceJoint,n=P.Dynamics.Joints.b2DistanceJointDef,s=P.Dynamics.Joints.b2FrictionJoint,r=P.Dynamics.Joints.b2FrictionJointDef,a=P.Dynamics.Joints.b2GearJoint,l=P.Dynamics.Joints.b2GearJointDef,t=P.Dynamics.Joints.b2Jacobian,C=P.Dynamics.Joints.b2Joint,o=P.Dynamics.Joints.b2JointDef,m=P.Dynamics.Joints.b2JointEdge,c=P.Dynamics.Joints.b2LineJoint,h=P.Dynamics.Joints.b2LineJointDef,_=P.Dynamics.Joints.b2MouseJoint,p=P.Dynamics.Joints.b2MouseJointDef,y=P.Dynamics.Joints.b2PrismaticJoint,u=P.Dynamics.Joints.b2PrismaticJointDef,x=P.Dynamics.Joints.b2PulleyJoint,f=P.Dynamics.Joints.b2PulleyJointDef,b=P.Dynamics.Joints.b2RevoluteJoint,d=P.Dynamics.Joints.b2RevoluteJointDef,v=P.Dynamics.Joints.b2WeldJoint,A=P.Dynamics.Joints.b2WeldJointDef;P.Dynamics.b2Body,P.Dynamics.b2BodyDef,P.Dynamics.b2ContactFilter,P.Dynamics.b2ContactImpulse,P.Dynamics.b2ContactListener,P.Dynamics.b2ContactManager,P.Dynamics.b2DebugDraw,P.Dynamics.b2DestructionListener,P.Dynamics.b2FilterData,P.Dynamics.b2Fixture,P.Dynamics.b2FixtureDef,P.Dynamics.b2Island,P.Dynamics.b2TimeStep,P.Dynamics.b2World;P.inherit(e,P.Dynamics.Joints.b2Joint),e.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,e.b2DistanceJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new D,this.m_localAnchor2=new D,this.m_u=new D},e.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},e.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},e.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},e.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},e.prototype.GetLength=function(){return this.m_length},e.prototype.SetLength=function(t){void 0===t&&(t=0),this.m_length=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},e.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},e.prototype.InitVelocityConstraints=function(t){var i=0,o=this.m_bodyA,e=this.m_bodyB,n=o.m_xf.R,s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,r=this.m_localAnchor1.y-o.m_sweep.localCenter.y,i=n.col1.x*s+n.col2.x*r,r=n.col1.y*s+n.col2.y*r,s=i;n=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x,l=this.m_localAnchor2.y-e.m_sweep.localCenter.y;i=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,a=i,this.m_u.x=e.m_sweep.c.x+a-o.m_sweep.c.x-s,this.m_u.y=e.m_sweep.c.y+l-o.m_sweep.c.y-r;var m=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);m>S.b2_linearSlop?this.m_u.Multiply(1/m):this.m_u.SetZero();var c=s*this.m_u.y-r*this.m_u.x,n=a*this.m_u.y-l*this.m_u.x,i=o.m_invMass+o.m_invI*c*c+e.m_invMass+e.m_invI*n*n;this.m_mass=0!=i?1/i:0,0<this.m_frequencyHz&&(c=m-this.m_length,n=2*Math.PI*this.m_frequencyHz,m=2*this.m_mass*this.m_dampingRatio*n,n=this.m_mass*n*n,this.m_gamma=t.dt*(m+t.dt*n),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=c*t.dt*n*this.m_gamma,this.m_mass=i+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0),t.warmStarting?(this.m_impulse*=t.dtRatio,i=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y,o.m_linearVelocity.x-=o.m_invMass*i,o.m_linearVelocity.y-=o.m_invMass*t,o.m_angularVelocity-=o.m_invI*(s*t-r*i),e.m_linearVelocity.x+=e.m_invMass*i,e.m_linearVelocity.y+=e.m_invMass*t,e.m_angularVelocity+=e.m_invI*(a*t-l*i)):this.m_impulse=0},e.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_xf.R,n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=r;e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y,r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r,m=i.m_linearVelocity.x+-i.m_angularVelocity*s,c=i.m_linearVelocity.y+i.m_angularVelocity*n,e=o.m_linearVelocity.x+-o.m_angularVelocity*l,r=o.m_linearVelocity.y+o.m_angularVelocity*a,r=this.m_u.x*(e-m)+this.m_u.y*(r-c),c=-this.m_mass*(r+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=c;r=c*this.m_u.x,c*=this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*r,i.m_linearVelocity.y-=i.m_invMass*c,i.m_angularVelocity-=i.m_invI*(n*c-s*r),o.m_linearVelocity.x+=o.m_invMass*r,o.m_linearVelocity.y+=o.m_invMass*c,o.m_angularVelocity+=o.m_invI*(a*c-l*r)},e.prototype.SolvePositionConstraints=function(t){if(void 0===t&&(t=0),0<this.m_frequencyHz)return!0;var i=this.m_bodyA,o=this.m_bodyB,e=i.m_xf.R,n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=r;e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y,r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r,m=o.m_sweep.c.x+a-i.m_sweep.c.x-n,t=o.m_sweep.c.y+l-i.m_sweep.c.y-s,e=Math.sqrt(m*m+t*t);m/=e,t/=e;r=e-this.m_length,r=w.Clamp(r,-S.b2_maxLinearCorrection,S.b2_maxLinearCorrection),e=-this.m_mass*r;this.m_u.Set(m,t);t=e*this.m_u.x,e*=this.m_u.y;return i.m_sweep.c.x-=i.m_invMass*t,i.m_sweep.c.y-=i.m_invMass*e,i.m_sweep.a-=i.m_invI*(n*e-s*t),o.m_sweep.c.x+=o.m_invMass*t,o.m_sweep.c.y+=o.m_invMass*e,o.m_sweep.a+=o.m_invI*(a*e-l*t),i.SynchronizeTransform(),o.SynchronizeTransform(),w.Abs(r)<S.b2_linearSlop},P.inherit(n,P.Dynamics.Joints.b2JointDef),n.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,n.b2DistanceJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new D,this.localAnchorB=new D},n.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},n.prototype.Initialize=function(t,i,o,e){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));i=e.x-o.x,o=e.y-o.y;this.length=Math.sqrt(i*i+o*o),this.frequencyHz=0,this.dampingRatio=0},P.inherit(s,P.Dynamics.Joints.b2Joint),s.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,s.b2FrictionJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new D,this.m_localAnchorB=new D,this.m_linearMass=new g,this.m_linearImpulse=new D},s.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},s.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},s.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},s.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},s.prototype.GetMaxForce=function(){return this.m_maxForce},s.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},s.prototype.GetMaxTorque=function(){return this.m_maxTorque},s.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},s.prototype.InitVelocityConstraints=function(t){var i=0,o=this.m_bodyA,e=this.m_bodyB,n=o.m_xf.R,s=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y,i=n.col1.x*s+n.col2.x*r,r=n.col1.y*s+n.col2.y*r,s=i;n=e.m_xf.R;var a=this.m_localAnchorB.x-e.m_sweep.localCenter.x,l=this.m_localAnchorB.y-e.m_sweep.localCenter.y;i=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,a=i;var m=o.m_invMass,c=e.m_invMass,h=o.m_invI,n=e.m_invI,i=new g;i.col1.x=m+c,i.col2.x=0,i.col1.y=0,i.col2.y=m+c,i.col1.x+=h*r*r,i.col2.x+=-h*s*r,i.col1.y+=-h*s*r,i.col2.y+=h*s*s,i.col1.x+=n*l*l,i.col2.x+=-n*a*l,i.col1.y+=-n*a*l,i.col2.y+=n*a*a,i.GetInverse(this.m_linearMass),this.m_angularMass=h+n,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting?(this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio,t=this.m_linearImpulse,o.m_linearVelocity.x-=m*t.x,o.m_linearVelocity.y-=m*t.y,o.m_angularVelocity-=h*(s*t.y-r*t.x+this.m_angularImpulse),e.m_linearVelocity.x+=c*t.x,e.m_linearVelocity.y+=c*t.y,e.m_angularVelocity+=n*(a*t.y-l*t.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},s.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_linearVelocity,n=i.m_angularVelocity,s=o.m_linearVelocity,r=o.m_angularVelocity,a=i.m_invMass,l=o.m_invMass,m=i.m_invI,c=o.m_invI,h=i.m_xf.R,_=this.m_localAnchorA.x-i.m_sweep.localCenter.x,p=this.m_localAnchorA.y-i.m_sweep.localCenter.y,y=h.col1.x*_+h.col2.x*p,p=h.col1.y*_+h.col2.y*p,_=y;h=o.m_xf.R;var u=this.m_localAnchorB.x-o.m_sweep.localCenter.x,x=this.m_localAnchorB.y-o.m_sweep.localCenter.y;y=h.col1.x*u+h.col2.x*x,x=h.col1.y*u+h.col2.y*x,u=y;var h=r-n,y=-this.m_angularMass*h,h=this.m_angularImpulse,f=t.dt*this.m_maxTorque;this.m_angularImpulse=w.Clamp(this.m_angularImpulse+y,-f,f),n-=m*(y=this.m_angularImpulse-h),r+=c*y;h=s.x-r*x-e.x+n*p,y=s.y+r*u-e.y-n*_,h=w.MulMV(this.m_linearMass,new D(-h,-y)),y=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(h),f=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(f)),h=w.SubtractVV(this.m_linearImpulse,y),e.x-=a*h.x,e.y-=a*h.y,n-=m*(_*h.y-p*h.x),s.x+=l*h.x,s.y+=l*h.y,r+=c*(u*h.y-x*h.x),i.m_angularVelocity=n,o.m_angularVelocity=r},s.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},P.inherit(r,P.Dynamics.Joints.b2JointDef),r.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,r.b2FrictionJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new D,this.localAnchorB=new D},r.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_frictionJoint,this.maxForce=0,this.maxTorque=0},r.prototype.Initialize=function(t,i,o){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o))},P.inherit(a,P.Dynamics.Joints.b2Joint),a.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,a.b2GearJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new D,this.m_groundAnchor2=new D,this.m_localAnchor1=new D,this.m_localAnchor2=new D,this.m_J=new t},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},a.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},a.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var i=this.m_bodyB.m_xf.R,o=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=i.col1.x*o+i.col2.x*e,e=i.col1.y*o+i.col2.y*e,o=n,i=this.m_impulse*this.m_J.linearB.x,n=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-o*n+e*i)},a.prototype.GetRatio=function(){return this.m_ratio},a.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},a.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var i=parseInt(t.joint1.m_type),o=parseInt(t.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var e=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e=i==C.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof b?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof y?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),n=o==C.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof b?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof y?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=e+this.m_ratio*n,this.m_impulse=0},a.prototype.InitVelocityConstraints=function(t){var i,o,e=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,m=0,c=0,h=0,_=0,p=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,p+=s.m_invI):(i=e.m_xf.R,o=this.m_prismatic1.m_localXAxis1,a=i.col1.x*o.x+i.col2.x*o.y,l=i.col1.y*o.x+i.col2.y*o.y,i=s.m_xf.R,m=this.m_localAnchor1.x-s.m_sweep.localCenter.x,c=this.m_localAnchor1.y-s.m_sweep.localCenter.y,_=i.col1.x*m+i.col2.x*c,c=i.col1.y*m+i.col2.y*c,h=(m=_)*l-c*a,this.m_J.linearA.Set(-a,-l),this.m_J.angularA=-h,p+=s.m_invMass+s.m_invI*h*h),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*r.m_invI):(i=n.m_xf.R,o=this.m_prismatic2.m_localXAxis1,a=i.col1.x*o.x+i.col2.x*o.y,l=i.col1.y*o.x+i.col2.y*o.y,i=r.m_xf.R,m=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y,_=i.col1.x*m+i.col2.x*c,c=i.col1.y*m+i.col2.y*c,h=(m=_)*l-c*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*h,p+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*h*h)),this.m_mass=0<p?1/p:0,t.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},a.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=this.m_J.Compute(i.m_linearVelocity,i.m_angularVelocity,o.m_linearVelocity,o.m_angularVelocity),e=-this.m_mass*e;this.m_impulse+=e,i.m_linearVelocity.x+=i.m_invMass*e*this.m_J.linearA.x,i.m_linearVelocity.y+=i.m_invMass*e*this.m_J.linearA.y,i.m_angularVelocity+=i.m_invI*e*this.m_J.angularA,o.m_linearVelocity.x+=o.m_invMass*e*this.m_J.linearB.x,o.m_linearVelocity.y+=o.m_invMass*e*this.m_J.linearB.y,o.m_angularVelocity+=o.m_invI*e*this.m_J.angularB},a.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var i=this.m_bodyA,o=this.m_bodyB,e=0,t=0,e=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),t=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),t=this.m_constant-(e+this.m_ratio*t),t=-this.m_mass*t;return i.m_sweep.c.x+=i.m_invMass*t*this.m_J.linearA.x,i.m_sweep.c.y+=i.m_invMass*t*this.m_J.linearA.y,i.m_sweep.a+=i.m_invI*t*this.m_J.angularA,o.m_sweep.c.x+=o.m_invMass*t*this.m_J.linearB.x,o.m_sweep.c.y+=o.m_invMass*t*this.m_J.linearB.y,o.m_sweep.a+=o.m_invI*t*this.m_J.angularB,i.SynchronizeTransform(),o.SynchronizeTransform(),0<S.b2_linearSlop},P.inherit(l,P.Dynamics.Joints.b2JointDef),l.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,l.b2GearJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},l.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},t.b2Jacobian=function(){this.linearA=new D,this.linearB=new D},t.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},t.prototype.Set=function(t,i,o,e){void 0===i&&(i=0),void 0===e&&(e=0),this.linearA.SetV(t),this.angularA=i,this.linearB.SetV(o),this.angularB=e},t.prototype.Compute=function(t,i,o,e){return void 0===i&&(i=0),void 0===e&&(e=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*i+(this.linearB.x*o.x+this.linearB.y*o.y)+this.angularB*e},C.b2Joint=function(){this.m_edgeA=new m,this.m_edgeB=new m,this.m_localCenterA=new D,this.m_localCenterB=new D},C.prototype.GetType=function(){return this.m_type},C.prototype.GetAnchorA=function(){return null},C.prototype.GetAnchorB=function(){return null},C.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),null},C.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},C.prototype.GetBodyA=function(){return this.m_bodyA},C.prototype.GetBodyB=function(){return this.m_bodyB},C.prototype.GetNext=function(){return this.m_next},C.prototype.GetUserData=function(){return this.m_userData},C.prototype.SetUserData=function(t){this.m_userData=t},C.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},C.Create=function(t,i){var o=null;switch(t.type){case C.e_distanceJoint:o=new e(t instanceof n?t:null);break;case C.e_mouseJoint:o=new _(t instanceof p?t:null);break;case C.e_prismaticJoint:o=new y(t instanceof u?t:null);break;case C.e_revoluteJoint:o=new b(t instanceof d?t:null);break;case C.e_pulleyJoint:o=new x(t instanceof f?t:null);break;case C.e_gearJoint:o=new a(t instanceof l?t:null);break;case C.e_lineJoint:o=new c(t instanceof h?t:null);break;case C.e_weldJoint:o=new v(t instanceof A?t:null);break;case C.e_frictionJoint:o=new s(t instanceof r?t:null)}return o},C.Destroy=function(t,i){},C.prototype.b2Joint=function(t){S.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},C.prototype.InitVelocityConstraints=function(t){},C.prototype.SolveVelocityConstraints=function(t){},C.prototype.FinalizeVelocityConstraints=function(){},C.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!1},P.postDefs.push(function(){P.Dynamics.Joints.b2Joint.e_unknownJoint=0,P.Dynamics.Joints.b2Joint.e_revoluteJoint=1,P.Dynamics.Joints.b2Joint.e_prismaticJoint=2,P.Dynamics.Joints.b2Joint.e_distanceJoint=3,P.Dynamics.Joints.b2Joint.e_pulleyJoint=4,P.Dynamics.Joints.b2Joint.e_mouseJoint=5,P.Dynamics.Joints.b2Joint.e_gearJoint=6,P.Dynamics.Joints.b2Joint.e_lineJoint=7,P.Dynamics.Joints.b2Joint.e_weldJoint=8,P.Dynamics.Joints.b2Joint.e_frictionJoint=9,P.Dynamics.Joints.b2Joint.e_inactiveLimit=0,P.Dynamics.Joints.b2Joint.e_atLowerLimit=1,P.Dynamics.Joints.b2Joint.e_atUpperLimit=2,P.Dynamics.Joints.b2Joint.e_equalLimits=3}),o.b2JointDef=function(){},o.prototype.b2JointDef=function(){this.type=C.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},m.b2JointEdge=function(){},P.inherit(c,P.Dynamics.Joints.b2Joint),c.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,c.b2LineJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new D,this.m_localAnchor2=new D,this.m_localXAxis1=new D,this.m_localYAxis1=new D,this.m_axis=new D,this.m_perp=new D,this.m_K=new g,this.m_impulse=new D},c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},c.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},c.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},c.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),e=i.GetWorldPoint(this.m_localAnchor2),i=e.x-o.x,o=e.y-o.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*i+t.y*o},c.prototype.GetJointSpeed=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.m_xf.R,e=this.m_localAnchor1.x-t.m_sweep.localCenter.x,n=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=o.col1.x*e+o.col2.x*n,n=o.col1.y*e+o.col2.y*n,e=s;o=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,s=o.col1.x*r+o.col2.x*a,a=o.col1.y*r+o.col2.y*a,r=s,l=t.m_sweep.c.x+e,m=t.m_sweep.c.y+n,c=i.m_sweep.c.x+r-l,o=i.m_sweep.c.y+a-m,s=t.GetWorldVector(this.m_localXAxis1),l=t.m_linearVelocity,m=i.m_linearVelocity,t=t.m_angularVelocity,i=i.m_angularVelocity;return c*(-t*s.y)+o*(t*s.x)+(s.x*(m.x+-i*a-l.x- -t*n)+s.y*(m.y+i*r-l.y-t*e))},c.prototype.IsLimitEnabled=function(){return this.m_enableLimit},c.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},c.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},c.prototype.GetUpperLimit=function(){return this.m_upperTranslation},c.prototype.SetLimits=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i},c.prototype.IsMotorEnabled=function(){return this.m_enableMotor},c.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},c.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},c.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},c.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},c.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},c.prototype.GetMotorForce=function(){return this.m_motorImpulse},c.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=C.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},c.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=0;this.m_localCenterA.SetV(i.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var n=i.GetTransform(),s=(o.GetTransform(),i.m_xf.R),r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y,e=s.col1.x*r+s.col2.x*a,a=s.col1.y*r+s.col2.y*a,r=e;s=o.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;e=s.col1.x*l+s.col2.x*m,m=s.col1.y*l+s.col2.y*m,l=e;s=o.m_sweep.c.x+l-i.m_sweep.c.x-r,e=o.m_sweep.c.y+m-i.m_sweep.c.y-a;this.m_invMassA=i.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=i.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(w.MulMV(n.R,this.m_localXAxis1)),this.m_a1=(s+r)*this.m_axis.y-(e+a)*this.m_axis.x,this.m_a2=l*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(w.MulMV(n.R,this.m_localYAxis1)),this.m_s1=(s+r)*this.m_perp.y-(e+a)*this.m_perp.x,this.m_s2=l*this.m_perp.y-m*this.m_perp.x;var c,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;this.m_K.col1.x=r+a+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=r+a+l*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_enableLimit?(c=this.m_axis.x*s+this.m_axis.y*e,w.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*S.b2_linearSlop?this.m_limitState=C.e_equalLimits:c<=this.m_lowerTranslation?this.m_limitState!=C.e_atLowerLimit&&(this.m_limitState=C.e_atLowerLimit,this.m_impulse.y=0):c>=this.m_upperTranslation?this.m_limitState!=C.e_atUpperLimit&&(this.m_limitState=C.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=C.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=C.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,s=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,t=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,i.m_linearVelocity.x-=this.m_invMassA*s,i.m_linearVelocity.y-=this.m_invMassA*e,i.m_angularVelocity-=this.m_invIA*c,o.m_linearVelocity.x+=this.m_invMassB*s,o.m_linearVelocity.y+=this.m_invMassB*e,o.m_angularVelocity+=this.m_invIB*t):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},c.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_linearVelocity,n=i.m_angularVelocity,s=o.m_linearVelocity,r=o.m_angularVelocity,a=0,l=0,m=0,c=0;this.m_enableMotor&&this.m_limitState!=C.e_equalLimits&&(p=this.m_axis.x*(s.x-e.x)+this.m_axis.y*(s.y-e.y)+this.m_a2*r-this.m_a1*n,_=this.m_motorMass*(this.m_motorSpeed-p),h=this.m_motorImpulse,p=t.dt*this.m_maxMotorForce,this.m_motorImpulse=w.Clamp(this.m_motorImpulse+_,-p,p),a=(_=this.m_motorImpulse-h)*this.m_axis.x,l=_*this.m_axis.y,m=_*this.m_a1,c=_*this.m_a2,e.x-=this.m_invMassA*a,e.y-=this.m_invMassA*l,n-=this.m_invIA*m,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*c);var h,_,p,y,t=this.m_perp.x*(s.x-e.x)+this.m_perp.y*(s.y-e.y)+this.m_s2*r-this.m_s1*n;c=this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit?(p=this.m_axis.x*(s.x-e.x)+this.m_axis.y*(s.y-e.y)+this.m_a2*r-this.m_a1*n,h=this.m_impulse.Copy(),y=this.m_K.Solve(new D,-t,-p),this.m_impulse.Add(y),this.m_limitState==C.e_atLowerLimit?this.m_impulse.y=w.Max(this.m_impulse.y,0):this.m_limitState==C.e_atUpperLimit&&(this.m_impulse.y=w.Min(this.m_impulse.y,0)),_=-t-(this.m_impulse.y-h.y)*this.m_K.col2.x,p=(p=0)!=this.m_K.col1.x?_/this.m_K.col1.x+h.x:h.x,this.m_impulse.x=p,y.x=this.m_impulse.x-h.x,y.y=this.m_impulse.y-h.y,a=y.x*this.m_perp.x+y.y*this.m_axis.x,l=y.x*this.m_perp.y+y.y*this.m_axis.y,m=y.x*this.m_s1+y.y*this.m_a1,y.x*this.m_s2+y.y*this.m_a2):(y=(y=0)!=this.m_K.col1.x?-t/this.m_K.col1.x:0,this.m_impulse.x+=y,a=y*this.m_perp.x,l=y*this.m_perp.y,m=y*this.m_s1,y*this.m_s2),e.x-=this.m_invMassA*a,e.y-=this.m_invMassA*l,n-=this.m_invIA*m,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*c,i.m_linearVelocity.SetV(e),i.m_angularVelocity=n,o.m_linearVelocity.SetV(s),o.m_angularVelocity=r},c.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var i=this.m_bodyA,o=this.m_bodyB,e=i.m_sweep.c,n=i.m_sweep.a,s=o.m_sweep.c,r=o.m_sweep.a,a=0,l=0,m=0,c=0,h=0,_=0,p=!1,y=0,u=g.FromAngle(n),x=g.FromAngle(r),f=u,d=this.m_localAnchor1.x-this.m_localCenterA.x,b=this.m_localAnchor1.y-this.m_localCenterA.y,a=f.col1.x*d+f.col2.x*b,b=f.col1.y*d+f.col2.y*b,d=a;f=x;var v=this.m_localAnchor2.x-this.m_localCenterB.x,t=this.m_localAnchor2.y-this.m_localCenterB.y;a=f.col1.x*v+f.col2.x*t,t=f.col1.y*v+f.col2.y*t,v=a;x=s.x+v-e.x-d,f=s.y+t-e.y-b;this.m_enableLimit&&(this.m_axis=w.MulMV(u,this.m_localXAxis1),this.m_a1=(x+d)*this.m_axis.y-(f+b)*this.m_axis.x,this.m_a2=v*this.m_axis.y-t*this.m_axis.x,a=this.m_axis.x*x+this.m_axis.y*f,w.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*S.b2_linearSlop?(y=w.Clamp(a,-S.b2_maxLinearCorrection,S.b2_maxLinearCorrection),_=w.Abs(a),p=!0):a<=this.m_lowerTranslation?(y=w.Clamp(a-this.m_lowerTranslation+S.b2_linearSlop,-S.b2_maxLinearCorrection,0),_=this.m_lowerTranslation-a,p=!0):a>=this.m_upperTranslation&&(y=w.Clamp(a-this.m_upperTranslation+S.b2_linearSlop,0,S.b2_maxLinearCorrection),_=a-this.m_upperTranslation,p=!0)),this.m_perp=w.MulMV(u,this.m_localYAxis1),this.m_s1=(x+d)*this.m_perp.y-(f+b)*this.m_perp.x,this.m_s2=v*this.m_perp.y-t*this.m_perp.x;t=new D,f=this.m_perp.x*x+this.m_perp.y*f,_=w.Max(_,w.Abs(f));p?(l=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=l+m+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+m+c*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.Solve(t,-f,-y)):(l=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,A=(A=0)!=(C=l+m+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2)?-f/C:0,t.x=A,t.y=0);var f=t.x*this.m_perp.x+t.y*this.m_axis.x,C=t.x*this.m_perp.y+t.y*this.m_axis.y,A=t.x*this.m_s1+t.y*this.m_a1,t=t.x*this.m_s2+t.y*this.m_a2;return e.x-=this.m_invMassA*f,e.y-=this.m_invMassA*C,n-=this.m_invIA*A,s.x+=this.m_invMassB*f,s.y+=this.m_invMassB*C,r+=this.m_invIB*t,i.m_sweep.a=n,o.m_sweep.a=r,i.SynchronizeTransform(),o.SynchronizeTransform(),_<=S.b2_linearSlop&&0<=S.b2_angularSlop},P.inherit(h,P.Dynamics.Joints.b2JointDef),h.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,h.b2LineJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new D,this.localAnchorB=new D,this.localAxisA=new D},h.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},h.prototype.Initialize=function(t,i,o,e){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.localAxisA=this.bodyA.GetLocalVector(e)},P.inherit(_,P.Dynamics.Joints.b2Joint),_.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,_.b2MouseJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new g,this.K1=new g,this.K2=new g,this.m_localAnchor=new D,this.m_target=new D,this.m_impulse=new D,this.m_mass=new g,this.m_C=new D},_.prototype.GetAnchorA=function(){return this.m_target},_.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},_.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_impulse.x,t*this.m_impulse.y)},_.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},_.prototype.GetTarget=function(){return this.m_target},_.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},_.prototype.GetMaxForce=function(){return this.m_maxForce},_.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},_.prototype.GetFrequency=function(){return this.m_frequencyHz},_.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},_.prototype.GetDampingRatio=function(){return this.m_dampingRatio},_.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},_.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var i=this.m_target.x-this.m_bodyB.m_xf.position.x,o=this.m_target.y-this.m_bodyB.m_xf.position.y,e=this.m_bodyB.m_xf.R;this.m_localAnchor.x=i*e.col1.x+o*e.col1.y,this.m_localAnchor.y=i*e.col2.x+o*e.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},_.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyB,o=i.GetMass(),e=2*Math.PI*this.m_frequencyHz,n=2*o*this.m_dampingRatio*e,s=o*e*e;this.m_gamma=t.dt*(n+t.dt*s),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*s*this.m_gamma,o=i.m_xf.R;e=this.m_localAnchor.x-i.m_sweep.localCenter.x,n=this.m_localAnchor.y-i.m_sweep.localCenter.y,s=o.col1.x*e+o.col2.x*n,n=o.col1.y*e+o.col2.y*n,e=s,o=i.m_invMass,s=i.m_invI;this.K1.col1.x=o,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=o,this.K2.col1.x=s*n*n,this.K2.col2.x=-s*e*n,this.K2.col1.y=-s*e*n,this.K2.col2.y=s*e*e,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=i.m_sweep.c.x+e-this.m_target.x,this.m_C.y=i.m_sweep.c.y+n-this.m_target.y,i.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,i.m_linearVelocity.x+=o*this.m_impulse.x,i.m_linearVelocity.y+=o*this.m_impulse.y,i.m_angularVelocity+=s*(e*this.m_impulse.y-n*this.m_impulse.x)},_.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyB,o=i.m_xf.R,e=this.m_localAnchor.x-i.m_sweep.localCenter.x,n=this.m_localAnchor.y-i.m_sweep.localCenter.y,s=o.col1.x*e+o.col2.x*n,n=o.col1.y*e+o.col2.y*n,e=s,r=i.m_linearVelocity.x+-i.m_angularVelocity*n,a=i.m_linearVelocity.y+i.m_angularVelocity*e;o=this.m_mass,s=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,l=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var a=-(o.col1.x*s+o.col2.x*l),s=-(o.col1.y*s+o.col2.y*l),o=this.m_impulse.x,l=this.m_impulse.y;this.m_impulse.x+=a,this.m_impulse.y+=s;t=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>t*t&&this.m_impulse.Multiply(t/this.m_impulse.Length()),a=this.m_impulse.x-o,s=this.m_impulse.y-l,i.m_linearVelocity.x+=i.m_invMass*a,i.m_linearVelocity.y+=i.m_invMass*s,i.m_angularVelocity+=i.m_invI*(e*s-n*a)},_.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},P.inherit(p,P.Dynamics.Joints.b2JointDef),p.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,p.b2MouseJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new D},p.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},P.inherit(y,P.Dynamics.Joints.b2Joint),y.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,y.b2PrismaticJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new D,this.m_localAnchor2=new D,this.m_localXAxis1=new D,this.m_localYAxis1=new D,this.m_axis=new D,this.m_perp=new D,this.m_K=new i,this.m_impulse=new B},y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},y.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},y.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},y.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),e=i.GetWorldPoint(this.m_localAnchor2),i=e.x-o.x,o=e.y-o.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*i+t.y*o},y.prototype.GetJointSpeed=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.m_xf.R,e=this.m_localAnchor1.x-t.m_sweep.localCenter.x,n=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=o.col1.x*e+o.col2.x*n,n=o.col1.y*e+o.col2.y*n,e=s;o=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,s=o.col1.x*r+o.col2.x*a,a=o.col1.y*r+o.col2.y*a,r=s,l=t.m_sweep.c.x+e,m=t.m_sweep.c.y+n,c=i.m_sweep.c.x+r-l,o=i.m_sweep.c.y+a-m,s=t.GetWorldVector(this.m_localXAxis1),l=t.m_linearVelocity,m=i.m_linearVelocity,t=t.m_angularVelocity,i=i.m_angularVelocity;return c*(-t*s.y)+o*(t*s.x)+(s.x*(m.x+-i*a-l.x- -t*n)+s.y*(m.y+i*r-l.y-t*e))},y.prototype.IsLimitEnabled=function(){return this.m_enableLimit},y.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},y.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},y.prototype.GetUpperLimit=function(){return this.m_upperTranslation},y.prototype.SetLimits=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i},y.prototype.IsMotorEnabled=function(){return this.m_enableMotor},y.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},y.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},y.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},y.prototype.GetMotorForce=function(){return this.m_motorImpulse},y.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=C.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},y.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=0;this.m_localCenterA.SetV(i.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var n=i.GetTransform(),s=(o.GetTransform(),i.m_xf.R),r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y,e=s.col1.x*r+s.col2.x*a,a=s.col1.y*r+s.col2.y*a,r=e;s=o.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;e=s.col1.x*l+s.col2.x*m,m=s.col1.y*l+s.col2.y*m,l=e;s=o.m_sweep.c.x+l-i.m_sweep.c.x-r,e=o.m_sweep.c.y+m-i.m_sweep.c.y-a;this.m_invMassA=i.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=i.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(w.MulMV(n.R,this.m_localXAxis1)),this.m_a1=(s+r)*this.m_axis.y-(e+a)*this.m_axis.x,this.m_a2=l*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(w.MulMV(n.R,this.m_localYAxis1)),this.m_s1=(s+r)*this.m_perp.y-(e+a)*this.m_perp.x,this.m_s2=l*this.m_perp.y-m*this.m_perp.x;var c,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;this.m_K.col1.x=r+a+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1+m*this.m_s2,this.m_K.col1.z=l*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+m,this.m_K.col2.z=l*this.m_a1+m*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=r+a+l*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_enableLimit?(c=this.m_axis.x*s+this.m_axis.y*e,w.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*S.b2_linearSlop?this.m_limitState=C.e_equalLimits:c<=this.m_lowerTranslation?this.m_limitState!=C.e_atLowerLimit&&(this.m_limitState=C.e_atLowerLimit,this.m_impulse.z=0):c>=this.m_upperTranslation?this.m_limitState!=C.e_atUpperLimit&&(this.m_limitState=C.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=C.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=C.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,s=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,t=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,i.m_linearVelocity.x-=this.m_invMassA*s,i.m_linearVelocity.y-=this.m_invMassA*e,i.m_angularVelocity-=this.m_invIA*c,o.m_linearVelocity.x+=this.m_invMassB*s,o.m_linearVelocity.y+=this.m_invMassB*e,o.m_angularVelocity+=this.m_invIB*t):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},y.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_linearVelocity,n=i.m_angularVelocity,s=o.m_linearVelocity,r=o.m_angularVelocity,a=0,l=0,m=0,c=0;this.m_enableMotor&&this.m_limitState!=C.e_equalLimits&&(u=this.m_axis.x*(s.x-e.x)+this.m_axis.y*(s.y-e.y)+this.m_a2*r-this.m_a1*n,p=this.m_motorMass*(this.m_motorSpeed-u),_=this.m_motorImpulse,h=t.dt*this.m_maxMotorForce,this.m_motorImpulse=w.Clamp(this.m_motorImpulse+p,-h,h),a=(p=this.m_motorImpulse-_)*this.m_axis.x,l=p*this.m_axis.y,m=p*this.m_a1,c=p*this.m_a2,e.x-=this.m_invMassA*a,e.y-=this.m_invMassA*l,n-=this.m_invIA*m,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*c);var h,_,p,y=this.m_perp.x*(s.x-e.x)+this.m_perp.y*(s.y-e.y)+this.m_s2*r-this.m_s1*n,u=r-n;c=this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit?(t=this.m_axis.x*(s.x-e.x)+this.m_axis.y*(s.y-e.y)+this.m_a2*r-this.m_a1*n,h=this.m_impulse.Copy(),_=this.m_K.Solve33(new B,-y,-u,-t),this.m_impulse.Add(_),this.m_limitState==C.e_atLowerLimit?this.m_impulse.z=w.Max(this.m_impulse.z,0):this.m_limitState==C.e_atUpperLimit&&(this.m_impulse.z=w.Min(this.m_impulse.z,0)),p=-y-(this.m_impulse.z-h.z)*this.m_K.col3.x,t=-u-(this.m_impulse.z-h.z)*this.m_K.col3.y,(t=this.m_K.Solve22(new D,p,t)).x+=h.x,t.y+=h.y,this.m_impulse.x=t.x,this.m_impulse.y=t.y,_.x=this.m_impulse.x-h.x,_.y=this.m_impulse.y-h.y,_.z=this.m_impulse.z-h.z,a=_.x*this.m_perp.x+_.z*this.m_axis.x,l=_.x*this.m_perp.y+_.z*this.m_axis.y,m=_.x*this.m_s1+_.y+_.z*this.m_a1,_.x*this.m_s2+_.y+_.z*this.m_a2):(u=this.m_K.Solve22(new D,-y,-u),this.m_impulse.x+=u.x,this.m_impulse.y+=u.y,a=u.x*this.m_perp.x,l=u.x*this.m_perp.y,m=u.x*this.m_s1+u.y,u.x*this.m_s2+u.y),e.x-=this.m_invMassA*a,e.y-=this.m_invMassA*l,n-=this.m_invIA*m,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*c,i.m_linearVelocity.SetV(e),i.m_angularVelocity=n,o.m_linearVelocity.SetV(s),o.m_angularVelocity=r},y.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var i=this.m_bodyA,o=this.m_bodyB,e=i.m_sweep.c,n=i.m_sweep.a,s=o.m_sweep.c,r=o.m_sweep.a,a=0,l=0,m=0,c=0,h=0,_=0,p=!1,y=0,u=g.FromAngle(n),x=g.FromAngle(r),f=u,d=this.m_localAnchor1.x-this.m_localCenterA.x,b=this.m_localAnchor1.y-this.m_localCenterA.y,a=f.col1.x*d+f.col2.x*b,b=f.col1.y*d+f.col2.y*b,d=a;f=x;var v=this.m_localAnchor2.x-this.m_localCenterB.x,t=this.m_localAnchor2.y-this.m_localCenterB.y;a=f.col1.x*v+f.col2.x*t,t=f.col1.y*v+f.col2.y*t,v=a;x=s.x+v-e.x-d,f=s.y+t-e.y-b;this.m_enableLimit&&(this.m_axis=w.MulMV(u,this.m_localXAxis1),this.m_a1=(x+d)*this.m_axis.y-(f+b)*this.m_axis.x,this.m_a2=v*this.m_axis.y-t*this.m_axis.x,a=this.m_axis.x*x+this.m_axis.y*f,w.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*S.b2_linearSlop?(y=w.Clamp(a,-S.b2_maxLinearCorrection,S.b2_maxLinearCorrection),_=w.Abs(a),p=!0):a<=this.m_lowerTranslation?(y=w.Clamp(a-this.m_lowerTranslation+S.b2_linearSlop,-S.b2_maxLinearCorrection,0),_=this.m_lowerTranslation-a,p=!0):a>=this.m_upperTranslation&&(y=w.Clamp(a-this.m_upperTranslation+S.b2_linearSlop,0,S.b2_maxLinearCorrection),_=a-this.m_upperTranslation,p=!0)),this.m_perp=w.MulMV(u,this.m_localYAxis1),this.m_s1=(x+d)*this.m_perp.y-(f+b)*this.m_perp.x,this.m_s2=v*this.m_perp.y-t*this.m_perp.x;var t=new B,x=this.m_perp.x*x+this.m_perp.y*f,f=r-n-this.m_refAngle,_=w.Max(_,w.Abs(x)),C=w.Abs(f);p?(l=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=l+m+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+h*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+h,this.m_K.col2.z=c*this.m_a1+h*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=l+m+c*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.Solve33(t,-x,-f,-y)):(l=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,l=l+m+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,m=c*this.m_s1+h*this.m_s2,A=c+h,this.m_K.col1.Set(l,m,0),this.m_K.col2.Set(m,A,0),A=this.m_K.Solve22(new D,-x,-f),t.x=A.x,t.y=A.y,t.z=0);var x=t.x*this.m_perp.x+t.z*this.m_axis.x,f=t.x*this.m_perp.y+t.z*this.m_axis.y,A=t.x*this.m_s1+t.y+t.z*this.m_a1,t=t.x*this.m_s2+t.y+t.z*this.m_a2;return e.x-=this.m_invMassA*x,e.y-=this.m_invMassA*f,n-=this.m_invIA*A,s.x+=this.m_invMassB*x,s.y+=this.m_invMassB*f,r+=this.m_invIB*t,i.m_sweep.a=n,o.m_sweep.a=r,i.SynchronizeTransform(),o.SynchronizeTransform(),_<=S.b2_linearSlop&&C<=S.b2_angularSlop},P.inherit(u,P.Dynamics.Joints.b2JointDef),u.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,u.b2PrismaticJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new D,this.localAnchorB=new D,this.localAxisA=new D},u.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},u.prototype.Initialize=function(t,i,o,e){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.localAxisA=this.bodyA.GetLocalVector(e),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},P.inherit(x,P.Dynamics.Joints.b2Joint),x.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,x.b2PulleyJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new D,this.m_groundAnchor2=new D,this.m_localAnchor1=new D,this.m_localAnchor2=new D,this.m_u1=new D,this.m_u2=new D},x.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},x.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},x.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},x.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},x.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},x.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),i=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,i=t.x-i,o=t.y-o;return Math.sqrt(i*i+o*o)},x.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),i=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,i=t.x-i,o=t.y-o;return Math.sqrt(i*i+o*o)},x.prototype.GetRatio=function(){return this.m_ratio},x.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=w.Min(t.maxLengthA,this.m_constant-this.m_ratio*x.b2_minPulleyLength),this.m_maxLength2=w.Min(t.maxLengthB,(this.m_constant-x.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},x.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_xf.R,n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=r;e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y,r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r,m=i.m_sweep.c.x+n,c=i.m_sweep.c.y+s,h=o.m_sweep.c.x+a,_=o.m_sweep.c.y+l,p=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,r=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(m-p,c-y),this.m_u2.Set(h-e,_-r);e=this.m_u1.Length(),_=this.m_u2.Length();e>S.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),_>S.b2_linearSlop?this.m_u2.Multiply(1/_):this.m_u2.SetZero(),0<this.m_constant-e-this.m_ratio*_?(this.m_state=C.e_inactiveLimit,this.m_impulse=0):this.m_state=C.e_atUpperLimit,e<this.m_maxLength1?(this.m_limitState1=C.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=C.e_atUpperLimit,_<this.m_maxLength2?(this.m_limitState2=C.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=C.e_atUpperLimit;r=n*this.m_u1.y-s*this.m_u1.x,e=a*this.m_u2.y-l*this.m_u2.x;this.m_limitMass1=i.m_invMass+i.m_invI*r*r,this.m_limitMass2=o.m_invMass+o.m_invI*e*e,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio,_=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,r=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,e=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,t=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*_,i.m_linearVelocity.y+=i.m_invMass*r,i.m_angularVelocity+=i.m_invI*(n*r-s*_),o.m_linearVelocity.x+=o.m_invMass*e,o.m_linearVelocity.y+=o.m_invMass*t,o.m_angularVelocity+=o.m_invI*(a*t-l*e)):(this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0)},x.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_xf.R,n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=r;e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y,r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r,m=0,c=0,h=0,_=0,p=0,y=0,u=0,x=0,f=0,e=0,r=0;this.m_state==C.e_atUpperLimit&&(m=i.m_linearVelocity.x+-i.m_angularVelocity*s,c=i.m_linearVelocity.y+i.m_angularVelocity*n,h=o.m_linearVelocity.x+-o.m_angularVelocity*l,_=o.m_linearVelocity.y+o.m_angularVelocity*a,f=-(this.m_u1.x*m+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*h+this.m_u2.y*_),e=this.m_pulleyMass*-f,r=this.m_impulse,this.m_impulse=w.Max(0,this.m_impulse+e),p=-(e=this.m_impulse-r)*this.m_u1.x,y=-e*this.m_u1.y,u=-this.m_ratio*e*this.m_u2.x,x=-this.m_ratio*e*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(n*y-s*p),o.m_linearVelocity.x+=o.m_invMass*u,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(a*x-l*u)),this.m_limitState1==C.e_atUpperLimit&&(m=i.m_linearVelocity.x+-i.m_angularVelocity*s,c=i.m_linearVelocity.y+i.m_angularVelocity*n,f=-(this.m_u1.x*m+this.m_u1.y*c),e=-this.m_limitMass1*f,r=this.m_limitImpulse1,this.m_limitImpulse1=w.Max(0,this.m_limitImpulse1+e),p=-(e=this.m_limitImpulse1-r)*this.m_u1.x,y=-e*this.m_u1.y,i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(n*y-s*p)),this.m_limitState2==C.e_atUpperLimit&&(h=o.m_linearVelocity.x+-o.m_angularVelocity*l,_=o.m_linearVelocity.y+o.m_angularVelocity*a,f=-(this.m_u2.x*h+this.m_u2.y*_),e=-this.m_limitMass2*f,r=this.m_limitImpulse2,this.m_limitImpulse2=w.Max(0,this.m_limitImpulse2+e),u=-(e=this.m_limitImpulse2-r)*this.m_u2.x,x=-e*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*u,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(a*x-l*u))},x.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var i,o=this.m_bodyA,e=this.m_bodyB,n=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,l=0,m=0,c=0,h=0,_=0,p=0,y=0,u=0,x=0,f=0,d=0,b=0,v=0,t=0;return this.m_state==C.e_atUpperLimit&&(i=o.m_xf.R,l=this.m_localAnchor1.x-o.m_sweep.localCenter.x,m=this.m_localAnchor1.y-o.m_sweep.localCenter.y,v=i.col1.x*l+i.col2.x*m,m=i.col1.y*l+i.col2.y*m,l=v,i=e.m_xf.R,c=this.m_localAnchor2.x-e.m_sweep.localCenter.x,h=this.m_localAnchor2.y-e.m_sweep.localCenter.y,v=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=v,_=o.m_sweep.c.x+l,p=o.m_sweep.c.y+m,y=e.m_sweep.c.x+c,u=e.m_sweep.c.y+h,this.m_u1.Set(_-n,p-s),this.m_u2.Set(y-r,u-a),x=this.m_u1.Length(),f=this.m_u2.Length(),x>S.b2_linearSlop?this.m_u1.Multiply(1/x):this.m_u1.SetZero(),f>S.b2_linearSlop?this.m_u2.Multiply(1/f):this.m_u2.SetZero(),d=this.m_constant-x-this.m_ratio*f,t=w.Max(t,-d),d=w.Clamp(d+S.b2_linearSlop,-S.b2_maxLinearCorrection,0),_=-(b=-this.m_pulleyMass*d)*this.m_u1.x,p=-b*this.m_u1.y,y=-this.m_ratio*b*this.m_u2.x,u=-this.m_ratio*b*this.m_u2.y,o.m_sweep.c.x+=o.m_invMass*_,o.m_sweep.c.y+=o.m_invMass*p,o.m_sweep.a+=o.m_invI*(l*p-m*_),e.m_sweep.c.x+=e.m_invMass*y,e.m_sweep.c.y+=e.m_invMass*u,e.m_sweep.a+=e.m_invI*(c*u-h*y),o.SynchronizeTransform(),e.SynchronizeTransform()),this.m_limitState1==C.e_atUpperLimit&&(i=o.m_xf.R,l=this.m_localAnchor1.x-o.m_sweep.localCenter.x,m=this.m_localAnchor1.y-o.m_sweep.localCenter.y,v=i.col1.x*l+i.col2.x*m,m=i.col1.y*l+i.col2.y*m,l=v,_=o.m_sweep.c.x+l,p=o.m_sweep.c.y+m,this.m_u1.Set(_-n,p-s),(x=this.m_u1.Length())>S.b2_linearSlop?(this.m_u1.x*=1/x,this.m_u1.y*=1/x):this.m_u1.SetZero(),d=this.m_maxLength1-x,t=w.Max(t,-d),d=w.Clamp(d+S.b2_linearSlop,-S.b2_maxLinearCorrection,0),_=-(b=-this.m_limitMass1*d)*this.m_u1.x,p=-b*this.m_u1.y,o.m_sweep.c.x+=o.m_invMass*_,o.m_sweep.c.y+=o.m_invMass*p,o.m_sweep.a+=o.m_invI*(l*p-m*_),o.SynchronizeTransform()),this.m_limitState2==C.e_atUpperLimit&&(i=e.m_xf.R,c=this.m_localAnchor2.x-e.m_sweep.localCenter.x,h=this.m_localAnchor2.y-e.m_sweep.localCenter.y,v=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=v,y=e.m_sweep.c.x+c,u=e.m_sweep.c.y+h,this.m_u2.Set(y-r,u-a),(f=this.m_u2.Length())>S.b2_linearSlop?(this.m_u2.x*=1/f,this.m_u2.y*=1/f):this.m_u2.SetZero(),d=this.m_maxLength2-f,t=w.Max(t,-d),d=w.Clamp(d+S.b2_linearSlop,-S.b2_maxLinearCorrection,0),y=-(b=-this.m_limitMass2*d)*this.m_u2.x,u=-b*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*y,e.m_sweep.c.y+=e.m_invMass*u,e.m_sweep.a+=e.m_invI*(c*u-h*y),e.SynchronizeTransform()),t<S.b2_linearSlop},P.postDefs.push(function(){P.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),P.inherit(f,P.Dynamics.Joints.b2JointDef),f.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,f.b2PulleyJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new D,this.groundAnchorB=new D,this.localAnchorA=new D,this.localAnchorB=new D},f.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},f.prototype.Initialize=function(t,i,o,e,n,s,r){void 0===r&&(r=0),this.bodyA=t,this.bodyB=i,this.groundAnchorA.SetV(o),this.groundAnchorB.SetV(e),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s);i=n.x-o.x,o=n.y-o.y;this.lengthA=Math.sqrt(i*i+o*o);o=s.x-e.x,e=s.y-e.y;this.lengthB=Math.sqrt(o*o+e*e),this.ratio=r;r=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=r-this.ratio*x.b2_minPulleyLength,this.maxLengthB=(r-x.b2_minPulleyLength)/this.ratio},P.inherit(b,P.Dynamics.Joints.b2Joint),b.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,b.b2RevoluteJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new g,this.K1=new g,this.K2=new g,this.K3=new g,this.impulse3=new B,this.impulse2=new D,this.reduced=new D,this.m_localAnchor1=new D,this.m_localAnchor2=new D,this.m_impulse=new B,this.m_mass=new i},b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_impulse.x,t*this.m_impulse.y)},b.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},b.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b.prototype.EnableLimit=function(t){this.m_enableLimit=t},b.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b.prototype.GetUpperLimit=function(){return this.m_upperAngle},b.prototype.SetLimits=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_lowerAngle=t,this.m_upperAngle=i},b.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b.prototype.EnableMotor=function(t){this.m_enableMotor=t},b.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},b.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},b.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=C.e_inactiveLimit},b.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB;this.m_enableMotor||this.m_enableLimit,r=i.m_xf.R;var e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=r.col1.x*e+r.col2.x*n,n=r.col1.y*e+r.col2.y*n,e=s,r=o.m_xf.R,a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=r.col1.x*a+r.col2.x*l,l=r.col1.y*a+r.col2.y*l,a=s;var m,c=i.m_invMass,h=o.m_invMass,r=i.m_invI,s=o.m_invI;this.m_mass.col1.x=c+h+n*n*r+l*l*s,this.m_mass.col2.x=-n*e*r-l*a*s,this.m_mass.col3.x=-n*r-l*s,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+h+e*e*r+a*a*s,this.m_mass.col3.y=e*r+a*s,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=r+s,this.m_motorMass=1/(r+s),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit?(m=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,w.Abs(this.m_upperAngle-this.m_lowerAngle)<2*S.b2_angularSlop?this.m_limitState=C.e_equalLimits:m<=this.m_lowerAngle?(this.m_limitState!=C.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=C.e_atLowerLimit):m>=this.m_upperAngle?(this.m_limitState!=C.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=C.e_atUpperLimit):(this.m_limitState=C.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=C.e_inactiveLimit,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,m=this.m_impulse.x,t=this.m_impulse.y,i.m_linearVelocity.x-=c*m,i.m_linearVelocity.y-=c*t,i.m_angularVelocity-=r*(e*t-n*m+this.m_motorImpulse+this.m_impulse.z),o.m_linearVelocity.x+=h*m,o.m_linearVelocity.y+=h*t,o.m_angularVelocity+=s*(a*t-l*m+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b.prototype.SolveVelocityConstraints=function(t){var i,o,e,n,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,m=0,c=0,h=0,_=s.m_linearVelocity,p=s.m_angularVelocity,y=r.m_linearVelocity,u=r.m_angularVelocity,x=s.m_invMass,f=r.m_invMass,d=s.m_invI,b=r.m_invI;this.m_enableMotor&&this.m_limitState!=C.e_equalLimits&&(i=u-p-this.m_motorSpeed,e=this.m_motorMass*-i,o=this.m_motorImpulse,i=t.dt*this.m_maxMotorTorque,this.m_motorImpulse=w.Clamp(this.m_motorImpulse+e,-i,i),p-=d*(e=this.m_motorImpulse-o),u+=b*e),this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit?(n=s.m_xf.R,l=this.m_localAnchor1.x-s.m_sweep.localCenter.x,m=this.m_localAnchor1.y-s.m_sweep.localCenter.y,a=n.col1.x*l+n.col2.x*m,m=n.col1.y*l+n.col2.y*m,l=a,n=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,h=this.m_localAnchor2.y-r.m_sweep.localCenter.y,a=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=a,i=y.x+-u*h-_.x- -p*m,o=y.y+u*c-_.y-p*l,e=u-p,this.m_mass.Solve33(this.impulse3,-i,-o,-e),this.m_limitState==C.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==C.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-i,-o),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==C.e_atUpperLimit&&0<this.m_impulse.z+this.impulse3.z&&(this.m_mass.Solve22(this.reduced,-i,-o),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),_.x-=x*this.impulse3.x,_.y-=x*this.impulse3.y,p-=d*(l*this.impulse3.y-m*this.impulse3.x+this.impulse3.z),y.x+=f*this.impulse3.x,y.y+=f*this.impulse3.y,u+=b*(c*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)):(n=s.m_xf.R,l=this.m_localAnchor1.x-s.m_sweep.localCenter.x,m=this.m_localAnchor1.y-s.m_sweep.localCenter.y,a=n.col1.x*l+n.col2.x*m,m=n.col1.y*l+n.col2.y*m,l=a,n=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,h=this.m_localAnchor2.y-r.m_sweep.localCenter.y,a=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=a,n=y.x+-u*h-_.x- -p*m,a=y.y+u*c-_.y-p*l,this.m_mass.Solve22(this.impulse2,-n,-a),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,_.x-=x*this.impulse2.x,_.y-=x*this.impulse2.y,p-=d*(l*this.impulse2.y-m*this.impulse2.x),y.x+=f*this.impulse2.x,y.y+=f*this.impulse2.y,u+=b*(c*this.impulse2.y-h*this.impulse2.x)),s.m_linearVelocity.SetV(_),s.m_angularVelocity=p,r.m_linearVelocity.SetV(y),r.m_angularVelocity=u},b.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var i=0,o=this.m_bodyA,e=this.m_bodyB,n=0,s=0,r=0;this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit&&(f=e.m_sweep.a-o.m_sweep.a-this.m_referenceAngle,d=0,this.m_limitState==C.e_equalLimits?(i=w.Clamp(f-this.m_lowerAngle,-S.b2_maxAngularCorrection,S.b2_maxAngularCorrection),d=-this.m_motorMass*i,n=w.Abs(i)):this.m_limitState==C.e_atLowerLimit?(n=-(i=f-this.m_lowerAngle),i=w.Clamp(i+S.b2_angularSlop,-S.b2_maxAngularCorrection,0),d=-this.m_motorMass*i):this.m_limitState==C.e_atUpperLimit&&(n=i=f-this.m_upperAngle,i=w.Clamp(i-S.b2_angularSlop,0,S.b2_maxAngularCorrection),d=-this.m_motorMass*i),o.m_sweep.a-=o.m_invI*d,e.m_sweep.a+=e.m_invI*d,o.SynchronizeTransform(),e.SynchronizeTransform()),c=o.m_xf.R;var a=this.m_localAnchor1.x-o.m_sweep.localCenter.x,l=this.m_localAnchor1.y-o.m_sweep.localCenter.y,m=c.col1.x*a+c.col2.x*l,l=c.col1.y*a+c.col2.y*l,a=m,c=e.m_xf.R,h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,_=this.m_localAnchor2.y-e.m_sweep.localCenter.y;m=c.col1.x*h+c.col2.x*_,_=c.col1.y*h+c.col2.y*_,h=m;var p=e.m_sweep.c.x+h-o.m_sweep.c.x-a,y=e.m_sweep.c.y+_-o.m_sweep.c.y-l,u=p*p+y*y,t=Math.sqrt(u),x=t,f=o.m_invMass,i=e.m_invMass,d=o.m_invI,c=e.m_invI,m=10*S.b2_linearSlop;return m*m<u&&(s=(t=1/(f+i))*-p,r=t*-y,o.m_sweep.c.x-=.5*f*s,o.m_sweep.c.y-=.5*f*r,e.m_sweep.c.x+=.5*i*s,e.m_sweep.c.y+=.5*i*r,p=e.m_sweep.c.x+h-o.m_sweep.c.x-a,y=e.m_sweep.c.y+_-o.m_sweep.c.y-l),this.K1.col1.x=f+i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=f+i,this.K2.col1.x=d*l*l,this.K2.col2.x=-d*a*l,this.K2.col1.y=-d*a*l,this.K2.col2.y=d*a*a,this.K3.col1.x=c*_*_,this.K3.col2.x=-c*h*_,this.K3.col1.y=-c*h*_,this.K3.col2.y=c*h*h,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b.tImpulse,-p,-y),s=b.tImpulse.x,r=b.tImpulse.y,o.m_sweep.c.x-=o.m_invMass*s,o.m_sweep.c.y-=o.m_invMass*r,o.m_sweep.a-=o.m_invI*(a*r-l*s),e.m_sweep.c.x+=e.m_invMass*s,e.m_sweep.c.y+=e.m_invMass*r,e.m_sweep.a+=e.m_invI*(h*r-_*s),o.SynchronizeTransform(),e.SynchronizeTransform(),x<=S.b2_linearSlop&&n<=S.b2_angularSlop},P.postDefs.push(function(){P.Dynamics.Joints.b2RevoluteJoint.tImpulse=new D}),P.inherit(d,P.Dynamics.Joints.b2JointDef),d.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,d.b2RevoluteJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new D,this.localAnchorB=new D},d.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},d.prototype.Initialize=function(t,i,o){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},P.inherit(v,P.Dynamics.Joints.b2Joint),v.prototype.__super=P.Dynamics.Joints.b2Joint.prototype,v.b2WeldJoint=function(){P.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new D,this.m_localAnchorB=new D,this.m_impulse=new B,this.m_mass=new i},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},v.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new D(t*this.m_impulse.x,t*this.m_impulse.y)},v.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},v.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new i},v.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_xf.R,n=this.m_localAnchorA.x-i.m_sweep.localCenter.x,s=this.m_localAnchorA.y-i.m_sweep.localCenter.y,r=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=r;e=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,l=this.m_localAnchorB.y-o.m_sweep.localCenter.y;r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r;var m=i.m_invMass,c=o.m_invMass,e=i.m_invI,r=o.m_invI;this.m_mass.col1.x=m+c+s*s*e+l*l*r,this.m_mass.col2.x=-s*n*e-l*a*r,this.m_mass.col3.x=-s*e-l*r,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+c+n*n*e+a*a*r,this.m_mass.col3.y=n*e+a*r,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=e+r,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,i.m_linearVelocity.x-=m*this.m_impulse.x,i.m_linearVelocity.y-=m*this.m_impulse.y,i.m_angularVelocity-=e*(n*this.m_impulse.y-s*this.m_impulse.x+this.m_impulse.z),o.m_linearVelocity.x+=c*this.m_impulse.x,o.m_linearVelocity.y+=c*this.m_impulse.y,o.m_angularVelocity+=r*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},v.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=i.m_linearVelocity,n=i.m_angularVelocity,s=o.m_linearVelocity,r=o.m_angularVelocity,a=i.m_invMass,l=o.m_invMass,m=i.m_invI,c=o.m_invI,h=i.m_xf.R,_=this.m_localAnchorA.x-i.m_sweep.localCenter.x,p=this.m_localAnchorA.y-i.m_sweep.localCenter.y,y=h.col1.x*_+h.col2.x*p,p=h.col1.y*_+h.col2.y*p,_=y;h=o.m_xf.R;var u=this.m_localAnchorB.x-o.m_sweep.localCenter.x,x=this.m_localAnchorB.y-o.m_sweep.localCenter.y;y=h.col1.x*u+h.col2.x*x,x=h.col1.y*u+h.col2.y*x,u=y;var f=s.x-r*x-e.x+n*p,d=s.y+r*u-e.y-n*_,h=r-n,y=new B;this.m_mass.Solve33(y,-f,-d,-h),this.m_impulse.Add(y),e.x-=a*y.x,e.y-=a*y.y,n-=m*(_*y.y-p*y.x+y.z),s.x+=l*y.x,s.y+=l*y.y,r+=c*(u*y.y-x*y.x+y.z),i.m_angularVelocity=n,o.m_angularVelocity=r},v.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var i=this.m_bodyA,o=this.m_bodyB,e=i.m_xf.R,n=this.m_localAnchorA.x-i.m_sweep.localCenter.x,s=this.m_localAnchorA.y-i.m_sweep.localCenter.y,r=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=r;e=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,l=this.m_localAnchorB.y-o.m_sweep.localCenter.y;r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r;var m=i.m_invMass,c=o.m_invMass,h=i.m_invI,_=o.m_invI,p=o.m_sweep.c.x+a-i.m_sweep.c.x-n,y=o.m_sweep.c.y+l-i.m_sweep.c.y-s,u=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,t=10*S.b2_linearSlop,e=Math.sqrt(p*p+y*y),r=w.Abs(u);t<e&&(h*=1,_*=1),this.m_mass.col1.x=m+c+s*s*h+l*l*_,this.m_mass.col2.x=-s*n*h-l*a*_,this.m_mass.col3.x=-s*h-l*_,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+c+n*n*h+a*a*_,this.m_mass.col3.y=n*h+a*_,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=h+_;t=new B;return this.m_mass.Solve33(t,-p,-y,-u),i.m_sweep.c.x-=m*t.x,i.m_sweep.c.y-=m*t.y,i.m_sweep.a-=h*(n*t.y-s*t.x+t.z),o.m_sweep.c.x+=c*t.x,o.m_sweep.c.y+=c*t.y,o.m_sweep.a+=_*(a*t.y-l*t.x+t.z),i.SynchronizeTransform(),o.SynchronizeTransform(),e<=S.b2_linearSlop&&r<=S.b2_angularSlop},P.inherit(A,P.Dynamics.Joints.b2JointDef),A.prototype.__super=P.Dynamics.Joints.b2JointDef.prototype,A.b2WeldJointDef=function(){P.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new D,this.localAnchorB=new D},A.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=C.e_weldJoint,this.referenceAngle=0},A.prototype.Initialize=function(t,i,o){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),(E=P.Dynamics.b2DebugDraw).b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},E.prototype._color=function(t,i){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+i+")"},E.prototype.b2DebugDraw=function(){this.m_drawFlags=0},E.prototype.SetFlags=function(t){void 0===t&&(t=0),this.m_drawFlags=t},E.prototype.GetFlags=function(){return this.m_drawFlags},E.prototype.AppendFlags=function(t){void 0===t&&(t=0),this.m_drawFlags|=t},E.prototype.ClearFlags=function(t){void 0===t&&(t=0),this.m_drawFlags&=~t},E.prototype.SetSprite=function(t){this.m_ctx=t},E.prototype.GetSprite=function(){return this.m_ctx},E.prototype.SetDrawScale=function(t){void 0===t&&(t=0),this.m_drawScale=t},E.prototype.GetDrawScale=function(){return this.m_drawScale},E.prototype.SetLineThickness=function(t){void 0===t&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},E.prototype.GetLineThickness=function(){return this.m_lineThickness},E.prototype.SetAlpha=function(t){void 0===t&&(t=0),this.m_alpha=t},E.prototype.GetAlpha=function(){return this.m_alpha},E.prototype.SetFillAlpha=function(t){void 0===t&&(t=0),this.m_fillAlpha=t},E.prototype.GetFillAlpha=function(){return this.m_fillAlpha},E.prototype.SetXFormScale=function(t){void 0===t&&(t=0),this.m_xformScale=t},E.prototype.GetXFormScale=function(){return this.m_xformScale},E.prototype.DrawPolygon=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(o.color,this.m_alpha),e.moveTo(t[0].x*n,t[0].y*n);for(var s=1;s<i;s++)e.lineTo(t[s].x*n,t[s].y*n);e.lineTo(t[0].x*n,t[0].y*n),e.closePath(),e.stroke()}},E.prototype.DrawSolidPolygon=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(o.color,this.m_alpha),e.fillStyle=this._color(o.color,this.m_fillAlpha),e.moveTo(t[0].x*n,t[0].y*n);for(var s=1;s<i;s++)e.lineTo(t[s].x*n,t[s].y*n);e.lineTo(t[0].x*n,t[0].y*n),e.closePath(),e.fill(),e.stroke()}},E.prototype.DrawCircle=function(t,i,o){var e,n;i&&(e=this.m_ctx,n=this.m_drawScale,e.beginPath(),e.strokeStyle=this._color(o.color,this.m_alpha),e.arc(t.x*n,t.y*n,i*n,0,2*Math.PI,!0),e.closePath(),e.stroke())},E.prototype.DrawSolidCircle=function(t,i,o,e){var n,s,r,a;i&&(n=this.m_ctx,s=this.m_drawScale,r=t.x*s,a=t.y*s,n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(e.color,this.m_alpha),n.fillStyle=this._color(e.color,this.m_fillAlpha),n.arc(r,a,i*s,0,2*Math.PI,!0),n.moveTo(r,a),n.lineTo((t.x+o.x*i)*s,(t.y+o.y*i)*s),n.closePath(),n.fill(),n.stroke())},E.prototype.DrawSegment=function(t,i,o){var e=this.m_ctx,n=this.m_drawScale;e.strokeStyle=this._color(o.color,this.m_alpha),e.beginPath(),e.moveTo(t.x*n,t.y*n),e.lineTo(i.x*n,i.y*n),e.closePath(),e.stroke()},E.prototype.DrawTransform=function(t){var i=this.m_ctx,o=this.m_drawScale;i.beginPath(),i.strokeStyle=this._color(16711680,this.m_alpha),i.moveTo(t.position.x*o,t.position.y*o),i.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*o,(t.position.y+this.m_xformScale*t.R.col1.y)*o),i.strokeStyle=this._color(65280,this.m_alpha),i.moveTo(t.position.x*o,t.position.y*o),i.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*o,(t.position.y+this.m_xformScale*t.R.col2.y)*o),i.closePath(),i.stroke()},j=0;j<P.postDefs.length;++j)P.postDefs[j]();t.exports=P}((g.module.exports,g.module.require,g.module),(g.filename,g.dirname));
		};
	



</script>

<script>

	!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).gameStorage=e()}(function(){return function n(o,i,a){function u(t,e){if(!i[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(s)return s(t,!0);r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}r=i[t]={exports:{}};o[t][0].call(r.exports,function(e){return u(o[t][1][e]||e)},r,r.exports,n,o,i,a)}return i[t].exports}for(var s="function"==typeof require&&require,e=0;e<a.length;e++)u(a[e]);return u}({1:[function(e,t,r){"use strict";var a=e("@akashic/akashic-engine"),u=e("./validator"),e=(n.prototype.set=function(e,t,r){u.validateStorageKey(e),this.expandVariables(e);var n=this.storageKeyToStringKey(e),o=this.getValue(n),i=null;switch(e.region){case a.StorageRegion.Values:i=this.createValuesValue(o,t,r);break;case a.StorageRegion.Counts:i=this.createCountsValue(o,t,r);break;case a.StorageRegion.Scores:i=this.createScoresValue(o,t,r);break;case a.StorageRegion.Slots:throw new Error("Slots is not supported.");default:throw new Error("Unknown region.")}i&&(t=null,r=new Date,t=o?{data:i.data,tag:i.tag,createdAt:o.createdAt,updatedAt:r}:{data:i.data,tag:i.tag,createdAt:r,updatedAt:r},this.setValue(n,t))},n.prototype.load=function(e){var o=this,i={};Object.keys(this._localStorage).forEach(function(e){0===e.indexOf("akst:")&&(e=e.slice("akst:".length),i[e]=o.getValue(e))});var a=[];return e.forEach(function(e){u.validateStorageReadKey(e),o.expandVariables(e);var r,t,n=[];-1!==e.regionKey.indexOf("*")||"*"===e.userId?(r=o.storageReadKeyToRegExp(e),Object.keys(i).forEach(function(e){var t;r.test(e)&&(e={data:(t=i[e]).data,storageKey:o.stringKeyToStorageKey(e)},null!=t.tag&&(e.tag=t.tag),n.push(e))}),e.option&&(void 0!==e.option.valueOrder&&o.sortByValue(n,e.option.valueOrder),void 0!==e.option.keyOrder&&o.sortByRegionKey(n,e.option.keyOrder))):(t=o.storageKeyToStringKey(e),(t=i[t])&&(e={data:t.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}},null!=t.tag&&(e.tag=t.tag),n.push(e))),a.push(n)}),a},n.prototype.clearAll=function(){var t=this;Object.keys(this._localStorage).forEach(function(e){0===e.indexOf("akst:")&&t._localStorage.removeItem(e)})},n.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==a.StorageCondition.Equal)throw new Error("Invalid condition.");if(e.data!==r.comparisonValue)return null}r={data:t.data};return null!=t.tag?r.tag=t.tag:e&&null!=e.tag&&(r.tag=e.tag),r},n.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case a.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case a.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case a.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}r={data:t.data};return null!=t.tag?r.tag=t.tag:e&&null!=e.tag&&(r.tag=e.tag),r},n.prototype.createCountsIncrDecrValue=function(e,t,r){var n={data:0},o=0;if(e&&(o=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case a.StorageCondition.Equal:if(o!==r.comparisonValue)return e?null:n;break;case a.StorageCondition.GreaterThan:if(!(o>r.comparisonValue))return e?null:n;break;case a.StorageCondition.LessThan:if(!(o<r.comparisonValue))return e?null:n}if(r.operation===a.StorageCountsOperation.Incr)t&&null!=t.data?n.data=o+Number(t.data):n.data=o+1;else{if(r.operation!==a.StorageCountsOperation.Decr)throw new Error("Unknown StorageCountsOperation");t&&null!=t.data?n.data=o-Number(t.data):n.data=o-1}return t&&null!=t.tag?n.tag=t.tag:e&&null!=e.tag&&(n.tag=e.tag),n},n.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===a.StorageCountsOperation.Incr||r.operation===a.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case a.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case a.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case a.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}r={data:t.data};return t&&null!=t.tag?r.tag=t.tag:e&&null!=e.tag&&(r.tag=e.tag),r},n.prototype.setValue=function(e,t){this._localStorage.setItem("akst:"+e,JSON.stringify(t))},n.prototype.getValue=function(e){return JSON.parse(this._localStorage.getItem("akst:"+e))},n.prototype.storageKeyToStringKey=function(e){return(e.region||"")+"/"+(null!=e.gameId?String(e.gameId):"")+"/"+(null!=e.userId?String(e.userId):"")+"/"+(e.regionKey||"")},n.prototype.stringKeyToStorageKey=function(e){var t=e.split("/"),e={region:Number(t[0]),regionKey:t[3]};return t[1]&&(e.gameId=t[1]),t[2]&&(e.userId=t[2]),e},n.prototype.storageReadKeyToRegExp=function(e){var r,t=e.region||"",n=null!=e.gameId?String(e.gameId):"",o=null!=e.userId?String(e.userId):"",i="";return"*"===o&&(o="[0-9]+"),-1!==e.regionKey.indexOf("*")?(r=e.regionKey.split(".")).forEach(function(e,t){"*"===e?i+="[.a-z0-9]*":-1!==e.indexOf("*")?i+=e.replace("*","[a-z0-9]*"):i+=e,t!==r.length-1&&(i+=".")}):i=e.regionKey.replace(".","."),new RegExp("^"+t+"/"+n+"/"+o+"/"+i+"$")},n.prototype.sortByValue=function(e,r){e.sort(function(e,t){e=e.data,t=t.data;if(r===a.StorageOrder.Asc){if(e<t)return-1;if(t<e)return 1}else if(r===a.StorageOrder.Desc){if(e<t)return 1;if(t<e)return-1}return 0})},n.prototype.sortByRegionKey=function(e,r){e.sort(function(e,t){e=e.storageKey.regionKey,t=t.storageKey.regionKey;if(r===a.StorageOrder.Asc){if(e<t)return-1;if(t<e)return 1}else if(r===a.StorageOrder.Desc){if(e<t)return 1;if(t<e)return-1}return 0})},n.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf("$gameId")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\$gameId/g,this._metaData.gameId))},n);function n(e,t){this._localStorage=e,this._metaData=t}r.GameStorage=e},{"./validator":3,"@akashic/akashic-engine":"@akashic/akashic-engine"}],2:[function(e,t,r){"use strict";e=e("./GameStorage");r.GameStorage=e.GameStorage},{"./GameStorage":1}],3:[function(e,t,r){"use strict";var i=e("assert"),n=e("@akashic/akashic-engine"),a=4;function o(e,t){i(0<e.length,"regionKey is empty.");var r=e.split(".");i(r.length<=a,"The maximum number of layers in the region key is "+a+".");for(var n=!1,o=0;o<r.length;++o)t?"*"===r[o]?(i(!n,"The only one layer of the region key for reading consists of a wildcard character."),n=!0):i(/^(\*|[a-z])[a-z0-9]{0,31}\*?$/.test(r[o]),"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'."):i(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.")}function u(e,t){void 0===t&&(t=!1),i(e.region===n.StorageRegion.Counts||e.region===n.StorageRegion.Scores||e.region===n.StorageRegion.Values,"Invalid region."),i(e.regionKey,"regionKey must be set."),o(e.regionKey,t),i(e.gameId||e.userId,"StorageKey must have any one at least from gameId and userId."),null!=e.gameId&&(i.equal(typeof e.gameId,"string","gameId must be a string type."),i(0<e.gameId.length,"gameId is empty.")),null!=e.userId&&(i.equal(typeof e.userId,"string","userId must be a string type."),i(0<e.userId.length,"userId is empty."),t?"*"===e.userId&&(i(e.gameId,'gameId for reading must be set when userId is "*".'),i(-1===e.regionKey.indexOf("*"),'regionKey for reading must not include "*" when userId is "*".')):i("*"!==e.userId,'userId for writing must not include "*".'))}r.validateRegionKey=o,r.validateStorageKey=u,r.validateStorageReadKey=function(e){u(e,!0),null!=e.option&&(null!=(e=e.option).keyOrder&&i(e.keyOrder===n.StorageOrder.Asc||e.keyOrder===n.StorageOrder.Desc,"Invalid keyOrder."),null!=e.valueOrder&&i(e.valueOrder===n.StorageOrder.Asc||e.valueOrder===n.StorageOrder.Desc,"Invalid valueOrder."))},r.validateStorageWriteOption=function(e){}},{"@akashic/akashic-engine":"@akashic/akashic-engine",assert:4}],4:[function(w,O,e){(function(t){"use strict";function i(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function a(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var l=w("util/"),n=Object.prototype.hasOwnProperty,f=Array.prototype.slice,r="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function s(e){return!a(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&(e instanceof DataView||e.buffer&&e.buffer instanceof ArrayBuffer))}var c=O.exports=e,o=/\s*function\s+([^\(\s]*)\s*/;function g(e){if(l.isFunction(e)){if(r)return e.name;e=e.toString().match(o);return e&&e[1]}}function p(e,t){return"string"!=typeof e||e.length<t?e:e.slice(0,t)}function d(e){if(r||!l.isFunction(e))return l.inspect(e);e=g(e);return"[Function"+(e?": "+e:"")+"]"}function y(e,t,r,n,o){throw new c.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function e(e,t){e||y(e,!0,t,"==",c.ok)}function h(e,t,r,n){if(e===t)return!0;if(a(e)&&a(t))return 0===i(e,t);if(l.isDate(e)&&l.isDate(t))return e.getTime()===t.getTime();if(l.isRegExp(e)&&l.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(s(e)&&s(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var o=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==o&&o===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(l.isPrimitive(e)||l.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=m(e),i=m(t);if(o&&!i||!o&&i)return!1;if(o)return h(e=f.call(e),t=f.call(t),r);var a,u,s=b(e),c=b(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;0<=u;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;0<=u;u--)if(!h(e[a=s[u]],t[a],r,n))return!1;return!0}(e,t,r,n))}return r?e===t:e==t}function m(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function v(e,t){if(e&&t){if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return 1}catch(e){}return Error.isPrototypeOf(t)?void 0:!0===t.call({},e)}}function S(e,t,r,n){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),o=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!o&&y(o,r,"Missing expected exception"+n);var i="string"==typeof n,t=!e&&o&&!r;if((!e&&l.isError(o)&&i&&v(o,r)||t)&&y(o,r,"Got unwanted exception"+n),e&&o&&r&&!v(o,r)||!e&&o)throw o}c.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(d(this.actual),128)+" "+this.operator+" "+p(d(this.expected),128),this.generatedMessage=!0);var t=e.stackStartFunction||y;Error.captureStackTrace?Error.captureStackTrace(this,t):(e=new Error).stack&&(e=e.stack,t=g(t),0<=(t=e.indexOf("\n"+t))&&(t=e.indexOf("\n",t+1),e=e.substring(t+1)),this.stack=e)},l.inherits(c.AssertionError,Error),c.fail=y,c.ok=e,c.equal=function(e,t,r){e!=t&&y(e,t,r,"==",c.equal)},c.notEqual=function(e,t,r){e==t&&y(e,t,r,"!=",c.notEqual)},c.deepEqual=function(e,t,r){h(e,t,!1)||y(e,t,r,"deepEqual",c.deepEqual)},c.deepStrictEqual=function(e,t,r){h(e,t,!0)||y(e,t,r,"deepStrictEqual",c.deepStrictEqual)},c.notDeepEqual=function(e,t,r){h(e,t,!1)&&y(e,t,r,"notDeepEqual",c.notDeepEqual)},c.notDeepStrictEqual=function e(t,r,n){h(t,r,!0)&&y(t,r,n,"notDeepStrictEqual",e)},c.strictEqual=function(e,t,r){e!==t&&y(e,t,r,"===",c.strictEqual)},c.notStrictEqual=function(e,t,r){e===t&&y(e,t,r,"!==",c.notStrictEqual)},c.throws=function(e,t,r){S(!0,e,t,r)},c.doesNotThrow=function(e,t,r){S(!1,e,t,r)},c.ifError=function(e){if(e)throw e};var b=Object.keys||function(e){var t,r=[];for(t in e)n.call(e,t)&&r.push(t);return r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":8}],5:[function(e,t,r){var n,o,t=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var s,c=[],l=!1,f=-1;function g(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=u(g);l=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,l=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function y(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new d(e,t)),1!==c.length||l||u(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=y,t.addListener=y,t.once=y,t.off=y,t.removeListener=y,t.removeAllListeners=y,t.emit=y,t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){function r(){}e.super_=t,r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],8:[function(x,e,I){(function(n,o){var u=/%[sdj%]/g;I.format=function(e){if(!m(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,i=String(e).replace(u,function(e){if("%%"===e)return"%";if(o<=r)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<o;a=n[++r])null!==a&&l(a)?i+=" "+s(a):i+=" "+a;return i},I.deprecate=function(e,t){if(void 0===o.process)return function(){return I.deprecate(e,t).apply(this,arguments)};if(!0===n.noDeprecation)return e;var r=!1;return function(){if(!r){if(n.throwDeprecation)throw new Error(t);n.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}};var e,i={};function s(e,t){var r={seen:[],stylize:c};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),y(t)?r.showHidden=t:t&&I._extend(r,t),void 0===r.showHidden&&(r.showHidden=!1),void 0===r.depth&&(r.depth=2),void 0===r.colors&&(r.colors=!1),void 0===r.customInspect&&(r.customInspect=!0),r.colors&&(r.stylize=a),f(r,e,r.depth)}function a(e,t){t=s.styles[t];return t?"["+s.colors[t][0]+"m"+e+"["+s.colors[t][1]+"m":e}function c(e,t){return e}function f(t,r,n){if(t.customInspect&&r&&w(r.inspect)&&r.inspect!==I.inspect&&(!r.constructor||r.constructor.prototype!==r)){var e=r.inspect(n,t);return m(e)||(e=f(t,e,n)),e}var o=function(e,t){if(void 0===t)return e.stylize("undefined","undefined");if(m(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return h(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):null===t?e.stylize("null","null"):void 0}(t,r);if(o)return o;var i,a=Object.keys(r),u=(i={},a.forEach(function(e,t){i[e]=!0}),i);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),b(r)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return g(r);if(0===a.length){if(w(r)){var s=r.name?": "+r.name:"";return t.stylize("[Function"+s+"]","special")}if(v(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(S(r))return t.stylize(Date.prototype.toString.call(r),"date");if(b(r))return g(r)}var c="",l=!1,e=["{","}"];return d(r)&&(l=!0,e=["[","]"]),w(r)&&(c=" [Function"+(r.name?": "+r.name:"")+"]"),v(r)&&(c=" "+RegExp.prototype.toString.call(r)),S(r)&&(c=" "+Date.prototype.toUTCString.call(r)),b(r)&&(c=" "+g(r)),0!==a.length||l&&0!=r.length?n<0?v(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),o=l?function(t,r,n,o,e){for(var i=[],a=0,u=r.length;a<u;++a)E(r,String(a))?i.push(p(t,r,n,o,String(a),!0)):i.push("");return e.forEach(function(e){e.match(/^\d+$/)||i.push(p(t,r,n,o,e,!0))}),i}(t,r,n,u,a):a.map(function(e){return p(t,r,n,u,e,l)}),t.seen.pop(),s=c,a=e,60<(o=o).reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?a[0]+(""===s?"":s+"\n ")+" "+o.join(",\n  ")+" "+a[1]:a[0]+s+" "+o.join(", ")+" "+a[1]):e[0]+c+e[1]}function g(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,o,i){var a,u,t=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]};if(t.get?u=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(u=e.stylize("[Setter]","special")),E(n,o)||(a="["+o+"]"),u||(e.seen.indexOf(t.value)<0?-1<(u=f(e,t.value,null===r?null:r-1)).indexOf("\n")&&(u=i?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n")):u=e.stylize("[Circular]","special")),void 0===a){if(i&&o.match(/^\d+$/))return u;a=(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+u}function d(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function h(e){return"number"==typeof e}function m(e){return"string"==typeof e}function v(e){return l(e)&&"[object RegExp]"===t(e)}function l(e){return"object"==typeof e&&null!==e}function S(e){return l(e)&&"[object Date]"===t(e)}function b(e){return l(e)&&("[object Error]"===t(e)||e instanceof Error)}function w(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function r(e){return e<10?"0"+e.toString(10):e.toString(10)}I.debuglog=function(t){var r;return void 0===e&&(e=n.env.NODE_DEBUG||""),t=t.toUpperCase(),i[t]||(new RegExp("\\b"+t+"\\b","i").test(e)?(r=n.pid,i[t]=function(){var e=I.format.apply(I,arguments);console.error("%s %d: %s",t,r,e)}):i[t]=function(){}),i[t]},(I.inspect=s).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},I.isArray=d,I.isBoolean=y,I.isNull=function(e){return null===e},I.isNullOrUndefined=function(e){return null==e},I.isNumber=h,I.isString=m,I.isSymbol=function(e){return"symbol"==typeof e},I.isUndefined=function(e){return void 0===e},I.isRegExp=v,I.isObject=l,I.isDate=S,I.isError=b,I.isFunction=w,I.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},I.isBuffer=x("./support/isBuffer");var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}I.log=function(){var e,t;console.log("%s - %s",(t=[r((e=new Date).getHours()),r(e.getMinutes()),r(e.getSeconds())].join(":"),[e.getDate(),O[e.getMonth()],t].join(" ")),I.format.apply(I,arguments))},I.inherits=x("inherits"),I._extend=function(e,t){if(!t||!l(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,x("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}]},{},[2])(2)});

	window.addEventListener("load",function(){!function(e){var n="sandboxDummyPlayId",t=new gameStorage.GameStorage(window.localStorage,{gameId:e}),o=engineFiles.pdiBrowser,a=engineFiles.gameDriver,i=new a.MemoryAmflowClient({playId:n,putStorageDataSyncFunc:t.set.bind(t),getStorageDataSyncFunc:function(e){var o=t.load(e);return e.map(function(e,n){return{readKey:e,values:o[n]}})}});{var r;!0!==window.__akashic__.autoSendEventName&&"string"!=typeof window.__akashic__.autoSendEventName||(e=window.__akashic__.sandboxConfigFunc(),!0===(r=window.__akashic__.autoSendEventName)&&(r=e.autoSendEventName||e.autoSendEvents),e&&r&&e.events&&e.events[r]&&e.events[r].forEach(function(e){i.sendEvent(e)}))}r="file:"!==location.protocol?[o.WebAudioPlugin,o.HTMLAudioPlugin]:[o.HTMLAudioPlugin];var d=new o.Platform({amflow:i,containerView:document.getElementById("container"),audioPlugins:r});d.loadGameConfiguration=function(e,n){try{var o=window.gLocalAssetContainer["game.json"],o=decodeURIComponent(o);n(null,JSON.parse(o))}catch(e){n(e,null)}},d._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};"undefined"!=typeof LocalTextAsset&&(d._resourceFactory.createTextAsset=function(e,n){return new LocalTextAsset(e,n)});function c(e){var n,o,t,a;d.containerController&&(n=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight,t=Math.min(n/e.width,o/e.height),a=Math.floor(e.width*t),e=Math.floor(e.height*t),d.containerController.changeScale(t,t),e={x:Math.floor((n-a)/2),y:Math.floor((o-e)/2)},d.containerController.inputHandlerLayer.setOffset(e))}driver=new a.GameDriver({platform:d,player:{id:"9999",name:"sandbox-player"},errorHandler:function(e){console.log("ERRORHANDLER:",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(c(e),window.addEventListener("resize",function(){c(e)}))}),driver.initialize({configurationUrl:"game.json",assetBase:"./",driverConfiguration:{playId:n,playToken:"dummyToken",executionMode:a.ExecutionMode.Active},loopConfiguration:{loopMode:a.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}("exportHTML")});

	window.g=require("@akashic/akashic-engine"),"gLocalAssetContainer"in window||(window.gLocalAssetContainer={}),"__akashic__"in window||(window.__akashic__={});

	var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),LocalScriptAsset=function(n){function t(t,o){o=n.call(this,t,o)||this;return o.func=window.gLocalAssetContainer[t],o}return __extends(t,n),t.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load script asset"))},0)},t.prototype.execute=function(t){return this.func(t),t.module.exports},t}(g.ScriptAsset);

	var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),LocalTextAsset=function(n){function t(t,o){o=n.call(this,t,o)||this;return o.data=decodeURIComponent(window.gLocalAssetContainer[t]),o}return __extends(t,n),t.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load text asset"))},0)},t}(g.TextAsset);

</script>

<style type="text/css">
* {
	margin: 0;
	border: 0;
	padding: 0;
}

html {
	width: 100%;
	height: 100%;
}

body {
	overflow: hidden;
	width: 100%;
	height: 100%;
}

#container {
	margin: 0px;
	padding: 0px;
	overflow: hidden;
	touch-action: none;
	width: 100%;
	height: 100%;

	/* iOS: body */
	position: absolute;
}

#container canvas {
	background-size: contain;
}

</style>



</head>
<body>
<div id="container">
</div>
</body>
</html>
