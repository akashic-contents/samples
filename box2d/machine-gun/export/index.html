<!doctype html>
<!-- Generated by akashic-cli-export-html@0.6.3. -->
<!-- Options: {"strip":true,"minify":true,"bundle":true,"magnify":true} -->
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>game</title>
<script>

	!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.engineFilesV2_1_38=t()}}(function(){var t;return function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){e.exports=t("./lib/main.node")},{"./lib/main.node":2}],2:[function(t,e,i){(function(){"use strict";var t,i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){!function(t){t[t.Unspecified=0]="Unspecified",t[t.RetryLimitExceeded=1]="RetryLimitExceeded",t[t.NetworkError=2]="NetworkError",t[t.ClientError=3]="ClientError",t[t.ServerError=4]="ServerError"}(t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e){var i=new Error(t);return i.name="AssertionError",i.cause=e,i}function r(t,e,i,r){var n="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,n+=", actual type is "+(o.length>40?o.substr(0,40):o)}catch(t){}n+=".";var s=new Error(n);return s.name="TypeMismatchError",s.cause=r,s.expected=e,s.actual=i,s}function n(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name="AssetLoadError",o.cause=n,o.retriable=i,o.type=r,o}e.createAssertionError=i,e.createTypeMismatchError=r,e.createAssetLoadError=n}(t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),n=r.renderer();return n.begin(),n.drawImage(t,i.x,i.y,i.width,i.height,0,0),n.end(),r},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.seed=t,this[0]=this}return t}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.id=e,this.originalPath=i,this.path=this._assetPathFilter(i),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return o.width=r,o.height=n,o}return i(e,t),e.prototype.initialize=function(t){this.hint=t},e}(e);t.ImageAsset=r;var n=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,e,i,r,n)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=s,h._useRealSize=a,h}return i(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(r);t.VideoAsset=n;var o=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=s,a._system=n,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r,n){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=n||{},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,n="string"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(n))++this._refCounts[n],e._onAssetLoad(this._assets[n]);else if(this._loadings.hasOwnProperty(n))r=this._loadings[n],r.handlers.push(e),++this._refCounts[n],o=!0;else{var s=this._createAssetFor(t);r=new i(s,e),this._loadings[n]=r,this._refCounts[n]=1,o=!0,r.loading=!0,s._load(this)}return o},r.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,n=t.length;r<n;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var n in e)if(e.hasOwnProperty(n)){var o=Object.create(e[n]);if(!o.path)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+n);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+n);if(!o.type)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+n);if("image"===o.type){if("number"!=typeof o.width)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+n);if("number"!=typeof o.height)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+n)}if("audio"===o.type){void 0===o.duration&&(o.duration=0);var s=i[o.systemId];void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{})}if("video"===o.type&&!o.useRealSize){if("number"!=typeof o.width)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+n);if("number"!=typeof o.height)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+n);o.useRealSize=!1}o.global||(o.global=!1),r[n]=o}return r},r.prototype._createAssetFor=function(e){var i,r,n;if("string"==typeof e)i=e,n=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,n=o,r=o.uri}var s=this.game.resourceFactory;if(!n)throw t.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+i);switch(n.type){case"image":var a=s.createImageAsset(i,r,n.width,n.height);return a.initialize(n.hint),a;case"audio":var h=n.systemId?this.game.audio[n.systemId]:this.game.audio[this.game.defaultAudioSystemId];return s.createAudioAsset(i,r,n.duration,h,n.loop,n.hint);case"text":return s.createTextAsset(i,r);case"script":return s.createScriptAsset(i,r);case"video":return s.createVideoAsset(i,r,n.width,n.height,new t.VideoSystem,n.loop,n.useRealSize);default:throw t.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+n.type+" for asset ID: "+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+r.id);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var n=this.configuration[e].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var n=this._loadings[e.id],o=n.handlers;n.loading=!1,++n.errorCount,n.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<o.length;++s)o[s]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var n=i.handlers,o=0;o<n.length;++o)n[o]._onAssetLoad(e)}},r.MAX_ERROR_COUNT=3,r}();t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var n,o,s=e._assetManager._liveAssetVirtualPathTable,a=e._assetManager._moduleMainScripts;if(-1===i.indexOf("/")&&e._assetManager._assets.hasOwnProperty(i)&&(n=e._assetManager._assets[i],o=e._assetManager._liveAbsolutePathTable[n.path]),/^\.\/|^\.\.\/|^\//.test(i)){if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError("g._require: require from DynamicAsset is not supported");o=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if(!/^\.\//.test(i))throw t.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");o=i.substring(2)}if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+".js"))return e._scriptCaches[o+".js"]._cachedValue();n||(n=t.Util.findAssetByPathAsFile(o,s)),n||(n=t.Util.findAssetByPathAsDirectory(o,s))}else if(a[i]&&(o=a[i],n=e._assetManager._liveAssetVirtualPathTable[o]),!n){var h=r?r.paths:[];h.push("node_modules");for(var c=0;c<h.length;++c){var u=h[c];if(o=t.PathUtil.resolvePath(u,i),n=t.Util.findAssetByPathAsFile(o,s))break;if(n=t.Util.findAssetByPathAsDirectory(o,s))break}}if(n){if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(n instanceof t.ScriptAsset){var l=new t.ScriptAssetContext(e,n);return e._scriptCaches[o]=l,l._executeScript(r)}if(n instanceof t.TextAsset&&n&&".json"===t.PathUtil.resolveExtname(i)){return(e._scriptCaches[o]=new t.RequireCachedValue(JSON.parse(n.data)))._cachedValue()}}throw t.ExceptionFactory.createAssertionError("g._require: can not find module: "+i)}t._require=e;var i=function(){function e(e,i,r){var n=this,o=t.PathUtil.resolveDirname(r),s=e._assetManager._liveAbsolutePathTable[r],a=s?t.PathUtil.resolveDirname(s):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return"g"===i?h:t._require(e,i,n)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=o&&null!=s?this.updateWithAnchor(t,e,i,r,n,0,0,o,s):this.update(t,e,i,r,n,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h*i,l=c*i,d=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-u*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u*i,p=l*i,f=l*r,_=u*r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*g+f*y+o,this._matrix[5]=-p*g-_*y+s},t.prototype.updateByInverse=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h/i,l=c/r,d=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-u*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.updateByInverseWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u/i,p=l/r,f=l/i,_=u/r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+g,this._matrix[5]=p*o-_*s+y},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],n=e[1],o=e[2],s=e[3];e[0]=r*i[0]+o*i[1],e[1]=n*i[0]+s*i[1],e[2]=r*i[2]+o*i[3],e[3]=n*i[2]+s*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=n*i[4]+s*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function n(t,i){return e.distance(t.x+t.width/2,t.y+t.height/2,i.x+i.width/2,i.y+i.height/2)}function o(e,i,r,n,o,s,a){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,n,o,s,a)}function s(e,i,r){var n=i.x,o=i.y,s=0,a=0,h=i.width,c=i.height,u=i.calculateBoundingRect(r);if(!u)throw t.ExceptionFactory.createAssertionError("Util#createSpriteFromE: camera must look e");h=u.right-u.left,c=u.bottom-u.top,u.left<i.x&&(s=i.x-u.left),u.top<i.y&&(a=i.y-u.top),i.moveTo(s,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),d=l.renderer();d.begin(),i.render(d,r),d.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(u.left,u.top),i.moveTo(n,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var n=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=n.renderer();o.begin();for(var s=i.children,a=0;a<s.length;++a)s[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:n,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError("Util#asSurface","ImageAsset|Surface",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0}function u(i,r){var n;if(n=i+"/package.json",r.hasOwnProperty(n)&&r[n]instanceof t.TextAsset){var o=JSON.parse(r[n].data);if(o&&"string"==typeof o.main){var s=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(s)return s}}if(n=i+"/index.js",r.hasOwnProperty(n))return r[n]}function l(t,e){var i=t.charCodeAt(e);if(55296<=i&&i<=56319){return i<<16|t.charCodeAt(e+1)}return 56320<=i&&i<=57343?null:i}function d(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=n,e.createMatrix=o,e.createSpriteFromE=s,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=u,e.charCodeAt=l,e.setupAnimatingHandler=d,e.migrateAnimatingHandler=p}(t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r,n,o,s,a){return t<=n+s&&n<=t+i&&e<=o+a&&o<=e+r}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function n(e,i,r,n,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,n)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=n,e.withinAreas=o}(t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var n=this._handlers.indexOf(r);-1!==n&&this._handlers.splice(n,1)}}this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var n=this._handlers[r];if(i.func===n.func&&i.owner===n.owner&&i.name===n.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var n=t.call(this)||this;return n.chain=e,n.filter=i,n.filterOwner=r,n._isActivated=!1,n}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(e);t.ChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=n,this._timer.elapsed.add(this._fire,this)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),e<0)throw t.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");e<1&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var n=new t.Timer(e,this._fps);return this._timers.push(n),n},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(e.destroyed())throw t.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e.prototype._onVolumeChanged=function(){},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(e<0||e>1||isNaN(e)||"number"!=typeof e)throw t.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(e<0||isNaN(e)||"number"!=typeof e)throw t.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,"player",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player._changeMuted(!0),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.played.remove({owner:this,func:this._onPlayerPlayed}),i.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},e.prototype._onPlayerPlayed=function(t){
t.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},e}(e);t.SoundAudioSystem=n}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity="opacity"in t?t.opacity:1,this.scaleX="scaleX"in t?t.scaleX:1,this.scaleY="scaleY"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if("number"==typeof e&&"number"!=typeof i)throw t.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if("number"==typeof e&&"number"!=typeof i)throw t.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=i.tag,r.shaderProgram=i.shaderProgram,r.local=i.scene.local!==t.LocalTickMode.NonLocal||!!i.local,i.children)for(var n=0;n<i.children.length;++n)r.append(i.children[n]);return i.parent&&i.parent.append(r),i.targetCameras&&(r.targetCameras=i.targetCameras),"touchable"in i&&(r.touchable=i.touchable),i.hidden&&r.hide(),r.id=i.id,i.scene.register(r),r}return i(r,e),Object.defineProperty(r.prototype,"update",{get:function(){return this._update||(this._update=new t.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"message",{get:function(){return this._message||(this._message=new t.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointDown",{get:function(){return this._pointDown||(this._pointDown=new t.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointUp",{get:function(){return this._pointUp||(this._pointUp=new t.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointMove",{get:function(){return this._pointMove||(this._pointMove=new t.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"targetCameras",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,o=n.length,s=0;s<o;++s)n[s].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,s=0;s<n.length;++s)n[s].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(i<0)throw t.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var e=this.children.length-1;e>=0;--e)this.children[e].destroy();if(0!==this.children.length)throw t.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var n=this._targetCameras;if(!(n&&n.length>0)||r&&-1!==n.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var s=this.children.length-1;s>=0;--s){var a=this.children[s];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!=(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(s.left>h.left&&(s.left=h.left),s.right<h.right&&(s.right=h.right),s.top>h.top&&(s.top=h.top),s.bottom<h.bottom&&(s.bottom=h.bottom))}return s}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return!(1&this.state)&&(e instanceof t.PointEvent&&(this._touchable&&e.target===this))},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*r,o=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(t.E);t.CacheableE=e}(t||(t={}));var t;!function(t){!function(t){t[t.Slots=1]="Slots",t[t.Scores=2]="Scores",t[t.Counts=3]="Counts",t[t.Values=4]="Values"}(t.StorageRegion||(t.StorageRegion={}));!function(t){t[t.Asc=0]="Asc",t[t.Desc=1]="Desc"}(t.StorageOrder||(t.StorageOrder={}));!function(t){t[t.Equal=1]="Equal",t[t.GreaterThan=2]="GreaterThan",t[t.LessThan=3]="LessThan"}(t.StorageCondition||(t.StorageCondition={}));!function(t){t[t.Incr=1]="Incr",t[t.Decr=2]="Decr"}(t.StorageCountsOperation||(t.StorageCountsOperation={}));var e=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();t.StorageValueStore=e;var i=function(){function t(t,i,r){this._loaded=!1,this._storage=t,this._valueStore=new e(i),this._handler=void 0,this._valueStoreSerialization=r}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=i;var r=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new i(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=r}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return 0!==this.waitingAssetsCount&&(!!this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),!0))},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError("SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]="Destroyed",t[t.Standby=1]="Standby",t[t.Active=2]="Active",t[t.Deactive=3]="Deactive",t[t.BeforeDestroyed=4]="BeforeDestroyed"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]="Initial",t[t.Ready=1]="Ready",t[t.ReadyFired=2]="ReadyFired",t[t.LoadedFired=3]="LoadedFired"}(r=t.SceneLoadState||(t.SceneLoadState={}));var n=function(){function n(n){var o,s,a,h;o=n.game,h=n.assetIds,n.storageKeys?(this._storageLoader=o.storage._createLoader(n.storageKeys,n.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),s=void 0===n.local?t.LocalTickMode.NonLocal:!1===n.local?t.LocalTickMode.NonLocal:!0===n.local?t.LocalTickMode.FullLocal:n.local,a=void 0!==n.tickGenerationMode?n.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=n.name,h||(h=[]),this.game=o,this.local=s,this.tickGenerationMode=a,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:h,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return n.prototype.modified=function(t){this.game.modified=!0},n.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},n.prototype.destroyed=function(){return void 0===this.game},n.prototype.createTimer=function(t){return this._timer.createTimer(t)},n.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},n.prototype.setInterval=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},n.prototype.clearInterval=function(t){this._timer.clearInterval(t)},n.prototype.setTimeout=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},n.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},n.prototype.isCurrentScene=function(){return this.game.scene()===this},n.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");i?this.game.pushScene(e):this.game.replaceScene(e)},n.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},n.prototype.register=function(t){this.game.register(t),t.scene=this},n.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},n.prototype.append=function(t){this.insertBefore(t,void 0)},n.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},n.prototype.findPointSourceByPoint=function(e,i,r){var n=this.local!==t.LocalTickMode.NonLocal,o=this.children,s=void 0;r&&r instanceof t.Camera2D&&(s=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,s,i,r);if(h)return h.local=h.target.local||n,h}return{target:void 0,point:void 0,local:n}},n.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},n.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},n.prototype.requestAssets=function(i,n){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:n});this._assetHolders.push(o),o.request()},n.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},n.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},n.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},n.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},n.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},n.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},n.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},n.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},n.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},n.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},n}();t.Scene=n}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:"(no scene)",i="LoadingScene#end(): the target scene is in invalid state: "+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},r.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function n(t){var e=r.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(n,r),n.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:"rgba(0, 0, 0, 0.8)",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},n.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},n.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},n.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},n}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.surface=t.Util.asSurface(i.src),"width"in i||(r.width=r.surface.width),"height"in i||(r.height=r.surface.height),r.srcWidth="srcWidth"in i?i.srcWidth:r.width,r.srcHeight="srcHeight"in i?i.srcHeight:r.height,r.srcX=i.srcX||0,r.srcY=i.srcY||0,r._stretchMatrix=void 0,r._beforeSurface=r.surface,t.Util.setupAnimatingHandler(r,r.surface),r._invalidateSelf(),r}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._lastUsedIndex=0,r.frameNumber=i.frameNumber||0,r.frames="frames"in i?i.frames:[0],r.interval=i.interval,r._timer=void 0,r.loop=null==i.loop||i.loop,r.finished=new t.Trigger,r._modifiedSelf(),r}return i(r,e),r.createBySprite=function(t,e,i){var n=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===e?t.srcWidth:e,n},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]="Unknown",t[t.Join=1]="Join",t[t.Leave=2]="Leave",t[t.Timestamp=3]="Timestamp",t[t.Seed=4]="Seed",t[t.PointDown=5]="PointDown",t[t.PointMove=6]="PointMove",t[t.PointUp=7]="PointUp",t[t.Message=8]="Message",t[t.Operation=9]="Operation"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,n,o){this.priority=o,this.local=n,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var n=function(t){function r(i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=n;var o=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointUp,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointUpEvent=o;var s=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointMove,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointMoveEvent=s;var a=function(){function t(t,i,r,n){this.type=e.Message,this.priority=n,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,n,o){this.type=e.Operation,this.priority=o,this.local=n,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var u=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=u;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var d=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=d}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Info=2]="Info",t[t.Debug=3]="Debug"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},i.prototype.destroyed=function(){return!this.game},i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,
message:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=r||"",this.resourceFactory=i,this.selfId=n||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem("music",this),sound:new t.SoundAudioSystem("sound",this)},this.defaultAudioSystemId="sound",this.storage=new t.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,this.resized=new t.Trigger,this.skippingChanged=new t.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio,e.moduleMainScripts);var s=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,s),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new t.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}return Object.defineProperty(e.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},e.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var n=0;n<r.length;++n){var o=this._eventTriggerMap[r[n].type];o&&o.fire(r[n])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if("assets"in e||(e.assets={}),"fps"in e||(e.fps=30),"number"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof e.width)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof e.height)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random=e.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new t.SurfaceAtlasSet({game:this}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){if(this.modified=!0,!e)return this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0);this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,e._activate()},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._abortGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene.destroyed()||r.scene._fireReady();break;case 4:r.scene.destroyed()||r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError("Game#_flushSceneChangeRequests: unknown scene change request.")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError("Game#_start: global asset 'snapshotLoader' not found.");t._require(this,"snapshotLoader")(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError("Game#_start: global asset 'mainScene' not found.");var e=t._require(this,"mainScene")();this.pushScene(e),this._flushSceneChangeRequests()}return void this._started.fire()}var i=t._require(this,this._main);if(!i||"function"!=typeof i)throw t.ExceptionFactory.createAssertionError("Game#_start: Entry point '"+this._main+"' not found.");i(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.game=e.game,i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i.width=e.game.width,i.height=e.game.height,i.id=i.local?void 0:i.game._cameraIdx++,i}return i(e,t),e.deserialize=function(t,i){var r=t;r.param.game=i;var n=new e(r.param);return n.id=r.id,n},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},e.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},e}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,n=0;n<r.length;++n)r[n].render(this,e);e&&this.restore(),this.restore(),this.end()}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n){if(void 0===n&&(n=!1),e%1!=0||i%1!=0)throw t.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=n,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.text=i.text,r.font=i.font,r.textAlign="textAlign"in i?i.textAlign:t.TextAlign.Left,r.glyphs=new Array(i.text.length),r.fontSize=i.fontSize,r.maxWidth=i.maxWidth,r.widthAutoAdjust=!("widthAutoAdjust"in i)||i.widthAutoAdjust,r.textColor=i.textColor,r._textWidth=0,r._game=void 0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderSelfFromCache=function(e){var i;switch(this.textAlign){case t.TextAlign.Center:i=this.widthAutoAdjust?this._overhangLeft:0;break;case t.TextAlign.Right:i=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:i=this._overhangLeft}e.drawImage(this._cache,0,0,this._cacheSize.width+t.CacheableE.PADDING,this._cacheSize.height+t.CacheableE.PADDING,i,0)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this.textAlign){case t.TextAlign.Center:r=this.width/2-(this._textWidth+this._overhangLeft)/2*i;break;case t.TextAlign.Right:r=this.width-(this._textWidth+this._overhangLeft)*i;break;default:r-=this._overhangLeft*i}e.translate(r,0),1!==i&&e.transform([i,0,0,1,0,0]),e.save();for(var n=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(e.save(),e.transform([n,0,0,n,0,0]),e.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),e.restore()),e.translate(a,0)):this._outputOfWarnLogWithNoGlyph(h,"renderCache()")}e.restore(),e.save(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=t.Util.charCodeAt(this.text,i);if(r){var n=this.font.glyphForCharacter(r);if(n&&0!==n.width&&0!==n.advanceWidth){e=i;break}}}for(var o=0,s=this.font.size>0?this.fontSize/this.font.size:0,i=0;i<=e;++i){var a=t.Util.charCodeAt(this.text,i);if(a){var n=this.font.glyphForCharacter(a);if(n){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;o<c&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,"_invalidateSelf()")}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s},r.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn("Label#"+e+": failed to get a glyph for '"+i+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s,a,h,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=n,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if("string"!=typeof i.cssColor)throw t.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",i.cssColor);return r.cssColor=i.cssColor,r}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._oldWidth=i.width,r._oldHeight=i.height,r.backgroundImage=t.Util.asSurface(i.backgroundImage),r.backgroundEffector=i.backgroundEffector,r._shouldRenderChildren=!1,r._padding=i.padding,r._initialize(),r._paddingChanged=!1,r._bgSurface=void 0,r._bgRenderer=void 0,r}return i(r,e),Object.defineProperty(r.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){if(this.backgroundImage&&this.backgroundEffector){var t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var n=t._require(this._game,r.script);if(n.isSupported()){var o=new n(this._game,this._viewInfo,r.option),s=r.code;if(this.plugins[s])throw new Error("Plugin#code conflicted for code: "+s);this.plugins[s]=o,r._plugin=o;var a=new e(s,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;t||(t={});var t;!function(t){var e=function(){function e(){}return e.prototype.measureText=function(e){for(var i,r=0,n=0,o=0,s=0;s<e.length;s++){var a=t.Util.charCodeAt(e,s);if(a){var h=this.glyphForCharacter(a);!h||h.x<0||h.y<0||h.width<0||h.height<0||(0===s&&(n=-h.offsetX),i=h,r+=h.advanceWidth)}}return i&&(o=r+i.offsetX+i.width-i.advanceWidth),{width:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}},e}();t.Font=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Normal=0]="Normal",t[t.Bold=1]="Bold"}(e=t.FontWeight||(t.FontWeight={}));var r=function(r){function n(i){var n=r.call(this)||this;if(n.fontFamily=i.fontFamily,n.size=i.size,n.hint="hint"in i?i.hint:{},n.fontColor="fontColor"in i?i.fontColor:"black",n.fontWeight="fontWeight"in i?i.fontWeight:e.Normal,n.strokeWidth="strokeWidth"in i?i.strokeWidth:0,n.strokeColor="strokeColor"in i?i.strokeColor:"black",n.strokeOnly="strokeOnly"in i&&i.strokeOnly,n._resourceFactory=i.game.resourceFactory,n._glyphFactory=n._resourceFactory.createGlyphFactory(n.fontFamily,n.size,n.hint.baselineHeight,n.fontColor,n.strokeWidth,n.strokeColor,n.strokeOnly,n.fontWeight),n._glyphs={},n._destroyed=!1,n._isSurfaceAtlasSetOwner=!1,i.surfaceAtlasSet?n._atlasSet=i.surfaceAtlasSet:i.hint?(n._isSurfaceAtlasSetOwner=!0,n._atlasSet=new t.SurfaceAtlasSet({game:i.game,hint:n.hint})):n._atlasSet=i.game.surfaceAtlasSet,n._atlasSet.addAtlas(),n.hint.presetChars)for(var o=0,s=n.hint.presetChars.length;o<s;o++){var a=t.Util.charCodeAt(n.hint.presetChars,o);a&&n.glyphForCharacter(a)}return n}return i(n,r),n.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){this._atlasSet.getAtlas(r)._accessScore/=2}return e},n.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));var n={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};n[e]=o});var o=n[r],s=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new t.BitmapFont({src:s,map:n,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o})},n.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},n.prototype.destroyed=function(){return this._destroyed},n}(t.Font);t.DynamicFont=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this)||this;return r.surface=t.Util.asSurface(i.src),r.map=i.map,r.defaultGlyphWidth=i.defaultGlyphWidth,r.defaultGlyphHeight=i.defaultGlyphHeight,r.missingGlyph=i.missingGlyph,r.size=i.defaultGlyphHeight,r}return i(r,e),r.prototype.glyphForCharacter=function(e){var i=this.map[e]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,n=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,s=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===n?void 0:this.surface;return new t.Glyph(e,i.x,i.y,r,n,o,s,a,h,!0)},r.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},r.prototype.destroyed=function(){return!this.map},r}(t.Font);t.BitmapFont=e}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=r;var n=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var n=e(this._emptySurfaceAtlasSlotHead,t,i);if(!n)return null;var o,s,a=n.width-t,h=n.height-i;a<=h?(o=new r(n.x+t,n.y,a,i),s=new r(n.x,n.y+i,n.width,h)):(o=new r(n.x,n.y+i,t,h),s=new r(n.x+t,n.y,a,n.height)),o.prev=n.prev,o.next=s,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,s.prev=o,s.next=n.next,s.next&&(s.next.prev=s);var c=new r(n.x,n.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=n;var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.game.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=i(r)}return t.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t),i=e.surfaceAtlases,r=0;r<i.length;++r)i[r].destroy()},t.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var n=Number.MAX_VALUE,o=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=n&&(n=this._surfaceAtlases[s]._accessScore,o=s);var a=this._surfaceAtlases.splice(o,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(o,1)[0])}return{surfaceAtlases:e,glyphs:i}},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],n=r.addSurface(t);if(n)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=n.x,t.y=n.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},t.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var n=i[r];n.surface=null,n.isSurfaceValid=!1,n._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),
this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();t.SurfaceAtlasSet=o}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t=this._game.audio;for(var e in t)t.hasOwnProperty(e)&&t[e]._reset()},t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){!function(t){t[t.SourceOver=0]="SourceOver",t[t.SourceAtop=1]="SourceAtop",t[t.Lighter=2]="Lighter",t[t.Copy=3]="Copy",t[t.ExperimentalSourceIn=4]="ExperimentalSourceIn",t[t.ExperimentalSourceOut=5]="ExperimentalSourceOut",t[t.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",t[t.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",t[t.DestinationOut=8]="DestinationOut",t[t.DestinationOver=9]="DestinationOver",t[t.Xor=10]="Xor"}(t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o,s,a,h){void 0===r&&(r=i),void 0===n&&(n="black"),void 0===o&&(o=0),void 0===s&&(s="black"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=o,this.strokeColor=s,this.strokeOnly=a}return e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){!function(t){t[t.NonLocal=0]="NonLocal",t[t.FullLocal=1]="FullLocal",t[t.InterpolateLocal=2]="InterpolateLocal"}(t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var n=this._surface.renderer();n.begin(),r||n.clear();var o=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,u=e-this.borderWidth.right,l=this.borderWidth.top,d=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:u,y:0},{x:0,y:d},{x:u,y:d}],_=0;for(_=0;_<p.length;++_){var g=p[_];n.save(),n.translate(f[_].x,f[_].y),n.drawImage(t,g.x,g.y,g.width,g.height,0,0),n.restore()}var y=[{x:o,y:0,width:s-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:s-o,height:this.borderWidth.bottom}],m=[{x:c,y:0,width:u-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:d-l},{x:u,y:l,width:this.borderWidth.right,height:d-l},{x:c,y:d,width:u-c,height:this.borderWidth.bottom}];for(_=0;_<y.length;++_){var v=y[_],T=m[_];n.save(),n.translate(T.x,T.y),n.transform([T.width/v.width,0,0,T.height/v.height,0,0]),n.drawImage(t,v.x,v.y,v.width,v.height,0,0),n.restore()}var A=s-o,x=h-a,w=u-c,S=d-l;return n.save(),n.translate(c,l),n.transform([w/A,0,0,S/x,0,0]),n.drawImage(t,o,a,A,x,0,0),n.restore(),n.end(),this._surface},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){!function(e){function i(i,r){function n(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===r)return i;for(var o=e.splitPath(i),s=n(o.path).concat(n(r)),a=[],h=0;h<s.length;++h){var c=s[h];switch(c){case"..":var u=a.pop();if(void 0===u||""===u||"."===u)throw t.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===a.length&&a.push(".");break;case"":a=[""];break;default:a.push(c)}}return o.host+a.join("/")}function r(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)}function n(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,"/"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var n=t.split("/"),o=n.indexOf("node_modules"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if("node_modules"!==n[h]){var c=n.slice(0,h+1);c.push("node_modules");var u=c.join("/");a.push(r+u)}return a}function s(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)}function a(t){var e="",i=t.indexOf("//");if(i>=0){var r=t.indexOf("/",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t="/")}else e="";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=n,e.makeNodeModulePaths=o,e.addExtname=s,e.splitPath=a}(t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){!function(t){t[t.SansSerif=0]="SansSerif",t[t.Serif=1]="Serif",t[t.Monospace=2]="Monospace"}(t.FontFamily||(t.FontFamily={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Alphabetic=2]="Alphabetic",t[t.Bottom=3]="Bottom"}(e=t.TextBaseline||(t.TextBaseline={}));var r=function(r){function n(i){var n=r.call(this,i)||this;return n.text=i.text,n.fontSize=i.fontSize,n.textAlign="textAlign"in i?i.textAlign:t.TextAlign.Left,n.textBaseline="textBaseline"in i?i.textBaseline:e.Alphabetic,n.maxWidth=i.maxWidth,n.textColor="textColor"in i?i.textColor:"black",n.fontFamily="fontFamily"in i?i.fontFamily:t.FontFamily.SansSerif,n.strokeWidth="strokeWidth"in i?i.strokeWidth:0,n.strokeColor="strokeColor"in i?i.strokeColor:"black",n.strokeOnly="strokeOnly"in i&&i.strokeOnly,n}return i(n,r),n.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},n}(t.E);t.SystemLabel=r}(t||(t={}));var t;!function(t){!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){!function(t){t[t.ByClock=0]="ByClock",t[t.Manual=1]="Manual"}(t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){t=1812433253*(t^t>>30)+1,this._state0U=t,t=1812433253*(t^t>>30)+2,this._state0L=t,t=1812433253*(t^t>>30)+3,this._state1U=t,t=1812433253*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var n=0,o=0,s=0,a=0;n=t<<23|(-512&e)>>>9,o=e<<23,t^=n,e^=o,n=t^i,o=e^r;s=t>>>17,a=e>>>17|(131071&t)<<15,n^=s,o^=a;s=i>>>26,a=r>>>26|(67108863&i)<<6,n^=s,o^=a,this._state1U=n,this._state1L=o;var h=(o>>>0)+(r>>>0);return s=n+i+(h/2>>>31)>>>0,a=h>>>0,[s,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var n=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return n=e.call(this,i)||this,n._xorshift=r?t.Xorshift.deserialize(r):new t.Xorshift(i),n}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.generate=function(){return this._xorshift.random()},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}return t}();t.ShaderProgram=e}(t||(t={})),e.exports=t}).call(this)},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],4:[function(t,e,i){e.exports=t("./lib/index")},{"./lib/index":27}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;for(var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};n>0&&this.running&&!o.interrupt;)--n,this.frameTrigger.fire(o),o.deltaTime=0;return i-=(r-n)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=i,this._waitTime-i},t.prototype._updateWaitTimes=function(e,i){var r=e*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();i.Clock=n},{"@akashic/akashic-engine":1}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(t("@akashic/akashic-pdi"),t("@akashic/akashic-engine")),n=t("./PointEventResolver"),o=function(){function t(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new n.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError("EventBuffer.isEventLocal")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){if(t.isEventLocal(e))return void(this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(e));this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(e),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;return void this._localBuffer.push(e)}this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer.push(e):this._buffer.push(e)),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters){if(!t)return void(this._filters=null);for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1)}},t.prototype.processEvents=function(e){var i=this._unfilteredLocalEvents,r=this._unfilteredEvents;this._unfilteredLocalEvents=[];var n=i;if(!e&&r.length>0&&(n=n.length>0?n.concat(r):r,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var s=this._filters[o];(n.length>0||s.handleEmpty)&&(n=this._filters[o].func(n)||[])}for(var o=0;o<n.length;++o){var a=n[o];t.isEventLocal(a)?this._localBuffer.push(a):0===a[0]||1===a[0]?this._joinLeaveBuffer.push(a):this._buffer.push(a)}},t}();i.EventBuffer=o},{"./PointEventResolver":17,"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t){this._game=t.game,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,n,o,s,a,h,c,u=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(u){case 0:p={id:d,name:t[3]},this._playerTable[d]=p;var f=void 0;if(t[4]){var _=[],g=[];t[4].map(function(t){_.push(t.readKey),g.push(t.values)}),f=new r.StorageValueStore(_,g)}return new r.JoinEvent(p,f,l);case 1:return delete this._playerTable[p.id],new r.LeaveEvent(p,l);case 2:return c=t[3],new r.TimestampEvent(c,p,l);case 32:return h=t[4],new r.MessageEvent(t[3],p,h,l);case 33:return h=t[7],e=t[3],i=t[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new r.PointDownEvent(e,n,o,p,h,l);case 34:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointMoveEvent(e,n,o,a,s,p,h,l);case 35:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointUpEvent(e,n,o,a,s,p,h,l);case 64:h=t[5];var y=t[3],m=t[4],v=this._game._decodeOperationPluginOperation(y,m);return new r.OperationEvent(y,v,p,h,l);default:throw r.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},t.prototype.toPlaylogEvent=function(t,e){var i,n;switch(t.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+r.EventType[t.type]);case r.EventType.Timestamp:var o=t;return n=e?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=t;return i=s.target?s.target.id:null,n=e?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=t;return i=a.target?a.target.id:null,n=e?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var h=t;return i=h.target?h.target.id:null,n=e?h.player.id:this._game.player.id,[35,h.priority,n,h.pointerId,h.point.x,h.point.y,h.startDelta.x,h.startDelta.y,h.prevDelta.x,h.prevDelta.y,i,!!h.local];case r.EventType.Message:var c=t;return n=e?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var u=t;return n=e?u.player.id:this._game.player.id,[64,u.priority,n,u.code,u.data,!!u.local];default:throw r.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?t.priority:0,e,t._code,t.data,!!t.local]},t}();i.EventConverter=n},{"@akashic/akashic-engine":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.Active=0]="Active",t[t.Passive=1]="Passive"}(r||(r={})),i.default=r},{}],10:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e){var i=t.call(this,e.configuration,e.resourceFactory,e.assetBase,e.player.id,e.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.targetTimeReachedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=e.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!e.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._notifiesTargetTimeReached=!1,i._isSkipAware=!1,i._gameArgs=e.gameArgs,i._globalGameArgs=e.globalGameArgs,i.skippingChangedTrigger.add(i._onSkippingChanged,i),i}return r(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError("Game#raiseTick(): tickGenerationMode for the current scene is not Manual.");this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},e.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;if(this._eventFilterFuncs.removeFilter(),null!=e.seed){var i=new n.XorshiftRandomGenerator(e.seed);this._reset({age:t.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,e.randGenSer);this._reset({age:t.frame,randGen:i}),this._loadAndStart({snapshot:e.gameSnapshot})}},e.prototype._leaveGame=function(){},e.prototype._abortGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},e}(n.Game);i.Game=o},{"@akashic/akashic-engine":1}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("es6-promise"),n=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),s=t("./Game"),a=t("./EventBuffer"),h=t("./GameLoop"),c=t("./PdiUtil"),u=function(){function t(t){this.errorTrigger=new n.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=t.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}return t.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},t.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){if(t)return void e(t);r&&i._gameLoop.start(),e()})},t.prototype.startGame=function(){if(!this._gameLoop)return void this.errorTrigger.fire(new Error("Not initialized"));this._gameLoop.start()},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,n=this._platform,o=n.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==o.renderer()}),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(n.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},t.prototype.doInitialize=function(t){var e=this,i=new r.Promise(function(i,r){if(e._gameLoop&&e._gameLoop.running)return r(new Error("Game is running. Must be stopped."));e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),i()}).then(function(){return e._assertLive(),e._doSetDriverConfiguration(t.driverConfiguration)});return t.configurationUrl?i.then(function(){return e._assertLive(),e._loadConfiguration(t.configurationUrl,t.assetBase,t.configurationBase)}).then(function(i){return e._assertLive(),e._createGame(i,e._player,t)}):i},t.prototype.destroy=function(){var t=this;return new r.Promise(function(e,i){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.destroy?t._platform.destroy():t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=null,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,t._destroyed=!0,e()})},t.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return r.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===o.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===o.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)})),i.then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},t.prototype._doCloseAmflow=function(){var t=this;return new r.Promise(function(e,i){if(!t._openedAmflow)return e();t._platform.amflow.close(function(r){t._openedAmflow=!1;var n=t._getCallbackError(r);if(n)return i(n);e()})})},t.prototype._doOpenAmflow=function(t){var e=this;return void 0===t?r.Promise.resolve():this._doCloseAmflow().then(function(){return e._assertLive(),new r.Promise(function(i,r){if(null===t)return i();e._platform.amflow.open(t,function(n){var o=e._getCallbackError(n);if(o)return r(o);e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),i()})})})},t.prototype._doAuthenticate=function(t){var e=this;return null==t?r.Promise.resolve():new r.Promise(function(i,r){e._platform.amflow.authenticate(t,function(n,o){var s=e._getCallbackError(n);if(s)return r(s);e._playToken=t,e._permission=o,e._game&&(e._game.isSnapshotSaver=e._permission.writeTick),i()})})},t.prototype._loadConfiguration=function(t,e,i){var n=this;return new r.Promise(function(r,o){n._loadConfigurationFunc(t,e,i,function(t,e){var i=n._getCallbackError(t);if(i)return o(i);n.configurationLoadedTrigger.fire(e),r(e)})})},t.prototype._putZerothStartPoint=function(t){var e=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,function(t){var n=e._getCallbackError(t);if(n)return r(n);i()})})},t.prototype._getZerothStartPointData=function(){var t=this;return new r.Promise(function(e,i){t._platform.amflow.getStartPoint({frame:0},function(r,n){var o=t._getCallbackError(r);if(o)return i(o);var s=n.data;if("number"!=typeof s.seed)return i(new Error("GameDriver#_getRandomSeed: No seed found."));e(s)})})},t.prototype._createGame=function(t,e,i){var c,u=this,l=i.driverConfiguration.executionMode===o.default.Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:t.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return u._assertLive(),u._getZerothStartPointData()}),c.then(function(r){u._assertLive();var c=u._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o.default.Active},d=r.seed,p=i.gameArgs,f=r.globalArgs,_=r.startedAt,g={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(g);var y=new s.Game({configuration:t,player:e,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:p,globalGameArgs:f}),m=new a.EventBuffer({game:y,amflow:c.amflow});m.setMode(l.eventBufferMode),c.setPlatformEventHandler(m),y.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),y.renderers.push(c.getPrimarySurface().renderer());var v=new h.GameLoop({game:y,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:m,configuration:i.loopConfiguration,startedAt:_,profiler:i.profiler});v.rawTargetTimeReachedTrigger.add(y._onRawTargetTimeReached,y),y.setCurrentTimeFunc(v.getCurrentTime.bind(v)),y._reset({age:0,randGen:new n.XorshiftRandomGenerator(d)}),u._updateGamePlayId(y),u._hidden&&y._setMuted(!0),y.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){var e=u._getCallbackError(t);e&&u.errorTrigger.fire(e)})}),u._game=y,u._eventBuffer=m,u._gameLoop=v,u._rendererRequirement=g,u.gameCreatedTrigger.fire(y),u._game._loadAndStart({args:i.gameArgs||void 0})})},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},t.prototype._assertLive=function(){if(this._destroyed)throw new Error("GAME_DESTROYED")},t.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error("GAME_DESTROYED"):null)},t}();i.GameDriver=u},{"./EventBuffer":6,"./ExecutionMode":9,"./Game":10,"./GameLoop":12,"./PdiUtil":16,"@akashic/akashic-engine":1,"es6-promise":83}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})
;var r=t("@akashic/akashic-engine"),n=t("./constants"),o=t("./LoopMode"),s=t("./LoopRenderMode"),a=t("./ExecutionMode"),h=t("./Clock"),c=t("./ProfilerClock"),u=t("./EventConverter"),l=t("./TickController"),d=function(){function t(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:s.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new c.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new h.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new l.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new u.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},t.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:r.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var n=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,n&&this._handleSceneChange()},t.prototype._onFrame=function(t){if(this._loopMode===o.default.Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),i=e+this._realTargetTimeOffset,r=this._currentTime;this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var i=!1,n=this._game,o=t-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),s<=0)return void(this._skipping&&this._stopSkipping());this._skipping||(s>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var a=0;a<this._skipTicksAtOnce;++a){var h=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),t>h&&this._doLocalTick());break}var c=this._tickBuffer.readNextTickTime();if(null==c&&(c=h),t<h){if(!(c<=t))break;h=t}else if(h<c){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=c){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}h=c,this._omittedTickDuration+=c-this._currentTime}this._currentTime=h;var u=this._tickBuffer.consume(),l=-1,d=this._eventBuffer.readLocalEvents();if(d)for(var p=0,f=d.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(d[p]));if("number"==typeof u)l=u,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{l=u[0];var _=u[1];if(_)for(var p=0,f=_.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(_[p]));i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[l]&&n.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()},t.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var n,s,a=this._tickBuffer.currentAge;if(this._loopMode===o.default.Realtime?(n=this._tickBuffer.knownLatestAge+1,s=n-a):null===this._targetAge?(n=null,s=1):this._targetAge===a?(n=this._targetAge=null,s=1):(n=this._targetAge,s=n-a),(s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=n,this._amflow.getStartPoint({frame:n},this._onGotStartPoint_bound)),s<=0)return 0===s&&(0===a&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var h=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;c<h;++c){var u=this._currentTime+this._frameTime,l=this._tickBuffer.readNextTickTime();if(null!=l&&u<l){if(!(this._loopMode===o.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}u=Math.ceil(l/this._frameTime)*this._frameTime,this._omittedTickDuration+=u-this._currentTime}this._currentTime=u;var d=this._tickBuffer.consume(),p=-1;if(null==d){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,g=f.length;_<g;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if("number"==typeof d)p=d,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{p=d[0];var y=d[1];if(y)for(var m=0,g=y.length;m<g;++m)i.events.push(this._eventConverter.toGameEvent(y[m]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[p]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&n-this._tickBuffer.currentAge<1&&this._stopSkipping()},t.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==o.default.FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)return void this.errorTrigger.fire(t);if(this._targetTimeFunc&&this._loopMode!==o.default.Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(r<=i&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===o.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var s=this._tickBuffer.currentAge;if(s<=n&&e.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===r.LocalTickMode.FullLocal)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case s.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case s.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+t))}},t.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&t.scenes.length>0&&t.render()},t.prototype._onGameRaiseEvent=function(t){var e=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===a.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},t.prototype._onGameOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t}();i.GameLoop=d},{"./Clock":5,"./EventConverter":7,"./ExecutionMode":9,"./LoopMode":14,"./LoopRenderMode":15,"./ProfilerClock":18,"./TickController":21,"./constants":26,"@akashic/akashic-engine":1}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t,e,i,r){this.joinResolver=e,this.pev=t,0===t[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return t.prototype._onGotStorageData=function(t,e){if(this.resolved=!0,t)return void this.joinResolver.errorTrigger.fire(t);this.pev[4]=e},t}();i.JoinLeaveRequest=n;var o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}return t.prototype.request=function(t){this._requested.push(new n(t,this,this._amflow,this._keysForJoin))},t.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},t.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t}();i.JoinResolver=o},{"@akashic/akashic-engine":1}],14:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.Realtime=0]="Realtime",t[t.Replay=1]="Replay",t[t.FrameByFrame=2]="FrameByFrame"}(r||(r={})),i.default=r},{}],15:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.AfterRawFrame=0]="AfterRawFrame",t[t.None=1]="None"}(r||(r={})),i.default=r},{}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("es6-promise"),n=t("@akashic/akashic-engine");!function(t){function e(e){function i(i,s,a,h){e.loadGameConfiguration(i,function(e,c){if(e)return void h(e,null);try{c=t._resolveConfigurationBasePath(c,null!=s?s:n.PathUtil.resolveDirname(i))}catch(t){return void h(t,null)}if(!c.definitions)return void h(null,c);var u=c.definitions.map(function(t){if("string"==typeof t){var e=null!=a?n.PathUtil.resolvePath(a,t):t;return o(e,void 0,a)}var e=null!=a?n.PathUtil.resolvePath(a,t.url):t.url;return o(e,t.basePath,a)});r.Promise.all(u).then(function(e){return h(null,e.reduce(t._mergeGameConfiguration))}).catch(function(t){return h(t,null)})})}function o(t,e,n){return new r.Promise(function(r,o){i(t,e,n,function(t,e){t?o(t):r(e)})})}return i}function i(t,e){function i(t,e){var i=n.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw n.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: invalid path: "+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&"path"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw n.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: asset ID already exists: "+t);r[t]={type:/\.json$/i.test(t)?"text":"script",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t}function o(e,i){for(var r=Object.keys(i),n=0,o=r.length;n<o;++n){var s=r[n],a=i[s];if(typeof a===typeof e[s])switch(typeof a){case"string":case"number":case"boolean":e[s]=a;break;case"object":null==a?e[s]=a:Array.isArray(a)?e[s]=e[s].concat(a):t._mergeObject(e[s],a);break;default:throw new Error("PdiUtil._mergeObject(): unknown type")}else e[s]=a}return e}function s(e,i){return t._mergeObject(e,i)}t.makeLoadConfigurationFunc=e,t._resolveConfigurationBasePath=i,t._mergeObject=o,t._mergeGameConfiguration=s}(i.PdiUtil||(i.PdiUtil={}))},{"@akashic/akashic-engine":1,"es6-promise":83}],17:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._game=t.game,this._pointEventMap={}}return t.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point?i.point:t.offset,n=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:n,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var o=[33,2,e.id,t.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},t.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n);var o=[34,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n),delete this._pointEventMap[t.identifier];var o=[35,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();i.PointEventResolver=r},{}],18:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Clock"),o=function(t){function e(e){var i=t.call(this,e)||this;return i._profiler=e.profiler,i}return r(e,t),e.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;this._profiler.timeEnd(1),this._profiler.time(1);var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,n-1);n>0&&this.running&&!o.interrupt;)--n,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return i-=(r-n)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush(),this._waitTime-i},e}(n.Clock);i.ProfilerClock=o},{"./Clock":5}],19:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./ExecutionMode"),o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return t.prototype.setExecutionMode=function(t){if(this._executionMode!==t){this._executionMode=t;var e=this._tickBuffer,i=this._tickGenerator;t===n.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this))}},t.prototype._onGotStorageOnTick=function(t){var e=t.age,i=t.storageData,r=this._unresolvedLoaders[e];if(!r)return void(this._unresolvedStorages[e]=i);delete this._unresolvedLoaders[e];var n=e,o=i.map(function(t){return t.values});r._onLoaded(o,n)},t.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=e);delete this._unresolvedStorages[r];var s=r,a=o.map(function(t){return t.values});e._onLoaded(a,s)},t.prototype._putStorage=function(t,e,i){this._executionMode===n.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},t.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},t.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},t}();i.StorageResolver=o},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],20:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./ExecutionMode"),o=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var i=e.ticks[0];if(i[0]!==t)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0]){var o=r[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===n.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},t.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(e>=n.start)break}var o=this._tickRanges[r+1];if(r<0)this._tickRanges.unshift(this._createTickRangeFromTick(t));else{var n=this._tickRanges[r];e===n.end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t))}this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],n=e,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var c=s;if(s>0){--s;var u=this._tickRanges[s].end;e<u&&(e=u)}for(;s<a;++s){var h=this._tickRanges[s];if(i<=h.end)break}if(s<a){var l=this._tickRanges[s].start;i>l&&(i=l)}if(e>=i)return{start:e,end:e,ticks:[]};r||(r=[]),n===e&&o===i||(r=r.filter(function(t){var r=t[0];return e<=r&&r<i}));for(var d=0;d<r.length;++d){var p=r[d];p[2]&&this.gotStorageTrigger.fire({age:p[0],storageData:p[2]})}var f={start:e,end:i,ticks:r},_=Math.max(0,s-c);return this._tickRanges.splice(c,_,f),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),f},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw new Error;if(!e)return void this.gotNoTickTrigger.fire();var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(e);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire(),r.ticks.length||this.gotNoTickTrigger.fire()},t.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},t.prototype._createTickRangeFromTick=function(t){var e=t[0],i={start:e,end:e+1,ticks:[]};return t[1]&&i.ticks.push(t),i},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();i.TickBuffer=o},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./ExecutionMode"),o=t("./TickBuffer"),s=t("./TickGenerator"),a=t("./StorageResolver"),h=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===n.default.Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();i.TickController=h},{"./ExecutionMode":9,"./StorageResolver":19,"./TickBuffer":20,"./TickGenerator":22,"@akashic/akashic-engine":1}],22:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./JoinResolver"),o=function(){function t(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,
this._eventBuffer=t.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return t.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},t.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage."));var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){if(this._waitingStorage)return void this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage."));this._nextAge=t},t.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError("TickGenerator#requestStorageTick(): Unsupported: multiple storage request");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},t.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},t.prototype._onGotStorageData=function(t,e){if(this._waitingStorage=!1,t)return void this.errorTrigger.fire(t);this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e})},t}();i.TickGenerator=o},{"./JoinResolver":13,"@akashic/akashic-engine":1}],23:[function(t,e,i){"use strict";function r(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(r):Object.keys(t).reduce(function(e,i){return e[i]=r(t[i]),e},{}):t}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var i=this;setTimeout(function(){if(t!==i._playId)return void e(new Error("MemoryAmflowClient#open: unknown playId"));e(null)},0)},t.prototype.close=function(t){setTimeout(function(){t(null)},0)},t.prototype.authenticate=function(e,i){setTimeout(function(){switch(e){case t.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},t.prototype.sendTick=function(t){if(t=r(t),this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];(t[1]||t[2])&&this._tickList[2].push(t),this._tickHandlers.forEach(function(e){return e(t)})},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter(function(e){return e!==t})},t.prototype.sendEvent=function(t){if(t=r(t),0===this._eventHandlers.length)return void this._events.push(t);this._eventHandlers.forEach(function(e){return e(t)})},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach(function(t){e._eventHandlers.forEach(function(e){return e(t)})}),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter(function(e){return e!==t})},t.prototype.getTickList=function(t,e,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);t=Math.max(t,this._tickList[0]),e=Math.min(e,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return t<=r&&r<=e}),n=[t,e,r];setTimeout(function(){return i(null,n)},0)},t.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},t.prototype.getStartPoint=function(t,e){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void e(new Error("no startpoint"));var r=0;if(null!=t.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var h=i._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},t.prototype.getStorageData=function(t,e){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(t);e(null,r)}catch(t){e(t)}},0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return e<=r&&r<=t-1}),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.TOKEN_ACTIVE="mamfc-token:active",t.TOKEN_PASSIVE="mamfc-token:passive",t}();i.MemoryAmflowClient=n,i._cloneDeep=r},{}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1],r=this._tickList[2];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(r,i,t-1),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(t,e,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=n<=t&&t<=o,h=n<=e&&e<=o;a&&h?setTimeout(function(){i(null,[t,e,r._sliceTicks(s,t,e)])},0):this._amflow.getTickList(t,e,function(c,u){if(c)return void i(c);if(u)if(a||h)if(a){var l=r._sliceTicks(s,t,e).concat(u[2]||[]);i(null,[t,u[1],l])}else{var l=(u[2]||[]).concat(r._sliceTicks(s,t,e));i(null,[u[0],e,l])}else if(e<n||o<t)i(null,u);else{var l=u[2];if(l){var d=r._sliceTicks(l,t,n-1),p=r._sliceTicks(l,o+1,e);l=d.concat(s,p)}else l=s;i(null,[t,e,l])}else a||h?a?i(null,[t,o,r._sliceTicks(s,t,e)]):i(null,[n,e,r._sliceTicks(s,t,e)]):e<n||o<t?i(null,u):i(null,[n,o,r._sliceTicks(s,t,e)])})},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var i=this,r=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,n){if(t)return void e(t);c<n.frame?e(null,n):e(null,i._startPoints[r])}):setTimeout(function(){e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){var r=t[0];return e<=r&&r<=i})},t}();i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(e){this._interval=null!=e.interval?e.interval:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(0<n&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;o<h&&(o=h),h<s&&(s=h),r+=h,++n}return{ave:r/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();i.SimpleProfiler=n},{"@akashic/akashic-engine":1}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}(t("./constants"));var r=t("./EventIndex");i.EventIndex=r;var n=t("./LoopMode");i.LoopMode=n.default;var o=t("./LoopRenderMode");i.LoopRenderMode=o.default;var s=t("./ExecutionMode");i.ExecutionMode=s.default;var a=t("./GameDriver");i.GameDriver=a.GameDriver;var h=t("./Game");i.Game=h.Game;var c=t("./auxiliary/ReplayAmflowProxy");i.ReplayAmflowProxy=c.ReplayAmflowProxy;var u=t("./auxiliary/MemoryAmflowClient");i.MemoryAmflowClient=u.MemoryAmflowClient;var l=t("./auxiliary/SimpleProfiler");i.SimpleProfiler=l.SimpleProfiler},{"./EventIndex":8,"./ExecutionMode":9,"./Game":10,"./GameDriver":11,"./LoopMode":14,"./LoopRenderMode":15,"./auxiliary/MemoryAmflowClient":23,"./auxiliary/ReplayAmflowProxy":24,"./auxiliary/SimpleProfiler":25,"./constants":26}],28:[function(t,e,i){e.exports=t("./lib/full/index")},{"./lib/full/index":63}],29:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();i.AudioManager=r},{}],30:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./InputHandlerLayer"),o=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new n.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();i.ContainerController=o},{"./InputHandlerLayer":31,"@akashic/akashic-engine":1}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./handler/TouchHandler"),o=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new n.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e="position:relative; left:"+t.x+"px; top:"+t.y+"px";this._inputHandler.inputView.setAttribute("style",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},t.prototype._createInputView=function(t,e){var i=document.createElement("div");return i.setAttribute("tabindex","1"),i.className="input-handler",i.setAttribute("style","display:inline-block; outline:none;"),i.style.width=t+"px",i.style.height=e+"px",i},t}();i.InputHandlerLayer=o},{"./handler/TouchHandler":62,"@akashic/akashic-engine":1}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./RafLooper"),n=t("./ResourceFactory"),o=t("./ContainerController"),s=t("./plugin/AudioPluginManager"),a=t("./AudioManager"),h=t("./plugin/AudioPluginRegistry"),c=t("./asset/XHRTextAsset"),u=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new n.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new o.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new c.XHRTextAsset("(game.json)",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new r.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},t.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},t}();i.Platform=u},{"./AudioManager":29,"./ContainerController":30,"./RafLooper":33,"./ResourceFactory":34,"./asset/XHRTextAsset":39,"./plugin/AudioPluginManager":64,"./plugin/AudioPluginRegistry":65}],33:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)},i=function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i};this._timerId=requestAnimationFrame(i)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();i.RafLooper=r},{}],34:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./asset/HTMLImageAsset"),s=t("./asset/HTMLVideoAsset"),a=t("./asset/XHRTextAsset"),h=t("./asset/XHRScriptAsset"),c=t("./canvas/GlyphFactory"),u=t("./canvas/shims/SurfaceFactory"),l=function(t){function e(e){var i=t.call(this)||this;return i._audioPluginManager=e.audioPluginManager,i._audioManager=e.audioManager,i._platform=e.platform,i._surfaceFactory=new u.SurfaceFactory,i}return r(e,t),e.prototype.createAudioAsset=function(t,e,i,r,n,o){var s=this._audioPluginManager.getActivePlugin(),a=s.createAsset(t,e,i,r,n,o);return a.onDestroyed&&(this._audioManager.registerAudioAsset(a),a.onDestroyed.add(this._onAudioAssetDestroyed,this)),a},e.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},e.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},e.prototype.createVideoAsset=function(t,e,i,r,n,o,a){return new s.HTMLVideoAsset(t,e,i,r,n,o,a)},e.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new h.XHRScriptAsset(t,e)},e.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},e.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,i,r,n,o,s,a){return new c.GlyphFactory(t,e,i,r,n,o,s,a)},e.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},e}(n.ResourceFactory);i.ResourceFactory=l},{"./asset/HTMLImageAsset":35,"./asset/HTMLVideoAsset":36,"./asset/XHRScriptAsset":38,"./asset/XHRTextAsset":39,"./canvas/GlyphFactory":42,"./canvas/shims/SurfaceFactory":48,"@akashic/akashic-engine":1}],35:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError("ImageAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);i.ImageAssetSurface=o;var s=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o.data=void 0,o._surface=void 0,o}return r(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw n.ExceptionFactory.createAssertionError("ImageAssetImpl#asSurface: not yet loaded.");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(n.ImageAsset);i.HTMLImageAsset=s},{"@akashic/akashic-engine":1}],36:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./HTMLVideoPlayer"),s=function(t){function e(e,i,r){return t.call(this,e,i,r,!0)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError("VideoAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),a=function(t){function e(e,i,r,n,a,h,c){var u=t.call(this,e,i,r,n,a,h,c)||this;return u._player=new o.HTMLVideoPlayer,u._surface=new s(r,n,null),u}return r(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(n.VideoAsset);i.HTMLVideoAsset=a},{"./HTMLVideoPlayer":37,"@akashic/akashic-engine":1}],37:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.isDummy=!0,i}return r(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(n.VideoPlayer);i.HTMLVideoPlayer=o},{"@akashic/akashic-engine":1}],38:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("../utils/XHRLoader"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.script=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.script=r+"\n",t._onAssetLoad(e)})},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype._wrap=function(){return new Function("g",e.PRE_SCRIPT+this.script+e.POST_SCRIPT)},e.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",e.POST_SCRIPT="\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",e}(n.ScriptAsset);i.XHRScriptAsset=s},{"../utils/XHRLoader":82,"@akashic/akashic-engine":1}],39:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("../utils/XHRLoader"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.data=r,t._onAssetLoad(e)})},e}(n.TextAsset);i.XHRTextAsset=s},{"../utils/XHRLoader":82,"@akashic/akashic-engine":1}],40:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();i.AffineTransformer=r},{}],41:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e,i){var r=this,n=document.createElement("canvas");return r=t.call(this,e,i,n)||this,n.width=e,n.height=i,r.canvas=n,r._renderer=void 0,r}return r(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},e}(n.Surface);i.CanvasSurface=o},{"@akashic/akashic-engine":1}],42:[function(t,e,i){"use strict";function r(t,e,i,r,n,o,s,a,h,c,d,f){var _=e<p._environmentMinimumFontSize?e/p._environmentMinimumFontSize:1,g=Math.ceil((e+2*n)*_),y=Math.ceil((e+2*o)*_),m=new l.Context2DSurface(g,y),v=m.canvas,T=v.getContext("2d"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),x=f===u.FontWeight.Bold?"bold ":"";T.save(),T.font=x+e+"px "+i,T.textAlign="left",T.textBaseline="alphabetic",T.lineJoin="bevel",1!==_&&T.scale(_,_),h>0&&(T.lineWidth=h,T.strokeStyle=c,T.strokeText(A,n,o+r)),d||(T.fillStyle=a,T.fillText(A,n,o+r));var w=T.measureText(A).width;return T.restore(),{surface:m,advanceWidth:w,imageData:s?T.getImageData(0,0,v.width,v.height):void 0}}function n(t){for(var e=t.width,i=t.height,r=0,n=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0){var u=t.data[o+3];0!==u&&(h<e&&(e=h),h>r&&(r=h),s<i&&(i=s),s>n&&(n=s)),o+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:n-i+1}}function o(t){return 0===t.width||0===t.height}function s(t){switch(t){case u.FontFamily.Monospace:return"monospace";case u.FontFamily.Serif:return"serif";default:return"sans-serif"}}function a(t){return-1!==d.indexOf(t)?t:'"'+t+'"'}function h(t){return"number"==typeof t?s(t):"string"==typeof t?a(t):t.map(function(t){return"string"==typeof t?a(t):s(t)}).join(",")}var c=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{
__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var u=t("@akashic/akashic-engine"),l=t("./context2d/Context2DSurface"),d=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],p=function(t){function e(i,r,n,o,a,c,l,d){var p=t.call(this,i,r,n,o,a,c,l,d)||this;p._glyphAreas={},p._cssFontFamily=h(i);var f=s(u.FontFamily.SansSerif);return-1===p._cssFontFamily.indexOf(f)&&(p._cssFontFamily+=","+f),p._marginW=Math.ceil(.3*p.fontSize+p.strokeWidth/2),p._marginH=Math.ceil(.3*p.fontSize+p.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=p.measureMinimumFontSize()),p}return c(e,t),e.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),i=n(e.imageData),i.advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),o(i)?(e&&e.surface.destroy(),new u.Glyph(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new u.Glyph(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e=document.createElement("canvas"),i=e.getContext("2d");i.textAlign="left",i.textBaseline="alphabetic",i.lineJoin="bevel";var r;i.font=t+"px sans-serif";var n=i.measureText("M").width;do{r=n,t+=1,i.font=t+"px sans-serif",n=i.measureText("M").width}while(r===n||t>50);return t},e}(u.GlyphFactory);i.GlyphFactory=p},{"./context2d/Context2DSurface":47,"@akashic/akashic-engine":1}],43:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});!function(t){function e(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t}function i(t){return Math.min(Math.max(t,0),1)}function r(t){var e=!1;return t&&0<t.length&&(e="webgl"===t[0]),e}t.toPowerOfTwo=e,t.clamp=i,t.usedWebGL=r}(i.RenderingHelper||(i.RenderingHelper={}))},{}],44:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("../AffineTransformer"),n=function(){function t(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer)}return t}();i.CanvasRenderingState=n},{"../AffineTransformer":40}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./CanvasRenderingState"),n=function(){function t(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;var e=new r.CanvasRenderingState;this._currentFillStyle=e.fillStyle,this._currentGlobalAlpha=e.globalAlpha,this._currentGlobalCompositeOperation=e.globalCompositeOperation,this.pushState(e)}return Object.defineProperty(t.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!0,configurable:!0}),t.prototype.getCanvasRenderingContext2D=function(){return this._context},t.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},t.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},t.prototype.restore=function(){this.popState()},t.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},t.prototype.drawImage=function(t,e,i,r,n,o,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,n,o,s,a,h)},t.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},t.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},t.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},t.prototype.transform=function(t,e,i,r,n,o){this.currentState().transformer.transform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setTransform=function(t,e,i,r,n,o){this.currentState().transformer.setTransform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},t.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,n,o,s){this._context.putImageData(t,e,i,r,n,o,s)},t.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._currentFillStyle&&(this._context.fillStyle=t.fillStyle,this._currentFillStyle=t.fillStyle),t.globalAlpha!==this._currentGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._currentGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._currentGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._currentGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},t.prototype.pushState=function(t){this._stateStack.push(t)},t.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0)},t.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},t}();i.CanvasSurfaceContext=n},{"./CanvasRenderingState":44}],46:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e){var i=t.call(this)||this;return i.surface=e,i.context=e.context(),i.canvasRenderingContext2D=i.context.getCanvasRenderingContext2D(),i}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),t.prototype.end.call(this)},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,i,r,n,o,s){this.context.drawImage(t._drawable,e,i,r,n,o,s,r,n)},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawSystemText=function(t,e,i,r,o,s,a,h,c,u,l,d){var p,f,_,g=this.canvasRenderingContext2D;switch(this.context.prerender(),g.save(),c){case n.FontFamily.Monospace:p="monospace";break;case n.FontFamily.Serif:p="serif";break;default:p="sans-serif"}switch(g.font=o+"px "+p,s){case n.TextAlign.Right:f="right";break;case n.TextAlign.Center:f="center";break;default:f="left"}switch(g.textAlign=f,a){case n.TextBaseline.Top:_="top";break;case n.TextBaseline.Middle:_="middle";break;case n.TextBaseline.Bottom:_="bottom";break;default:_="alphabetic"}g.textBaseline=_,g.lineJoin="bevel",u>0&&(g.lineWidth=u,g.strokeStyle=l,void 0===r?g.strokeText(t,e,i):g.strokeText(t,e,i,r)),d||(g.fillStyle=h,g.fillText(t,e,i,r)),g.restore()},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,i,r,n){this.context.fillStyle=n,this.context.fillRect(t,e,i,r)},e.prototype.setCompositeOperation=function(t){var e;switch(t){case n.CompositeOperation.SourceAtop:e="source-atop";break;case n.CompositeOperation.Lighter:e="lighter";break;case n.CompositeOperation.Copy:e="copy";break;case n.CompositeOperation.ExperimentalSourceIn:e="source-in";break;case n.CompositeOperation.ExperimentalSourceOut:e="source-out";break;case n.CompositeOperation.ExperimentalDestinationAtop:e="destination-atop";break;case n.CompositeOperation.ExperimentalDestinationIn:e="destination-in";break;case n.CompositeOperation.DestinationOut:e="destination-out";break;case n.CompositeOperation.DestinationOver:e="destination-over";break;case n.CompositeOperation.Xor:e="xor";break;default:e="source-over"}this.context.globalCompositeOperation=e},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw n.ExceptionFactory.createAssertionError("Context2DRenderer#setShaderProgram() is not implemented")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},e.prototype._putImageData=function(t,e,i,r,n,o,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,n,o,s)},e}(n.Renderer);i.Context2DRenderer=o},{"@akashic/akashic-engine":1}],47:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Context2DRenderer"),o=t("./CanvasSurfaceContext"),s=t("../CanvasSurface"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.context=function(){return this._context||(this._context=new o.CanvasSurfaceContext(this.canvas.getContext("2d"))),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(s.CanvasSurface);i.Context2DSurface=a},{"../CanvasSurface":41,"./CanvasSurfaceContext":45,"./Context2DRenderer":46}],48:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("../RenderingHelper"),n=t("../context2d/Context2DSurface"),o=t("../webgl/WebGLSharedObject"),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new o.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new n.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new n.Context2DSurface(t,e)},t}();i.SurfaceFactory=s},{"../RenderingHelper":43,"../context2d/Context2DSurface":47,"../webgl/WebGLSharedObject":57}],49:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./WebGLBackSurfaceRenderer"),o=t("./WebGLPrimarySurface"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(o.WebGLPrimarySurface);i.WebGLBackSurface=s},{"./WebGLBackSurfaceRenderer":50,"./WebGLPrimarySurface":52}],50:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./WebGLRenderer"),o=t("./WebGLRenderingState"),s=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new o.WebGLRenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);i.WebGLBackSurfaceRenderer=s},{"./WebGLRenderer":54,"./WebGLRenderingState":55}],51:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("../RenderingHelper");!function(t){function e(e){var i="string"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=r.RenderingHelper.clamp(i[3]),i[0]=r.RenderingHelper.clamp(i[0])*i[3],i[1]=r.RenderingHelper.clamp(i[1])*i[3],i[2]=r.RenderingHelper.clamp(i[2])*i[3],i}function i(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],n=t[3],o=r+r*i,s=r-r*i;return e<60?[o,e/60*(o-s)+s,s,n]:e<120?[(120-e)/60*(o-s)+s,o,s,n]:e<180?[s,o,(e-120)/60*(o-s)+s,n]:e<240?[s,(240-e)/60*(o-s)+s,o,n]:e<300?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]}function n(e){var i=e.toUpperCase().replace(/\s+/g,""),n=t.colorMap[i];if(n)return n;if(i.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+i)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=i,t._toColor=n}(i.WebGLColor||(i.WebGLColor={}))},{"../RenderingHelper":43}],52:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("../CanvasSurface"),o=t("./WebGLPrimarySurfaceRenderer"),s=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.canvas.style.position="absolute",n._shared=e,n}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);i.WebGLPrimarySurface=s},{"../CanvasSurface":41,"./WebGLPrimarySurfaceRenderer":53}],53:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./WebGLRenderer"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(n.WebGLRenderer);i.WebGLPrimarySurfaceRenderer=o},{"./WebGLRenderer":54}],54:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./WebGLColor"),s=t("./WebGLRenderingState"),a=function(t){function e(i,r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(e.DEFAULT_CAPACITY),n._whiteColor=[1,1,1,1],n._shared=i,n._renderTarget=r,n}return r(e,t),e.prototype.clear=function(){this._shared.clear()},e.prototype.end=function(){this._shared.end()},e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.fillRect=function(t,e,i,r,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,o.WebGLColor.get(n))},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawImage=function(t,e,i,r,o,s,a){if(!t._drawable)throw n.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw n.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,s,a,this._whiteColor)},e.prototype.drawSystemText=function(t,e,i,r,n,o,s,a,h,c,u,l){},e.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},e.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},e.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},e.prototype.isSupportedShaderProgram=function(){return!0},e.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},e.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},e.prototype._getImageData=function(){throw n.ExceptionFactory.createAssertionError("WebGLRenderer#_getImageData() is not implemented")},e.prototype._putImageData=function(t,e,i,r,o,s,a){throw n.ExceptionFactory.createAssertionError("WebGLRenderer#_putImageData() is not implemented")},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw n.ExceptionFactory.createAssertionError("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new s.WebGLRenderingState)}},e.DEFAULT_CAPACITY=16,e}(n.Renderer);i.WebGLRenderer=a},{"./WebGLColor":51,"./WebGLRenderingState":55,"@akashic/akashic-engine":1}],55:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("../AffineTransformer"),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new n.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();i.WebGLRenderingState=o},{"../AffineTransformer":40,"@akashic/akashic-engine":1}],56:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(e,i,r){var n=t._DEFAULT_VERTEX_SHADER,i=i||t._DEFAULT_FRAGMENT_SHADER,o=t._makeShaderProgram(e,n,i);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,"aVertex"),this._uColor=e.getUniformLocation(this.program,"uColor"),this._uAlpha=e.getUniformLocation(this.program,"uAlpha"),this._uSampler=e.getUniformLocation(this.program,"uSampler"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(n)}return r},t._makeShaderProgram=function(e,i,r){var n=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(a)}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach(function(n){var o=i[n].type,s=Array.isArray(i[n].value);!s||"int"!==o&&"float"!==o||(o+="_v");var a=t._uniformSetterTable[o];if(!a)throw r.ExceptionFactory.createAssertionError("WebGLShaderProgram#initializeUniforms: Uniform type '"+o+"' is not supported.");e.push({name:n,update:a,beforeValue:null,isArray:s,loc:t._context.getUniformLocation(t.program,n)})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",
t._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",t}();i.WebGLShaderProgram=n},{"@akashic/akashic-engine":1}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./WebGLShaderProgram"),o=t("./WebGLTextureAtlas"),s=t("./WebGLPrimarySurface"),a=t("./WebGLBackSurface"),h=function(){function t(t,e){var i=new s.WebGLPrimarySurface(this,t,e),n=i.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw r.ExceptionFactory.createAssertionError("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=i,this._context=n,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,n,o,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit();var c;if(c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var u=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(u[0],u[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+n),g=d*(f+r+o),y=l*(p+i),m=d*(f+r);this._register(this._transformVertex(s,a,n,o,t.transformer),[y,m,_,m,_,g,y,m,_,g,y,g])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw r.ExceptionFactory.createAssertionError("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),t instanceof HTMLImageElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof ImageData&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:n}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t,e=new n.WebGLShaderProgram(this._context);this._textureAtlas=new o.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=r.CompositeOperation.SourceOver,this._currentShaderProgram=e,this._defaultShaderProgram=e,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=(t={},t[r.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[r.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[r.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[r.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[r.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);var i=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(i[0],i[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,c=s*i*h[0],u=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,c+p,u+f,c+l+p,u+d+f,p,f,c+l+p,u+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();i.WebGLSharedObject=h},{"./WebGLBackSurface":49,"./WebGLPrimarySurface":52,"./WebGLShaderProgram":56,"./WebGLTextureAtlas":58,"@akashic/akashic-engine":1}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./WebGLTextureMap"),n=t("../RenderingHelper"),o=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var r=i._drawable;if(r&&!r.texture){var o=r.width,s=r.height;if(o>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=n.RenderingHelper.toPowerOfTwo(r.width),h=n.RenderingHelper.toPowerOfTwo(r.height);if(a!==r.width||h!==r.height){var c=document.createElement("canvas");c.width=a,c.height=h;var u=c.getContext("2d");u.globalCompositeOperation="copy",u.drawImage(r,0,0),r=u.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(r),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,n){for(var o,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(e,o,i._drawable),void(this._insertPos=s);o=null,n.length>=t.TEXTURE_COUNT&&(o=n.shift(),e.disposeTexture(o.texture),o.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new r.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(e,o,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();i.WebGLTextureAtlas=o},{"../RenderingHelper":43,"./WebGLTextureMap":59}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t,e,i,r,n){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,n=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<n)return null;var a=this._width-r,h=this._height-n;return a<=h?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();i.WebGLTextureMap=r},{}],60:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=(t("@akashic/akashic-pdi"),function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error("This method is abstract")},t.prototype.stop=function(){throw new Error("This method is abstract")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},t}());i.InputAbstractHandler=n},{"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],61:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./InputAbstractHandler"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onMouseDown=function(t){0===t.button&&(r.pointDown(1,r.getOffsetPositionFromInputView(t)),window.addEventListener("mousemove",r.onMouseMove,!1),window.addEventListener("mouseup",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){r.pointMove(1,r.getOffsetPositionFromInputView(t)),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r.onMouseUp=function(t){r.pointUp(1,r.getOffsetPositionFromInputView(t)),window.removeEventListener("mousemove",r.onMouseMove,!1),window.removeEventListener("mouseup",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r}return r(e,t),e.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1)},e}(n.InputAbstractHandler);i.MouseHandler=o},{"./InputAbstractHandler":60}],62:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./MouseHandler"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointDown(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointMove(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointUp(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return r(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener("touchstart",this.onTouchDown),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener("touchstart",this.onTouchDown),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchUp)},e}(n.MouseHandler);i.TouchHandler=o},{"./MouseHandler":61}],63:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Platform");i.Platform=r.Platform;var n=t("./ResourceFactory");i.ResourceFactory=n.ResourceFactory;var o=t("@akashic/akashic-engine");i.g=o;var s=t("./plugin/AudioPluginRegistry");i.AudioPluginRegistry=s.AudioPluginRegistry;var a=t("./plugin/AudioPluginManager");i.AudioPluginManager=a.AudioPluginManager;var h=t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin");i.HTMLAudioPlugin=h.HTMLAudioPlugin;var c=t("./plugin/WebAudioPlugin/WebAudioPlugin");i.WebAudioPlugin=c.WebAudioPlugin;var u=t("./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin");i.PostMessageAudioPlugin=u.PostMessageAudioPlugin;var l=t("./plugin/ProxyAudioPlugin/ProxyAudioPlugin");i.ProxyAudioPlugin=l.ProxyAudioPlugin},{"./Platform":32,"./ResourceFactory":34,"./plugin/AudioPluginManager":64,"./plugin/AudioPluginRegistry":65,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":69,"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin":72,"./plugin/ProxyAudioPlugin/ProxyAudioPlugin":76,"./plugin/WebAudioPlugin/WebAudioPlugin":81,"@akashic/akashic-engine":1}],64:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;var n=r;if(n.isSupported())return this._activePlugin=new n,!0}return!1},t}();i.AudioPluginManager=r},{}],65:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],66:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload="none",r.src=t,i._attachAll(r,e),r.preload="auto",a(r,e),r.load()},s={success:function(){i._detachAll(r,s),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,s),i.data=r,t._onAssetError(i,n.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(i._intervalId)}},a=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():600===++i._intervalCount&&e.error()},100)},h=this.path.indexOf("?");if(".aac"===(h>=0?this.path.substring(0,h):this.path).slice(-4)&&-1!==e.supportedFormats.indexOf("mp4")){var c={success:s.success,error:function(){i._detachAll(r,c),window.clearInterval(i._intervalId),i.path=n.PathUtil.addExtname(i.originalPath,"mp4"),o(i.path,s)}};return void o(this.path,c)}o(this.path,s)},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?n.PathUtil.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("aac")?n.PathUtil.addExtname(t,"aac"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},e}(n.AudioAsset);i.HTMLAudioAsset=o},{"@akashic/akashic-engine":1}],67:[function(t,e,i){"use strict";function r(){s(),o()}function n(){document.addEventListener("keydown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("touchend",r,!0)}function o(){document.removeEventListener("keydown",r),document.removeEventListener("mousedown",r),document.removeEventListener("touchend",r)}function s(){h=2,c.forEach(function(t){return t.play()}),c=[]}var a,h=0,c=[];!function(t){function e(t){function e(){switch(h){case 0:case 1:s()}h=2,clearTimeout(r)}function i(){switch(t.removeEventListener("play",e),h){case 0:c.push(t),h=1,n();break;case 1:c.push(t);break;case 2:t.play()}}switch(h){case 0:t.addEventListener("play",e,!0);var r=setTimeout(i,100);break;case 1:c.push(t)}}t.setupChromeMEIWorkaround=e}(a||(a={})),e.exports=a},{}],68:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./HTMLAudioAutoplayHelper"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return r(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(o.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play().catch(function(t){}),i.loop=e.loop,i.addEventListener("ended",this._endedEventHandler,!1),i.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.HTMLAudioPlayer=s},{"./HTMLAudioAutoplayHelper":67,"@akashic/akashic-engine":1}],69:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./HTMLAudioAsset"),n=t("./HTMLAudioPlayer"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.HTMLAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType("audio/"+o);"no"!==s&&""!==s&&e.push(o)}}catch(t){}return e},t}();i.HTMLAudioPlugin=o},{"./HTMLAudioAsset":66,"./HTMLAudioPlayer":68}],70:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./PostMessageAudioPlugin"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};o.PostMessageAudioPlugin.send("akashic:AudioAsset#_load",i),setTimeout(function(){return t._onAssetLoad(e)})},e.prototype.destroy=function(){o.PostMessageAudioPlugin.send("akashic:AudioAsset#destroy",{id:this.id}),t.prototype.destroy.call(this)},e}(n.AudioAsset);i.PostMessageAudioAsset=s},{"./PostMessageAudioPlugin":72,"@akashic/akashic-engine":1}],71:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./PostMessageAudioPlugin"),s=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._manager=i,n.id=r,o.PostMessageAudioPlugin.send("akashic:AudioPlayer#new",{id:r}),n}return r(e,t),e.prototype.play=function(t){o.PostMessageAudioPlugin.send("akashic:AudioPlayer#play",{id:this.id,assetId:t.id})},e.prototype.stop=function(){o.PostMessageAudioPlugin.send("akashic:AudioPlayer#stop",{id:this.id})},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},e.prototype._changePlaybackRate=function(e){t.prototype._changePlaybackRate.call(this,e),o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changePlaybackRate",{id:this.id,rate:e})},e.prototype.notifyMasterVolumeChanged=function(){o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.PostMessageAudioPlayer=s},{"./PostMessageAudioPlugin":72,"@akashic/akashic-engine":1}],
72:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=t("./PostMessageAudioAsset"),o=t("./PostMessageAudioPlayer"),s=t("./PostMessageHandler"),a=function(){function t(){this.supportedFormats=void 0,this._playerIdx=0}return t.isSupported=function(){return"undefined"!=typeof window&&!!window.postMessage},t.initialize=function(t,e){return r=new s.PostMessageHandler(t,e),r.start(),r},t.send=function(t,e){r.send({type:t,parameters:e})},t.prototype.createAsset=function(t,e,i,r,o,s){return new n.PostMessageAudioAsset(t,e,i,r,o,s)},t.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,""+this._playerIdx++)},t}();i.PostMessageAudioPlugin=a},{"./PostMessageAudioAsset":70,"./PostMessageAudioPlayer":71,"./PostMessageHandler":73}],73:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}return t.prototype.start=function(){window.addEventListener("message",this.onMessage_bound)},t.prototype.stop=function(){window.removeEventListener("message",this.onMessage_bound)},t.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},t.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},t}();i.PostMessageHandler=n},{"@akashic/akashic-engine":1}],74:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h._handlerSet=e,h}return r(e,t),e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(i){i?t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(i)):t._onAssetLoad(e)})},e.prototype._assetPathFilter=function(t){return t},e}(n.AudioAsset);i.ProxyAudioAsset=o},{"@akashic/akashic-engine":1}],75:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e,i,r){var n=t.call(this,i)||this;return n._audioPlayerId=null,n._handlerSet=e,n._manager=r,n}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},e.prototype.play=function(i){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap"+e._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:i.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,i)},e.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},e.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e._audioPlayerIdCounter=0,e}(n.AudioPlayer);i.ProxyAudioPlayer=o},{"@akashic/akashic-engine":1}],76:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./ProxyAudioAsset"),n=t("./ProxyAudioPlayer"),o=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,e,i,n,o,s){return new r.ProxyAudioAsset(this._handlerSet,t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.ProxyAudioPlayer(this._handlerSet,t,e)},t}();i.ProxyAudioPlugin=o},{"./ProxyAudioAsset":74,"./ProxyAudioPlayer":75}],77:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("../../utils/XHRLoader"),s=t("./WebAudioHelper"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},a=function(t){s.getAudioContext().decodeAudioData(t,i,r)},h=new o.XHRLoader,c=function(t,e,i){h.getArrayBuffer(t,function(t,r){t?i(t):e(r)})},u=this.path.indexOf("?");if(".aac"===(u>=0?this.path.substring(0,u):this.path).slice(-4))return void c(this.path,a,function(t){var i=n.PathUtil.addExtname(e.originalPath,"mp4");c(i,function(t){e.path=i,a(t)},r)});c(this.path,a,r)},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?n.PathUtil.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("aac")?n.PathUtil.addExtname(t,"aac"):null},e.supportedFormats=[],e}(n.AudioAsset);i.WebAudioAsset=a},{"../../utils/XHRLoader":82,"./WebAudioHelper":79,"@akashic/akashic-engine":1}],78:[function(t,e,i){"use strict";function r(){a.getAudioContext().resume(),o()}function n(){document.addEventListener("keydown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("touchend",r,!0)}function o(){document.removeEventListener("keydown",r),document.removeEventListener("mousedown",r),document.removeEventListener("touchend",r)}var s,a=t("./WebAudioHelper");!function(t){function e(){var t=a.getAudioContext();if(!t||"function"==typeof t.resume){var e=a.createGainNode(t),i=t.createOscillator();i.type="sawtooth",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),"running"!==r&&n()}}t.setupChromeMEIWorkaround=e}(s||(s={})),e.exports=s},{"./WebAudioHelper":79}],79:[function(t,e,i){"use strict";var r,n=window.AudioContext||window.webkitAudioContext;!function(t){function e(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof n||(e=window.__akashic__.audioContext=new n,t._workAroundSafari()),e}function i(t){return t.createGain?t.createGain():t.createGainNode()}function r(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}function o(){document.addEventListener("touchstart",function e(){document.removeEventListener("touchstart",e),t.getAudioContext().createBufferSource().start(0)},!0)}t.getAudioContext=e,t.createGainNode=i,t.createBufferNode=r,t._workAroundSafari=o}(r||(r={})),e.exports=r},{}],80:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./WebAudioHelper"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._manager=i,r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=o.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.WebAudioPlayer=s},{"./WebAudioHelper":79,"@akashic/akashic-engine":1}],81:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./WebAudioAsset"),n=t("./WebAudioPlayer"),o=t("./WebAudioAutoplayHelper"),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.WebAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType("audio/"+o);"no"!==s&&""!==s&&e.push(o)}}catch(t){}return e},t}();i.WebAudioPlugin=s},{"./WebAudioAsset":77,"./WebAudioAutoplayHelper":78,"./WebAudioPlayer":80}],82:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open("GET",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener("timeout",function(){e(r.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),i.addEventListener("load",function(){if(i.status>=200&&i.status<300){var n="text"===t.responseType?i.responseText:i.response;e(null,n)}else e(r.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))},!1),i.addEventListener("error",function(){e(r.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))},!1),i.send()},t}();i.XHRLoader=n},{"@akashic/akashic-engine":1}],83:[function(e,i,r){(function(n,o){!function(e,n){"object"==typeof r&&void 0!==i?i.exports=n():"function"==typeof t&&t.amd?t(n):e.ES6Promise=n()}(this,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function i(t){return"function"==typeof t}function r(t){N=t}function s(t){W=t}function a(){return void 0!==U?function(){U(c)}:h()}function h(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<H;t+=2){(0,z[t])(z[t+1]),z[t]=void 0,z[t+1]=void 0}H=0}function u(t,e){var i=this,r=new this.constructor(d);void 0===r[K]&&k(r);var n=i._state;if(n){var o=arguments[n-1];W(function(){return E(n,r,o,i._result)})}else w(i,r,t,e);return r}function l(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(d);return v(i,t),i}function d(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function _(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}function g(t,e,i){W(function(t){var r=!1,n=_(i,e,function(i){r||(r=!0,e!==i?v(t,i):A(t,i))},function(e){r||(r=!0,x(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&n&&(r=!0,x(t,n))},t)}function y(t,e){e._state===$?A(t,e._result):e._state===Z?x(t,e._result):w(e,void 0,function(e){return v(t,e)},function(e){return x(t,e)})}function m(t,e,r){e.constructor===t.constructor&&r===u&&e.constructor.resolve===l?y(t,e):void 0===r?A(t,e):i(r)?g(t,e,r):A(t,e)}function v(e,i){if(e===i)x(e,p());else if(t(i)){var r=void 0;try{r=i.then}catch(t){return void x(e,t)}m(e,i,r)}else A(e,i)}function T(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,e){t._state===J&&(t._result=e,t._state=$,0!==t._subscribers.length&&W(S,t))}function x(t,e){t._state===J&&(t._state=Z,t._result=e,W(T,t))}function w(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+$]=i,n[o+Z]=r,0===o&&t._state&&W(S,t)}function S(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?E(i,r,n,o):n(o);t._subscribers.length=0}}function E(t,e,r,n){var o=i(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(e===s)return void x(e,f())}else s=n;e._state!==J||(o&&h?v(e,s):!1===h?x(e,a):t===$?A(e,s):t===Z&&x(e,s))}function b(t,e){try{e(function(e){v(t,e)},function(e){x(t,e)})}catch(e){x(t,e)}}function P(){return Q++}function k(t){t[K]=Q++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(){return new Error("Array Methods must be provided an Array")}function L(t){return new tt(this,t).promise}function M(t){var e=this;return new e(G(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function C(t){var e=this,i=new e(d);return x(i,t),i}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function I(){var t=void 0;if(void 0!==o)t=o;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=et}var D=void 0;D=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var G=D,H=0,U=void 0,N=void 0,W=function(t,e){z[H]=t,z[H+1]=e,2===(H+=2)&&(N?N(c):Y())},B="undefined"!=typeof window?window:void 0,j=B||{},V=j.MutationObserver||j.WebKitMutationObserver,q="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,z=new Array(1e3),Y=void 0;Y=q?function(){return function(){return n.nextTick(c)}}():V?function(){var t=0,e=new V(c),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():X?function(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}():void 0===B&&"function"==typeof e?function(){try{var t=Function("return this")().require("vertx");return U=t.runOnLoop||t.runOnContext,a()}catch(t){return h()}}():h();var K=Math.random().toString(36).substring(2),J=void 0,$=1,Z=2,Q=0,tt=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(d),this.promise[K]||k(this.promise),G(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):x(this.promise,R())}return t.prototype._enumerate=function(t){for(var e=0;this._state===J&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===l){var n=void 0,o=void 0,s=!1;try{n=t.then}catch(t){s=!0,o=t}if(n===u&&t._state!==J)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===et){var a=new i(d);s?x(a,o):m(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===J&&(this._remaining--,t===Z?x(r,i):this._result[e]=i),0===this._remaining&&A(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){return i._settledAt($,e,t)},function(t){return i._settledAt(Z,e,t)})},t}(),et=function(){function t(e){this[K]=P(),this._result=this._state=void 0,this._subscribers=[],d!==e&&("function"!=typeof e&&O(),this instanceof t?b(this,e):F())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return i(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return et.prototype.then=u,et.all=L,et.race=M,et.resolve=l,et.reject=C,et._setScheduler=r,et._setAsap=s,et._asap=W,et.polyfill=I,et.Promise=et,et})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:84}],84:[function(t,e,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(d===clearTimeout)return clearTimeout(t);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?_=f.concat(_):y=-1,_.length&&h())}function h(){if(!g){var t=o(a);g=!0;for(var e=_.length;e;){for(f=_,_=[];++y<e;)f&&f[y].run();y=-1,e=_.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,d,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{d="function"==typeof clearTimeout?clearTimeout:n}catch(t){d=n}}();var f,_=[],g=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];_.push(new c(t,e)),1!==_.length||g||o(h)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],85:[function(t,e,i){e.exports={gameDriver:t("@akashic/game-driver"),akashicEngine:t("@akashic/akashic-engine"),pdiBrowser:t("@akashic/pdi-browser")}},{"@akashic/akashic-engine":1,"@akashic/game-driver":4,"@akashic/pdi-browser":28}]},{},[85])(85)});

	window.engineFiles=engineFilesV2_1_38,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){switch(i){case"@akashic/akashic-engine":return engineFiles.akashicEngine;default:return this.call(this,i)}}}();

</script>

<script>
if (! ("optionProps" in window)) {
	window.optionProps = {};
}
window.optionProps.magnify = true

window.g = require("@akashic/akashic-engine");
</script>
<script>
if (! ("gLocalAssetContainer" in window)) {
	window.gLocalAssetContainer = {};
}

if (! ("__akashic__" in window)) {
	window.__akashic__ = {};
}


	
		window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 800,%0A%09%22height%22: 450,%0A%09%22fps%22: 30,%0A%09%22main%22: %22./script/main.js%22,%0A%09%22assets%22: {%0A%09%09%22main%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/main.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22circleA%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 100,%0A%09%09%09%22height%22: 100,%0A%09%09%09%22path%22: %22image/circleA.png%22%0A%09%09},%0A%09%09%22circleB%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 100,%0A%09%09%09%22height%22: 100,%0A%09%09%09%22path%22: %22image/circleB.png%22%0A%09%09}%0A%09},%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %222%22%0A%09},%0A%09%22globalScripts%22: [%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/BodyType.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/Box2D.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/Box2DOptions.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-box2d/lib/index.js%22,%0A%09%09%22node_modules/box2dweb/box2d.js%22%0A%09],%0A%09%22moduleMainScripts%22: {%0A%09%09%22@akashic-extension/akashic-box2d%22: %22node_modules/@akashic-extension/akashic-box2d/lib/index.js%22,%0A%09%09%22box2dweb%22: %22node_modules/box2dweb/box2d.js%22%0A%09}%0A}";
	

	
		window.gLocalAssetContainer["main"] = function(g) {
			!function(e,t,a,i,o){"use strict";function r(){var e=new g.Scene({game:g.game,assetIds:["circleA","circleB"]});e.loaded.add(function(){var t=h(g.game),a=t.Copy(),i=c(e,w);a.x-=1,i.b2body.SetPosition(a);var o=c(e,C);a.x+=2,o.b2body.SetPosition(a);var r,d=!1;e.pointDownCapture.add(function(e){d=!0,r=v.vec2(e.point.x,e.point.y)}),e.pointMoveCapture.add(function(e){var t=v.vec2(e.prevDelta.x,e.prevDelta.y);r.Add(t)}),e.pointUpCapture.add(function(){d=!1});var u=0;e.update.add(function(){for(d&&(r.x<t.x?2<=u++&&(u=0,n(e,r)):5<=u++&&(u=0,s(e,r)));0<F.length;)for(var a=F.pop(),i=0;i<S.length;++i){var o=S[i],c=o.b2body.GetUserData();if(a.a.id===o.entity.id||a.b.id===o.entity.id){var h=o.b2body.GetPosition().Copy();h.Multiply(x.scale);var l=o.b2body.GetFixtureList().GetFilterData(),f=l.groupIndex===m?"crimson":"teal";e.append(y(e,h,c.damage,f)),p(o),--i}}v.step(1/g.game.fps)})}),g.game.pushScene(e)}function n(e,t){var a=d(e,B);a.b2body.SetPosition(t);var i=10*g.game.random.generate()*2-10,o=new l(.1,0);o.MulM(f.FromAngle(i/180*Math.PI)),a.b2body.ApplyImpulse(o,a.b2body.GetPosition())}function s(e,t){var a=d(e,D);a.b2body.SetPosition(t);var i=3*g.game.random.generate()*2-3,o=new l(-.2,0);o.MulM(f.FromAngle(i/180*Math.PI)),a.b2body.ApplyImpulse(o,a.b2body.GetPosition())}function c(e,t){var a=new g.FilledRect({scene:e,width:t.appear.width,height:t.appear.height,cssColor:t.appear.cssColor});return e.append(a),v.createBody(a,t.physics.body,t.physics.fixture)}function d(e,t){var a=new g.Sprite({scene:e,src:e.assets[t.appear.assetId],srcWidth:100,srcHeight:100,width:t.appear.width,height:t.appear.height});e.append(a);var i=v.createBody(a,t.physics.body,t.physics.fixture),o=10*g.game.random.generate()-5;return i.b2body.SetUserData({id:a.id,damage:20+o}),e.setTimeout(p.bind(this,i),3e3),S.push(i),i}function p(e){e.entity.destroyed()||(S.splice(S.indexOf(e),1),v.removeBody(e),e.entity.destroy())}function y(e,t,a,i){var o=new g.Label({scene:e,font:b,text:a.toFixed(1).toString(),fontSize:a,textColor:i,x:t.x,y:t.y});return o.update.add(function(){o.opacity-=.05,o.opacity<=0&&o.destroy()}),o}function h(e){return v.vec2(e.width/2,e.height/2)}var u=t("@akashic-extension/akashic-box2d"),l=u.Box2DWeb.Common.Math.b2Vec2,f=u.Box2DWeb.Common.Math.b2Mat22,m=-1,b=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.Monospace,size:30}),x={gravity:[0,0],scale:50,sleep:!0},v=new u.Box2D(x),B={appear:{assetId:"circleA",width:.1*x.scale,height:.1*x.scale},physics:{body:v.createBodyDef({type:u.BodyType.Dynamic}),fixture:v.createFixtureDef({density:1,friction:.3,restitution:.7,shape:v.createCircleShape(.1*x.scale),filter:{groupIndex:m,categoryBits:1,maskBits:2}})}},D={appear:{assetId:"circleB",width:.1*x.scale,height:.1*x.scale},physics:{body:v.createBodyDef({type:u.BodyType.Dynamic}),fixture:v.createFixtureDef({density:1,friction:.3,restitution:.7,shape:v.createCircleShape(.1*x.scale),filter:{groupIndex:-2,categoryBits:1,maskBits:2}})}},w={appear:{width:.3*x.scale,height:g.game.height/3,cssColor:"crimson"},physics:{body:v.createBodyDef({type:u.BodyType.Static}),fixture:v.createFixtureDef({density:1,friction:.3,restitution:.7,shape:v.createRectShape(.3*x.scale,g.game.height/3),filter:{groupIndex:m,categoryBits:2}})}},C={appear:{width:.3*x.scale,height:g.game.height/3,cssColor:"teal"},physics:{body:v.createBodyDef({type:u.BodyType.Static}),fixture:v.createFixtureDef({density:1,friction:.3,restitution:.7,shape:v.createRectShape(.3*x.scale,g.game.height/3),filter:{groupIndex:-2,categoryBits:2}})}},S=[],F=[],I=new u.Box2DWeb.Dynamics.b2ContactListener;I.BeginContact=function(e){var t=e.GetFixtureA().GetBody(),a=e.GetFixtureB().GetBody();F.push({a:t.GetUserData(),b:a.GetUserData()})},v.world.SetContactListener(I),a.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/BodyType.js"] = function(g) {
			!function(e,i,o,y,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=i("box2dweb");!function(e){e[e.Static=c.Dynamics.b2Body.b2_staticBody]="Static",e[e.Kinematic=c.Dynamics.b2Body.b2_kinematicBody]="Kinematic",e[e.Dynamic=c.Dynamics.b2Body.b2_dynamicBody]="Dynamic"}(e.BodyType||(e.BodyType={}))}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/Box2D.js"] = function(g) {
			!function(e,t,i,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=t("box2dweb"),n=t("./BodyType"),l=function(){function e(e){if(!e.gravity)throw new Error("Missing parameter: gravity");if(!e.scale)throw new Error("Missing parameter: scale");var t=null==e.sleep||e.sleep;this.world=new a.Dynamics.b2World(new a.Common.Math.b2Vec2(e.gravity[0],e.gravity[1]),t),this.bodies=[],this.scale=e.scale}return e.prototype.createBody=function(e,t,i){for(var r=0;r<this.bodies.length;r++)if(this.bodies[r].entity===e)return;for(var o=Array.isArray(i)?i:[i],r=0;r<o.length;r++)if(!o[r].shape)throw new Error("Missing parameter: shape");for(var a=this.world.CreateBody(t),r=0;r<o.length;r++)a.CreateFixture(o[r]);var n=null!=t.userData?t.userData:e.id;a.SetUserData(n),a.SetPositionAndAngle(this.vec2(e.x+e.width/2,e.y+e.height/2),this.radian(e.angle));var l={entity:e,b2body:a};return this.bodies.push(l),l},e.prototype.removeBody=function(e){this.world.DestroyBody(e.b2body);var t=this.bodies.indexOf(e);-1!==t&&this.bodies.splice(t,1)},e.prototype.destroy=function(){this.world=void 0,this.bodies=void 0,this.scale=void 0},e.prototype.destroyed=function(){return void 0===this.world},e.prototype.step=function(e,t,i){t=null!=t?t:10,i=null!=i?i:10,this.world.Step(e,t,i);for(var r=0;r<this.bodies.length;++r){var o=this.bodies[r].b2body,a=this.bodies[r].entity;if(!a.destroyed()&&o.IsAwake()){var n=o.GetPosition();a.x=n.x*this.scale-a.width/2,a.y=n.y*this.scale-a.height/2,a.angle=this.degree(o.GetAngle()),a.modified()}}},e.prototype.isContact=function(e,t,i){var r=i.GetFixtureA().GetBody().GetUserData(),o=i.GetFixtureB().GetBody().GetUserData();return e.b2body.GetUserData()===r&&t.b2body.GetUserData()===o||e.b2body.GetUserData()===o&&t.b2body.GetUserData()===r},e.prototype.createRectShape=function(e,t){var i=new a.Collision.Shapes.b2PolygonShape;return i.SetAsBox(e/(2*this.scale),t/(2*this.scale)),i},e.prototype.createCircleShape=function(e){return new a.Collision.Shapes.b2CircleShape(e/2/this.scale)},e.prototype.createPolygonShape=function(e){var t=new a.Collision.Shapes.b2PolygonShape;return t.SetAsArray(e,e.length),t},e.prototype.createFixtureDef=function(e){var t=new a.Dynamics.b2FixtureDef;t.density=null!=e.density?e.density:0,t.friction=null!=e.friction?e.friction:.2,t.restitution=null!=e.restitution?e.restitution:0,t.shape=e.shape;var i=e.filter||{};return t.filter.categoryBits=null!=i.categoryBits?i.categoryBits:1,t.filter.maskBits=null!=i.maskBits?i.maskBits:65535,t.filter.groupIndex=null!=i.groupIndex?i.groupIndex:0,t},e.prototype.createBodyDef=function(e){var t=new a.Dynamics.b2BodyDef;return t.type=null!=e.type?e.type:n.BodyType.Static,t.userData=e.userData,t.angularDamping=null!=e.angularDamping?e.angularDamping:0,t.angularVelocity=null!=e.angularVelocity?e.angularVelocity:0,t.linearDamping=null!=e.linearDamping?e.linearDamping:0,t.linearVelocity=null!=e.linearVelocity?e.linearVelocity:this.vec2(0,0),t.inertiaScale=null!=e.inertiaScale?e.inertiaScale:1,t.active=null==e.active||e.active,t.allowSleep=null==e.allowSleep||e.allowSleep,t.awake=null==e.awake||e.awake,t.bullet=null==e.bullet||e.bullet,t.fixedRotation=null!=e.fixedRotation&&e.fixedRotation,t},e.prototype.degree=function(e){return 180*e/Math.PI},e.prototype.radian=function(e){return e*Math.PI/180},e.prototype.vec2=function(e,t){return new a.Common.Math.b2Vec2(e/this.scale,t/this.scale)},e}();e.Box2D=l}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/Box2DOptions.js"] = function(g) {
			!function(e,u,o,r,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);
		};
	

	
		window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-box2d/lib/index.js"] = function(g) {
			!function(e,o,r,d,B){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("box2dweb");e.Box2DWeb=i;var t=o("./Box2D");e.Box2D=t.Box2D;var u=o("./BodyType");e.BodyType=u.BodyType;var x=o("./Box2DOptions");e.Box2DOptions=x}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);
		};
	

	
		window.gLocalAssetContainer["node_modules/box2dweb/box2d.js"] = function(g) {
			!function(t,i,o,e,n){"use strict";var s={};!function(t,i){function o(){}t.inherit=function(t,i){var e=t;o.prototype=i.prototype,t.prototype=new o,t.prototype.constructor=e},t.generateCallback=function(t,i){return function(){i.apply(t,arguments)}},t.NVector=function(t){void 0===t&&(t=0);for(var i=new Array(t||0),o=0;o<t;++o)i[o]=0;return i},t.is=function(t,i){return null!==t&&(i instanceof Function&&t instanceof i||!(void 0==t.constructor.__implements||!t.constructor.__implements[i]))},t.parseUInt=function(t){return Math.abs(parseInt(t))}}(s);var r=Array,a=s.NVector;void 0===s&&(s={}),void 0===s.Collision&&(s.Collision={}),void 0===s.Collision.Shapes&&(s.Collision.Shapes={}),void 0===s.Common&&(s.Common={}),void 0===s.Common.Math&&(s.Common.Math={}),void 0===s.Dynamics&&(s.Dynamics={}),void 0===s.Dynamics.Contacts&&(s.Dynamics.Contacts={}),void 0===s.Dynamics.Controllers&&(s.Dynamics.Controllers={}),void 0===s.Dynamics.Joints&&(s.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function i(){i.b2Bound.apply(this,arguments)}function o(){o.b2BoundValues.apply(this,arguments),this.constructor===o&&this.b2BoundValues.apply(this,arguments)}function e(){e.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments),this.constructor===n&&this.b2ContactID.apply(this,arguments)}function r(){r.b2ContactPoint.apply(this,arguments)}function a(){a.b2Distance.apply(this,arguments)}function l(){l.b2DistanceInput.apply(this,arguments)}function m(){m.b2DistanceOutput.apply(this,arguments)}function c(){c.b2DistanceProxy.apply(this,arguments)}function h(){h.b2DynamicTree.apply(this,arguments),this.constructor===h&&this.b2DynamicTree.apply(this,arguments)}function _(){_.b2DynamicTreeBroadPhase.apply(this,arguments)}function p(){p.b2DynamicTreeNode.apply(this,arguments)}function y(){y.b2DynamicTreePair.apply(this,arguments)}function u(){u.b2Manifold.apply(this,arguments),this.constructor===u&&this.b2Manifold.apply(this,arguments)}function x(){x.b2ManifoldPoint.apply(this,arguments),this.constructor===x&&this.b2ManifoldPoint.apply(this,arguments)}function f(){f.b2Point.apply(this,arguments)}function d(){d.b2RayCastInput.apply(this,arguments),this.constructor===d&&this.b2RayCastInput.apply(this,arguments)}function b(){b.b2RayCastOutput.apply(this,arguments)}function v(){v.b2Segment.apply(this,arguments)}function C(){C.b2SeparationFunction.apply(this,arguments)}function A(){A.b2Simplex.apply(this,arguments),this.constructor===A&&this.b2Simplex.apply(this,arguments)}function S(){S.b2SimplexCache.apply(this,arguments)}function g(){g.b2SimplexVertex.apply(this,arguments)}function w(){w.b2TimeOfImpact.apply(this,arguments)}function D(){D.b2TOIInput.apply(this,arguments)}function B(){B.b2WorldManifold.apply(this,arguments),this.constructor===B&&this.b2WorldManifold.apply(this,arguments)}function M(){M.ClipVertex.apply(this,arguments)}function V(){V.Features.apply(this,arguments)}function I(){I.b2CircleShape.apply(this,arguments),this.constructor===I&&this.b2CircleShape.apply(this,arguments)}function G(){G.b2EdgeChainDef.apply(this,arguments),this.constructor===G&&this.b2EdgeChainDef.apply(this,arguments)}function L(){L.b2EdgeShape.apply(this,arguments),this.constructor===L&&this.b2EdgeShape.apply(this,arguments)}function J(){J.b2MassData.apply(this,arguments)}function F(){F.b2PolygonShape.apply(this,arguments),this.constructor===F&&this.b2PolygonShape.apply(this,arguments)}function P(){P.b2Shape.apply(this,arguments),this.constructor===P&&this.b2Shape.apply(this,arguments)}function R(){R.b2Color.apply(this,arguments),this.constructor===R&&this.b2Color.apply(this,arguments)}function T(){T.b2Settings.apply(this,arguments)}function k(){k.b2Mat22.apply(this,arguments),this.constructor===k&&this.b2Mat22.apply(this,arguments)}function z(){z.b2Mat33.apply(this,arguments),this.constructor===z&&this.b2Mat33.apply(this,arguments)}function N(){N.b2Math.apply(this,arguments)}function E(){E.b2Sweep.apply(this,arguments)}function j(){j.b2Transform.apply(this,arguments),this.constructor===j&&this.b2Transform.apply(this,arguments)}function U(){U.b2Vec2.apply(this,arguments),this.constructor===U&&this.b2Vec2.apply(this,arguments)}function q(){q.b2Vec3.apply(this,arguments),this.constructor===q&&this.b2Vec3.apply(this,arguments)}function O(){O.b2Body.apply(this,arguments),this.constructor===O&&this.b2Body.apply(this,arguments)}function K(){K.b2BodyDef.apply(this,arguments),this.constructor===K&&this.b2BodyDef.apply(this,arguments)}function W(){W.b2ContactFilter.apply(this,arguments)}function X(){X.b2ContactImpulse.apply(this,arguments)}function Z(){Z.b2ContactListener.apply(this,arguments)}function H(){H.b2ContactManager.apply(this,arguments),this.constructor===H&&this.b2ContactManager.apply(this,arguments)}function Y(){Y.b2DebugDraw.apply(this,arguments),this.constructor===Y&&this.b2DebugDraw.apply(this,arguments)}function Q(){Q.b2DestructionListener.apply(this,arguments)}function $(){$.b2FilterData.apply(this,arguments)}function tt(){tt.b2Fixture.apply(this,arguments),this.constructor===tt&&this.b2Fixture.apply(this,arguments)}function it(){it.b2FixtureDef.apply(this,arguments),this.constructor===it&&this.b2FixtureDef.apply(this,arguments)}function ot(){ot.b2Island.apply(this,arguments),this.constructor===ot&&this.b2Island.apply(this,arguments)}function et(){et.b2TimeStep.apply(this,arguments)}function nt(){nt.b2World.apply(this,arguments),this.constructor===nt&&this.b2World.apply(this,arguments)}function st(){st.b2CircleContact.apply(this,arguments)}function rt(){rt.b2Contact.apply(this,arguments),this.constructor===rt&&this.b2Contact.apply(this,arguments)}function at(){at.b2ContactConstraint.apply(this,arguments),this.constructor===at&&this.b2ContactConstraint.apply(this,arguments)}function lt(){lt.b2ContactConstraintPoint.apply(this,arguments)}function mt(){mt.b2ContactEdge.apply(this,arguments)}function ct(){ct.b2ContactFactory.apply(this,arguments),this.constructor===ct&&this.b2ContactFactory.apply(this,arguments)}function ht(){ht.b2ContactRegister.apply(this,arguments)}function _t(){_t.b2ContactResult.apply(this,arguments)}function pt(){pt.b2ContactSolver.apply(this,arguments),this.constructor===pt&&this.b2ContactSolver.apply(this,arguments)}function yt(){yt.b2EdgeAndCircleContact.apply(this,arguments)}function ut(){ut.b2NullContact.apply(this,arguments),this.constructor===ut&&this.b2NullContact.apply(this,arguments)}function xt(){xt.b2PolyAndCircleContact.apply(this,arguments)}function ft(){ft.b2PolyAndEdgeContact.apply(this,arguments)}function dt(){dt.b2PolygonContact.apply(this,arguments)}function bt(){bt.b2PositionSolverManifold.apply(this,arguments),this.constructor===bt&&this.b2PositionSolverManifold.apply(this,arguments)}function vt(){vt.b2BuoyancyController.apply(this,arguments)}function Ct(){Ct.b2ConstantAccelController.apply(this,arguments)}function At(){At.b2ConstantForceController.apply(this,arguments)}function St(){St.b2Controller.apply(this,arguments)}function gt(){gt.b2ControllerEdge.apply(this,arguments)}function wt(){wt.b2GravityController.apply(this,arguments)}function Dt(){Dt.b2TensorDampingController.apply(this,arguments)}function Bt(){Bt.b2DistanceJoint.apply(this,arguments),this.constructor===Bt&&this.b2DistanceJoint.apply(this,arguments)}function Mt(){Mt.b2DistanceJointDef.apply(this,arguments),this.constructor===Mt&&this.b2DistanceJointDef.apply(this,arguments)}function Vt(){Vt.b2FrictionJoint.apply(this,arguments),this.constructor===Vt&&this.b2FrictionJoint.apply(this,arguments)}function It(){It.b2FrictionJointDef.apply(this,arguments),this.constructor===It&&this.b2FrictionJointDef.apply(this,arguments)}function Gt(){Gt.b2GearJoint.apply(this,arguments),this.constructor===Gt&&this.b2GearJoint.apply(this,arguments)}function Lt(){Lt.b2GearJointDef.apply(this,arguments),this.constructor===Lt&&this.b2GearJointDef.apply(this,arguments)}function Jt(){Jt.b2Jacobian.apply(this,arguments)}function Ft(){Ft.b2Joint.apply(this,arguments),this.constructor===Ft&&this.b2Joint.apply(this,arguments)}function Pt(){Pt.b2JointDef.apply(this,arguments),this.constructor===Pt&&this.b2JointDef.apply(this,arguments)}function Rt(){Rt.b2JointEdge.apply(this,arguments)}function Tt(){Tt.b2LineJoint.apply(this,arguments),this.constructor===Tt&&this.b2LineJoint.apply(this,arguments)}function kt(){kt.b2LineJointDef.apply(this,arguments),this.constructor===kt&&this.b2LineJointDef.apply(this,arguments)}function zt(){zt.b2MouseJoint.apply(this,arguments),this.constructor===zt&&this.b2MouseJoint.apply(this,arguments)}function Nt(){Nt.b2MouseJointDef.apply(this,arguments),this.constructor===Nt&&this.b2MouseJointDef.apply(this,arguments)}function Et(){Et.b2PrismaticJoint.apply(this,arguments),this.constructor===Et&&this.b2PrismaticJoint.apply(this,arguments)}function jt(){jt.b2PrismaticJointDef.apply(this,arguments),this.constructor===jt&&this.b2PrismaticJointDef.apply(this,arguments)}function Ut(){Ut.b2PulleyJoint.apply(this,arguments),this.constructor===Ut&&this.b2PulleyJoint.apply(this,arguments)}function qt(){qt.b2PulleyJointDef.apply(this,arguments),this.constructor===qt&&this.b2PulleyJointDef.apply(this,arguments)}function Ot(){Ot.b2RevoluteJoint.apply(this,arguments),this.constructor===Ot&&this.b2RevoluteJoint.apply(this,arguments)}function Kt(){Kt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Kt&&this.b2RevoluteJointDef.apply(this,arguments)}function Wt(){Wt.b2WeldJoint.apply(this,arguments),this.constructor===Wt&&this.b2WeldJoint.apply(this,arguments)}function Xt(){Xt.b2WeldJointDef.apply(this,arguments),this.constructor===Xt&&this.b2WeldJointDef.apply(this,arguments)}s.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",s.Collision.b2AABB=t,s.Collision.b2Bound=i,s.Collision.b2BoundValues=o,s.Collision.b2Collision=e,s.Collision.b2ContactID=n,s.Collision.b2ContactPoint=r,s.Collision.b2Distance=a,s.Collision.b2DistanceInput=l,s.Collision.b2DistanceOutput=m,s.Collision.b2DistanceProxy=c,s.Collision.b2DynamicTree=h,s.Collision.b2DynamicTreeBroadPhase=_,s.Collision.b2DynamicTreeNode=p,s.Collision.b2DynamicTreePair=y,s.Collision.b2Manifold=u,s.Collision.b2ManifoldPoint=x,s.Collision.b2Point=f,s.Collision.b2RayCastInput=d,s.Collision.b2RayCastOutput=b,s.Collision.b2Segment=v,s.Collision.b2SeparationFunction=C,s.Collision.b2Simplex=A,s.Collision.b2SimplexCache=S,s.Collision.b2SimplexVertex=g,s.Collision.b2TimeOfImpact=w,s.Collision.b2TOIInput=D,s.Collision.b2WorldManifold=B,s.Collision.ClipVertex=M,s.Collision.Features=V,s.Collision.Shapes.b2CircleShape=I,s.Collision.Shapes.b2EdgeChainDef=G,s.Collision.Shapes.b2EdgeShape=L,s.Collision.Shapes.b2MassData=J,s.Collision.Shapes.b2PolygonShape=F,s.Collision.Shapes.b2Shape=P,s.Common.b2internal="Box2D.Common.b2internal",s.Common.b2Color=R,s.Common.b2Settings=T,s.Common.Math.b2Mat22=k,s.Common.Math.b2Mat33=z,s.Common.Math.b2Math=N,s.Common.Math.b2Sweep=E,s.Common.Math.b2Transform=j,s.Common.Math.b2Vec2=U,s.Common.Math.b2Vec3=q,s.Dynamics.b2Body=O,s.Dynamics.b2BodyDef=K,s.Dynamics.b2ContactFilter=W,s.Dynamics.b2ContactImpulse=X,s.Dynamics.b2ContactListener=Z,s.Dynamics.b2ContactManager=H,s.Dynamics.b2DebugDraw=Y,s.Dynamics.b2DestructionListener=Q,s.Dynamics.b2FilterData=$,s.Dynamics.b2Fixture=tt,s.Dynamics.b2FixtureDef=it,s.Dynamics.b2Island=ot,s.Dynamics.b2TimeStep=et,s.Dynamics.b2World=nt,s.Dynamics.Contacts.b2CircleContact=st,s.Dynamics.Contacts.b2Contact=rt,s.Dynamics.Contacts.b2ContactConstraint=at,s.Dynamics.Contacts.b2ContactConstraintPoint=lt,s.Dynamics.Contacts.b2ContactEdge=mt,s.Dynamics.Contacts.b2ContactFactory=ct,s.Dynamics.Contacts.b2ContactRegister=ht,s.Dynamics.Contacts.b2ContactResult=_t,s.Dynamics.Contacts.b2ContactSolver=pt,s.Dynamics.Contacts.b2EdgeAndCircleContact=yt,s.Dynamics.Contacts.b2NullContact=ut,s.Dynamics.Contacts.b2PolyAndCircleContact=xt,s.Dynamics.Contacts.b2PolyAndEdgeContact=ft,s.Dynamics.Contacts.b2PolygonContact=dt,s.Dynamics.Contacts.b2PositionSolverManifold=bt,s.Dynamics.Controllers.b2BuoyancyController=vt,s.Dynamics.Controllers.b2ConstantAccelController=Ct,s.Dynamics.Controllers.b2ConstantForceController=At,s.Dynamics.Controllers.b2Controller=St,s.Dynamics.Controllers.b2ControllerEdge=gt,s.Dynamics.Controllers.b2GravityController=wt,s.Dynamics.Controllers.b2TensorDampingController=Dt,s.Dynamics.Joints.b2DistanceJoint=Bt,s.Dynamics.Joints.b2DistanceJointDef=Mt,s.Dynamics.Joints.b2FrictionJoint=Vt,s.Dynamics.Joints.b2FrictionJointDef=It,s.Dynamics.Joints.b2GearJoint=Gt,s.Dynamics.Joints.b2GearJointDef=Lt,s.Dynamics.Joints.b2Jacobian=Jt,s.Dynamics.Joints.b2Joint=Ft,s.Dynamics.Joints.b2JointDef=Pt,s.Dynamics.Joints.b2JointEdge=Rt,s.Dynamics.Joints.b2LineJoint=Tt,s.Dynamics.Joints.b2LineJointDef=kt,s.Dynamics.Joints.b2MouseJoint=zt,s.Dynamics.Joints.b2MouseJointDef=Nt,s.Dynamics.Joints.b2PrismaticJoint=Et,s.Dynamics.Joints.b2PrismaticJointDef=jt,s.Dynamics.Joints.b2PulleyJoint=Ut,s.Dynamics.Joints.b2PulleyJointDef=qt,s.Dynamics.Joints.b2RevoluteJoint=Ot,s.Dynamics.Joints.b2RevoluteJointDef=Kt,s.Dynamics.Joints.b2WeldJoint=Wt,s.Dynamics.Joints.b2WeldJointDef=Xt}(),s.postDefs=[],function(){var t=s.Collision.Shapes.b2CircleShape,i=(s.Collision.Shapes.b2EdgeChainDef,s.Collision.Shapes.b2EdgeShape,s.Collision.Shapes.b2MassData,s.Collision.Shapes.b2PolygonShape),o=s.Collision.Shapes.b2Shape,e=(s.Common.b2Color,s.Common.b2internal,s.Common.b2Settings),n=(s.Common.Math.b2Mat22,s.Common.Math.b2Mat33,s.Common.Math.b2Math),l=s.Common.Math.b2Sweep,m=s.Common.Math.b2Transform,c=s.Common.Math.b2Vec2,h=(s.Common.Math.b2Vec3,s.Collision.b2AABB),_=s.Collision.b2Bound,p=s.Collision.b2BoundValues,y=s.Collision.b2Collision,u=s.Collision.b2ContactID,x=s.Collision.b2ContactPoint,f=s.Collision.b2Distance,d=s.Collision.b2DistanceInput,b=s.Collision.b2DistanceOutput,v=s.Collision.b2DistanceProxy,C=s.Collision.b2DynamicTree,A=s.Collision.b2DynamicTreeBroadPhase,S=s.Collision.b2DynamicTreeNode,g=s.Collision.b2DynamicTreePair,w=s.Collision.b2Manifold,D=s.Collision.b2ManifoldPoint,B=s.Collision.b2Point,M=s.Collision.b2RayCastInput,V=s.Collision.b2RayCastOutput,I=s.Collision.b2Segment,G=s.Collision.b2SeparationFunction,L=s.Collision.b2Simplex,J=s.Collision.b2SimplexCache,F=s.Collision.b2SimplexVertex,P=s.Collision.b2TimeOfImpact,R=s.Collision.b2TOIInput,T=s.Collision.b2WorldManifold,k=s.Collision.ClipVertex,z=s.Collision.Features,N=s.Collision.IBroadPhase;h.b2AABB=function(){this.lowerBound=new c,this.upperBound=new c},h.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,i=this.upperBound.y-this.lowerBound.y,o=t>=0&&i>=0;return o=o&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},h.prototype.GetCenter=function(){return new c((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},h.prototype.GetExtents=function(){return new c((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},h.prototype.Contains=function(t){var i=!0;return i=i&&this.lowerBound.x<=t.lowerBound.x,i=i&&this.lowerBound.y<=t.lowerBound.y,i=i&&t.upperBound.x<=this.upperBound.x,i=i&&t.upperBound.y<=this.upperBound.y},h.prototype.RayCast=function(t,i){var o=-Number.MAX_VALUE,e=Number.MAX_VALUE,n=i.p1.x,s=i.p1.y,r=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y,l=Math.abs(r),m=Math.abs(a),c=t.normal,h=0,_=0,p=0,y=0,u=0;if(l<Number.MIN_VALUE){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else if(h=1/r,_=(this.lowerBound.x-n)*h,p=(this.upperBound.x-n)*h,u=-1,_>p&&(y=_,_=p,p=y,u=1),_>o&&(c.x=u,c.y=0,o=_),e=Math.min(e,p),o>e)return!1;if(m<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else if(h=1/a,_=(this.lowerBound.y-s)*h,p=(this.upperBound.y-s)*h,u=-1,_>p&&(y=_,_=p,p=y,u=1),_>o&&(c.y=u,c.x=0,o=_),e=Math.min(e,p),o>e)return!1;return t.fraction=o,!0},h.prototype.TestOverlap=function(t){var i=t.lowerBound.x-this.upperBound.x,o=t.lowerBound.y-this.upperBound.y,e=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return!(i>0||o>0)&&!(e>0||n>0)},h.Combine=function(t,i){var o=new h;return o.Combine(t,i),o},h.prototype.Combine=function(t,i){this.lowerBound.x=Math.min(t.lowerBound.x,i.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,i.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,i.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,i.upperBound.y)},_.b2Bound=function(){},_.prototype.IsLower=function(){return 0==(1&this.value)},_.prototype.IsUpper=function(){return 1==(1&this.value)},_.prototype.Swap=function(t){var i=this.value,o=this.proxy,e=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=i,t.proxy=o,t.stabbingCount=e},p.b2BoundValues=function(){},p.prototype.b2BoundValues=function(){this.lowerValues=new a,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new a,this.upperValues[0]=0,this.upperValues[1]=0},y.b2Collision=function(){},y.ClipSegmentToLine=function(t,i,o,e){void 0===e&&(e=0);var n,s=0;n=i[0];var r=n.v;n=i[1];var a=n.v,l=o.x*r.x+o.y*r.y-e,m=o.x*a.x+o.y*a.y-e;if(l<=0&&t[s++].Set(i[0]),m<=0&&t[s++].Set(i[1]),l*m<0){var c=l/(l-m);n=t[s];var h=n.v;h.x=r.x+c*(a.x-r.x),h.y=r.y+c*(a.y-r.y),n=t[s];var _;l>0?(_=i[0],n.id=_.id):(_=i[1],n.id=_.id),++s}return s},y.EdgeSeparation=function(t,i,o,e,n){void 0===o&&(o=0);var s,r,a=(parseInt(t.m_vertexCount),t.m_vertices),l=t.m_normals,m=parseInt(e.m_vertexCount),c=e.m_vertices;s=i.R,r=l[o];var h=s.col1.x*r.x+s.col2.x*r.y,_=s.col1.y*r.x+s.col2.y*r.y;s=n.R;for(var p=s.col1.x*h+s.col1.y*_,y=s.col2.x*h+s.col2.y*_,u=0,x=Number.MAX_VALUE,f=0;f<m;++f){r=c[f];var d=r.x*p+r.y*y;d<x&&(x=d,u=f)}r=a[o],s=i.R;var b=i.position.x+(s.col1.x*r.x+s.col2.x*r.y),v=i.position.y+(s.col1.y*r.x+s.col2.y*r.y);r=c[u],s=n.R;var C=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),A=n.position.y+(s.col1.y*r.x+s.col2.y*r.y);return C-=b,A-=v,C*h+A*_},y.FindMaxSeparation=function(t,i,o,e,n){var s,r,a=parseInt(i.m_vertexCount),l=i.m_normals;r=n.R,s=e.m_centroid;var m=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=o.R,s=i.m_centroid,m-=o.position.x+(r.col1.x*s.x+r.col2.x*s.y),c-=o.position.y+(r.col1.y*s.x+r.col2.y*s.y);for(var h=m*o.R.col1.x+c*o.R.col1.y,_=m*o.R.col2.x+c*o.R.col2.y,p=0,u=-Number.MAX_VALUE,x=0;x<a;++x){s=l[x];var f=s.x*h+s.y*_;f>u&&(u=f,p=x)}var d=y.EdgeSeparation(i,o,p,e,n),b=parseInt(p-1>=0?p-1:a-1),v=y.EdgeSeparation(i,o,b,e,n),C=parseInt(p+1<a?p+1:0),A=y.EdgeSeparation(i,o,C,e,n),S=0,g=0,w=0;if(v>d&&v>A)w=-1,S=b,g=v;else{if(!(A>d))return t[0]=p,d;w=1,S=C,g=A}for(;;){if(p=-1==w?S-1>=0?S-1:a-1:S+1<a?S+1:0,!((d=y.EdgeSeparation(i,o,p,e,n))>g))break;S=p,g=d}return t[0]=S,g},y.FindIncidentEdge=function(t,i,o,e,n,s){void 0===e&&(e=0);var r,a,l=(parseInt(i.m_vertexCount),i.m_normals),m=parseInt(n.m_vertexCount),c=n.m_vertices,h=n.m_normals;r=o.R,a=l[e];var _=r.col1.x*a.x+r.col2.x*a.y,p=r.col1.y*a.x+r.col2.y*a.y;r=s.R;var y=r.col1.x*_+r.col1.y*p;p=r.col2.x*_+r.col2.y*p,_=y;for(var u=0,x=Number.MAX_VALUE,f=0;f<m;++f){a=h[f];var d=_*a.x+p*a.y;d<x&&(x=d,u=f)}var b,v=parseInt(u),C=parseInt(v+1<m?v+1:0);b=t[0],a=c[v],r=s.R,b.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),b.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),b.id.features.referenceEdge=e,b.id.features.incidentEdge=v,b.id.features.incidentVertex=0,b=t[1],a=c[C],r=s.R,b.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),b.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),b.id.features.referenceEdge=e,b.id.features.incidentEdge=C,b.id.features.incidentVertex=1},y.MakeClipPointVector=function(){var t=new r(2);return t[0]=new k,t[1]=new k,t},y.CollidePolygons=function(t,i,o,n,s){var r;t.m_pointCount=0;var a=i.m_radius+n.m_radius,l=0;y.s_edgeAO[0]=l;var m=y.FindMaxSeparation(y.s_edgeAO,i,o,n,s);if(l=y.s_edgeAO[0],!(m>a)){var c=0;y.s_edgeBO[0]=c;var h=y.FindMaxSeparation(y.s_edgeBO,n,s,i,o);if(c=y.s_edgeBO[0],!(h>a)){var _,p,u,x,f,d=0,b=0;h>.98*m+.001?(_=n,p=i,u=s,x=o,d=c,t.m_type=w.e_faceB,b=1):(_=i,p=n,u=o,x=s,d=l,t.m_type=w.e_faceA,b=0);var v=y.s_incidentEdge;y.FindIncidentEdge(v,_,u,d,p,x);var C,A=parseInt(_.m_vertexCount),S=_.m_vertices,g=S[d];C=d+1<A?S[parseInt(d+1)]:S[0];var D=y.s_localTangent;D.Set(C.x-g.x,C.y-g.y),D.Normalize();var B=y.s_localNormal;B.x=D.y,B.y=-D.x;var M=y.s_planePoint;M.Set(.5*(g.x+C.x),.5*(g.y+C.y));var V=y.s_tangent;f=u.R,V.x=f.col1.x*D.x+f.col2.x*D.y,V.y=f.col1.y*D.x+f.col2.y*D.y;var I=y.s_tangent2;I.x=-V.x,I.y=-V.y;var G=y.s_normal;G.x=V.y,G.y=-V.x;var L=y.s_v11,J=y.s_v12;L.x=u.position.x+(f.col1.x*g.x+f.col2.x*g.y),L.y=u.position.y+(f.col1.y*g.x+f.col2.y*g.y),J.x=u.position.x+(f.col1.x*C.x+f.col2.x*C.y),J.y=u.position.y+(f.col1.y*C.x+f.col2.y*C.y);var F=G.x*L.x+G.y*L.y,P=-V.x*L.x-V.y*L.y+a,R=V.x*J.x+V.y*J.y+a,T=y.s_clipPoints1,k=y.s_clipPoints2;if(!(y.ClipSegmentToLine(T,v,I,P)<2||y.ClipSegmentToLine(k,T,V,R)<2)){t.m_localPlaneNormal.SetV(B),t.m_localPoint.SetV(M);for(var z=0,N=0;N<e.b2_maxManifoldPoints;++N){r=k[N];if(G.x*r.v.x+G.y*r.v.y-F<=a){var E=t.m_points[z];f=x.R;var j=r.v.x-x.position.x,U=r.v.y-x.position.y;E.m_localPoint.x=j*f.col1.x+U*f.col1.y,E.m_localPoint.y=j*f.col2.x+U*f.col2.y,E.m_id.Set(r.id),E.m_id.features.flip=b,++z}}t.m_pointCount=z}}}},y.CollideCircles=function(t,i,o,e,n){t.m_pointCount=0;var s,r;s=o.R,r=i.m_p;var a=o.position.x+(s.col1.x*r.x+s.col2.x*r.y),l=o.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=n.R,r=e.m_p;var m=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),c=n.position.y+(s.col1.y*r.x+s.col2.y*r.y),h=m-a,_=c-l,p=h*h+_*_,y=i.m_radius+e.m_radius;p>y*y||(t.m_type=w.e_circles,t.m_localPoint.SetV(i.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0)},y.CollidePolygonAndCircle=function(t,i,o,e,n){t.m_pointCount=0;var s,r,a=0,l=0;r=n.R,s=e.m_p;var m=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);a=m-o.position.x,l=c-o.position.y,r=o.R;for(var h=a*r.col1.x+l*r.col1.y,_=a*r.col2.x+l*r.col2.y,p=0,y=-Number.MAX_VALUE,u=i.m_radius+e.m_radius,x=parseInt(i.m_vertexCount),f=i.m_vertices,d=i.m_normals,b=0;b<x;++b){s=f[b],a=h-s.x,l=_-s.y,s=d[b];var v=s.x*a+s.y*l;if(v>u)return;v>y&&(y=v,p=b)}var C=parseInt(p),A=parseInt(C+1<x?C+1:0),S=f[C],g=f[A];if(y<Number.MIN_VALUE)return t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.SetV(d[p]),t.m_localPoint.x=.5*(S.x+g.x),t.m_localPoint.y=.5*(S.y+g.y),t.m_points[0].m_localPoint.SetV(e.m_p),void(t.m_points[0].m_id.key=0);var D=(h-S.x)*(g.x-S.x)+(_-S.y)*(g.y-S.y),B=(h-g.x)*(S.x-g.x)+(_-g.y)*(S.y-g.y);if(D<=0){if((h-S.x)*(h-S.x)+(_-S.y)*(_-S.y)>u*u)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=h-S.x,t.m_localPlaneNormal.y=_-S.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(S),t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0}else if(B<=0){if((h-g.x)*(h-g.x)+(_-g.y)*(_-g.y)>u*u)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=h-g.x,t.m_localPlaneNormal.y=_-g.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(g),t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0}else{var M=.5*(S.x+g.x),V=.5*(S.y+g.y);if((y=(h-M)*d[C].x+(_-V)*d[C].y)>u)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=d[C].x,t.m_localPlaneNormal.y=d[C].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(M,V),t.m_points[0].m_localPoint.SetV(e.m_p),t.m_points[0].m_id.key=0}},y.TestOverlap=function(t,i){var o=i.lowerBound,e=t.upperBound,n=o.x-e.x,s=o.y-e.y;o=t.lowerBound,e=i.upperBound;var r=o.x-e.x,a=o.y-e.y;return!(n>0||s>0)&&!(r>0||a>0)},s.postDefs.push(function(){s.Collision.b2Collision.s_incidentEdge=y.MakeClipPointVector(),s.Collision.b2Collision.s_clipPoints1=y.MakeClipPointVector(),s.Collision.b2Collision.s_clipPoints2=y.MakeClipPointVector(),s.Collision.b2Collision.s_edgeAO=new a(1),s.Collision.b2Collision.s_edgeBO=new a(1),s.Collision.b2Collision.s_localTangent=new c,s.Collision.b2Collision.s_localNormal=new c,s.Collision.b2Collision.s_planePoint=new c,s.Collision.b2Collision.s_normal=new c,s.Collision.b2Collision.s_tangent=new c,s.Collision.b2Collision.s_tangent2=new c,s.Collision.b2Collision.s_v11=new c,s.Collision.b2Collision.s_v12=new c,s.Collision.b2Collision.b2CollidePolyTempVec=new c,s.Collision.b2Collision.b2_nullFeature=255}),u.b2ContactID=function(){this.features=new z},u.prototype.b2ContactID=function(){this.features._m_id=this},u.prototype.Set=function(t){this.key=t._key},u.prototype.Copy=function(){var t=new u;return t.key=this.key,t},Object.defineProperty(u.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(u.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),x.b2ContactPoint=function(){this.position=new c,this.velocity=new c,this.normal=new c,this.id=new u},f.b2Distance=function(){},f.Distance=function(t,i,o){++f.b2_gjkCalls;var s=o.proxyA,r=o.proxyB,a=o.transformA,l=o.transformB,m=f.s_simplex;m.ReadCache(i,s,a,r,l);for(var h,_=m.m_vertices,p=f.s_saveA,y=f.s_saveB,u=0,x=m.GetClosestPoint(),d=x.LengthSquared(),b=d,v=0,C=0;C<20;){for(u=m.m_count,v=0;v<u;v++)p[v]=_[v].indexA,y[v]=_[v].indexB;switch(m.m_count){case 1:break;case 2:m.Solve2();break;case 3:m.Solve3();break;default:e.b2Assert(!1)}if(3==m.m_count)break;h=m.GetClosestPoint(),b=h.LengthSquared(),d=b;var A=m.GetSearchDirection();if(A.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var S=_[m.m_count];S.indexA=s.GetSupport(n.MulTMV(a.R,A.GetNegative())),S.wA=n.MulX(a,s.GetVertex(S.indexA)),S.indexB=r.GetSupport(n.MulTMV(l.R,A)),S.wB=n.MulX(l,r.GetVertex(S.indexB)),S.w=n.SubtractVV(S.wB,S.wA),++C,++f.b2_gjkIters;var g=!1;for(v=0;v<u;v++)if(S.indexA==p[v]&&S.indexB==y[v]){g=!0;break}if(g)break;++m.m_count}if(f.b2_gjkMaxIters=n.Max(f.b2_gjkMaxIters,C),m.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=C,m.WriteCache(i),o.useRadii){var w=s.m_radius,D=r.m_radius;if(t.distance>w+D&&t.distance>Number.MIN_VALUE){t.distance-=w+D;var B=n.SubtractVV(t.pointB,t.pointA);B.Normalize(),t.pointA.x+=w*B.x,t.pointA.y+=w*B.y,t.pointB.x-=D*B.x,t.pointB.y-=D*B.y}else h=new c,h.x=.5*(t.pointA.x+t.pointB.x),h.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=h.x,t.pointA.y=t.pointB.y=h.y,t.distance=0}},s.postDefs.push(function(){s.Collision.b2Distance.s_simplex=new L,s.Collision.b2Distance.s_saveA=new a(3),s.Collision.b2Distance.s_saveB=new a(3)}),d.b2DistanceInput=function(){},b.b2DistanceOutput=function(){this.pointA=new c,this.pointB=new c},v.b2DistanceProxy=function(){},v.prototype.Set=function(n){switch(n.GetType()){case o.e_circleShape:var s=n instanceof t?n:null;this.m_vertices=new r(1,!0),this.m_vertices[0]=s.m_p,this.m_count=1,this.m_radius=s.m_radius;break;case o.e_polygonShape:var a=n instanceof i?n:null;this.m_vertices=a.m_vertices,this.m_count=a.m_vertexCount,this.m_radius=a.m_radius;break;default:e.b2Assert(!1)}},v.prototype.GetSupport=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_count;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;n>o&&(i=e,o=n)}return i},v.prototype.GetSupportVertex=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_count;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;n>o&&(i=e,o=n)}return this.m_vertices[i]},v.prototype.GetVertexCount=function(){return this.m_count},v.prototype.GetVertex=function(t){return void 0===t&&(t=0),e.b2Assert(0<=t&&t<this.m_count),this.m_vertices[t]},C.b2DynamicTree=function(){},C.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},C.prototype.CreateProxy=function(t,i){var o=this.AllocateNode(),n=e.b2_aabbExtension,s=e.b2_aabbExtension;return o.aabb.lowerBound.x=t.lowerBound.x-n,o.aabb.lowerBound.y=t.lowerBound.y-s,o.aabb.upperBound.x=t.upperBound.x+n,o.aabb.upperBound.y=t.upperBound.y+s,o.userData=i,this.InsertLeaf(o),o},C.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},C.prototype.MoveProxy=function(t,i,o){if(e.b2Assert(t.IsLeaf()),t.aabb.Contains(i))return!1;this.RemoveLeaf(t);var n=e.b2_aabbExtension+e.b2_aabbMultiplier*(o.x>0?o.x:-o.x),s=e.b2_aabbExtension+e.b2_aabbMultiplier*(o.y>0?o.y:-o.y);return t.aabb.lowerBound.x=i.lowerBound.x-n,t.aabb.lowerBound.y=i.lowerBound.y-s,t.aabb.upperBound.x=i.upperBound.x+n,t.aabb.upperBound.y=i.upperBound.y+s,this.InsertLeaf(t),!0},C.prototype.Rebalance=function(t){if(void 0===t&&(t=0),null!=this.m_root)for(var i=0;i<t;i++){for(var o=this.m_root,e=0;0==o.IsLeaf();)o=this.m_path>>e&1?o.child2:o.child1,e=e+1&31;++this.m_path,this.RemoveLeaf(o),this.InsertLeaf(o)}},C.prototype.GetFatAABB=function(t){return t.aabb},C.prototype.GetUserData=function(t){return t.userData},C.prototype.Query=function(t,i){if(null!=this.m_root){var o=new r,e=0;for(o[e++]=this.m_root;e>0;){var n=o[--e];if(n.aabb.TestOverlap(i))if(n.IsLeaf()){var s=t(n);if(!s)return}else o[e++]=n.child1,o[e++]=n.child2}}},C.prototype.RayCast=function(t,i){if(null!=this.m_root){var o=i.p1,e=i.p2,s=n.SubtractVV(o,e);s.Normalize();var a=n.CrossFV(1,s),l=n.AbsV(a),m=i.maxFraction,c=new h,_=0,p=0;_=o.x+m*(e.x-o.x),p=o.y+m*(e.y-o.y),c.lowerBound.x=Math.min(o.x,_),c.lowerBound.y=Math.min(o.y,p),c.upperBound.x=Math.max(o.x,_),c.upperBound.y=Math.max(o.y,p);var y=new r,u=0;for(y[u++]=this.m_root;u>0;){var x=y[--u];if(0!=x.aabb.TestOverlap(c)){var f=x.aabb.GetCenter(),d=x.aabb.GetExtents();if(!(Math.abs(a.x*(o.x-f.x)+a.y*(o.y-f.y))-l.x*d.x-l.y*d.y>0))if(x.IsLeaf()){var b=new M;if(b.p1=i.p1,b.p2=i.p2,b.maxFraction=i.maxFraction,0==(m=t(b,x)))return;m>0&&(_=o.x+m*(e.x-o.x),p=o.y+m*(e.y-o.y),c.lowerBound.x=Math.min(o.x,_),c.lowerBound.y=Math.min(o.y,p),c.upperBound.x=Math.max(o.x,_),c.upperBound.y=Math.max(o.y,p))}else y[u++]=x.child1,y[u++]=x.child2}}}},C.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new S},C.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},C.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);var i=t.aabb.GetCenter(),o=this.m_root;if(0==o.IsLeaf())do{var e=o.child1,n=o.child2,s=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-i.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-i.y),r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-i.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-i.y);o=s<r?e:n}while(0==o.IsLeaf());var a=o.parent,l=this.AllocateNode();if(l.parent=a,l.userData=null,l.aabb.Combine(t.aabb,o.aabb),a){o.parent.child1==o?a.child1=l:a.child2=l,l.child1=o,l.child2=t,o.parent=l,t.parent=l;do{if(a.aabb.Contains(l.aabb))break;a.aabb.Combine(a.child1.aabb,a.child2.aabb),l=a,a=a.parent}while(a)}else l.child1=o,l.child2=t,o.parent=l,t.parent=l,this.m_root=l},C.prototype.RemoveLeaf=function(t){if(t==this.m_root)return void(this.m_root=null);var i,o=t.parent,e=o.parent;if(i=o.child1==t?o.child2:o.child1,e)for(e.child1==o?e.child1=i:e.child2=i,i.parent=e,this.FreeNode(o);e;){var n=e.aabb;if(e.aabb=h.Combine(e.child1.aabb,e.child2.aabb),n.Contains(e.aabb))break;e=e.parent}else this.m_root=i,i.parent=null,this.FreeNode(o)},A.b2DynamicTreeBroadPhase=function(){this.m_tree=new C,this.m_moveBuffer=new r,this.m_pairBuffer=new r,this.m_pairCount=0},A.prototype.CreateProxy=function(t,i){var o=this.m_tree.CreateProxy(t,i);return++this.m_proxyCount,this.BufferMove(o),o},A.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},A.prototype.MoveProxy=function(t,i,o){this.m_tree.MoveProxy(t,i,o)&&this.BufferMove(t)},A.prototype.TestOverlap=function(t,i){var o=this.m_tree.GetFatAABB(t),e=this.m_tree.GetFatAABB(i);return o.TestOverlap(e)},A.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},
A.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},A.prototype.GetProxyCount=function(){return this.m_proxyCount},A.prototype.UpdatePairs=function(t){function i(t){if(t==e)return!0;o.m_pairCount==o.m_pairBuffer.length&&(o.m_pairBuffer[o.m_pairCount]=new g);var i=o.m_pairBuffer[o.m_pairCount];return i.proxyA=t<e?t:e,i.proxyB=t>=e?t:e,++o.m_pairCount,!0}var o=this;o.m_pairCount=0;var e,n=0;for(n=0;n<o.m_moveBuffer.length;++n){e=o.m_moveBuffer[n];var s=o.m_tree.GetFatAABB(e);o.m_tree.Query(i,s)}o.m_moveBuffer.length=0;for(var n=0;n<o.m_pairCount;){var r=o.m_pairBuffer[n],a=o.m_tree.GetUserData(r.proxyA),l=o.m_tree.GetUserData(r.proxyB);for(t(a,l),++n;n<o.m_pairCount;){var m=o.m_pairBuffer[n];if(m.proxyA!=r.proxyA||m.proxyB!=r.proxyB)break;++n}}},A.prototype.Query=function(t,i){this.m_tree.Query(t,i)},A.prototype.RayCast=function(t,i){this.m_tree.RayCast(t,i)},A.prototype.Validate=function(){},A.prototype.Rebalance=function(t){void 0===t&&(t=0),this.m_tree.Rebalance(t)},A.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},A.prototype.UnBufferMove=function(t){var i=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(i,1)},A.prototype.ComparePairs=function(t,i){return 0},A.__implements={},A.__implements[N]=!0,S.b2DynamicTreeNode=function(){this.aabb=new h},S.prototype.IsLeaf=function(){return null==this.child1},g.b2DynamicTreePair=function(){},w.b2Manifold=function(){this.m_pointCount=0},w.prototype.b2Manifold=function(){this.m_points=new r(e.b2_maxManifoldPoints);for(var t=0;t<e.b2_maxManifoldPoints;t++)this.m_points[t]=new D;this.m_localPlaneNormal=new c,this.m_localPoint=new c},w.prototype.Reset=function(){for(var t=0;t<e.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof D?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},w.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var i=0;i<e.b2_maxManifoldPoints;i++)(this.m_points[i]instanceof D?this.m_points[i]:null).Set(t.m_points[i]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},w.prototype.Copy=function(){var t=new w;return t.Set(this),t},s.postDefs.push(function(){s.Collision.b2Manifold.e_circles=1,s.Collision.b2Manifold.e_faceA=2,s.Collision.b2Manifold.e_faceB=4}),D.b2ManifoldPoint=function(){this.m_localPoint=new c,this.m_id=new u},D.prototype.b2ManifoldPoint=function(){this.Reset()},D.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},D.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},B.b2Point=function(){this.p=new c},B.prototype.Support=function(t,i,o){return void 0===i&&(i=0),void 0===o&&(o=0),this.p},B.prototype.GetFirstVertex=function(t){return this.p},M.b2RayCastInput=function(){this.p1=new c,this.p2=new c},M.prototype.b2RayCastInput=function(t,i,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===o&&(o=1),t&&this.p1.SetV(t),i&&this.p2.SetV(i),this.maxFraction=o},V.b2RayCastOutput=function(){this.normal=new c},I.b2Segment=function(){this.p1=new c,this.p2=new c},I.prototype.TestSegment=function(t,i,o,e){void 0===e&&(e=0);var n=o.p1,s=o.p2.x-n.x,r=o.p2.y-n.y,a=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y,m=l,c=-a,h=100*Number.MIN_VALUE,_=-(s*m+r*c);if(_>h){var p=n.x-this.p1.x,y=n.y-this.p1.y,u=p*m+y*c;if(0<=u&&u<=e*_){var x=-s*y+r*p;if(-h*_<=x&&x<=_*(1+h)){u/=_;var f=Math.sqrt(m*m+c*c);return m/=f,c/=f,t[0]=u,i.Set(m,c),!0}}}return!1},I.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},I.prototype.ExtendForward=function(t){var i=this.p2.x-this.p1.x,o=this.p2.y-this.p1.y,e=Math.min(i>0?(t.upperBound.x-this.p1.x)/i:i<0?(t.lowerBound.x-this.p1.x)/i:Number.POSITIVE_INFINITY,o>0?(t.upperBound.y-this.p1.y)/o:o<0?(t.lowerBound.y-this.p1.y)/o:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+i*e,this.p2.y=this.p1.y+o*e},I.prototype.ExtendBackward=function(t){var i=-this.p2.x+this.p1.x,o=-this.p2.y+this.p1.y,e=Math.min(i>0?(t.upperBound.x-this.p2.x)/i:i<0?(t.lowerBound.x-this.p2.x)/i:Number.POSITIVE_INFINITY,o>0?(t.upperBound.y-this.p2.y)/o:o<0?(t.lowerBound.y-this.p2.y)/o:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+i*e,this.p1.y=this.p2.y+o*e},G.b2SeparationFunction=function(){this.m_localPoint=new c,this.m_axis=new c},G.prototype.Initialize=function(t,i,o,s,r){this.m_proxyA=i,this.m_proxyB=s;var a=parseInt(t.count);e.b2Assert(0<a&&a<3);var l,m,h,_,p,y,u,x,f=0,d=0,b=0,v=0,C=0,A=0,S=0;if(1==a)this.m_type=G.e_points,l=this.m_proxyA.GetVertex(t.indexA[0]),_=this.m_proxyB.GetVertex(t.indexB[0]),x=l,u=o.R,f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y),d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y),x=_,u=r.R,b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y),v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y),this.m_axis.x=b-f,this.m_axis.y=v-d,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=G.e_faceA,m=this.m_proxyA.GetVertex(t.indexA[0]),h=this.m_proxyA.GetVertex(t.indexA[1]),_=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(m.x+h.x),this.m_localPoint.y=.5*(m.y+h.y),this.m_axis=n.CrossVF(n.SubtractVV(h,m),1),this.m_axis.Normalize(),x=this.m_axis,u=o.R,C=u.col1.x*x.x+u.col2.x*x.y,A=u.col1.y*x.x+u.col2.y*x.y,x=this.m_localPoint,u=o.R,f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y),d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y),x=_,u=r.R,b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y),v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y),(S=(b-f)*C+(v-d)*A)<0&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=G.e_faceB,p=this.m_proxyB.GetVertex(t.indexB[0]),y=this.m_proxyB.GetVertex(t.indexB[1]),l=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(p.x+y.x),this.m_localPoint.y=.5*(p.y+y.y),this.m_axis=n.CrossVF(n.SubtractVV(y,p),1),this.m_axis.Normalize(),x=this.m_axis,u=r.R,C=u.col1.x*x.x+u.col2.x*x.y,A=u.col1.y*x.x+u.col2.y*x.y,x=this.m_localPoint,u=r.R,b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y),v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y),x=l,u=o.R,f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y),d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y),(S=(f-b)*C+(d-v)*A)<0&&this.m_axis.NegativeSelf();else{m=this.m_proxyA.GetVertex(t.indexA[0]),h=this.m_proxyA.GetVertex(t.indexA[1]),p=this.m_proxyB.GetVertex(t.indexB[0]),y=this.m_proxyB.GetVertex(t.indexB[1]);var g=(n.MulX(o,l),n.MulMV(o.R,n.SubtractVV(h,m))),w=(n.MulX(r,_),n.MulMV(r.R,n.SubtractVV(y,p))),D=g.x*g.x+g.y*g.y,B=w.x*w.x+w.y*w.y,M=n.SubtractVV(w,g),V=g.x*M.x+g.y*M.y,I=w.x*M.x+w.y*M.y,L=g.x*w.x+g.y*w.y,J=D*B-L*L;S=0,0!=J&&(S=n.Clamp((L*I-V*B)/J,0,1));var F=(L*S+I)/B;F<0&&(F=0,S=n.Clamp((L-V)/D,0,1)),l=new c,l.x=m.x+S*(h.x-m.x),l.y=m.y+S*(h.y-m.y),_=new c,_.x=p.x+S*(y.x-p.x),_.y=p.y+S*(y.y-p.y),0==S||1==S?(this.m_type=G.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(y,p),1),this.m_axis.Normalize(),this.m_localPoint=_,x=this.m_axis,u=r.R,C=u.col1.x*x.x+u.col2.x*x.y,A=u.col1.y*x.x+u.col2.y*x.y,x=this.m_localPoint,u=r.R,b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y),v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y),x=l,u=o.R,f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y),d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y),(f-b)*C+(d-v)*A,S<0&&this.m_axis.NegativeSelf()):(this.m_type=G.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(h,m),1),this.m_localPoint=l,x=this.m_axis,u=o.R,C=u.col1.x*x.x+u.col2.x*x.y,A=u.col1.y*x.x+u.col2.y*x.y,x=this.m_localPoint,u=o.R,f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y),d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y),x=_,u=r.R,b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y),v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y),(b-f)*C+(v-d)*A,S<0&&this.m_axis.NegativeSelf())}},G.prototype.Evaluate=function(t,i){var o,s,r,a,l,m,c;switch(this.m_type){case G.e_points:return o=n.MulTMV(t.R,this.m_axis),s=n.MulTMV(i.R,this.m_axis.GetNegative()),r=this.m_proxyA.GetSupportVertex(o),a=this.m_proxyB.GetSupportVertex(s),l=n.MulX(t,r),m=n.MulX(i,a),(m.x-l.x)*this.m_axis.x+(m.y-l.y)*this.m_axis.y;case G.e_faceA:return c=n.MulMV(t.R,this.m_axis),l=n.MulX(t,this.m_localPoint),s=n.MulTMV(i.R,c.GetNegative()),a=this.m_proxyB.GetSupportVertex(s),m=n.MulX(i,a),(m.x-l.x)*c.x+(m.y-l.y)*c.y;case G.e_faceB:return c=n.MulMV(i.R,this.m_axis),m=n.MulX(i,this.m_localPoint),o=n.MulTMV(t.R,c.GetNegative()),r=this.m_proxyA.GetSupportVertex(o),l=n.MulX(t,r),(l.x-m.x)*c.x+(l.y-m.y)*c.y;default:return e.b2Assert(!1),0}},s.postDefs.push(function(){s.Collision.b2SeparationFunction.e_points=1,s.Collision.b2SeparationFunction.e_faceA=2,s.Collision.b2SeparationFunction.e_faceB=4}),L.b2Simplex=function(){this.m_v1=new F,this.m_v2=new F,this.m_v3=new F,this.m_vertices=new r(3)},L.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},L.prototype.ReadCache=function(t,i,o,s,r){e.b2Assert(0<=t.count&&t.count<=3);var a,l;this.m_count=t.count;for(var m=this.m_vertices,c=0;c<this.m_count;c++){var h=m[c];h.indexA=t.indexA[c],h.indexB=t.indexB[c],a=i.GetVertex(h.indexA),l=s.GetVertex(h.indexB),h.wA=n.MulX(o,a),h.wB=n.MulX(r,l),h.w=n.SubtractVV(h.wB,h.wA),h.a=0}if(this.m_count>1){var _=t.metric,p=this.GetMetric();(p<.5*_||2*_<p||p<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(h=m[0],h.indexA=0,h.indexB=0,a=i.GetVertex(0),l=s.GetVertex(0),h.wA=n.MulX(o,a),h.wB=n.MulX(r,l),h.w=n.SubtractVV(h.wB,h.wA),this.m_count=1)},L.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=s.parseUInt(this.m_count);for(var i=this.m_vertices,o=0;o<this.m_count;o++)t.indexA[o]=s.parseUInt(i[o].indexA),t.indexB[o]=s.parseUInt(i[o].indexB)},L.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w);return n.CrossVV(t,this.m_v1.w.GetNegative())>0?n.CrossFV(1,t):n.CrossVF(t,1);default:return e.b2Assert(!1),new c}},L.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return e.b2Assert(!1),new c;case 1:return this.m_v1.w;case 2:return new c(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return e.b2Assert(!1),new c}},L.prototype.GetWitnessPoints=function(t,i){switch(this.m_count){case 0:e.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),i.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,i.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,i.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:i.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,i.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:e.b2Assert(!1)}},L.prototype.GetMetric=function(){switch(this.m_count){case 0:return e.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return e.b2Assert(!1),0}},L.prototype.Solve2=function(){var t=this.m_v1.w,i=this.m_v2.w,o=n.SubtractVV(i,t),e=-(t.x*o.x+t.y*o.y);if(e<=0)return this.m_v1.a=1,void(this.m_count=1);var s=i.x*o.x+i.y*o.y;if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var r=1/(s+e);this.m_v1.a=s*r,this.m_v2.a=e*r,this.m_count=2},L.prototype.Solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,o=this.m_v3.w,e=n.SubtractVV(i,t),s=n.Dot(t,e),r=n.Dot(i,e),a=r,l=-s,m=n.SubtractVV(o,t),c=n.Dot(t,m),h=n.Dot(o,m),_=h,p=-c,y=n.SubtractVV(o,i),u=n.Dot(i,y),x=n.Dot(o,y),f=x,d=-u,b=n.CrossVV(e,m),v=b*n.CrossVV(i,o),C=b*n.CrossVV(o,t),A=b*n.CrossVV(t,i);if(l<=0&&p<=0)return this.m_v1.a=1,void(this.m_count=1);if(a>0&&l>0&&A<=0){var S=1/(a+l);return this.m_v1.a=a*S,this.m_v2.a=l*S,void(this.m_count=2)}if(_>0&&p>0&&C<=0){var g=1/(_+p);return this.m_v1.a=_*g,this.m_v3.a=p*g,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(a<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(_<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(f>0&&d>0&&v<=0){var w=1/(f+d);return this.m_v2.a=f*w,this.m_v3.a=d*w,this.m_count=2,void this.m_v1.Set(this.m_v3)}var D=1/(v+C+A);this.m_v1.a=v*D,this.m_v2.a=C*D,this.m_v3.a=A*D,this.m_count=3},J.b2SimplexCache=function(){this.indexA=new a(3),this.indexB=new a(3)},F.b2SimplexVertex=function(){},F.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},P.b2TimeOfImpact=function(){},P.TimeOfImpact=function(t){++P.b2_toiCalls;var i=t.proxyA,o=t.proxyB,s=t.sweepA,r=t.sweepB;e.b2Assert(s.t0==r.t0),e.b2Assert(1-s.t0>Number.MIN_VALUE);var a=i.m_radius+o.m_radius,l=t.tolerance,m=0,c=0,h=0;for(P.s_cache.count=0,P.s_distanceInput.useRadii=!1;;){if(s.GetTransform(P.s_xfA,m),r.GetTransform(P.s_xfB,m),P.s_distanceInput.proxyA=i,P.s_distanceInput.proxyB=o,P.s_distanceInput.transformA=P.s_xfA,P.s_distanceInput.transformB=P.s_xfB,f.Distance(P.s_distanceOutput,P.s_cache,P.s_distanceInput),P.s_distanceOutput.distance<=0){m=1;break}P.s_fcn.Initialize(P.s_cache,i,P.s_xfA,o,P.s_xfB);var _=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(_<=0){m=1;break}if(0==c&&(h=_>a?n.Max(a-l,.75*a):n.Max(_-l,.02*a)),_-h<.5*l){if(0==c){m=1;break}break}var p=m,y=m,u=1,x=_;s.GetTransform(P.s_xfA,u),r.GetTransform(P.s_xfB,u);var d=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(d>=h){m=1;break}for(var b=0;;){var v=0;v=1&b?y+(h-x)*(u-y)/(d-x):.5*(y+u),s.GetTransform(P.s_xfA,v),r.GetTransform(P.s_xfB,v);var C=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(n.Abs(C-h)<.025*l){p=v;break}if(C>h?(y=v,x=C):(u=v,d=C),++b,++P.b2_toiRootIters,50==b)break}if(P.b2_toiMaxRootIters=n.Max(P.b2_toiMaxRootIters,b),p<(1+100*Number.MIN_VALUE)*m)break;if(m=p,c++,++P.b2_toiIters,1e3==c)break}return P.b2_toiMaxIters=n.Max(P.b2_toiMaxIters,c),m},s.postDefs.push(function(){s.Collision.b2TimeOfImpact.b2_toiCalls=0,s.Collision.b2TimeOfImpact.b2_toiIters=0,s.Collision.b2TimeOfImpact.b2_toiMaxIters=0,s.Collision.b2TimeOfImpact.b2_toiRootIters=0,s.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,s.Collision.b2TimeOfImpact.s_cache=new J,s.Collision.b2TimeOfImpact.s_distanceInput=new d,s.Collision.b2TimeOfImpact.s_xfA=new m,s.Collision.b2TimeOfImpact.s_xfB=new m,s.Collision.b2TimeOfImpact.s_fcn=new G,s.Collision.b2TimeOfImpact.s_distanceOutput=new b}),R.b2TOIInput=function(){this.proxyA=new v,this.proxyB=new v,this.sweepA=new l,this.sweepB=new l},T.b2WorldManifold=function(){this.m_normal=new c},T.prototype.b2WorldManifold=function(){this.m_points=new r(e.b2_maxManifoldPoints);for(var t=0;t<e.b2_maxManifoldPoints;t++)this.m_points[t]=new c},T.prototype.Initialize=function(t,i,o,e,n){if(void 0===o&&(o=0),void 0===n&&(n=0),0!=t.m_pointCount){var s,r,a=0,l=0,m=0,c=0,h=0,_=0,p=0;switch(t.m_type){case w.e_circles:r=i.R,s=t.m_localPoint;var y=i.position.x+r.col1.x*s.x+r.col2.x*s.y,u=i.position.y+r.col1.y*s.x+r.col2.y*s.y;r=e.R,s=t.m_points[0].m_localPoint;var x=e.position.x+r.col1.x*s.x+r.col2.x*s.y,f=e.position.y+r.col1.y*s.x+r.col2.y*s.y,d=x-y,b=f-u,v=d*d+b*b;if(v>Number.MIN_VALUE*Number.MIN_VALUE){var C=Math.sqrt(v);this.m_normal.x=d/C,this.m_normal.y=b/C}else this.m_normal.x=1,this.m_normal.y=0;var A=y+o*this.m_normal.x,S=u+o*this.m_normal.y,g=x-n*this.m_normal.x,D=f-n*this.m_normal.y;this.m_points[0].x=.5*(A+g),this.m_points[0].y=.5*(S+D);break;case w.e_faceA:for(r=i.R,s=t.m_localPlaneNormal,l=r.col1.x*s.x+r.col2.x*s.y,m=r.col1.y*s.x+r.col2.y*s.y,r=i.R,s=t.m_localPoint,c=i.position.x+r.col1.x*s.x+r.col2.x*s.y,h=i.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=l,this.m_normal.y=m,a=0;a<t.m_pointCount;a++)r=e.R,s=t.m_points[a].m_localPoint,_=e.position.x+r.col1.x*s.x+r.col2.x*s.y,p=e.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(o-(_-c)*l-(p-h)*m-n)*l,this.m_points[a].y=p+.5*(o-(_-c)*l-(p-h)*m-n)*m;break;case w.e_faceB:for(r=e.R,s=t.m_localPlaneNormal,l=r.col1.x*s.x+r.col2.x*s.y,m=r.col1.y*s.x+r.col2.y*s.y,r=e.R,s=t.m_localPoint,c=e.position.x+r.col1.x*s.x+r.col2.x*s.y,h=e.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=-l,this.m_normal.y=-m,a=0;a<t.m_pointCount;a++)r=i.R,s=t.m_points[a].m_localPoint,_=i.position.x+r.col1.x*s.x+r.col2.x*s.y,p=i.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(n-(_-c)*l-(p-h)*m-o)*l,this.m_points[a].y=p+.5*(n-(_-c)*l-(p-h)*m-o)*m}}},k.ClipVertex=function(){this.v=new c,this.id=new u},k.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},z.Features=function(){},Object.defineProperty(z.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(z.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._referenceEdge=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(z.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(z.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(z.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(z.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(z.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(z.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){var t=(s.Common.b2Color,s.Common.b2internal,s.Common.b2Settings),i=s.Collision.Shapes.b2CircleShape,o=s.Collision.Shapes.b2EdgeChainDef,e=s.Collision.Shapes.b2EdgeShape,n=s.Collision.Shapes.b2MassData,l=s.Collision.Shapes.b2PolygonShape,m=s.Collision.Shapes.b2Shape,c=s.Common.Math.b2Mat22,h=(s.Common.Math.b2Mat33,s.Common.Math.b2Math),_=(s.Common.Math.b2Sweep,s.Common.Math.b2Transform),p=s.Common.Math.b2Vec2,y=(s.Common.Math.b2Vec3,s.Dynamics.b2Body,s.Dynamics.b2BodyDef,s.Dynamics.b2ContactFilter,s.Dynamics.b2ContactImpulse,s.Dynamics.b2ContactListener,s.Dynamics.b2ContactManager,s.Dynamics.b2DebugDraw,s.Dynamics.b2DestructionListener,s.Dynamics.b2FilterData,s.Dynamics.b2Fixture,s.Dynamics.b2FixtureDef,s.Dynamics.b2Island,s.Dynamics.b2TimeStep,s.Dynamics.b2World,s.Collision.b2AABB,s.Collision.b2Bound,s.Collision.b2BoundValues,s.Collision.b2Collision,s.Collision.b2ContactID,s.Collision.b2ContactPoint,s.Collision.b2Distance),u=s.Collision.b2DistanceInput,x=s.Collision.b2DistanceOutput,f=s.Collision.b2DistanceProxy,d=(s.Collision.b2DynamicTree,s.Collision.b2DynamicTreeBroadPhase,s.Collision.b2DynamicTreeNode,s.Collision.b2DynamicTreePair,s.Collision.b2Manifold,s.Collision.b2ManifoldPoint,s.Collision.b2Point,s.Collision.b2RayCastInput,s.Collision.b2RayCastOutput,s.Collision.b2Segment,s.Collision.b2SeparationFunction,s.Collision.b2Simplex,s.Collision.b2SimplexCache);s.Collision.b2SimplexVertex,s.Collision.b2TimeOfImpact,s.Collision.b2TOIInput,s.Collision.b2WorldManifold,s.Collision.ClipVertex,s.Collision.Features,s.Collision.IBroadPhase;s.inherit(i,s.Collision.Shapes.b2Shape),i.prototype.__super=s.Collision.Shapes.b2Shape.prototype,i.b2CircleShape=function(){s.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new p},i.prototype.Copy=function(){var t=new i;return t.Set(this),t},i.prototype.Set=function(t){if(this.__super.Set.call(this,t),s.is(t,i)){var o=t instanceof i?t:null;this.m_p.SetV(o.m_p)}},i.prototype.TestPoint=function(t,i){var o=t.R,e=t.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),n=t.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);return e=i.x-e,n=i.y-n,e*e+n*n<=this.m_radius*this.m_radius},i.prototype.RayCast=function(t,i,o){var e=o.R,n=o.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),s=o.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),r=i.p1.x-n,a=i.p1.y-s,l=r*r+a*a-this.m_radius*this.m_radius,m=i.p2.x-i.p1.x,c=i.p2.y-i.p1.y,h=r*m+a*c,_=m*m+c*c,p=h*h-_*l;if(p<0||_<Number.MIN_VALUE)return!1;var y=-(h+Math.sqrt(p));return 0<=y&&y<=i.maxFraction*_&&(y/=_,t.fraction=y,t.normal.x=r+y*m,t.normal.y=a+y*c,t.normal.Normalize(),!0)},i.prototype.ComputeAABB=function(t,i){var o=i.R,e=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),n=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);t.lowerBound.Set(e-this.m_radius,n-this.m_radius),t.upperBound.Set(e+this.m_radius,n+this.m_radius)},i.prototype.ComputeMass=function(i,o){void 0===o&&(o=0),i.mass=o*t.b2_pi*this.m_radius*this.m_radius,i.center.SetV(this.m_p),i.I=i.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},i.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var n=h.MulX(o,this.m_p),s=-(h.Dot(t,n)-i);if(s<-this.m_radius+Number.MIN_VALUE)return 0;if(s>this.m_radius)return e.SetV(n),Math.PI*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,a=s*s,l=r*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(r-a),m=-2/3*Math.pow(r-a,1.5)/l;return e.x=n.x+t.x*m,e.y=n.y+t.y*m,l},i.prototype.GetLocalPosition=function(){return this.m_p},i.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},i.prototype.GetRadius=function(){return this.m_radius},i.prototype.SetRadius=function(t){void 0===t&&(t=0),this.m_radius=t},i.prototype.b2CircleShape=function(t){void 0===t&&(t=0),this.__super.b2Shape.call(this),this.m_type=m.e_circleShape,this.m_radius=t},o.b2EdgeChainDef=function(){},o.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},s.inherit(e,s.Collision.Shapes.b2Shape),e.prototype.__super=s.Collision.Shapes.b2Shape.prototype,e.b2EdgeShape=function(){s.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new p,this.m_v1=new p,this.m_v2=new p,this.m_coreV1=new p,this.m_coreV2=new p,this.m_normal=new p,this.m_direction=new p,this.m_cornerDir1=new p,this.m_cornerDir2=new p},e.prototype.TestPoint=function(t,i){return!1},e.prototype.RayCast=function(t,i,o){var e,n=i.p2.x-i.p1.x,s=i.p2.y-i.p1.y;e=o.R;var r=o.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),a=o.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),l=o.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y)-a,m=-(o.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y)-r),c=100*Number.MIN_VALUE,h=-(n*l+s*m);if(h>c){var _=i.p1.x-r,p=i.p1.y-a,y=_*l+p*m;if(0<=y&&y<=i.maxFraction*h){var u=-n*p+s*_;if(-c*h<=u&&u<=h*(1+c)){y/=h,t.fraction=y;var x=Math.sqrt(l*l+m*m);return t.normal.x=l/x,t.normal.y=m/x,!0}}}return!1},e.prototype.ComputeAABB=function(t,i){var o=i.R,e=i.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),n=i.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),s=i.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y),r=i.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y);e<s?(t.lowerBound.x=e,t.upperBound.x=s):(t.lowerBound.x=s,t.upperBound.x=e),n<r?(t.lowerBound.y=n,t.upperBound.y=r):(t.lowerBound.y=r,t.upperBound.y=n)},e.prototype.ComputeMass=function(t,i){void 0===i&&(i=0),t.mass=0,t.center.SetV(this.m_v1),t.I=0},e.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var n=new p(t.x*i,t.y*i),s=h.MulX(o,this.m_v1),r=h.MulX(o,this.m_v2),a=h.Dot(t,s)-i,l=h.Dot(t,r)-i;if(a>0){if(l>0)return 0;s.x=-l/(a-l)*s.x+a/(a-l)*r.x,s.y=-l/(a-l)*s.y+a/(a-l)*r.y}else l>0&&(r.x=-l/(a-l)*s.x+a/(a-l)*r.x,r.y=-l/(a-l)*s.y+a/(a-l)*r.y);return e.x=(n.x+s.x+r.x)/3,e.y=(n.y+s.y+r.y)/3,.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))},e.prototype.GetLength=function(){return this.m_length},e.prototype.GetVertex1=function(){return this.m_v1},e.prototype.GetVertex2=function(){return this.m_v2},e.prototype.GetCoreVertex1=function(){return this.m_coreV1},e.prototype.GetCoreVertex2=function(){return this.m_coreV2},e.prototype.GetNormalVector=function(){return this.m_normal},e.prototype.GetDirectionVector=function(){return this.m_direction},e.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},e.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},e.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},e.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},e.prototype.GetFirstVertex=function(t){var i=t.R;return new p(t.position.x+(i.col1.x*this.m_coreV1.x+i.col2.x*this.m_coreV1.y),t.position.y+(i.col1.y*this.m_coreV1.x+i.col2.y*this.m_coreV1.y))},e.prototype.GetNextEdge=function(){return this.m_nextEdge},e.prototype.GetPrevEdge=function(){return this.m_prevEdge},e.prototype.Support=function(t,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var e=t.R,n=t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),s=t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y),r=t.position.x+(e.col1.x*this.m_coreV2.x+e.col2.x*this.m_coreV2.y),a=t.position.y+(e.col1.y*this.m_coreV2.x+e.col2.y*this.m_coreV2.y);return n*i+s*o>r*i+a*o?(this.s_supportVec.x=n,this.s_supportVec.y=s):(this.s_supportVec.x=r,this.s_supportVec.y=a),this.s_supportVec},e.prototype.b2EdgeShape=function(i,o){this.__super.b2Shape.call(this),this.m_type=m.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=i,this.m_v2=o,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},e.prototype.SetPrevEdge=function(t,i,o,e){this.m_prevEdge=t,this.m_coreV1=i,this.m_cornerDir1=o,this.m_cornerConvex1=e},e.prototype.SetNextEdge=function(t,i,o,e){this.m_nextEdge=t,this.m_coreV2=i,this.m_cornerDir2=o,this.m_cornerConvex2=e},n.b2MassData=function(){this.mass=0,this.center=new p(0,0),this.I=0},s.inherit(l,s.Collision.Shapes.b2Shape),l.prototype.__super=s.Collision.Shapes.b2Shape.prototype,l.b2PolygonShape=function(){s.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},l.prototype.Copy=function(){var t=new l;return t.Set(this),t},l.prototype.Set=function(t){if(this.__super.Set.call(this,t),s.is(t,l)){var i=t instanceof l?t:null;this.m_centroid.SetV(i.m_centroid),this.m_vertexCount=i.m_vertexCount,this.Reserve(this.m_vertexCount);for(var o=0;o<this.m_vertexCount;o++)this.m_vertices[o].SetV(i.m_vertices[o]),this.m_normals[o].SetV(i.m_normals[o])}},l.prototype.SetAsArray=function(t,i){void 0===i&&(i=0);var o,e=new r,n=0;for(n=0;n<t.length;++n)o=t[n],e.push(o);this.SetAsVector(e,i)},l.AsArray=function(t,i){void 0===i&&(i=0);var o=new l;return o.SetAsArray(t,i),o},l.prototype.SetAsVector=function(i,o){void 0===o&&(o=0),0==o&&(o=i.length),t.b2Assert(2<=o),this.m_vertexCount=o,this.Reserve(o);var e=0;for(e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(i[e]);for(e=0;e<this.m_vertexCount;++e){var n=parseInt(e),s=parseInt(e+1<this.m_vertexCount?e+1:0),r=h.SubtractVV(this.m_vertices[s],this.m_vertices[n]);t.b2Assert(r.LengthSquared()>Number.MIN_VALUE),this.m_normals[e].SetV(h.CrossVF(r,1)),this.m_normals[e].Normalize()}this.m_centroid=l.ComputeCentroid(this.m_vertices,this.m_vertexCount)},l.AsVector=function(t,i){void 0===i&&(i=0);var o=new l;return o.SetAsVector(t,i),o},l.prototype.SetAsBox=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-i),this.m_vertices[1].Set(t,-i),this.m_vertices[2].Set(t,i),this.m_vertices[3].Set(-t,i),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},l.AsBox=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0);var o=new l;return o.SetAsBox(t,i),o},l.prototype.SetAsOrientedBox=function(t,i,o,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=null),void 0===e&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-i),this.m_vertices[1].Set(t,-i),this.m_vertices[2].Set(t,i),this.m_vertices[3].Set(-t,i),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=o;var n=new _;n.position=o,n.R.Set(e);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=h.MulX(n,this.m_vertices[s]),this.m_normals[s]=h.MulMV(n.R,this.m_normals[s])},l.AsOrientedBox=function(t,i,o,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=null),void 0===e&&(e=0);var n=new l;return n.SetAsOrientedBox(t,i,o,e),n},l.prototype.SetAsEdge=function(t,i){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(i),this.m_centroid.x=.5*(t.x+i.x),this.m_centroid.y=.5*(t.y+i.y),this.m_normals[0]=h.CrossVF(h.SubtractVV(i,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},l.AsEdge=function(t,i){var o=new l;return o.SetAsEdge(t,i),o},l.prototype.TestPoint=function(t,i){for(var o,e=t.R,n=i.x-t.position.x,s=i.y-t.position.y,r=n*e.col1.x+s*e.col1.y,a=n*e.col2.x+s*e.col2.y,l=0;l<this.m_vertexCount;++l){o=this.m_vertices[l],n=r-o.x,s=a-o.y,o=this.m_normals[l];if(o.x*n+o.y*s>0)return!1}return!0},l.prototype.RayCast=function(t,i,o){var e,n,s=0,r=i.maxFraction,a=0,l=0;a=i.p1.x-o.position.x,l=i.p1.y-o.position.y,e=o.R;var m=a*e.col1.x+l*e.col1.y,c=a*e.col2.x+l*e.col2.y;a=i.p2.x-o.position.x,l=i.p2.y-o.position.y,e=o.R;for(var h=a*e.col1.x+l*e.col1.y,_=a*e.col2.x+l*e.col2.y,p=h-m,y=_-c,u=parseInt(-1),x=0;x<this.m_vertexCount;++x){n=this.m_vertices[x],a=n.x-m,l=n.y-c,n=this.m_normals[x];var f=n.x*a+n.y*l,d=n.x*p+n.y*y;if(0==d){if(f<0)return!1}else d<0&&f<s*d?(s=f/d,u=x):d>0&&f<r*d&&(r=f/d);if(r<s-Number.MIN_VALUE)return!1}return u>=0&&(t.fraction=s,e=o.R,n=this.m_normals[u],t.normal.x=e.col1.x*n.x+e.col2.x*n.y,t.normal.y=e.col1.y*n.x+e.col2.y*n.y,!0)},l.prototype.ComputeAABB=function(t,i){for(var o=i.R,e=this.m_vertices[0],n=i.position.x+(o.col1.x*e.x+o.col2.x*e.y),s=i.position.y+(o.col1.y*e.x+o.col2.y*e.y),r=n,a=s,l=1;l<this.m_vertexCount;++l){e=this.m_vertices[l];var m=i.position.x+(o.col1.x*e.x+o.col2.x*e.y),c=i.position.y+(o.col1.y*e.x+o.col2.y*e.y);n=n<m?n:m,s=s<c?s:c,r=r>m?r:m,a=a>c?a:c}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=s-this.m_radius,t.upperBound.x=r+this.m_radius,t.upperBound.y=a+this.m_radius},l.prototype.ComputeMass=function(t,i){if(void 0===i&&(i=0),2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,void(t.I=0);for(var o=0,e=0,n=0,s=0,r=0;r<this.m_vertexCount;++r){var a=this.m_vertices[r],l=r+1<this.m_vertexCount?this.m_vertices[parseInt(r+1)]:this.m_vertices[0],m=a.x-0,c=a.y-0,h=l.x-0,_=l.y-0,p=m*_-c*h,y=.5*p;n+=y,o+=y*(1/3)*(0+a.x+l.x),e+=y*(1/3)*(0+a.y+l.y);var u=m,x=c,f=h,d=_;s+=p*(1/3*(.25*(u*u+f*u+f*f)+(0*u+0*f))+0+(1/3*(.25*(x*x+d*x+d*d)+(0*x+0*d))+0))}t.mass=i*n,o*=1/n,e*=1/n,t.center.Set(o,e),t.I=i*s},l.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var s=h.MulTMV(o.R,t),r=i-h.Dot(t,o.position),l=new a,m=0,c=parseInt(-1),_=parseInt(-1),y=!1,u=0;for(u=0;u<this.m_vertexCount;++u){l[u]=h.Dot(s,this.m_vertices[u])-r;var x=l[u]<-Number.MIN_VALUE;u>0&&(x?y||(c=u-1,m++):y&&(_=u-1,m++)),y=x}switch(m){case 0:if(y){var f=new n;return this.ComputeMass(f,1),e.SetV(h.MulX(o,f.center)),f.mass}return 0;case 1:-1==c?c=this.m_vertexCount-1:_=this.m_vertexCount-1}
var d,b=parseInt((c+1)%this.m_vertexCount),v=parseInt((_+1)%this.m_vertexCount),C=(0-l[c])/(l[b]-l[c]),A=(0-l[_])/(l[v]-l[_]),S=new p(this.m_vertices[c].x*(1-C)+this.m_vertices[b].x*C,this.m_vertices[c].y*(1-C)+this.m_vertices[b].y*C),g=new p(this.m_vertices[_].x*(1-A)+this.m_vertices[v].x*A,this.m_vertices[_].y*(1-A)+this.m_vertices[v].y*A),w=0,D=new p,B=this.m_vertices[b];for(u=b;u!=v;){u=(u+1)%this.m_vertexCount,d=u==v?g:this.m_vertices[u];var M=.5*((B.x-S.x)*(d.y-S.y)-(B.y-S.y)*(d.x-S.x));w+=M,D.x+=M*(S.x+B.x+d.x)/3,D.y+=M*(S.y+B.y+d.y)/3,B=d}return D.Multiply(1/w),e.SetV(h.MulX(o,D)),w},l.prototype.GetVertexCount=function(){return this.m_vertexCount},l.prototype.GetVertices=function(){return this.m_vertices},l.prototype.GetNormals=function(){return this.m_normals},l.prototype.GetSupport=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_vertexCount;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;n>o&&(i=e,o=n)}return i},l.prototype.GetSupportVertex=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_vertexCount;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;n>o&&(i=e,o=n)}return this.m_vertices[i]},l.prototype.Validate=function(){return!1},l.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=m.e_polygonShape,this.m_centroid=new p,this.m_vertices=new r,this.m_normals=new r},l.prototype.Reserve=function(t){void 0===t&&(t=0);for(var i=parseInt(this.m_vertices.length);i<t;i++)this.m_vertices[i]=new p,this.m_normals[i]=new p},l.ComputeCentroid=function(t,i){void 0===i&&(i=0);for(var o=new p,e=0,n=0;n<i;++n){var s=t[n],r=n+1<i?t[parseInt(n+1)]:t[0],a=s.x-0,l=s.y-0,m=r.x-0,c=r.y-0,h=a*c-l*m,_=.5*h;e+=_,o.x+=_*(1/3)*(0+s.x+r.x),o.y+=_*(1/3)*(0+s.y+r.y)}return o.x*=1/e,o.y*=1/e,o},l.ComputeOBB=function(t,i,o){void 0===o&&(o=0);var e=0,n=new r(o+1);for(e=0;e<o;++e)n[e]=i[e];n[o]=n[0];var s=Number.MAX_VALUE;for(e=1;e<=o;++e){var a=n[parseInt(e-1)],l=n[e].x-a.x,m=n[e].y-a.y,c=Math.sqrt(l*l+m*m);l/=c,m/=c;for(var h=-m,_=l,p=Number.MAX_VALUE,y=Number.MAX_VALUE,u=-Number.MAX_VALUE,x=-Number.MAX_VALUE,f=0;f<o;++f){var d=n[f].x-a.x,b=n[f].y-a.y,v=l*d+m*b,C=h*d+_*b;v<p&&(p=v),C<y&&(y=C),v>u&&(u=v),C>x&&(x=C)}var A=(u-p)*(x-y);if(A<.95*s){s=A,t.R.col1.x=l,t.R.col1.y=m,t.R.col2.x=h,t.R.col2.y=_;var S=.5*(p+u),g=.5*(y+x),w=t.R;t.center.x=a.x+(w.col1.x*S+w.col2.x*g),t.center.y=a.y+(w.col1.y*S+w.col2.y*g),t.extents.x=.5*(u-p),t.extents.y=.5*(x-y)}}},s.postDefs.push(function(){s.Collision.Shapes.b2PolygonShape.s_mat=new c}),m.b2Shape=function(){},m.prototype.Copy=function(){return null},m.prototype.Set=function(t){this.m_radius=t.m_radius},m.prototype.GetType=function(){return this.m_type},m.prototype.TestPoint=function(t,i){return!1},m.prototype.RayCast=function(t,i,o){return!1},m.prototype.ComputeAABB=function(t,i){},m.prototype.ComputeMass=function(t,i){void 0===i&&(i=0)},m.prototype.ComputeSubmergedArea=function(t,i,o,e){return void 0===i&&(i=0),0},m.TestOverlap=function(t,i,o,e){var n=new u;n.proxyA=new f,n.proxyA.Set(t),n.proxyB=new f,n.proxyB.Set(o),n.transformA=i,n.transformB=e,n.useRadii=!0;var s=new d;s.count=0;var r=new x;return y.Distance(r,s,n),r.distance<10*Number.MIN_VALUE},m.prototype.b2Shape=function(){this.m_type=m.e_unknownShape,this.m_radius=t.b2_linearSlop},s.postDefs.push(function(){s.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),s.Collision.Shapes.b2Shape.e_circleShape=0,s.Collision.Shapes.b2Shape.e_polygonShape=1,s.Collision.Shapes.b2Shape.e_edgeShape=2,s.Collision.Shapes.b2Shape.e_shapeTypeCount=3,s.Collision.Shapes.b2Shape.e_hitCollide=1,s.Collision.Shapes.b2Shape.e_missCollide=0,s.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=s.Common.b2Color,i=(s.Common.b2internal,s.Common.b2Settings),o=(s.Common.Math.b2Mat22,s.Common.Math.b2Mat33,s.Common.Math.b2Math);s.Common.Math.b2Sweep,s.Common.Math.b2Transform,s.Common.Math.b2Vec2,s.Common.Math.b2Vec3;t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),this._r=s.parseUInt(255*o.Clamp(t,0,1)),this._g=s.parseUInt(255*o.Clamp(i,0,1)),this._b=s.parseUInt(255*o.Clamp(e,0,1))},t.prototype.Set=function(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),this._r=s.parseUInt(255*o.Clamp(t,0,1)),this._g=s.parseUInt(255*o.Clamp(i,0,1)),this._b=s.parseUInt(255*o.Clamp(e,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._r=s.parseUInt(255*o.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._g=s.parseUInt(255*o.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._b=s.parseUInt(255*o.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),i.b2Settings=function(){},i.b2MixFriction=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),Math.sqrt(t*i)},i.b2MixRestitution=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),t>i?t:i},i.b2Assert=function(t){if(!t)throw"Assertion Failed"},s.postDefs.push(function(){s.Common.b2Settings.VERSION="2.1alpha",s.Common.b2Settings.USHRT_MAX=65535,s.Common.b2Settings.b2_pi=Math.PI,s.Common.b2Settings.b2_maxManifoldPoints=2,s.Common.b2Settings.b2_aabbExtension=.1,s.Common.b2Settings.b2_aabbMultiplier=2,s.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop,s.Common.b2Settings.b2_linearSlop=.005,s.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi,s.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop,s.Common.b2Settings.b2_maxTOIContactsPerIsland=32,s.Common.b2Settings.b2_maxTOIJointsPerIsland=32,s.Common.b2Settings.b2_velocityThreshold=1,s.Common.b2Settings.b2_maxLinearCorrection=.2,s.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi,s.Common.b2Settings.b2_maxTranslation=2,s.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation,s.Common.b2Settings.b2_maxRotation=.5*i.b2_pi,s.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation,s.Common.b2Settings.b2_contactBaumgarte=.2,s.Common.b2Settings.b2_timeToSleep=.5,s.Common.b2Settings.b2_linearSleepTolerance=.01,s.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})}(),function(){var t=(s.Collision.b2AABB,s.Common.b2Color,s.Common.b2internal,s.Common.b2Settings,s.Common.Math.b2Mat22),i=s.Common.Math.b2Mat33,o=s.Common.Math.b2Math,e=s.Common.Math.b2Sweep,n=s.Common.Math.b2Transform,r=s.Common.Math.b2Vec2,a=s.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new r,this.col2=new r},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(i){void 0===i&&(i=0);var o=new t;return o.Set(i),o},t.FromVV=function(i,o){var e=new t;return e.SetVV(i,o),e},t.prototype.Set=function(t){void 0===t&&(t=0);var i=Math.cos(t),o=Math.sin(t);this.col1.x=i,this.col2.x=-o,this.col1.y=o,this.col2.y=i},t.prototype.SetVV=function(t,i){this.col1.SetV(t),this.col2.SetV(i)},t.prototype.Copy=function(){var i=new t;return i.SetM(this),i},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var i=this.col1.x,o=this.col2.x,e=this.col1.y,n=this.col2.y,s=i*n-o*e;return 0!=s&&(s=1/s),t.col1.x=s*n,t.col2.x=-s*o,t.col1.y=-s*e,t.col2.y=s*i,t},t.prototype.Solve=function(t,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var e=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=e*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*i-n*o),t.y=a*(e*o-s*i),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},i.b2Mat33=function(){this.col1=new a,this.col2=new a,this.col3=new a},i.prototype.b2Mat33=function(t,i,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===o&&(o=null),t||i||o?(this.col1.SetV(t),this.col2.SetV(i),this.col3.SetV(o)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},i.prototype.SetVVV=function(t,i,o){this.col1.SetV(t),this.col2.SetV(i),this.col3.SetV(o)},i.prototype.Copy=function(){return new i(this.col1,this.col2,this.col3)},i.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},i.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},i.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},i.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},i.prototype.Solve22=function(t,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var e=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=e*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*i-n*o),t.y=a*(e*o-s*i),t},i.prototype.Solve33=function(t,i,o,e){void 0===i&&(i=0),void 0===o&&(o=0),void 0===e&&(e=0);var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,l=this.col2.y,m=this.col2.z,c=this.col3.x,h=this.col3.y,_=this.col3.z,p=n*(l*_-m*h)+s*(m*c-a*_)+r*(a*h-l*c);return 0!=p&&(p=1/p),t.x=p*(i*(l*_-m*h)+o*(m*c-a*_)+e*(a*h-l*c)),t.y=p*(n*(o*_-e*h)+s*(e*c-i*_)+r*(i*h-o*c)),t.z=p*(n*(l*e-m*o)+s*(m*i-a*e)+r*(a*o-l*i)),t},o.b2Math=function(){},o.IsValid=function(t){return void 0===t&&(t=0),isFinite(t)},o.Dot=function(t,i){return t.x*i.x+t.y*i.y},o.CrossVV=function(t,i){return t.x*i.y-t.y*i.x},o.CrossVF=function(t,i){return void 0===i&&(i=0),new r(i*t.y,-i*t.x)},o.CrossFV=function(t,i){return void 0===t&&(t=0),new r(-t*i.y,t*i.x)},o.MulMV=function(t,i){return new r(t.col1.x*i.x+t.col2.x*i.y,t.col1.y*i.x+t.col2.y*i.y)},o.MulTMV=function(t,i){return new r(o.Dot(i,t.col1),o.Dot(i,t.col2))},o.MulX=function(t,i){var e=o.MulMV(t.R,i);return e.x+=t.position.x,e.y+=t.position.y,e},o.MulXT=function(t,i){var e=o.SubtractVV(i,t.position),n=e.x*t.R.col1.x+e.y*t.R.col1.y;return e.y=e.x*t.R.col2.x+e.y*t.R.col2.y,e.x=n,e},o.AddVV=function(t,i){return new r(t.x+i.x,t.y+i.y)},o.SubtractVV=function(t,i){return new r(t.x-i.x,t.y-i.y)},o.Distance=function(t,i){var o=t.x-i.x,e=t.y-i.y;return Math.sqrt(o*o+e*e)},o.DistanceSquared=function(t,i){var o=t.x-i.x,e=t.y-i.y;return o*o+e*e},o.MulFV=function(t,i){return void 0===t&&(t=0),new r(t*i.x,t*i.y)},o.AddMM=function(i,e){return t.FromVV(o.AddVV(i.col1,e.col1),o.AddVV(i.col2,e.col2))},o.MulMM=function(i,e){return t.FromVV(o.MulMV(i,e.col1),o.MulMV(i,e.col2))},o.MulTMM=function(i,e){var n=new r(o.Dot(i.col1,e.col1),o.Dot(i.col2,e.col1)),s=new r(o.Dot(i.col1,e.col2),o.Dot(i.col2,e.col2));return t.FromVV(n,s)},o.Abs=function(t){return void 0===t&&(t=0),t>0?t:-t},o.AbsV=function(t){return new r(o.Abs(t.x),o.Abs(t.y))},o.AbsM=function(i){return t.FromVV(o.AbsV(i.col1),o.AbsV(i.col2))},o.Min=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),t<i?t:i},o.MinV=function(t,i){return new r(o.Min(t.x,i.x),o.Min(t.y,i.y))},o.Max=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),t>i?t:i},o.MaxV=function(t,i){return new r(o.Max(t.x,i.x),o.Max(t.y,i.y))},o.Clamp=function(t,i,o){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),t<i?i:t>o?o:t},o.ClampV=function(t,i,e){return o.MaxV(i,o.MinV(t,e))},o.Swap=function(t,i){var o=t[0];t[0]=i[0],i[0]=o},o.Random=function(){return 2*Math.random()-1},o.RandomRange=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0);var o=Math.random();return o=(i-t)*o+t},o.NextPowerOfTwo=function(t){return void 0===t&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1},o.IsPowerOfTwo=function(t){return void 0===t&&(t=0),t>0&&0==(t&t-1)},s.postDefs.push(function(){s.Common.Math.b2Math.b2Vec2_zero=new r(0,0),s.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new r(1,0),new r(0,1)),s.Common.Math.b2Math.b2Transform_identity=new n(o.b2Vec2_zero,o.b2Mat22_identity)}),e.b2Sweep=function(){this.localCenter=new r,this.c0=new r,this.c=new r},e.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},e.prototype.Copy=function(){var t=new e;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},e.prototype.GetTransform=function(t,i){void 0===i&&(i=0),t.position.x=(1-i)*this.c0.x+i*this.c.x,t.position.y=(1-i)*this.c0.y+i*this.c.y;var o=(1-i)*this.a0+i*this.a;t.R.Set(o);var e=t.R;t.position.x-=e.col1.x*this.localCenter.x+e.col2.x*this.localCenter.y,t.position.y-=e.col1.y*this.localCenter.x+e.col2.y*this.localCenter.y},e.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var i=(t-this.t0)/(1-this.t0);this.c0.x=(1-i)*this.c0.x+i*this.c.x,this.c0.y=(1-i)*this.c0.y+i*this.c.y,this.a0=(1-i)*this.a0+i*this.a,this.t0=t}},n.b2Transform=function(){this.position=new r,this.R=new t},n.prototype.b2Transform=function(t,i){void 0===t&&(t=null),void 0===i&&(i=null),t&&(this.position.SetV(t),this.R.SetM(i))},n.prototype.Initialize=function(t,i){this.position.SetV(t),this.R.SetM(i)},n.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},n.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},r.b2Vec2=function(){},r.prototype.b2Vec2=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},r.prototype.SetZero=function(){this.x=0,this.y=0},r.prototype.Set=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},r.prototype.SetV=function(t){this.x=t.x,this.y=t.y},r.prototype.GetNegative=function(){return new r(-this.x,-this.y)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},r.Make=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),new r(t,i)},r.prototype.Copy=function(){return new r(this.x,this.y)},r.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},r.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},r.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t},r.prototype.MulM=function(t){var i=this.x;this.x=t.col1.x*i+t.col2.x*this.y,this.y=t.col1.y*i+t.col2.y*this.y},r.prototype.MulTM=function(t){var i=o.Dot(this,t.col1);this.y=o.Dot(this,t.col2),this.x=i},r.prototype.CrossVF=function(t){void 0===t&&(t=0);var i=this.x;this.x=t*this.y,this.y=-t*i},r.prototype.CrossFV=function(t){void 0===t&&(t=0);var i=this.x;this.x=-t*this.y,this.y=t*i},r.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},r.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},r.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},r.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},r.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE)return 0;var i=1/t;return this.x*=i,this.y*=i,t},r.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)},a.b2Vec3=function(){},a.prototype.b2Vec3=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.x=t,this.y=i,this.z=o},a.prototype.SetZero=function(){this.x=this.y=this.z=0},a.prototype.Set=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.x=t,this.y=i,this.z=o},a.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},a.prototype.GetNegative=function(){return new a(-this.x,-this.y,-this.z)},a.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},a.prototype.Copy=function(){return new a(this.x,this.y,this.z)},a.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},a.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},a.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){var t=(s.Dynamics.Controllers.b2ControllerEdge,s.Common.Math.b2Mat22,s.Common.Math.b2Mat33,s.Common.Math.b2Math),i=s.Common.Math.b2Sweep,o=s.Common.Math.b2Transform,e=s.Common.Math.b2Vec2,n=(s.Common.Math.b2Vec3,s.Common.b2Color),l=(s.Common.b2internal,s.Common.b2Settings),m=s.Collision.b2AABB,c=(s.Collision.b2Bound,s.Collision.b2BoundValues,s.Collision.b2Collision,s.Collision.b2ContactID,s.Collision.b2ContactPoint),h=(s.Collision.b2Distance,s.Collision.b2DistanceInput,s.Collision.b2DistanceOutput,s.Collision.b2DistanceProxy,s.Collision.b2DynamicTree,s.Collision.b2DynamicTreeBroadPhase),_=(s.Collision.b2DynamicTreeNode,s.Collision.b2DynamicTreePair,s.Collision.b2Manifold,s.Collision.b2ManifoldPoint,s.Collision.b2Point,s.Collision.b2RayCastInput),p=s.Collision.b2RayCastOutput,y=(s.Collision.b2Segment,s.Collision.b2SeparationFunction,s.Collision.b2Simplex,s.Collision.b2SimplexCache,s.Collision.b2SimplexVertex,s.Collision.b2TimeOfImpact,s.Collision.b2TOIInput,s.Collision.b2WorldManifold,s.Collision.ClipVertex,s.Collision.Features,s.Collision.IBroadPhase,s.Collision.Shapes.b2CircleShape),u=(s.Collision.Shapes.b2EdgeChainDef,s.Collision.Shapes.b2EdgeShape),x=s.Collision.Shapes.b2MassData,f=s.Collision.Shapes.b2PolygonShape,d=s.Collision.Shapes.b2Shape,b=s.Dynamics.b2Body,v=s.Dynamics.b2BodyDef,C=s.Dynamics.b2ContactFilter,A=s.Dynamics.b2ContactImpulse,S=s.Dynamics.b2ContactListener,g=s.Dynamics.b2ContactManager,w=s.Dynamics.b2DebugDraw,D=s.Dynamics.b2DestructionListener,B=s.Dynamics.b2FilterData,M=s.Dynamics.b2Fixture,V=s.Dynamics.b2FixtureDef,I=s.Dynamics.b2Island,G=s.Dynamics.b2TimeStep,L=s.Dynamics.b2World,J=(s.Dynamics.Contacts.b2CircleContact,s.Dynamics.Contacts.b2Contact),F=(s.Dynamics.Contacts.b2ContactConstraint,s.Dynamics.Contacts.b2ContactConstraintPoint,s.Dynamics.Contacts.b2ContactEdge,s.Dynamics.Contacts.b2ContactFactory),P=(s.Dynamics.Contacts.b2ContactRegister,s.Dynamics.Contacts.b2ContactResult,s.Dynamics.Contacts.b2ContactSolver),R=(s.Dynamics.Contacts.b2EdgeAndCircleContact,s.Dynamics.Contacts.b2NullContact,s.Dynamics.Contacts.b2PolyAndCircleContact,s.Dynamics.Contacts.b2PolyAndEdgeContact,s.Dynamics.Contacts.b2PolygonContact,s.Dynamics.Contacts.b2PositionSolverManifold,s.Dynamics.Controllers.b2Controller,s.Dynamics.Joints.b2DistanceJoint,s.Dynamics.Joints.b2DistanceJointDef,s.Dynamics.Joints.b2FrictionJoint,s.Dynamics.Joints.b2FrictionJointDef,s.Dynamics.Joints.b2GearJoint,s.Dynamics.Joints.b2GearJointDef,s.Dynamics.Joints.b2Jacobian,s.Dynamics.Joints.b2Joint),T=(s.Dynamics.Joints.b2JointDef,s.Dynamics.Joints.b2JointEdge,s.Dynamics.Joints.b2LineJoint,s.Dynamics.Joints.b2LineJointDef,s.Dynamics.Joints.b2MouseJoint,s.Dynamics.Joints.b2MouseJointDef,s.Dynamics.Joints.b2PrismaticJoint,s.Dynamics.Joints.b2PrismaticJointDef,s.Dynamics.Joints.b2PulleyJoint);s.Dynamics.Joints.b2PulleyJointDef,s.Dynamics.Joints.b2RevoluteJoint,s.Dynamics.Joints.b2RevoluteJointDef,s.Dynamics.Joints.b2WeldJoint,s.Dynamics.Joints.b2WeldJointDef;b.b2Body=function(){this.m_xf=new o,this.m_sweep=new i,this.m_linearVelocity=new e,this.m_force=new e},b.prototype.connectEdges=function(i,o,e){void 0===e&&(e=0);var n=Math.atan2(o.GetDirectionVector().y,o.GetDirectionVector().x),s=Math.tan(.5*(n-e)),r=t.MulFV(s,o.GetDirectionVector());r=t.SubtractVV(r,o.GetNormalVector()),r=t.MulFV(l.b2_toiSlop,r),r=t.AddVV(r,o.GetVertex1());var a=t.AddVV(i.GetDirectionVector(),o.GetDirectionVector());a.Normalize();var m=t.Dot(i.GetDirectionVector(),o.GetNormalVector())>0;return i.SetNextEdge(o,r,a,m),o.SetPrevEdge(i,r,a,m),n},b.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var i=new M;if(i.Create(this,this.m_xf,t),this.m_flags&b.e_activeFlag){var o=this.m_world.m_contactManager.m_broadPhase;i.CreateProxy(o,this.m_xf)}return i.m_next=this.m_fixtureList,this.m_fixtureList=i,++this.m_fixtureCount,i.m_body=this,i.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=L.e_newFixture,i},b.prototype.CreateFixture2=function(t,i){void 0===i&&(i=0);var o=new V;return o.shape=t,o.density=i,this.CreateFixture(o)},b.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var i=this.m_fixtureList,o=null;null!=i;){if(i==t){o?o.m_next=t.m_next:this.m_fixtureList=t.m_next,!0;break}o=i,i=i.m_next}for(var e=this.m_contactList;e;){var n=e.contact;e=e.next;var s=n.GetFixtureA(),r=n.GetFixtureB();t!=s&&t!=r||this.m_world.m_contactManager.Destroy(n)}if(this.m_flags&b.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(a)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b.prototype.SetPositionAndAngle=function(t,i){void 0===i&&(i=0);var o;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(i),this.m_xf.position.SetV(t);var e=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=e.col1.x*n.x+e.col2.x*n.y,this.m_sweep.c.y=e.col1.y*n.x+e.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=i;var s=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},b.prototype.GetTransform=function(){return this.m_xf},b.prototype.GetPosition=function(){return this.m_xf.position},b.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},b.prototype.GetAngle=function(){return this.m_sweep.a},b.prototype.SetAngle=function(t){void 0===t&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},b.prototype.GetWorldCenter=function(){return this.m_sweep.c},b.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b.prototype.SetLinearVelocity=function(t){this.m_type!=b.b2_staticBody&&this.m_linearVelocity.SetV(t)},b.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=b.b2_staticBody&&(this.m_angularVelocity=t)},b.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b.prototype.GetDefinition=function(){var t=new v;return t.type=this.GetType(),t.allowSleep=(this.m_flags&b.e_allowSleepFlag)==b.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&b.e_fixedRotationFlag)==b.e_fixedRotationFlag,t.bullet=(this.m_flags&b.e_bulletFlag)==b.e_bulletFlag,t.awake=(this.m_flags&b.e_awakeFlag)==b.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},b.prototype.ApplyForce=function(t,i){this.m_type==b.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x)},b.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==b.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=t)},b.prototype.ApplyImpulse=function(t,i){this.m_type==b.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x))},b.prototype.Split=function(i){for(var o,e=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),s=this.GetWorldCenter(),r=this,a=this.m_world.CreateBody(this.GetDefinition()),l=r.m_fixtureList;l;)if(i(l)){var m=l.m_next;o?o.m_next=m:r.m_fixtureList=m,r.m_fixtureCount--,l.m_next=a.m_fixtureList,a.m_fixtureList=l,a.m_fixtureCount++,l.m_body=a,l=m}else o=l,l=l.m_next;r.ResetMassData(),a.ResetMassData();var c=r.GetWorldCenter(),h=a.GetWorldCenter(),_=t.AddVV(e,t.CrossFV(n,t.SubtractVV(c,s))),p=t.AddVV(e,t.CrossFV(n,t.SubtractVV(h,s)));return r.SetLinearVelocity(_),a.SetLinearVelocity(p),r.SetAngularVelocity(n),a.SetAngularVelocity(n),r.SynchronizeFixtures(),a.SynchronizeFixtures(),a},b.prototype.Merge=function(t){var i;for(i=t.m_fixtureList;i;){var o=i.m_next;t.m_fixtureCount--,i.m_next=this.m_fixtureList,this.m_fixtureList=i,this.m_fixtureCount++,i.m_body=n,i=o}e.m_fixtureCount=0;var e=this,n=t;e.GetWorldCenter(),n.GetWorldCenter(),e.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),e.GetAngularVelocity(),n.GetAngularVelocity();e.ResetMassData(),this.SynchronizeFixtures()},b.prototype.GetMass=function(){return this.m_mass},b.prototype.GetInertia=function(){return this.m_I},b.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},b.prototype.SetMassData=function(i){if(l.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==b.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=i.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,i.I>0&&0==(this.m_flags&b.e_fixedRotationFlag)&&(this.m_I=i.I-this.m_mass*(i.center.x*i.center.x+i.center.y*i.center.y),this.m_invI=1/this.m_I);var o=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-o.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-o.x)}},b.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=b.b2_staticBody&&this.m_type!=b.b2_kinematicBody){for(var i=e.Make(0,0),o=this.m_fixtureList;o;o=o.m_next)if(0!=o.m_density){var n=o.GetMassData();this.m_mass+=n.mass,i.x+=n.center.x*n.mass,i.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,i.x*=this.m_invMass,i.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&b.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(i.x*i.x+i.y*i.y),this.m_I*=this.m_inertiaScale,l.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-s.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-s.x)}},b.prototype.GetWorldPoint=function(t){var i=this.m_xf.R,o=new e(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);return o.x+=this.m_xf.position.x,o.y+=this.m_xf.position.y,o},b.prototype.GetWorldVector=function(i){return t.MulMV(this.m_xf.R,i)},b.prototype.GetLocalPoint=function(i){return t.MulXT(this.m_xf,i)},b.prototype.GetLocalVector=function(i){return t.MulTMV(this.m_xf.R,i)},b.prototype.GetLinearVelocityFromWorldPoint=function(t){return new e(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},b.prototype.GetLinearVelocityFromLocalPoint=function(t){var i=this.m_xf.R,o=new e(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);return o.x+=this.m_xf.position.x,o.y+=this.m_xf.position.y,new e(this.m_linearVelocity.x-this.m_angularVelocity*(o.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(o.x-this.m_sweep.c.x))},b.prototype.GetLinearDamping=function(){return this.m_linearDamping},b.prototype.SetLinearDamping=function(t){void 0===t&&(t=0),this.m_linearDamping=t},b.prototype.GetAngularDamping=function(){return this.m_angularDamping},b.prototype.SetAngularDamping=function(t){void 0===t&&(t=0),this.m_angularDamping=t},b.prototype.SetType=function(t){if(void 0===t&&(t=0),this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==b.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;i=i.next)i.contact.FlagForFiltering()}},b.prototype.GetType=function(){return this.m_type},b.prototype.SetBullet=function(t){t?this.m_flags|=b.e_bulletFlag:this.m_flags&=~b.e_bulletFlag},b.prototype.IsBullet=function(){return(this.m_flags&b.e_bulletFlag)==b.e_bulletFlag},b.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=b.e_allowSleepFlag:(this.m_flags&=~b.e_allowSleepFlag,this.SetAwake(!0))},b.prototype.SetAwake=function(t){t?(this.m_flags|=b.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b.prototype.IsAwake=function(){return(this.m_flags&b.e_awakeFlag)==b.e_awakeFlag},b.prototype.SetFixedRotation=function(t){t?this.m_flags|=b.e_fixedRotationFlag:this.m_flags&=~b.e_fixedRotationFlag,this.ResetMassData()},b.prototype.IsFixedRotation=function(){return(this.m_flags&b.e_fixedRotationFlag)==b.e_fixedRotationFlag},b.prototype.SetActive=function(t){if(t!=this.IsActive()){var i,o;if(t)for(this.m_flags|=b.e_activeFlag,i=this.m_world.m_contactManager.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.CreateProxy(i,this.m_xf);else{for(this.m_flags&=~b.e_activeFlag,i=this.m_world.m_contactManager.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.DestroyProxy(i);for(var e=this.m_contactList;e;){var n=e;e=e.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},b.prototype.IsActive=function(){return(this.m_flags&b.e_activeFlag)==b.e_activeFlag},b.prototype.IsSleepingAllowed=function(){return(this.m_flags&b.e_allowSleepFlag)==b.e_allowSleepFlag},b.prototype.GetFixtureList=function(){return this.m_fixtureList},b.prototype.GetJointList=function(){return this.m_jointList},b.prototype.GetControllerList=function(){return this.m_controllerList},b.prototype.GetContactList=function(){return this.m_contactList},b.prototype.GetNext=function(){return this.m_next},b.prototype.GetUserData=function(){return this.m_userData},b.prototype.SetUserData=function(t){this.m_userData=t},b.prototype.GetWorld=function(){return this.m_world},b.prototype.b2Body=function(t,i){this.m_flags=0,t.bullet&&(this.m_flags|=b.e_bulletFlag),t.fixedRotation&&(this.m_flags|=b.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=b.e_allowSleepFlag),t.awake&&(this.m_flags|=b.e_awakeFlag),t.active&&(this.m_flags|=b.e_activeFlag),this.m_world=i,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var o=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*e.x+o.col2.x*e.y,this.m_sweep.c.y=o.col1.y*e.x+o.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==b.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b.prototype.SynchronizeFixtures=function(){var t=b.s_xf1;t.R.Set(this.m_sweep.a0);var i=t.R,o=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(i.col1.x*o.x+i.col2.x*o.y),t.position.y=this.m_sweep.c0.y-(i.col1.y*o.x+i.col2.y*o.y);var e,n=this.m_world.m_contactManager.m_broadPhase
;for(e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(n,t,this.m_xf)},b.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,i=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*i.x+t.col2.x*i.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*i.x+t.col2.y*i.y)},b.prototype.ShouldCollide=function(t){if(this.m_type!=b.b2_dynamicBody&&t.m_type!=b.b2_dynamicBody)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&0==i.joint.m_collideConnected)return!1;return!0},b.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},s.postDefs.push(function(){s.Dynamics.b2Body.s_xf1=new o,s.Dynamics.b2Body.e_islandFlag=1,s.Dynamics.b2Body.e_awakeFlag=2,s.Dynamics.b2Body.e_allowSleepFlag=4,s.Dynamics.b2Body.e_bulletFlag=8,s.Dynamics.b2Body.e_fixedRotationFlag=16,s.Dynamics.b2Body.e_activeFlag=32,s.Dynamics.b2Body.b2_staticBody=0,s.Dynamics.b2Body.b2_kinematicBody=1,s.Dynamics.b2Body.b2_dynamicBody=2}),v.b2BodyDef=function(){this.position=new e,this.linearVelocity=new e},v.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=b.b2_staticBody,this.active=!0,this.inertiaScale=1},C.b2ContactFilter=function(){},C.prototype.ShouldCollide=function(t,i){var o=t.GetFilterData(),e=i.GetFilterData();return o.groupIndex==e.groupIndex&&0!=o.groupIndex?o.groupIndex>0:0!=(o.maskBits&e.categoryBits)&&0!=(o.categoryBits&e.maskBits)},C.prototype.RayCollide=function(t,i){return!t||this.ShouldCollide(t instanceof M?t:null,i)},s.postDefs.push(function(){s.Dynamics.b2ContactFilter.b2_defaultFilter=new C}),A.b2ContactImpulse=function(){this.normalImpulses=new a(l.b2_maxManifoldPoints),this.tangentImpulses=new a(l.b2_maxManifoldPoints)},S.b2ContactListener=function(){},S.prototype.BeginContact=function(t){},S.prototype.EndContact=function(t){},S.prototype.PreSolve=function(t,i){},S.prototype.PostSolve=function(t,i){},s.postDefs.push(function(){s.Dynamics.b2ContactListener.b2_defaultListener=new S}),g.b2ContactManager=function(){},g.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=C.b2_defaultFilter,this.m_contactListener=S.b2_defaultListener,this.m_contactFactory=new F(this.m_allocator),this.m_broadPhase=new h},g.prototype.AddPair=function(t,i){var o=t instanceof M?t:null,e=i instanceof M?i:null,n=o.GetBody(),s=e.GetBody();if(n!=s){for(var r=s.GetContactList();r;){if(r.other==n){var a=r.contact.GetFixtureA(),l=r.contact.GetFixtureB();if(a==o&&l==e)return;if(a==e&&l==o)return}r=r.next}if(0!=s.ShouldCollide(n)&&0!=this.m_contactFilter.ShouldCollide(o,e)){var m=this.m_contactFactory.Create(o,e);o=m.GetFixtureA(),e=m.GetFixtureB(),n=o.m_body,s=e.m_body,m.m_prev=null,m.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=m),this.m_world.m_contactList=m,m.m_nodeA.contact=m,m.m_nodeA.other=s,m.m_nodeA.prev=null,m.m_nodeA.next=n.m_contactList,null!=n.m_contactList&&(n.m_contactList.prev=m.m_nodeA),n.m_contactList=m.m_nodeA,m.m_nodeB.contact=m,m.m_nodeB.other=n,m.m_nodeB.prev=null,m.m_nodeB.next=s.m_contactList,null!=s.m_contactList&&(s.m_contactList.prev=m.m_nodeB),s.m_contactList=m.m_nodeB,++this.m_world.m_contactCount}}},g.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(s.generateCallback(this,this.AddPair))},g.prototype.Destroy=function(t){var i=t.GetFixtureA(),o=t.GetFixtureB(),e=i.GetBody(),n=o.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==e.m_contactList&&(e.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},g.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var i=t.GetFixtureA(),o=t.GetFixtureB(),e=i.GetBody(),n=o.GetBody();if(0!=e.IsAwake()||0!=n.IsAwake()){if(t.m_flags&J.e_filterFlag){if(0==n.ShouldCollide(e)){var s=t;t=s.GetNext(),this.Destroy(s);continue}if(0==this.m_contactFilter.ShouldCollide(i,o)){s=t,t=s.GetNext(),this.Destroy(s);continue}t.m_flags&=~J.e_filterFlag}var r=i.m_proxy,a=o.m_proxy;0!=this.m_broadPhase.TestOverlap(r,a)?(t.Update(this.m_contactListener),t=t.GetNext()):(s=t,t=s.GetNext(),this.Destroy(s))}else t=t.GetNext()}},s.postDefs.push(function(){s.Dynamics.b2ContactManager.s_evalCP=new c}),w.b2DebugDraw=function(){},w.prototype.b2DebugDraw=function(){},w.prototype.SetFlags=function(t){void 0===t&&(t=0)},w.prototype.GetFlags=function(){},w.prototype.AppendFlags=function(t){void 0===t&&(t=0)},w.prototype.ClearFlags=function(t){void 0===t&&(t=0)},w.prototype.SetSprite=function(t){},w.prototype.GetSprite=function(){},w.prototype.SetDrawScale=function(t){void 0===t&&(t=0)},w.prototype.GetDrawScale=function(){},w.prototype.SetLineThickness=function(t){void 0===t&&(t=0)},w.prototype.GetLineThickness=function(){},w.prototype.SetAlpha=function(t){void 0===t&&(t=0)},w.prototype.GetAlpha=function(){},w.prototype.SetFillAlpha=function(t){void 0===t&&(t=0)},w.prototype.GetFillAlpha=function(){},w.prototype.SetXFormScale=function(t){void 0===t&&(t=0)},w.prototype.GetXFormScale=function(){},w.prototype.DrawPolygon=function(t,i,o){void 0===i&&(i=0)},w.prototype.DrawSolidPolygon=function(t,i,o){void 0===i&&(i=0)},w.prototype.DrawCircle=function(t,i,o){void 0===i&&(i=0)},w.prototype.DrawSolidCircle=function(t,i,o,e){void 0===i&&(i=0)},w.prototype.DrawSegment=function(t,i,o){},w.prototype.DrawTransform=function(t){},s.postDefs.push(function(){s.Dynamics.b2DebugDraw.e_shapeBit=1,s.Dynamics.b2DebugDraw.e_jointBit=2,s.Dynamics.b2DebugDraw.e_aabbBit=4,s.Dynamics.b2DebugDraw.e_pairBit=8,s.Dynamics.b2DebugDraw.e_centerOfMassBit=16,s.Dynamics.b2DebugDraw.e_controllerBit=32}),D.b2DestructionListener=function(){},D.prototype.SayGoodbyeJoint=function(t){},D.prototype.SayGoodbyeFixture=function(t){},B.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},B.prototype.Copy=function(){var t=new B;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},M.b2Fixture=function(){this.m_filter=new B},M.prototype.GetType=function(){return this.m_shape.GetType()},M.prototype.GetShape=function(){return this.m_shape},M.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var i=this.m_body.GetContactList();i;){var o=i.contact,e=o.GetFixtureA(),n=o.GetFixtureB();e!=this&&n!=this||o.SetSensor(e.IsSensor()||n.IsSensor()),i=i.next}},M.prototype.IsSensor=function(){return this.m_isSensor},M.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body)for(var i=this.m_body.GetContactList();i;){var o=i.contact,e=o.GetFixtureA(),n=o.GetFixtureB();e!=this&&n!=this||o.FlagForFiltering(),i=i.next}},M.prototype.GetFilterData=function(){return this.m_filter.Copy()},M.prototype.GetBody=function(){return this.m_body},M.prototype.GetNext=function(){return this.m_next},M.prototype.GetUserData=function(){return this.m_userData},M.prototype.SetUserData=function(t){this.m_userData=t},M.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},M.prototype.RayCast=function(t,i){return this.m_shape.RayCast(t,i,this.m_body.GetTransform())},M.prototype.GetMassData=function(t){return void 0===t&&(t=null),null==t&&(t=new x),this.m_shape.ComputeMass(t,this.m_density),t},M.prototype.SetDensity=function(t){void 0===t&&(t=0),this.m_density=t},M.prototype.GetDensity=function(){return this.m_density},M.prototype.GetFriction=function(){return this.m_friction},M.prototype.SetFriction=function(t){void 0===t&&(t=0),this.m_friction=t},M.prototype.GetRestitution=function(){return this.m_restitution},M.prototype.SetRestitution=function(t){void 0===t&&(t=0),this.m_restitution=t},M.prototype.GetAABB=function(){return this.m_aabb},M.prototype.b2Fixture=function(){this.m_aabb=new m,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},M.prototype.Create=function(t,i,o){this.m_userData=o.userData,this.m_friction=o.friction,this.m_restitution=o.restitution,this.m_body=t,this.m_next=null,this.m_filter=o.filter.Copy(),this.m_isSensor=o.isSensor,this.m_shape=o.shape.Copy(),this.m_density=o.density},M.prototype.Destroy=function(){this.m_shape=null},M.prototype.CreateProxy=function(t,i){this.m_shape.ComputeAABB(this.m_aabb,i),this.m_proxy=t.CreateProxy(this.m_aabb,this)},M.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},M.prototype.Synchronize=function(i,o,e){if(this.m_proxy){var n=new m,s=new m;this.m_shape.ComputeAABB(n,o),this.m_shape.ComputeAABB(s,e),this.m_aabb.Combine(n,s);var r=t.SubtractVV(e.position,o.position);i.MoveProxy(this.m_proxy,this.m_aabb,r)}},V.b2FixtureDef=function(){this.filter=new B},V.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},I.b2Island=function(){},I.prototype.b2Island=function(){this.m_bodies=new r,this.m_contacts=new r,this.m_joints=new r},I.prototype.Initialize=function(t,i,o,e,n,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0);var r=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=i,this.m_jointCapacity=o,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=e,this.m_listener=n,this.m_contactSolver=s,r=this.m_bodies.length;r<t;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;r<i;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;r<o;r++)this.m_joints[r]=null},I.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},I.prototype.Solve=function(i,o,e){var n,s,r=0,a=0;for(r=0;r<this.m_bodyCount;++r)n=this.m_bodies[r],n.GetType()==b.b2_dynamicBody&&(n.m_linearVelocity.x+=i.dt*(o.x+n.m_invMass*n.m_force.x),n.m_linearVelocity.y+=i.dt*(o.y+n.m_invMass*n.m_force.y),n.m_angularVelocity+=i.dt*n.m_invI*n.m_torque,n.m_linearVelocity.Multiply(t.Clamp(1-i.dt*n.m_linearDamping,0,1)),n.m_angularVelocity*=t.Clamp(1-i.dt*n.m_angularDamping,0,1));this.m_contactSolver.Initialize(i,this.m_contacts,this.m_contactCount,this.m_allocator);var m=this.m_contactSolver;for(m.InitVelocityConstraints(i),r=0;r<this.m_jointCount;++r)s=this.m_joints[r],s.InitVelocityConstraints(i);for(r=0;r<i.velocityIterations;++r){for(a=0;a<this.m_jointCount;++a)s=this.m_joints[a],s.SolveVelocityConstraints(i);m.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r)s=this.m_joints[r],s.FinalizeVelocityConstraints();for(m.FinalizeVelocityConstraints(),r=0;r<this.m_bodyCount;++r)if(n=this.m_bodies[r],n.GetType()!=b.b2_staticBody){var c=i.dt*n.m_linearVelocity.x,h=i.dt*n.m_linearVelocity.y;c*c+h*h>l.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=l.b2_maxTranslation*i.inv_dt,n.m_linearVelocity.y*=l.b2_maxTranslation*i.inv_dt);var _=i.dt*n.m_angularVelocity;_*_>l.b2_maxRotationSquared&&(n.m_angularVelocity<0?n.m_angularVelocity=-l.b2_maxRotation*i.inv_dt:n.m_angularVelocity=l.b2_maxRotation*i.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=i.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=i.dt*n.m_linearVelocity.y,n.m_sweep.a+=i.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(r=0;r<i.positionIterations;++r){var p=m.SolvePositionConstraints(l.b2_contactBaumgarte),y=!0;for(a=0;a<this.m_jointCount;++a){s=this.m_joints[a];var u=s.SolvePositionConstraints(l.b2_contactBaumgarte);y=y&&u}if(p&&y)break}if(this.Report(m.m_constraints),e){var x=Number.MAX_VALUE,f=l.b2_linearSleepTolerance*l.b2_linearSleepTolerance,d=l.b2_angularSleepTolerance*l.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r)n=this.m_bodies[r],n.GetType()!=b.b2_staticBody&&(0==(n.m_flags&b.e_allowSleepFlag)&&(n.m_sleepTime=0,x=0),0==(n.m_flags&b.e_allowSleepFlag)||n.m_angularVelocity*n.m_angularVelocity>d||t.Dot(n.m_linearVelocity,n.m_linearVelocity)>f?(n.m_sleepTime=0,x=0):(n.m_sleepTime+=i.dt,x=t.Min(x,n.m_sleepTime)));if(x>=l.b2_timeToSleep)for(r=0;r<this.m_bodyCount;++r)n=this.m_bodies[r],n.SetAwake(!1)}},I.prototype.SolveTOI=function(t){var i=0,o=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var e=this.m_contactSolver;for(i=0;i<this.m_jointCount;++i)this.m_joints[i].InitVelocityConstraints(t);for(i=0;i<t.velocityIterations;++i)for(e.SolveVelocityConstraints(),o=0;o<this.m_jointCount;++o)this.m_joints[o].SolveVelocityConstraints(t);for(i=0;i<this.m_bodyCount;++i){var n=this.m_bodies[i];if(n.GetType()!=b.b2_staticBody){var s=t.dt*n.m_linearVelocity.x,r=t.dt*n.m_linearVelocity.y;s*s+r*r>l.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=l.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=l.b2_maxTranslation*t.inv_dt);var a=t.dt*n.m_angularVelocity;a*a>l.b2_maxRotationSquared&&(n.m_angularVelocity<0?n.m_angularVelocity=-l.b2_maxRotation*t.inv_dt:n.m_angularVelocity=l.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(i=0;i<t.positionIterations;++i){var m=e.SolvePositionConstraints(.75),c=!0;for(o=0;o<this.m_jointCount;++o){var h=this.m_joints[o].SolvePositionConstraints(l.b2_contactBaumgarte);c=c&&h}if(m&&c)break}this.Report(e.m_constraints)},I.prototype.Report=function(t){if(null!=this.m_listener)for(var i=0;i<this.m_contactCount;++i){for(var o=this.m_contacts[i],e=t[i],n=0;n<e.pointCount;++n)I.s_impulse.normalImpulses[n]=e.points[n].normalImpulse,I.s_impulse.tangentImpulses[n]=e.points[n].tangentImpulse;this.m_listener.PostSolve(o,I.s_impulse)}},I.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},I.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},I.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},s.postDefs.push(function(){s.Dynamics.b2Island.s_impulse=new A}),G.b2TimeStep=function(){},G.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},L.b2World=function(){this.s_stack=new r,this.m_contactManager=new g,this.m_contactSolver=new P,this.m_island=new I},L.prototype.b2World=function(t,i){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,L.m_warmStarting=!0,L.m_continuousPhysics=!0,this.m_allowSleep=i,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var o=new v;this.m_groundBody=this.CreateBody(o)},L.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},L.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},L.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},L.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},L.prototype.SetBroadPhase=function(t){var i=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var o=this.m_bodyList;o;o=o.m_next)for(var e=o.m_fixtureList;e;e=e.m_next)e.m_proxy=t.CreateProxy(i.GetFatAABB(e.m_proxy),e)},L.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},L.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},L.prototype.CreateBody=function(t){if(1==this.IsLocked())return null;var i=new b(t,this);return i.m_prev=null,i.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=i),this.m_bodyList=i,++this.m_bodyCount,i},L.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var i=t.m_jointList;i;){var o=i;i=i.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(o.joint),this.DestroyJoint(o.joint)}for(var e=t.m_controllerList;e;){var n=e;e=e.nextController,n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var r=s;s=s.next,this.m_contactManager.Destroy(r.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxy(this.m_contactManager.m_broadPhase),l.Destroy()}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},L.prototype.CreateJoint=function(t){var i=R.Create(t,null);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.joint=i,i.m_edgeA.other=i.m_bodyB,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.joint=i,i.m_edgeB.other=i.m_bodyA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var o=t.bodyA,e=t.bodyB;if(0==t.collideConnected)for(var n=e.GetContactList();n;)n.other==o&&n.contact.FlagForFiltering(),n=n.next;return i},L.prototype.DestroyJoint=function(t){var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var o=t.m_bodyA,e=t.m_bodyB;if(o.SetAwake(!0),e.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==o.m_jointList&&(o.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==e.m_jointList&&(e.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,R.Destroy(t,null),--this.m_jointCount,0==i)for(var n=e.GetContactList();n;)n.other==o&&n.contact.FlagForFiltering(),n=n.next},L.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},L.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},L.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},L.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},L.prototype.SetWarmStarting=function(t){L.m_warmStarting=t},L.prototype.SetContinuousPhysics=function(t){L.m_continuousPhysics=t},L.prototype.GetBodyCount=function(){return this.m_bodyCount},L.prototype.GetJointCount=function(){return this.m_jointCount},L.prototype.GetContactCount=function(){return this.m_contactCount},L.prototype.SetGravity=function(t){this.m_gravity=t},L.prototype.GetGravity=function(){return this.m_gravity},L.prototype.GetGroundBody=function(){return this.m_groundBody},L.prototype.Step=function(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.m_flags&L.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~L.e_newFixture),this.m_flags|=L.e_locked;var e=L.s_timestep2;e.dt=t,e.velocityIterations=i,e.positionIterations=o,e.inv_dt=t>0?1/t:0,e.dtRatio=this.m_inv_dt0*t,e.warmStarting=L.m_warmStarting,this.m_contactManager.Collide(),e.dt>0&&this.Solve(e),L.m_continuousPhysics&&e.dt>0&&this.SolveTOI(e),e.dt>0&&(this.m_inv_dt0=e.inv_dt),this.m_flags&=~L.e_locked},L.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},L.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,i,o,s,r,a,l=this.m_debugDraw.GetFlags(),c=(new e,new e,new e,new m,new m,[new e,new e,new e,new e]),h=new n(0,0,0);if(l&w.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(a=t.m_xf,i=t.GetFixtureList();i;i=i.m_next)o=i.GetShape(),0==t.IsActive()?(h.Set(.5,.5,.3),this.DrawShape(o,a,h)):t.GetType()==b.b2_staticBody?(h.Set(.5,.9,.5),this.DrawShape(o,a,h)):t.GetType()==b.b2_kinematicBody?(h.Set(.5,.5,.9),this.DrawShape(o,a,h)):0==t.IsAwake()?(h.Set(.6,.6,.6),this.DrawShape(o,a,h)):(h.Set(.9,.7,.7),this.DrawShape(o,a,h));if(l&w.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(l&w.e_controllerBit)for(var _=this.m_controllerList;_;_=_.m_next)_.Draw(this.m_debugDraw);if(l&w.e_pairBit){h.Set(.3,.9,.9);for(var p=this.m_contactManager.m_contactList;p;p=p.GetNext()){var y=p.GetFixtureA(),u=p.GetFixtureB(),x=y.GetAABB().GetCenter(),f=u.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(x,f,h)}}if(l&w.e_aabbBit)for(r=this.m_contactManager.m_broadPhase,c=[new e,new e,new e,new e],t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(i=t.GetFixtureList();i;i=i.GetNext()){var d=r.GetFatAABB(i.m_proxy);c[0].Set(d.lowerBound.x,d.lowerBound.y),c[1].Set(d.upperBound.x,d.lowerBound.y),c[2].Set(d.upperBound.x,d.upperBound.y),c[3].Set(d.lowerBound.x,d.upperBound.y),this.m_debugDraw.DrawPolygon(c,4,h)}if(l&w.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)a=L.s_xf,a.R=t.m_xf.R,a.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(a)}},L.prototype.QueryAABB=function(t,i){function o(i){return t(n.GetUserData(i))}var e=this,n=e.m_contactManager.m_broadPhase;n.Query(o,i)},L.prototype.QueryShape=function(t,i,e){function n(o){var n=r.GetUserData(o)instanceof M?r.GetUserData(o):null;return!d.TestOverlap(i,e,n.GetShape(),n.GetBody().GetTransform())||t(n)}var s=this;void 0===e&&(e=null),null==e&&(e=new o,e.SetIdentity());var r=s.m_contactManager.m_broadPhase,a=new m;i.ComputeAABB(a,e),r.Query(n,a)},L.prototype.QueryPoint=function(t,i){function o(o){var e=n.GetUserData(o)instanceof M?n.GetUserData(o):null;return!e.TestPoint(i)||t(e)}var e=this,n=e.m_contactManager.m_broadPhase,s=new m;s.lowerBound.Set(i.x-l.b2_linearSlop,i.y-l.b2_linearSlop),s.upperBound.Set(i.x+l.b2_linearSlop,i.y+l.b2_linearSlop),n.Query(o,s)},L.prototype.RayCast=function(t,i,o){function n(n,s){var l=r.GetUserData(s),m=l instanceof M?l:null;if(m.RayCast(a,n)){var c=a.fraction,h=new e((1-c)*i.x+c*o.x,(1-c)*i.y+c*o.y);return t(m,h,a.normal,c)}return n.maxFraction}var s=this,r=s.m_contactManager.m_broadPhase,a=new p,l=new _(i,o);r.RayCast(n,l)},L.prototype.RayCastOne=function(t,i){function o(t,i,o,n){return void 0===n&&(n=0),e=t,n}var e,n=this;return n.RayCast(o,t,i),e},L.prototype.RayCastAll=function(t,i){function o(t,i,o,e){return void 0===e&&(e=0),n[n.length]=t,1}var e=this,n=new r;return e.RayCast(o,t,i),n},L.prototype.GetBodyList=function(){return this.m_bodyList},L.prototype.GetJointList=function(){return this.m_jointList},L.prototype.GetContactList=function(){return this.m_contactList},L.prototype.IsLocked=function(){return(this.m_flags&L.e_locked)>0},L.prototype.Solve=function(t){for(var i,o=this.m_controllerList;o;o=o.m_next)o.Step(t);var e=this.m_island;for(e.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~b.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~J.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var r=(parseInt(this.m_bodyCount),this.s_stack),a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&b.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=b.b2_staticBody){e.Clear();var l=0;for(r[l++]=a,a.m_flags|=b.e_islandFlag;l>0;)if(i=r[--l],e.AddBody(i),0==i.IsAwake()&&i.SetAwake(!0),i.GetType()!=b.b2_staticBody){for(var m,c=i.m_contactList;c;c=c.next)c.contact.m_flags&J.e_islandFlag||1!=c.contact.IsSensor()&&0!=c.contact.IsEnabled()&&0!=c.contact.IsTouching()&&(e.AddContact(c.contact),c.contact.m_flags|=J.e_islandFlag,m=c.other,m.m_flags&b.e_islandFlag||(r[l++]=m,m.m_flags|=b.e_islandFlag));for(var h=i.m_jointList;h;h=h.next)1!=h.joint.m_islandFlag&&(m=h.other,0!=m.IsActive()&&(e.AddJoint(h.joint),h.joint.m_islandFlag=!0,m.m_flags&b.e_islandFlag||(r[l++]=m,m.m_flags|=b.e_islandFlag)))}e.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;_<e.m_bodyCount;++_)i=e.m_bodies[_],i.GetType()==b.b2_staticBody&&(i.m_flags&=~b.e_islandFlag)}for(_=0;_<r.length&&r[_];++_)r[_]=null;for(i=this.m_bodyList;i;i=i.m_next)0!=i.IsAwake()&&0!=i.IsActive()&&i.GetType()!=b.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},L.prototype.SolveTOI=function(t){var i,o,e,n,s,r,a,m=this.m_island;m.Initialize(this.m_bodyCount,l.b2_maxTOIContactsPerIsland,l.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c=L.s_queue;for(i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~b.e_islandFlag,i.m_sweep.t0=0;var h;for(h=this.m_contactList;h;h=h.m_next)h.m_flags&=~(J.e_toiFlag|J.e_islandFlag);for(a=this.m_jointList;a;a=a.m_next)a.m_islandFlag=!1;for(;;){var _=null,p=1;for(h=this.m_contactList;h;h=h.m_next)if(1!=h.IsSensor()&&0!=h.IsEnabled()&&0!=h.IsContinuous()){var y=1;if(h.m_flags&J.e_toiFlag)y=h.m_toi;else{if(o=h.m_fixtureA,e=h.m_fixtureB,n=o.m_body,s=e.m_body,!(n.GetType()==b.b2_dynamicBody&&0!=n.IsAwake()||s.GetType()==b.b2_dynamicBody&&0!=s.IsAwake()))continue;var u=n.m_sweep.t0;n.m_sweep.t0<s.m_sweep.t0?(u=s.m_sweep.t0,n.m_sweep.Advance(u)):s.m_sweep.t0<n.m_sweep.t0&&(u=n.m_sweep.t0,s.m_sweep.Advance(u)),y=h.ComputeTOI(n.m_sweep,s.m_sweep),l.b2Assert(0<=y&&y<=1),y>0&&y<1&&(y=(1-y)*u+y)>1&&(y=1),h.m_toi=y,h.m_flags|=J.e_toiFlag}Number.MIN_VALUE<y&&y<p&&(_=h,p=y)}if(null==_||1-100*Number.MIN_VALUE<p)break;if(o=_.m_fixtureA,e=_.m_fixtureB,n=o.m_body,s=e.m_body,L.s_backupA.Set(n.m_sweep),L.s_backupB.Set(s.m_sweep),n.Advance(p),s.Advance(p),_.Update(this.m_contactManager.m_contactListener),_.m_flags&=~J.e_toiFlag,1!=_.IsSensor()&&0!=_.IsEnabled()){if(0!=_.IsTouching()){var x=n;x.GetType()!=b.b2_dynamicBody&&(x=s),m.Clear();var f=0,d=0;for(c[f+d++]=x,x.m_flags|=b.e_islandFlag;d>0;)if(i=c[f++],--d,m.AddBody(i),0==i.IsAwake()&&i.SetAwake(!0),i.GetType()==b.b2_dynamicBody){for(r=i.m_contactList;r&&m.m_contactCount!=m.m_contactCapacity;r=r.next)if(!(r.contact.m_flags&J.e_islandFlag)&&1!=r.contact.IsSensor()&&0!=r.contact.IsEnabled()&&0!=r.contact.IsTouching()){m.AddContact(r.contact),r.contact.m_flags|=J.e_islandFlag;var v=r.other;v.m_flags&b.e_islandFlag||(v.GetType()!=b.b2_staticBody&&(v.Advance(p),v.SetAwake(!0)),c[f+d]=v,++d,v.m_flags|=b.e_islandFlag)}for(var C=i.m_jointList;C;C=C.next)m.m_jointCount!=m.m_jointCapacity&&1!=C.joint.m_islandFlag&&(v=C.other,0!=v.IsActive()&&(m.AddJoint(C.joint),C.joint.m_islandFlag=!0,v.m_flags&b.e_islandFlag||(v.GetType()!=b.b2_staticBody&&(v.Advance(p),v.SetAwake(!0)),c[f+d]=v,++d,v.m_flags|=b.e_islandFlag)))}var A=L.s_timestep;A.warmStarting=!1,A.dt=(1-p)*t.dt,A.inv_dt=1/A.dt,A.dtRatio=0,A.velocityIterations=t.velocityIterations,A.positionIterations=t.positionIterations,m.SolveTOI(A);var S=0;for(S=0;S<m.m_bodyCount;++S)if(i=m.m_bodies[S],i.m_flags&=~b.e_islandFlag,0!=i.IsAwake()&&i.GetType()==b.b2_dynamicBody)for(i.SynchronizeFixtures(),r=i.m_contactList;r;r=r.next)r.contact.m_flags&=~J.e_toiFlag;for(S=0;S<m.m_contactCount;++S)h=m.m_contacts[S],h.m_flags&=~(J.e_toiFlag|J.e_islandFlag);for(S=0;S<m.m_jointCount;++S)a=m.m_joints[S],a.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else n.m_sweep.Set(L.s_backupA),s.m_sweep.Set(L.s_backupB),n.SynchronizeTransform(),s.SynchronizeTransform()}},L.prototype.DrawJoint=function(t){var i=t.GetBodyA(),o=t.GetBodyB(),e=i.m_xf,n=o.m_xf,s=e.position,r=n.position,a=t.GetAnchorA(),l=t.GetAnchorB(),m=L.s_jointColor;switch(t.m_type){case R.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,m);break;case R.e_pulleyJoint:var c=t instanceof T?t:null,h=c.GetGroundAnchorA(),_=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(h,a,m),this.m_debugDraw.DrawSegment(_,l,m),this.m_debugDraw.DrawSegment(h,_,m);break;case R.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,m);break;default:i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,m),this.m_debugDraw.DrawSegment(a,l,m),o!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,l,m)}},L.prototype.DrawShape=function(i,o,e){switch(i.m_type){case d.e_circleShape:var n=i instanceof y?i:null,s=t.MulX(o,n.m_p),a=n.m_radius,l=o.R.col1;this.m_debugDraw.DrawSolidCircle(s,a,l,e);break;case d.e_polygonShape:var m=0,c=i instanceof f?i:null,h=parseInt(c.GetVertexCount()),_=c.GetVertices(),p=new r(h);for(m=0;m<h;++m)p[m]=t.MulX(o,_[m]);this.m_debugDraw.DrawSolidPolygon(p,h,e);break;case d.e_edgeShape:var x=i instanceof u?i:null;this.m_debugDraw.DrawSegment(t.MulX(o,x.GetVertex1()),t.MulX(o,x.GetVertex2()),e)}},s.postDefs.push(function(){s.Dynamics.b2World.s_timestep2=new G,s.Dynamics.b2World.s_xf=new o,s.Dynamics.b2World.s_backupA=new i,s.Dynamics.b2World.s_backupB=new i,s.Dynamics.b2World.s_timestep=new G,s.Dynamics.b2World.s_queue=new r,s.Dynamics.b2World.s_jointColor=new n(.5,.8,.8),s.Dynamics.b2World.e_newFixture=1,s.Dynamics.b2World.e_locked=2})}(),function(){var t=s.Collision.Shapes.b2CircleShape,i=(s.Collision.Shapes.b2EdgeChainDef,s.Collision.Shapes.b2EdgeShape),o=(s.Collision.Shapes.b2MassData,s.Collision.Shapes.b2PolygonShape),e=s.Collision.Shapes.b2Shape,n=s.Dynamics.Contacts.b2CircleContact,l=s.Dynamics.Contacts.b2Contact,m=s.Dynamics.Contacts.b2ContactConstraint,c=s.Dynamics.Contacts.b2ContactConstraintPoint,h=s.Dynamics.Contacts.b2ContactEdge,_=s.Dynamics.Contacts.b2ContactFactory,p=s.Dynamics.Contacts.b2ContactRegister,y=s.Dynamics.Contacts.b2ContactResult,u=s.Dynamics.Contacts.b2ContactSolver,x=s.Dynamics.Contacts.b2EdgeAndCircleContact,f=s.Dynamics.Contacts.b2NullContact,d=s.Dynamics.Contacts.b2PolyAndCircleContact,b=s.Dynamics.Contacts.b2PolyAndEdgeContact,v=s.Dynamics.Contacts.b2PolygonContact,C=s.Dynamics.Contacts.b2PositionSolverManifold,A=s.Dynamics.b2Body,S=(s.Dynamics.b2BodyDef,s.Dynamics.b2ContactFilter,s.Dynamics.b2ContactImpulse,s.Dynamics.b2ContactListener,s.Dynamics.b2ContactManager,s.Dynamics.b2DebugDraw,s.Dynamics.b2DestructionListener,s.Dynamics.b2FilterData,s.Dynamics.b2Fixture,s.Dynamics.b2FixtureDef,s.Dynamics.b2Island,s.Dynamics.b2TimeStep),g=(s.Dynamics.b2World,s.Common.b2Color,s.Common.b2internal,s.Common.b2Settings),w=s.Common.Math.b2Mat22,D=(s.Common.Math.b2Mat33,s.Common.Math.b2Math),B=(s.Common.Math.b2Sweep,s.Common.Math.b2Transform,s.Common.Math.b2Vec2),M=(s.Common.Math.b2Vec3,s.Collision.b2AABB,s.Collision.b2Bound,s.Collision.b2BoundValues,s.Collision.b2Collision),V=s.Collision.b2ContactID,I=(s.Collision.b2ContactPoint,s.Collision.b2Distance,s.Collision.b2DistanceInput,s.Collision.b2DistanceOutput,s.Collision.b2DistanceProxy,s.Collision.b2DynamicTree,s.Collision.b2DynamicTreeBroadPhase,s.Collision.b2DynamicTreeNode,s.Collision.b2DynamicTreePair,s.Collision.b2Manifold),G=(s.Collision.b2ManifoldPoint,s.Collision.b2Point,s.Collision.b2RayCastInput,s.Collision.b2RayCastOutput,s.Collision.b2Segment,s.Collision.b2SeparationFunction,s.Collision.b2Simplex,
s.Collision.b2SimplexCache,s.Collision.b2SimplexVertex,s.Collision.b2TimeOfImpact),L=s.Collision.b2TOIInput,J=s.Collision.b2WorldManifold;s.Collision.ClipVertex,s.Collision.Features,s.Collision.IBroadPhase;s.inherit(n,s.Dynamics.Contacts.b2Contact),n.prototype.__super=s.Dynamics.Contacts.b2Contact.prototype,n.b2CircleContact=function(){s.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(t){return new n},n.Destroy=function(t,i){},n.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},n.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();M.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},l.b2Contact=function(){this.m_nodeA=new h,this.m_nodeB=new h,this.m_manifold=new I,this.m_oldManifold=new I},l.prototype.GetManifold=function(){return this.m_manifold},l.prototype.GetWorldManifold=function(t){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,i.GetTransform(),e.m_radius,o.GetTransform(),n.m_radius)},l.prototype.IsTouching=function(){return(this.m_flags&l.e_touchingFlag)==l.e_touchingFlag},l.prototype.IsContinuous=function(){return(this.m_flags&l.e_continuousFlag)==l.e_continuousFlag},l.prototype.SetSensor=function(t){t?this.m_flags|=l.e_sensorFlag:this.m_flags&=~l.e_sensorFlag},l.prototype.IsSensor=function(){return(this.m_flags&l.e_sensorFlag)==l.e_sensorFlag},l.prototype.SetEnabled=function(t){t?this.m_flags|=l.e_enabledFlag:this.m_flags&=~l.e_enabledFlag},l.prototype.IsEnabled=function(){return(this.m_flags&l.e_enabledFlag)==l.e_enabledFlag},l.prototype.GetNext=function(){return this.m_next},l.prototype.GetFixtureA=function(){return this.m_fixtureA},l.prototype.GetFixtureB=function(){return this.m_fixtureB},l.prototype.FlagForFiltering=function(){this.m_flags|=l.e_filterFlag},l.prototype.b2Contact=function(){},l.prototype.Reset=function(t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),this.m_flags=l.e_enabledFlag,!t||!i)return this.m_fixtureA=null,void(this.m_fixtureB=null);(t.IsSensor()||i.IsSensor())&&(this.m_flags|=l.e_sensorFlag);var o=t.GetBody(),e=i.GetBody();(o.GetType()!=A.b2_dynamicBody||o.IsBullet()||e.GetType()!=A.b2_dynamicBody||e.IsBullet())&&(this.m_flags|=l.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=i,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},l.prototype.Update=function(t){var i=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=i,this.m_flags|=l.e_enabledFlag;var o=!1,n=(this.m_flags&l.e_touchingFlag)==l.e_touchingFlag,s=this.m_fixtureA.m_body,r=this.m_fixtureB.m_body,a=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&l.e_sensorFlag){if(a){var m=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape(),h=s.GetTransform(),_=r.GetTransform();o=e.TestOverlap(m,h,c,_)}this.m_manifold.m_pointCount=0}else{if(s.GetType()!=A.b2_dynamicBody||s.IsBullet()||r.GetType()!=A.b2_dynamicBody||r.IsBullet()?this.m_flags|=l.e_continuousFlag:this.m_flags&=~l.e_continuousFlag,a){this.Evaluate(),o=this.m_manifold.m_pointCount>0;for(var p=0;p<this.m_manifold.m_pointCount;++p){var y=this.m_manifold.m_points[p];y.m_normalImpulse=0,y.m_tangentImpulse=0;for(var u=y.m_id,x=0;x<this.m_oldManifold.m_pointCount;++x){var f=this.m_oldManifold.m_points[x];if(f.m_id.key==u.key){y.m_normalImpulse=f.m_normalImpulse,y.m_tangentImpulse=f.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;o!=n&&(s.SetAwake(!0),r.SetAwake(!0))}o?this.m_flags|=l.e_touchingFlag:this.m_flags&=~l.e_touchingFlag,0==n&&1==o&&t.BeginContact(this),1==n&&0==o&&t.EndContact(this),0==(this.m_flags&l.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)},l.prototype.Evaluate=function(){},l.prototype.ComputeTOI=function(t,i){return l.s_input.proxyA.Set(this.m_fixtureA.GetShape()),l.s_input.proxyB.Set(this.m_fixtureB.GetShape()),l.s_input.sweepA=t,l.s_input.sweepB=i,l.s_input.tolerance=g.b2_linearSlop,G.TimeOfImpact(l.s_input)},s.postDefs.push(function(){s.Dynamics.Contacts.b2Contact.e_sensorFlag=1,s.Dynamics.Contacts.b2Contact.e_continuousFlag=2,s.Dynamics.Contacts.b2Contact.e_islandFlag=4,s.Dynamics.Contacts.b2Contact.e_toiFlag=8,s.Dynamics.Contacts.b2Contact.e_touchingFlag=16,s.Dynamics.Contacts.b2Contact.e_enabledFlag=32,s.Dynamics.Contacts.b2Contact.e_filterFlag=64,s.Dynamics.Contacts.b2Contact.s_input=new L}),m.b2ContactConstraint=function(){this.localPlaneNormal=new B,this.localPoint=new B,this.normal=new B,this.normalMass=new w,this.K=new w},m.prototype.b2ContactConstraint=function(){this.points=new r(g.b2_maxManifoldPoints);for(var t=0;t<g.b2_maxManifoldPoints;t++)this.points[t]=new c},c.b2ContactConstraintPoint=function(){this.localPoint=new B,this.rA=new B,this.rB=new B},h.b2ContactEdge=function(){},_.b2ContactFactory=function(){},_.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},_.prototype.AddType=function(t,i,o,e){void 0===o&&(o=0),void 0===e&&(e=0),this.m_registers[o][e].createFcn=t,this.m_registers[o][e].destroyFcn=i,this.m_registers[o][e].primary=!0,o!=e&&(this.m_registers[e][o].createFcn=t,this.m_registers[e][o].destroyFcn=i,this.m_registers[e][o].primary=!1)},_.prototype.InitializeRegisters=function(){this.m_registers=new r(e.e_shapeTypeCount);for(var t=0;t<e.e_shapeTypeCount;t++){this.m_registers[t]=new r(e.e_shapeTypeCount);for(var i=0;i<e.e_shapeTypeCount;i++)this.m_registers[t][i]=new p}this.AddType(n.Create,n.Destroy,e.e_circleShape,e.e_circleShape),this.AddType(d.Create,d.Destroy,e.e_polygonShape,e.e_circleShape),this.AddType(v.Create,v.Destroy,e.e_polygonShape,e.e_polygonShape),this.AddType(x.Create,x.Destroy,e.e_edgeShape,e.e_circleShape),this.AddType(b.Create,b.Destroy,e.e_polygonShape,e.e_edgeShape)},_.prototype.Create=function(t,i){var o,e=parseInt(t.GetType()),n=parseInt(i.GetType()),s=this.m_registers[e][n];if(s.pool)return o=s.pool,s.pool=o.m_next,s.poolCount--,o.Reset(t,i),o;var r=s.createFcn;return null!=r?s.primary?(o=r(this.m_allocator),o.Reset(t,i),o):(o=r(this.m_allocator),o.Reset(i,t),o):null},_.prototype.Destroy=function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var i=parseInt(t.m_fixtureA.GetType()),o=parseInt(t.m_fixtureB.GetType()),e=this.m_registers[i][o];e.poolCount++,t.m_next=e.pool,e.pool=t,(0,e.destroyFcn)(t,this.m_allocator)},p.b2ContactRegister=function(){},y.b2ContactResult=function(){this.position=new B,this.normal=new B,this.id=new V},u.b2ContactSolver=function(){this.m_step=new S,this.m_constraints=new r},u.prototype.b2ContactSolver=function(){},u.prototype.Initialize=function(t,i,o,e){void 0===o&&(o=0);var n;this.m_step.Set(t),this.m_allocator=e;var s=0;for(this.m_constraintCount=o;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new m;for(s=0;s<o;++s){n=i[s];var r=n.m_fixtureA,a=n.m_fixtureB,l=r.m_shape,c=a.m_shape,h=l.m_radius,_=c.m_radius,p=r.m_body,y=a.m_body,x=n.GetManifold(),f=g.b2MixFriction(r.GetFriction(),a.GetFriction()),d=g.b2MixRestitution(r.GetRestitution(),a.GetRestitution()),b=p.m_linearVelocity.x,v=p.m_linearVelocity.y,C=y.m_linearVelocity.x,A=y.m_linearVelocity.y,S=p.m_angularVelocity,w=y.m_angularVelocity;g.b2Assert(x.m_pointCount>0),u.s_worldManifold.Initialize(x,p.m_xf,h,y.m_xf,_);var D=u.s_worldManifold.m_normal.x,B=u.s_worldManifold.m_normal.y,M=this.m_constraints[s];M.bodyA=p,M.bodyB=y,M.manifold=x,M.normal.x=D,M.normal.y=B,M.pointCount=x.m_pointCount,M.friction=f,M.restitution=d,M.localPlaneNormal.x=x.m_localPlaneNormal.x,M.localPlaneNormal.y=x.m_localPlaneNormal.y,M.localPoint.x=x.m_localPoint.x,M.localPoint.y=x.m_localPoint.y,M.radius=h+_,M.type=x.m_type;for(var V=0;V<M.pointCount;++V){var I=x.m_points[V],G=M.points[V];G.normalImpulse=I.m_normalImpulse,G.tangentImpulse=I.m_tangentImpulse,G.localPoint.SetV(I.m_localPoint);var L=G.rA.x=u.s_worldManifold.m_points[V].x-p.m_sweep.c.x,J=G.rA.y=u.s_worldManifold.m_points[V].y-p.m_sweep.c.y,F=G.rB.x=u.s_worldManifold.m_points[V].x-y.m_sweep.c.x,P=G.rB.y=u.s_worldManifold.m_points[V].y-y.m_sweep.c.y,R=L*B-J*D,T=F*B-P*D;R*=R,T*=T;var k=p.m_invMass+y.m_invMass+p.m_invI*R+y.m_invI*T;G.normalMass=1/k;var z=p.m_mass*p.m_invMass+y.m_mass*y.m_invMass;z+=p.m_mass*p.m_invI*R+y.m_mass*y.m_invI*T,G.equalizedMass=1/z;var N=B,E=-D,j=L*E-J*N,U=F*E-P*N;j*=j,U*=U;var q=p.m_invMass+y.m_invMass+p.m_invI*j+y.m_invI*U;G.tangentMass=1/q,G.velocityBias=0;var O=C+-w*P-b- -S*J,K=A+w*F-v-S*L,W=M.normal.x*O+M.normal.y*K;W<-g.b2_velocityThreshold&&(G.velocityBias+=-M.restitution*W)}if(2==M.pointCount){var X=M.points[0],Z=M.points[1],H=p.m_invMass,Y=p.m_invI,Q=y.m_invMass,$=y.m_invI,tt=X.rA.x*B-X.rA.y*D,it=X.rB.x*B-X.rB.y*D,ot=Z.rA.x*B-Z.rA.y*D,et=Z.rB.x*B-Z.rB.y*D,nt=H+Q+Y*tt*tt+$*it*it,st=H+Q+Y*ot*ot+$*et*et,rt=H+Q+Y*tt*ot+$*it*et;nt*nt<100*(nt*st-rt*rt)?(M.K.col1.Set(nt,rt),M.K.col2.Set(rt,st),M.K.GetInverse(M.normalMass)):M.pointCount=1}}},u.prototype.InitVelocityConstraints=function(t){for(var i=0;i<this.m_constraintCount;++i){var o=this.m_constraints[i],e=o.bodyA,n=o.bodyB,s=e.m_invMass,r=e.m_invI,a=n.m_invMass,l=n.m_invI,m=o.normal.x,c=o.normal.y,h=c,_=-m,p=0,y=0;if(t.warmStarting)for(y=o.pointCount,p=0;p<y;++p){var u=o.points[p];u.normalImpulse*=t.dtRatio,u.tangentImpulse*=t.dtRatio;var x=u.normalImpulse*m+u.tangentImpulse*h,f=u.normalImpulse*c+u.tangentImpulse*_;e.m_angularVelocity-=r*(u.rA.x*f-u.rA.y*x),e.m_linearVelocity.x-=s*x,e.m_linearVelocity.y-=s*f,n.m_angularVelocity+=l*(u.rB.x*f-u.rB.y*x),n.m_linearVelocity.x+=a*x,n.m_linearVelocity.y+=a*f}else for(y=o.pointCount,p=0;p<y;++p){var d=o.points[p];d.normalImpulse=0,d.tangentImpulse=0}}},u.prototype.SolveVelocityConstraints=function(){for(var t,i,o=0,e=0,n=0,s=0,r=0,a=0,l=0,m=0,c=0,h=0,_=0,p=0,y=0,u=0,x=0,f=0,d=0;d<this.m_constraintCount;++d){var b=this.m_constraints[d],v=b.bodyA,C=b.bodyB,A=v.m_angularVelocity,S=C.m_angularVelocity,g=v.m_linearVelocity,w=C.m_linearVelocity,B=v.m_invMass,M=v.m_invI,V=C.m_invMass,I=C.m_invI,G=b.normal.x,L=b.normal.y,J=L,F=-G,P=b.friction;for(o=0;o<b.pointCount;o++)t=b.points[o],e=w.x-S*t.rB.y-g.x+A*t.rA.y,n=w.y+S*t.rB.x-g.y-A*t.rA.x,r=e*J+n*F,a=t.tangentMass*-r,l=P*t.normalImpulse,m=D.Clamp(t.tangentImpulse+a,-l,l),a=m-t.tangentImpulse,c=a*J,h=a*F,g.x-=B*c,g.y-=B*h,A-=M*(t.rA.x*h-t.rA.y*c),w.x+=V*c,w.y+=V*h,S+=I*(t.rB.x*h-t.rB.y*c),t.tangentImpulse=m;parseInt(b.pointCount);if(1==b.pointCount)t=b.points[0],e=w.x+-S*t.rB.y-g.x- -A*t.rA.y,n=w.y+S*t.rB.x-g.y-A*t.rA.x,s=e*G+n*L,a=-t.normalMass*(s-t.velocityBias),m=t.normalImpulse+a,m=m>0?m:0,a=m-t.normalImpulse,c=a*G,h=a*L,g.x-=B*c,g.y-=B*h,A-=M*(t.rA.x*h-t.rA.y*c),w.x+=V*c,w.y+=V*h,S+=I*(t.rB.x*h-t.rB.y*c),t.normalImpulse=m;else{var R=b.points[0],T=b.points[1],k=R.normalImpulse,z=T.normalImpulse,N=w.x-S*R.rB.y-g.x+A*R.rA.y,E=w.y+S*R.rB.x-g.y-A*R.rA.x,j=w.x-S*T.rB.y-g.x+A*T.rA.y,U=w.y+S*T.rB.x-g.y-A*T.rA.x,q=N*G+E*L,O=j*G+U*L,K=q-R.velocityBias,W=O-T.velocityBias;i=b.K,K-=i.col1.x*k+i.col2.x*z,W-=i.col1.y*k+i.col2.y*z;for(;;){i=b.normalMass;var X=-(i.col1.x*K+i.col2.x*W),Z=-(i.col1.y*K+i.col2.y*W);if(X>=0&&Z>=0){_=X-k,p=Z-z,y=_*G,u=_*L,x=p*G,f=p*L,g.x-=B*(y+x),g.y-=B*(u+f),A-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x),w.x+=V*(y+x),w.y+=V*(u+f),S+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x),R.normalImpulse=X,T.normalImpulse=Z;break}if(X=-R.normalMass*K,Z=0,q=0,O=b.K.col1.y*X+W,X>=0&&O>=0){_=X-k,p=Z-z,y=_*G,u=_*L,x=p*G,f=p*L,g.x-=B*(y+x),g.y-=B*(u+f),A-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x),w.x+=V*(y+x),w.y+=V*(u+f),S+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x),R.normalImpulse=X,T.normalImpulse=Z;break}if(X=0,Z=-T.normalMass*W,q=b.K.col2.x*Z+K,O=0,Z>=0&&q>=0){_=X-k,p=Z-z,y=_*G,u=_*L,x=p*G,f=p*L,g.x-=B*(y+x),g.y-=B*(u+f),A-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x),w.x+=V*(y+x),w.y+=V*(u+f),S+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x),R.normalImpulse=X,T.normalImpulse=Z;break}if(X=0,Z=0,q=K,O=W,q>=0&&O>=0){_=X-k,p=Z-z,y=_*G,u=_*L,x=p*G,f=p*L,g.x-=B*(y+x),g.y-=B*(u+f),A-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x),w.x+=V*(y+x),w.y+=V*(u+f),S+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x),R.normalImpulse=X,T.normalImpulse=Z;break}break}}v.m_angularVelocity=A,C.m_angularVelocity=S}},u.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var i=this.m_constraints[t],o=i.manifold,e=0;e<i.pointCount;++e){var n=o.m_points[e],s=i.points[e];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},u.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var i=0,o=0;o<this.m_constraintCount;o++){var e=this.m_constraints[o],n=e.bodyA,s=e.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,l=s.m_mass*s.m_invMass,m=s.m_mass*s.m_invI;u.s_psm.Initialize(e);for(var c=u.s_psm.m_normal,h=0;h<e.pointCount;h++){var _=e.points[h],p=u.s_psm.m_points[h],y=u.s_psm.m_separations[h],x=p.x-n.m_sweep.c.x,f=p.y-n.m_sweep.c.y,d=p.x-s.m_sweep.c.x,b=p.y-s.m_sweep.c.y;i=i<y?i:y;var v=D.Clamp(t*(y+g.b2_linearSlop),-g.b2_maxLinearCorrection,0),C=-_.equalizedMass*v,A=C*c.x,S=C*c.y;n.m_sweep.c.x-=r*A,n.m_sweep.c.y-=r*S,n.m_sweep.a-=a*(x*S-f*A),n.SynchronizeTransform(),s.m_sweep.c.x+=l*A,s.m_sweep.c.y+=l*S,s.m_sweep.a+=m*(d*S-b*A),s.SynchronizeTransform()}}return i>-1.5*g.b2_linearSlop},s.postDefs.push(function(){s.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new J,s.Dynamics.Contacts.b2ContactSolver.s_psm=new C}),s.inherit(x,s.Dynamics.Contacts.b2Contact),x.prototype.__super=s.Dynamics.Contacts.b2Contact.prototype,x.b2EdgeAndCircleContact=function(){s.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},x.Create=function(t){return new x},x.Destroy=function(t,i){},x.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},x.prototype.Evaluate=function(){var o=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,o.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,e.m_xf)},x.prototype.b2CollideEdgeAndCircle=function(t,i,o,e,n){},s.inherit(f,s.Dynamics.Contacts.b2Contact),f.prototype.__super=s.Dynamics.Contacts.b2Contact.prototype,f.b2NullContact=function(){s.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},f.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},f.prototype.Evaluate=function(){},s.inherit(d,s.Dynamics.Contacts.b2Contact),d.prototype.__super=s.Dynamics.Contacts.b2Contact.prototype,d.b2PolyAndCircleContact=function(){s.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.Create=function(t){return new d},d.Destroy=function(t,i){},d.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i),g.b2Assert(t.GetType()==e.e_polygonShape),g.b2Assert(i.GetType()==e.e_circleShape)},d.prototype.Evaluate=function(){var i=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body;M.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,e.m_xf)},s.inherit(b,s.Dynamics.Contacts.b2Contact),b.prototype.__super=s.Dynamics.Contacts.b2Contact.prototype,b.b2PolyAndEdgeContact=function(){s.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b.Create=function(t){return new b},b.Destroy=function(t,i){},b.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i),g.b2Assert(t.GetType()==e.e_polygonShape),g.b2Assert(i.GetType()==e.e_edgeShape)},b.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)},b.prototype.b2CollidePolyAndEdge=function(t,i,o,e,n){},s.inherit(v,s.Dynamics.Contacts.b2Contact),v.prototype.__super=s.Dynamics.Contacts.b2Contact.prototype,v.b2PolygonContact=function(){s.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},v.Create=function(t){return new v},v.Destroy=function(t,i){},v.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();M.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof o?this.m_fixtureB.GetShape():null,i.m_xf)},C.b2PositionSolverManifold=function(){},C.prototype.b2PositionSolverManifold=function(){this.m_normal=new B,this.m_separations=new a(g.b2_maxManifoldPoints),this.m_points=new r(g.b2_maxManifoldPoints);for(var t=0;t<g.b2_maxManifoldPoints;t++)this.m_points[t]=new B},C.prototype.Initialize=function(t){g.b2Assert(t.pointCount>0);var i,o,e=0,n=0,s=0,r=0,a=0;switch(t.type){case I.e_circles:i=t.bodyA.m_xf.R,o=t.localPoint;var l=t.bodyA.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),m=t.bodyA.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y);i=t.bodyB.m_xf.R,o=t.points[0].localPoint;var c=t.bodyB.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),h=t.bodyB.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y),_=c-l,p=h-m,y=_*_+p*p;if(y>Number.MIN_VALUE*Number.MIN_VALUE){var u=Math.sqrt(y);this.m_normal.x=_/u,this.m_normal.y=p/u}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(l+c),this.m_points[0].y=.5*(m+h),this.m_separations[0]=_*this.m_normal.x+p*this.m_normal.y-t.radius;break;case I.e_faceA:for(i=t.bodyA.m_xf.R,o=t.localPlaneNormal,this.m_normal.x=i.col1.x*o.x+i.col2.x*o.y,this.m_normal.y=i.col1.y*o.x+i.col2.y*o.y,i=t.bodyA.m_xf.R,o=t.localPoint,r=t.bodyA.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),a=t.bodyA.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y),i=t.bodyB.m_xf.R,e=0;e<t.pointCount;++e)o=t.points[e].localPoint,n=t.bodyB.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),s=t.bodyB.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y),this.m_separations[e]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[e].x=n,this.m_points[e].y=s;break;case I.e_faceB:for(i=t.bodyB.m_xf.R,o=t.localPlaneNormal,this.m_normal.x=i.col1.x*o.x+i.col2.x*o.y,this.m_normal.y=i.col1.y*o.x+i.col2.y*o.y,i=t.bodyB.m_xf.R,o=t.localPoint,r=t.bodyB.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),a=t.bodyB.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y),i=t.bodyA.m_xf.R,e=0;e<t.pointCount;++e)o=t.points[e].localPoint,n=t.bodyA.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),s=t.bodyA.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y),this.m_separations[e]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[e].Set(n,s);this.m_normal.x*=-1,this.m_normal.y*=-1}},s.postDefs.push(function(){s.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new B,s.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new B})}(),function(){var t=(s.Dynamics.b2Body,s.Dynamics.b2BodyDef,s.Dynamics.b2ContactFilter,s.Dynamics.b2ContactImpulse,s.Dynamics.b2ContactListener,s.Dynamics.b2ContactManager,s.Dynamics.b2DebugDraw,s.Dynamics.b2DestructionListener,s.Dynamics.b2FilterData,s.Dynamics.b2Fixture,s.Dynamics.b2FixtureDef,s.Dynamics.b2Island,s.Dynamics.b2TimeStep,s.Dynamics.b2World,s.Common.Math.b2Mat22),i=(s.Common.Math.b2Mat33,s.Common.Math.b2Math),o=(s.Common.Math.b2Sweep,s.Common.Math.b2Transform,s.Common.Math.b2Vec2),e=(s.Common.Math.b2Vec3,s.Common.b2Color),n=(s.Common.b2internal,s.Common.b2Settings,s.Collision.Shapes.b2CircleShape,s.Collision.Shapes.b2EdgeChainDef,s.Collision.Shapes.b2EdgeShape,s.Collision.Shapes.b2MassData,s.Collision.Shapes.b2PolygonShape,s.Collision.Shapes.b2Shape,s.Dynamics.Controllers.b2BuoyancyController),r=s.Dynamics.Controllers.b2ConstantAccelController,a=s.Dynamics.Controllers.b2ConstantForceController,l=s.Dynamics.Controllers.b2Controller,m=s.Dynamics.Controllers.b2ControllerEdge,c=s.Dynamics.Controllers.b2GravityController,h=s.Dynamics.Controllers.b2TensorDampingController;s.inherit(n,s.Dynamics.Controllers.b2Controller),n.prototype.__super=s.Dynamics.Controllers.b2Controller.prototype,n.b2BuoyancyController=function(){s.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new o(0,-1),this.offset=0,this.density=0,this.velocity=new o(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},n.prototype.Step=function(t){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var i=this.m_bodyList;i;i=i.nextBody){var e=i.body;if(0!=e.IsAwake()){for(var n=new o,s=new o,r=0,a=0,l=e.GetFixtureList();l;l=l.GetNext()){var m=new o,c=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),m);r+=c,n.x+=c*m.x,n.y+=c*m.y;var h=0;h=(this.useDensity,1),a+=c*h,s.x+=c*m.x*h,s.y+=c*m.y*h}if(n.x/=r,n.y/=r,s.x/=a,s.y/=a,!(r<Number.MIN_VALUE)){var _=this.gravity.GetNegative();_.Multiply(this.density*r),e.ApplyForce(_,s);var p=e.GetLinearVelocityFromWorldPoint(n);p.Subtract(this.velocity),p.Multiply(-this.linearDrag*r),e.ApplyForce(p,n),e.ApplyTorque(-e.GetInertia()/e.GetMass()*r*e.GetAngularVelocity()*this.angularDrag)}}}}},n.prototype.Draw=function(t){var i=1e3,n=new o,s=new o;n.x=this.normal.x*this.offset+this.normal.y*i,n.y=this.normal.y*this.offset-this.normal.x*i,s.x=this.normal.x*this.offset-this.normal.y*i,s.y=this.normal.y*this.offset+this.normal.x*i;var r=new e(0,0,1);t.DrawSegment(n,s,r)},s.inherit(r,s.Dynamics.Controllers.b2Controller),r.prototype.__super=s.Dynamics.Controllers.b2Controller.prototype,r.b2ConstantAccelController=function(){s.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new o(0,0)},r.prototype.Step=function(t){for(var i=new o(this.A.x*t.dt,this.A.y*t.dt),e=this.m_bodyList;e;e=e.nextBody){var n=e.body;n.IsAwake()&&n.SetLinearVelocity(new o(n.GetLinearVelocity().x+i.x,n.GetLinearVelocity().y+i.y))}},s.inherit(a,s.Dynamics.Controllers.b2Controller),a.prototype.__super=s.Dynamics.Controllers.b2Controller.prototype,a.b2ConstantForceController=function(){s.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new o(0,0)},a.prototype.Step=function(t){for(var i=this.m_bodyList;i;i=i.nextBody){var o=i.body;o.IsAwake()&&o.ApplyForce(this.F,o.GetWorldCenter())}},l.b2Controller=function(){},l.prototype.Step=function(t){},l.prototype.Draw=function(t){},l.prototype.AddBody=function(t){var i=new m;i.controller=this,i.body=t,i.nextBody=this.m_bodyList,i.prevBody=null,this.m_bodyList=i,i.nextBody&&(i.nextBody.prevBody=i),this.m_bodyCount++,i.nextController=t.m_controllerList,i.prevController=null,t.m_controllerList=i,i.nextController&&(i.nextController.prevController=i),t.m_controllerCount++},l.prototype.RemoveBody=function(t){for(var i=t.m_controllerList;i&&i.controller!=this;)i=i.nextController;i.prevBody&&(i.prevBody.nextBody=i.nextBody),i.nextBody&&(i.nextBody.prevBody=i.prevBody),i.nextController&&(i.nextController.prevController=i.prevController),i.prevController&&(i.prevController.nextController=i.nextController),this.m_bodyList==i&&(this.m_bodyList=i.nextBody),t.m_controllerList==i&&(t.m_controllerList=i.nextController),t.m_controllerCount--,this.m_bodyCount--},l.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},l.prototype.GetNext=function(){return this.m_next},l.prototype.GetWorld=function(){return this.m_world},l.prototype.GetBodyList=function(){return this.m_bodyList},m.b2ControllerEdge=function(){},s.inherit(c,s.Dynamics.Controllers.b2Controller),c.prototype.__super=s.Dynamics.Controllers.b2Controller.prototype,c.b2GravityController=function(){s.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},c.prototype.Step=function(t){var i=null,e=null,n=null,s=0,r=null,a=null,l=null,m=0,c=0,h=0,_=null;if(this.invSqr)for(i=this.m_bodyList;i;i=i.nextBody)for(e=i.body,n=e.GetWorldCenter(),s=e.GetMass(),r=this.m_bodyList;r!=i;r=r.nextBody)a=r.body,l=a.GetWorldCenter(),m=l.x-n.x,c=l.y-n.y,(h=m*m+c*c)<Number.MIN_VALUE||(_=new o(m,c),_.Multiply(this.G/h/Math.sqrt(h)*s*a.GetMass()),e.IsAwake()&&e.ApplyForce(_,n),_.Multiply(-1),a.IsAwake()&&a.ApplyForce(_,l));else for(i=this.m_bodyList;i;i=i.nextBody)for(e=i.body,n=e.GetWorldCenter(),s=e.GetMass(),r=this.m_bodyList;r!=i;r=r.nextBody)a=r.body,l=a.GetWorldCenter(),m=l.x-n.x,c=l.y-n.y,(h=m*m+c*c)<Number.MIN_VALUE||(_=new o(m,c),_.Multiply(this.G/h*s*a.GetMass()),e.IsAwake()&&e.ApplyForce(_,n),_.Multiply(-1),a.IsAwake()&&a.ApplyForce(_,l))},s.inherit(h,s.Dynamics.Controllers.b2Controller),h.prototype.__super=s.Dynamics.Controllers.b2Controller.prototype,h.b2TensorDampingController=function(){s.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},h.prototype.SetAxisAligned=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-i,this.maxTimestep=t>0||i>0?1/Math.max(t,i):0},h.prototype.Step=function(t){var e=t.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(i.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity())));s.SetLinearVelocity(new o(s.GetLinearVelocity().x+r.x*e,s.GetLinearVelocity().y+r.y*e))}}}}}(),function(){var t=(s.Common.b2Color,s.Common.b2internal,s.Common.b2Settings),i=s.Common.Math.b2Mat22,o=s.Common.Math.b2Mat33,e=s.Common.Math.b2Math,n=(s.Common.Math.b2Sweep,s.Common.Math.b2Transform,s.Common.Math.b2Vec2),r=s.Common.Math.b2Vec3,a=s.Dynamics.Joints.b2DistanceJoint,l=s.Dynamics.Joints.b2DistanceJointDef,m=s.Dynamics.Joints.b2FrictionJoint,c=s.Dynamics.Joints.b2FrictionJointDef,h=s.Dynamics.Joints.b2GearJoint,_=s.Dynamics.Joints.b2GearJointDef,p=s.Dynamics.Joints.b2Jacobian,y=s.Dynamics.Joints.b2Joint,u=s.Dynamics.Joints.b2JointDef,x=s.Dynamics.Joints.b2JointEdge,f=s.Dynamics.Joints.b2LineJoint,d=s.Dynamics.Joints.b2LineJointDef,b=s.Dynamics.Joints.b2MouseJoint,v=s.Dynamics.Joints.b2MouseJointDef,C=s.Dynamics.Joints.b2PrismaticJoint,A=s.Dynamics.Joints.b2PrismaticJointDef,S=s.Dynamics.Joints.b2PulleyJoint,g=s.Dynamics.Joints.b2PulleyJointDef,w=s.Dynamics.Joints.b2RevoluteJoint,D=s.Dynamics.Joints.b2RevoluteJointDef,B=s.Dynamics.Joints.b2WeldJoint,M=s.Dynamics.Joints.b2WeldJointDef;s.Dynamics.b2Body,s.Dynamics.b2BodyDef,s.Dynamics.b2ContactFilter,s.Dynamics.b2ContactImpulse,s.Dynamics.b2ContactListener,s.Dynamics.b2ContactManager,s.Dynamics.b2DebugDraw,s.Dynamics.b2DestructionListener,s.Dynamics.b2FilterData,s.Dynamics.b2Fixture,s.Dynamics.b2FixtureDef,s.Dynamics.b2Island,s.Dynamics.b2TimeStep,s.Dynamics.b2World;s.inherit(a,s.Dynamics.Joints.b2Joint),a.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,a.b2DistanceJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u=new n},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},a.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},a.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},a.prototype.GetLength=function(){return this.m_length},a.prototype.SetLength=function(t){void 0===t&&(t=0),this.m_length=t},a.prototype.GetFrequency=function(){return this.m_frequencyHz},a.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},a.prototype.GetDampingRatio=function(){return this.m_dampingRatio},a.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},a.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},a.prototype.InitVelocityConstraints=function(i){var o,e=0,n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;e=o.col1.x*r+o.col2.x*a,a=o.col1.y*r+o.col2.y*a,r=e,o=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,m=this.m_localAnchor2.y-s.m_sweep.localCenter.y;e=o.col1.x*l+o.col2.x*m,m=o.col1.y*l+o.col2.y*m,l=e,this.m_u.x=s.m_sweep.c.x+l-n.m_sweep.c.x-r,this.m_u.y=s.m_sweep.c.y+m-n.m_sweep.c.y-a;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>t.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var h=r*this.m_u.y-a*this.m_u.x,_=l*this.m_u.y-m*this.m_u.x,p=n.m_invMass+n.m_invI*h*h+s.m_invMass+s.m_invI*_*_;if(this.m_mass=0!=p?1/p:0,this.m_frequencyHz>0){var y=c-this.m_length,u=2*Math.PI*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*u,f=this.m_mass*u*u;this.m_gamma=i.dt*(x+i.dt*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*i.dt*f*this.m_gamma,this.m_mass=p+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(i.warmStarting){this.m_impulse*=i.dtRatio;var d=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*d,n.m_linearVelocity.y-=n.m_invMass*b,n.m_angularVelocity-=n.m_invI*(r*b-a*d),s.m_linearVelocity.x+=s.m_invMass*d,s.m_linearVelocity.y+=s.m_invMass*b,s.m_angularVelocity+=s.m_invI*(l*b-m*d)}else this.m_impulse=0},a.prototype.SolveVelocityConstraints=function(t){var i,o=this.m_bodyA,e=this.m_bodyB;i=o.m_xf.R;var n=this.m_localAnchor1.x-o.m_sweep.localCenter.x,s=this.m_localAnchor1.y-o.m_sweep.localCenter.y,r=i.col1.x*n+i.col2.x*s;s=i.col1.y*n+i.col2.y*s,n=r,i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x,l=this.m_localAnchor2.y-e.m_sweep.localCenter.y;r=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=r;var m=o.m_linearVelocity.x+-o.m_angularVelocity*s,c=o.m_linearVelocity.y+o.m_angularVelocity*n,h=e.m_linearVelocity.x+-e.m_angularVelocity*l,_=e.m_linearVelocity.y+e.m_angularVelocity*a,p=this.m_u.x*(h-m)+this.m_u.y*(_-c),y=-this.m_mass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=y;var u=y*this.m_u.x,x=y*this.m_u.y;o.m_linearVelocity.x-=o.m_invMass*u,o.m_linearVelocity.y-=o.m_invMass*x,o.m_angularVelocity-=o.m_invI*(n*x-s*u),e.m_linearVelocity.x+=e.m_invMass*u,e.m_linearVelocity.y+=e.m_invMass*x,e.m_angularVelocity+=e.m_invI*(a*x-l*u)},a.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,l=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a,r=l,o=s.m_xf.R;var m=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;l=o.col1.x*m+o.col2.x*c,c=o.col1.y*m+o.col2.y*c,m=l;var h=s.m_sweep.c.x+m-n.m_sweep.c.x-r,_=s.m_sweep.c.y+c-n.m_sweep.c.y-a,p=Math.sqrt(h*h+_*_);h/=p,_/=p;var y=p-this.m_length;y=e.Clamp(y,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var u=-this.m_mass*y;this.m_u.Set(h,_);var x=u*this.m_u.x,f=u*this.m_u.y;return n.m_sweep.c.x-=n.m_invMass*x,n.m_sweep.c.y-=n.m_invMass*f,n.m_sweep.a-=n.m_invI*(r*f-a*x),s.m_sweep.c.x+=s.m_invMass*x,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(m*f-c*x),n.SynchronizeTransform(),s.SynchronizeTransform(),e.Abs(y)<t.b2_linearSlop},s.inherit(l,s.Dynamics.Joints.b2JointDef),l.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,l.b2DistanceJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},l.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},
l.prototype.Initialize=function(t,i,o,e){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));var n=e.x-o.x,s=e.y-o.y;this.length=Math.sqrt(n*n+s*s),this.frequencyHz=0,this.dampingRatio=0},s.inherit(m,s.Dynamics.Joints.b2Joint),m.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,m.b2FrictionJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_linearMass=new i,this.m_linearImpulse=new n},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},m.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},m.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},m.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},m.prototype.GetMaxForce=function(){return this.m_maxForce},m.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},m.prototype.GetMaxTorque=function(){return this.m_maxTorque},m.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},m.prototype.InitVelocityConstraints=function(t){var o,e=0,n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchorA.x-n.m_sweep.localCenter.x,a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;e=o.col1.x*r+o.col2.x*a,a=o.col1.y*r+o.col2.y*a,r=e,o=s.m_xf.R;var l=this.m_localAnchorB.x-s.m_sweep.localCenter.x,m=this.m_localAnchorB.y-s.m_sweep.localCenter.y;e=o.col1.x*l+o.col2.x*m,m=o.col1.y*l+o.col2.y*m,l=e;var c=n.m_invMass,h=s.m_invMass,_=n.m_invI,p=s.m_invI,y=new i;if(y.col1.x=c+h,y.col2.x=0,y.col1.y=0,y.col2.y=c+h,y.col1.x+=_*a*a,y.col2.x+=-_*r*a,y.col1.y+=-_*r*a,y.col2.y+=_*r*r,y.col1.x+=p*m*m,y.col2.x+=-p*l*m,y.col1.y+=-p*l*m,y.col2.y+=p*l*l,y.GetInverse(this.m_linearMass),this.m_angularMass=_+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var u=this.m_linearImpulse;n.m_linearVelocity.x-=c*u.x,n.m_linearVelocity.y-=c*u.y,n.m_angularVelocity-=_*(r*u.y-a*u.x+this.m_angularImpulse),s.m_linearVelocity.x+=h*u.x,s.m_linearVelocity.y+=h*u.y,s.m_angularVelocity+=p*(l*u.y-m*u.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},m.prototype.SolveVelocityConstraints=function(t){var i,o=0,s=this.m_bodyA,r=this.m_bodyB,a=s.m_linearVelocity,l=s.m_angularVelocity,m=r.m_linearVelocity,c=r.m_angularVelocity,h=s.m_invMass,_=r.m_invMass,p=s.m_invI,y=r.m_invI;i=s.m_xf.R;var u=this.m_localAnchorA.x-s.m_sweep.localCenter.x,x=this.m_localAnchorA.y-s.m_sweep.localCenter.y;o=i.col1.x*u+i.col2.x*x,x=i.col1.y*u+i.col2.y*x,u=o,i=r.m_xf.R;var f=this.m_localAnchorB.x-r.m_sweep.localCenter.x,d=this.m_localAnchorB.y-r.m_sweep.localCenter.y;o=i.col1.x*f+i.col2.x*d,d=i.col1.y*f+i.col2.y*d,f=o;var b=0,v=c-l,C=-this.m_angularMass*v,A=this.m_angularImpulse;b=t.dt*this.m_maxTorque,this.m_angularImpulse=e.Clamp(this.m_angularImpulse+C,-b,b),C=this.m_angularImpulse-A,l-=p*C,c+=y*C;var S=m.x-c*d-a.x+l*x,g=m.y+c*f-a.y-l*u,w=e.MulMV(this.m_linearMass,new n(-S,-g)),D=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(w),b=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b)),w=e.SubtractVV(this.m_linearImpulse,D),a.x-=h*w.x,a.y-=h*w.y,l-=p*(u*w.y-x*w.x),m.x+=_*w.x,m.y+=_*w.y,c+=y*(f*w.y-d*w.x),s.m_angularVelocity=l,r.m_angularVelocity=c},m.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},s.inherit(c,s.Dynamics.Joints.b2JointDef),c.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,c.b2FrictionJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},c.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_frictionJoint,this.maxForce=0,this.maxTorque=0},c.prototype.Initialize=function(t,i,o){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o))},s.inherit(h,s.Dynamics.Joints.b2Joint),h.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,h.b2GearJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_J=new p},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},h.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},h.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var i=this.m_bodyB.m_xf.R,o=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=i.col1.x*o+i.col2.x*e;e=i.col1.y*o+i.col2.y*e,o=n;var s=this.m_impulse*this.m_J.linearB.x,r=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-o*r+e*s)},h.prototype.GetRatio=function(){return this.m_ratio},h.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},h.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var i=parseInt(t.joint1.m_type),o=parseInt(t.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var e=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),i==y.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof w?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),e=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof C?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),e=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),o==y.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof w?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof C?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=e+this.m_ratio*n,this.m_impulse=0},h.prototype.InitVelocityConstraints=function(t){var i,o,e=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,m=0,c=0,h=0,_=0,p=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,p+=s.m_invI):(i=e.m_xf.R,o=this.m_prismatic1.m_localXAxis1,a=i.col1.x*o.x+i.col2.x*o.y,l=i.col1.y*o.x+i.col2.y*o.y,i=s.m_xf.R,m=this.m_localAnchor1.x-s.m_sweep.localCenter.x,c=this.m_localAnchor1.y-s.m_sweep.localCenter.y,_=i.col1.x*m+i.col2.x*c,c=i.col1.y*m+i.col2.y*c,m=_,h=m*l-c*a,this.m_J.linearA.Set(-a,-l),this.m_J.angularA=-h,p+=s.m_invMass+s.m_invI*h*h),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*r.m_invI):(i=n.m_xf.R,o=this.m_prismatic2.m_localXAxis1,a=i.col1.x*o.x+i.col2.x*o.y,l=i.col1.y*o.x+i.col2.y*o.y,i=r.m_xf.R,m=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y,_=i.col1.x*m+i.col2.x*c,c=i.col1.y*m+i.col2.y*c,m=_,h=m*l-c*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*h,p+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*h*h)),this.m_mass=p>0?1/p:0,t.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},h.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,e=this.m_J.Compute(i.m_linearVelocity,i.m_angularVelocity,o.m_linearVelocity,o.m_angularVelocity),n=-this.m_mass*e;this.m_impulse+=n,i.m_linearVelocity.x+=i.m_invMass*n*this.m_J.linearA.x,i.m_linearVelocity.y+=i.m_invMass*n*this.m_J.linearA.y,i.m_angularVelocity+=i.m_invI*n*this.m_J.angularA,o.m_linearVelocity.x+=o.m_invMass*n*this.m_J.linearB.x,o.m_linearVelocity.y+=o.m_invMass*n*this.m_J.linearB.y,o.m_angularVelocity+=o.m_invI*n*this.m_J.angularB},h.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o=this.m_bodyA,e=this.m_bodyB,n=0,s=0;n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),s=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var r=this.m_constant-(n+this.m_ratio*s),a=-this.m_mass*r;return o.m_sweep.c.x+=o.m_invMass*a*this.m_J.linearA.x,o.m_sweep.c.y+=o.m_invMass*a*this.m_J.linearA.y,o.m_sweep.a+=o.m_invI*a*this.m_J.angularA,e.m_sweep.c.x+=e.m_invMass*a*this.m_J.linearB.x,e.m_sweep.c.y+=e.m_invMass*a*this.m_J.linearB.y,e.m_sweep.a+=e.m_invI*a*this.m_J.angularB,o.SynchronizeTransform(),e.SynchronizeTransform(),0<t.b2_linearSlop},s.inherit(_,s.Dynamics.Joints.b2JointDef),_.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,_.b2GearJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},_.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},p.b2Jacobian=function(){this.linearA=new n,this.linearB=new n},p.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},p.prototype.Set=function(t,i,o,e){void 0===i&&(i=0),void 0===e&&(e=0),this.linearA.SetV(t),this.angularA=i,this.linearB.SetV(o),this.angularB=e},p.prototype.Compute=function(t,i,o,e){return void 0===i&&(i=0),void 0===e&&(e=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*i+(this.linearB.x*o.x+this.linearB.y*o.y)+this.angularB*e},y.b2Joint=function(){this.m_edgeA=new x,this.m_edgeB=new x,this.m_localCenterA=new n,this.m_localCenterB=new n},y.prototype.GetType=function(){return this.m_type},y.prototype.GetAnchorA=function(){return null},y.prototype.GetAnchorB=function(){return null},y.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),null},y.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},y.prototype.GetBodyA=function(){return this.m_bodyA},y.prototype.GetBodyB=function(){return this.m_bodyB},y.prototype.GetNext=function(){return this.m_next},y.prototype.GetUserData=function(){return this.m_userData},y.prototype.SetUserData=function(t){this.m_userData=t},y.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},y.Create=function(t,i){var o=null;switch(t.type){case y.e_distanceJoint:o=new a(t instanceof l?t:null);break;case y.e_mouseJoint:o=new b(t instanceof v?t:null);break;case y.e_prismaticJoint:o=new C(t instanceof A?t:null);break;case y.e_revoluteJoint:o=new w(t instanceof D?t:null);break;case y.e_pulleyJoint:o=new S(t instanceof g?t:null);break;case y.e_gearJoint:o=new h(t instanceof _?t:null);break;case y.e_lineJoint:o=new f(t instanceof d?t:null);break;case y.e_weldJoint:o=new B(t instanceof M?t:null);break;case y.e_frictionJoint:o=new m(t instanceof c?t:null)}return o},y.Destroy=function(t,i){},y.prototype.b2Joint=function(i){t.b2Assert(i.bodyA!=i.bodyB),this.m_type=i.type,this.m_prev=null,this.m_next=null,this.m_bodyA=i.bodyA,this.m_bodyB=i.bodyB,this.m_collideConnected=i.collideConnected,this.m_islandFlag=!1,this.m_userData=i.userData},y.prototype.InitVelocityConstraints=function(t){},y.prototype.SolveVelocityConstraints=function(t){},y.prototype.FinalizeVelocityConstraints=function(){},y.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!1},s.postDefs.push(function(){s.Dynamics.Joints.b2Joint.e_unknownJoint=0,s.Dynamics.Joints.b2Joint.e_revoluteJoint=1,s.Dynamics.Joints.b2Joint.e_prismaticJoint=2,s.Dynamics.Joints.b2Joint.e_distanceJoint=3,s.Dynamics.Joints.b2Joint.e_pulleyJoint=4,s.Dynamics.Joints.b2Joint.e_mouseJoint=5,s.Dynamics.Joints.b2Joint.e_gearJoint=6,s.Dynamics.Joints.b2Joint.e_lineJoint=7,s.Dynamics.Joints.b2Joint.e_weldJoint=8,s.Dynamics.Joints.b2Joint.e_frictionJoint=9,s.Dynamics.Joints.b2Joint.e_inactiveLimit=0,s.Dynamics.Joints.b2Joint.e_atLowerLimit=1,s.Dynamics.Joints.b2Joint.e_atUpperLimit=2,s.Dynamics.Joints.b2Joint.e_equalLimits=3}),u.b2JointDef=function(){},u.prototype.b2JointDef=function(){this.type=y.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},x.b2JointEdge=function(){},s.inherit(f,s.Dynamics.Joints.b2Joint),f.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,f.b2LineJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new i,this.m_impulse=new n},f.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},f.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},f.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},f.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),e=i.GetWorldPoint(this.m_localAnchor2),n=e.x-o.x,s=e.y-o.y,r=t.GetWorldVector(this.m_localXAxis1);return r.x*n+r.y*s},f.prototype.GetJointSpeed=function(){var t,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*e+t.col2.x*n;n=t.col1.y*e+t.col2.y*n,e=s,t=o.m_xf.R;var r=this.m_localAnchor2.x-o.m_sweep.localCenter.x,a=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=i.m_sweep.c.x+e,m=i.m_sweep.c.y+n,c=o.m_sweep.c.x+r,h=o.m_sweep.c.y+a,_=c-l,p=h-m,y=i.GetWorldVector(this.m_localXAxis1),u=i.m_linearVelocity,x=o.m_linearVelocity,f=i.m_angularVelocity,d=o.m_angularVelocity;return _*(-f*y.y)+p*(f*y.x)+(y.x*(x.x+-d*a-u.x- -f*n)+y.y*(x.y+d*r-u.y-f*e))},f.prototype.IsLimitEnabled=function(){return this.m_enableLimit},f.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},f.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},f.prototype.GetUpperLimit=function(){return this.m_upperTranslation},f.prototype.SetLimits=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i},f.prototype.IsMotorEnabled=function(){return this.m_enableMotor},f.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},f.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},f.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},f.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},f.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},f.prototype.GetMotorForce=function(){return this.m_motorImpulse},f.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=y.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},f.prototype.InitVelocityConstraints=function(i){var o,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform();o=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,m=this.m_localAnchor1.y-this.m_localCenterA.y;r=o.col1.x*l+o.col2.x*m,m=o.col1.y*l+o.col2.y*m,l=r,o=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;r=o.col1.x*c+o.col2.x*h,h=o.col1.y*c+o.col2.y*h,c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-l,p=s.m_sweep.c.y+h-n.m_sweep.c.y-m;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(e.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+l)*this.m_axis.y-(p+m)*this.m_axis.x,this.m_a2=c*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(e.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+l)*this.m_perp.y-(p+m)*this.m_perp.x,this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var u=this.m_invMassA,x=this.m_invMassB,f=this.m_invIA,d=this.m_invIB;if(this.m_K.col1.x=u+x+f*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+x+f*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2,this.m_enableLimit){var b=this.m_axis.x*_+this.m_axis.y*p;e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=y.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=y.e_atLowerLimit&&(this.m_limitState=y.e_atLowerLimit,this.m_impulse.y=0):b>=this.m_upperTranslation?this.m_limitState!=y.e_atUpperLimit&&(this.m_limitState=y.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=y.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),i.warmStarting){this.m_impulse.x*=i.dtRatio,this.m_impulse.y*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,C=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,A=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,S=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*C,n.m_angularVelocity-=this.m_invIA*A,s.m_linearVelocity.x+=this.m_invMassB*v,s.m_linearVelocity.y+=this.m_invMassB*C,s.m_angularVelocity+=this.m_invIB*S}else this.m_impulse.SetZero(),this.m_motorImpulse=0},f.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,s=i.m_linearVelocity,r=i.m_angularVelocity,a=o.m_linearVelocity,l=o.m_angularVelocity,m=0,c=0,h=0,_=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var p=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*r,u=this.m_motorMass*(this.m_motorSpeed-p),x=this.m_motorImpulse,f=t.dt*this.m_maxMotorForce;this.m_motorImpulse=e.Clamp(this.m_motorImpulse+u,-f,f),u=this.m_motorImpulse-x,m=u*this.m_axis.x,c=u*this.m_axis.y,h=u*this.m_a1,_=u*this.m_a2,s.x-=this.m_invMassA*m,s.y-=this.m_invMassA*c,r-=this.m_invIA*h,a.x+=this.m_invMassB*m,a.y+=this.m_invMassB*c,l+=this.m_invIB*_}var d=this.m_perp.x*(a.x-s.x)+this.m_perp.y*(a.y-s.y)+this.m_s2*l-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var b=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*r,v=this.m_impulse.Copy(),C=this.m_K.Solve(new n,-d,-b);this.m_impulse.Add(C),this.m_limitState==y.e_atLowerLimit?this.m_impulse.y=e.Max(this.m_impulse.y,0):this.m_limitState==y.e_atUpperLimit&&(this.m_impulse.y=e.Min(this.m_impulse.y,0));var A=-d-(this.m_impulse.y-v.y)*this.m_K.col2.x,S=0;S=0!=this.m_K.col1.x?A/this.m_K.col1.x+v.x:v.x,this.m_impulse.x=S,C.x=this.m_impulse.x-v.x,C.y=this.m_impulse.y-v.y,m=C.x*this.m_perp.x+C.y*this.m_axis.x,c=C.x*this.m_perp.y+C.y*this.m_axis.y,h=C.x*this.m_s1+C.y*this.m_a1,_=C.x*this.m_s2+C.y*this.m_a2,s.x-=this.m_invMassA*m,s.y-=this.m_invMassA*c,r-=this.m_invIA*h,a.x+=this.m_invMassB*m,a.y+=this.m_invMassB*c,l+=this.m_invIB*_}else{var g=0;g=0!=this.m_K.col1.x?-d/this.m_K.col1.x:0,this.m_impulse.x+=g,m=g*this.m_perp.x,c=g*this.m_perp.y,h=g*this.m_s1,_=g*this.m_s2,s.x-=this.m_invMassA*m,s.y-=this.m_invMassA*c,r-=this.m_invIA*h,a.x+=this.m_invMassB*m,a.y+=this.m_invMassB*c,l+=this.m_invIB*_}i.m_linearVelocity.SetV(s),i.m_angularVelocity=r,o.m_linearVelocity.SetV(a),o.m_angularVelocity=l},f.prototype.SolvePositionConstraints=function(o){void 0===o&&(o=0);var s,r=this.m_bodyA,a=this.m_bodyB,l=r.m_sweep.c,m=r.m_sweep.a,c=a.m_sweep.c,h=a.m_sweep.a,_=0,p=0,y=0,u=0,x=0,f=0,d=0,b=!1,v=0,C=i.FromAngle(m),A=i.FromAngle(h);s=C;var S=this.m_localAnchor1.x-this.m_localCenterA.x,g=this.m_localAnchor1.y-this.m_localCenterA.y;_=s.col1.x*S+s.col2.x*g,g=s.col1.y*S+s.col2.y*g,S=_,s=A;var w=this.m_localAnchor2.x-this.m_localCenterB.x,D=this.m_localAnchor2.y-this.m_localCenterB.y;_=s.col1.x*w+s.col2.x*D,D=s.col1.y*w+s.col2.y*D,w=_;var B=c.x+w-l.x-S,M=c.y+D-l.y-g;if(this.m_enableLimit){this.m_axis=e.MulMV(C,this.m_localXAxis1),this.m_a1=(B+S)*this.m_axis.y-(M+g)*this.m_axis.x,this.m_a2=w*this.m_axis.y-D*this.m_axis.x;var V=this.m_axis.x*B+this.m_axis.y*M;e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(v=e.Clamp(V,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),f=e.Abs(V),b=!0):V<=this.m_lowerTranslation?(v=e.Clamp(V-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=this.m_lowerTranslation-V,b=!0):V>=this.m_upperTranslation&&(v=e.Clamp(V-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),f=V-this.m_upperTranslation,b=!0)}this.m_perp=e.MulMV(C,this.m_localYAxis1),this.m_s1=(B+S)*this.m_perp.y-(M+g)*this.m_perp.x,this.m_s2=w*this.m_perp.y-D*this.m_perp.x;var I=new n,G=this.m_perp.x*B+this.m_perp.y*M;if(f=e.Max(f,e.Abs(G)),d=0,b)p=this.m_invMassA,y=this.m_invMassB,u=this.m_invIA,x=this.m_invIB,this.m_K.col1.x=p+y+u*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+y+u*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_K.Solve(I,-G,-v);else{p=this.m_invMassA,y=this.m_invMassB,u=this.m_invIA,x=this.m_invIB;var L=p+y+u*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,J=0;J=0!=L?-G/L:0,I.x=J,I.y=0}var F=I.x*this.m_perp.x+I.y*this.m_axis.x,P=I.x*this.m_perp.y+I.y*this.m_axis.y,R=I.x*this.m_s1+I.y*this.m_a1,T=I.x*this.m_s2+I.y*this.m_a2;return l.x-=this.m_invMassA*F,l.y-=this.m_invMassA*P,m-=this.m_invIA*R,c.x+=this.m_invMassB*F,c.y+=this.m_invMassB*P,h+=this.m_invIB*T,r.m_sweep.a=m,a.m_sweep.a=h,r.SynchronizeTransform(),a.SynchronizeTransform(),f<=t.b2_linearSlop&&d<=t.b2_angularSlop},s.inherit(d,s.Dynamics.Joints.b2JointDef),d.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,d.b2LineJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},d.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},d.prototype.Initialize=function(t,i,o,e){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.localAxisA=this.bodyA.GetLocalVector(e)},s.inherit(b,s.Dynamics.Joints.b2Joint),b.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,b.b2MouseJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new i,this.K1=new i,this.K2=new i,this.m_localAnchor=new n,this.m_target=new n,this.m_impulse=new n,this.m_mass=new i,this.m_C=new n},b.prototype.GetAnchorA=function(){return this.m_target},b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},b.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},b.prototype.GetTarget=function(){return this.m_target},b.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},b.prototype.GetMaxForce=function(){return this.m_maxForce},b.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},b.prototype.GetFrequency=function(){return this.m_frequencyHz},b.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},b.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},b.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var i=this.m_target.x-this.m_bodyB.m_xf.position.x,o=this.m_target.y-this.m_bodyB.m_xf.position.y,e=this.m_bodyB.m_xf.R;this.m_localAnchor.x=i*e.col1.x+o*e.col1.y,this.m_localAnchor.y=i*e.col2.x+o*e.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},b.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyB,o=i.GetMass(),e=2*Math.PI*this.m_frequencyHz,n=2*o*this.m_dampingRatio*e,s=o*e*e;this.m_gamma=t.dt*(n+t.dt*s),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*s*this.m_gamma;var r;r=i.m_xf.R;var a=this.m_localAnchor.x-i.m_sweep.localCenter.x,l=this.m_localAnchor.y-i.m_sweep.localCenter.y,m=r.col1.x*a+r.col2.x*l;l=r.col1.y*a+r.col2.y*l,a=m;var c=i.m_invMass,h=i.m_invI;this.K1.col1.x=c,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=c,this.K2.col1.x=h*l*l,this.K2.col2.x=-h*a*l,this.K2.col1.y=-h*a*l,this.K2.col2.y=h*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=i.m_sweep.c.x+a-this.m_target.x,this.m_C.y=i.m_sweep.c.y+l-this.m_target.y,i.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,i.m_linearVelocity.x+=c*this.m_impulse.x,i.m_linearVelocity.y+=c*this.m_impulse.y,i.m_angularVelocity+=h*(a*this.m_impulse.y-l*this.m_impulse.x)},b.prototype.SolveVelocityConstraints=function(t){var i,o=this.m_bodyB,e=0,n=0;i=o.m_xf.R;var s=this.m_localAnchor.x-o.m_sweep.localCenter.x,r=this.m_localAnchor.y-o.m_sweep.localCenter.y;e=i.col1.x*s+i.col2.x*r,r=i.col1.y*s+i.col2.y*r,s=e;var a=o.m_linearVelocity.x+-o.m_angularVelocity*r,l=o.m_linearVelocity.y+o.m_angularVelocity*s;i=this.m_mass,e=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,n=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var m=-(i.col1.x*e+i.col2.x*n),c=-(i.col1.y*e+i.col2.y*n),h=this.m_impulse.x,_=this.m_impulse.y;this.m_impulse.x+=m,this.m_impulse.y+=c;var p=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>p*p&&this.m_impulse.Multiply(p/this.m_impulse.Length()),m=this.m_impulse.x-h,c=this.m_impulse.y-_,o.m_linearVelocity.x+=o.m_invMass*m,o.m_linearVelocity.y+=o.m_invMass*c,o.m_angularVelocity+=o.m_invI*(s*c-r*m)},b.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},s.inherit(v,s.Dynamics.Joints.b2JointDef),v.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,v.b2MouseJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new n},v.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},s.inherit(C,s.Dynamics.Joints.b2Joint),C.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,C.b2PrismaticJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new o,this.m_impulse=new r},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},C.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},C.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},C.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),e=i.GetWorldPoint(this.m_localAnchor2),n=e.x-o.x,s=e.y-o.y,r=t.GetWorldVector(this.m_localXAxis1);return r.x*n+r.y*s},C.prototype.GetJointSpeed=function(){var t,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*e+t.col2.x*n;n=t.col1.y*e+t.col2.y*n,e=s,t=o.m_xf.R;var r=this.m_localAnchor2.x-o.m_sweep.localCenter.x,a=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=i.m_sweep.c.x+e,m=i.m_sweep.c.y+n,c=o.m_sweep.c.x+r,h=o.m_sweep.c.y+a,_=c-l,p=h-m,y=i.GetWorldVector(this.m_localXAxis1),u=i.m_linearVelocity,x=o.m_linearVelocity,f=i.m_angularVelocity,d=o.m_angularVelocity;return _*(-f*y.y)+p*(f*y.x)+(y.x*(x.x+-d*a-u.x- -f*n)+y.y*(x.y+d*r-u.y-f*e))},C.prototype.IsLimitEnabled=function(){return this.m_enableLimit},C.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},C.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},C.prototype.GetUpperLimit=function(){return this.m_upperTranslation},C.prototype.SetLimits=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i},C.prototype.IsMotorEnabled=function(){return this.m_enableMotor},C.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},C.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},C.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},C.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},C.prototype.GetMotorForce=function(){return this.m_motorImpulse},C.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,
this.m_enableMotor=t.enableMotor,this.m_limitState=y.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},C.prototype.InitVelocityConstraints=function(i){var o,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform();o=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,m=this.m_localAnchor1.y-this.m_localCenterA.y;r=o.col1.x*l+o.col2.x*m,m=o.col1.y*l+o.col2.y*m,l=r,o=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;r=o.col1.x*c+o.col2.x*h,h=o.col1.y*c+o.col2.y*h,c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-l,p=s.m_sweep.c.y+h-n.m_sweep.c.y-m;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(e.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+l)*this.m_axis.y-(p+m)*this.m_axis.x,this.m_a2=c*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(e.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+l)*this.m_perp.y-(p+m)*this.m_perp.x,this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var u=this.m_invMassA,x=this.m_invMassB,f=this.m_invIA,d=this.m_invIB;if(this.m_K.col1.x=u+x+f*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+d*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+d,this.m_K.col2.z=f*this.m_a1+d*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+x+f*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2,this.m_enableLimit){var b=this.m_axis.x*_+this.m_axis.y*p;e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=y.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=y.e_atLowerLimit&&(this.m_limitState=y.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!=y.e_atUpperLimit&&(this.m_limitState=y.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=y.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),i.warmStarting){this.m_impulse.x*=i.dtRatio,this.m_impulse.y*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,C=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,A=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,S=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*C,n.m_angularVelocity-=this.m_invIA*A,s.m_linearVelocity.x+=this.m_invMassB*v,s.m_linearVelocity.y+=this.m_invMassB*C,s.m_angularVelocity+=this.m_invIB*S}else this.m_impulse.SetZero(),this.m_motorImpulse=0},C.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,s=i.m_linearVelocity,a=i.m_angularVelocity,l=o.m_linearVelocity,m=o.m_angularVelocity,c=0,h=0,_=0,p=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var u=this.m_axis.x*(l.x-s.x)+this.m_axis.y*(l.y-s.y)+this.m_a2*m-this.m_a1*a,x=this.m_motorMass*(this.m_motorSpeed-u),f=this.m_motorImpulse,d=t.dt*this.m_maxMotorForce;this.m_motorImpulse=e.Clamp(this.m_motorImpulse+x,-d,d),x=this.m_motorImpulse-f,c=x*this.m_axis.x,h=x*this.m_axis.y,_=x*this.m_a1,p=x*this.m_a2,s.x-=this.m_invMassA*c,s.y-=this.m_invMassA*h,a-=this.m_invIA*_,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*h,m+=this.m_invIB*p}var b=this.m_perp.x*(l.x-s.x)+this.m_perp.y*(l.y-s.y)+this.m_s2*m-this.m_s1*a,v=m-a;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var C=this.m_axis.x*(l.x-s.x)+this.m_axis.y*(l.y-s.y)+this.m_a2*m-this.m_a1*a,A=this.m_impulse.Copy(),S=this.m_K.Solve33(new r,-b,-v,-C);this.m_impulse.Add(S),this.m_limitState==y.e_atLowerLimit?this.m_impulse.z=e.Max(this.m_impulse.z,0):this.m_limitState==y.e_atUpperLimit&&(this.m_impulse.z=e.Min(this.m_impulse.z,0));var g=-b-(this.m_impulse.z-A.z)*this.m_K.col3.x,w=-v-(this.m_impulse.z-A.z)*this.m_K.col3.y,D=this.m_K.Solve22(new n,g,w);D.x+=A.x,D.y+=A.y,this.m_impulse.x=D.x,this.m_impulse.y=D.y,S.x=this.m_impulse.x-A.x,S.y=this.m_impulse.y-A.y,S.z=this.m_impulse.z-A.z,c=S.x*this.m_perp.x+S.z*this.m_axis.x,h=S.x*this.m_perp.y+S.z*this.m_axis.y,_=S.x*this.m_s1+S.y+S.z*this.m_a1,p=S.x*this.m_s2+S.y+S.z*this.m_a2,s.x-=this.m_invMassA*c,s.y-=this.m_invMassA*h,a-=this.m_invIA*_,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*h,m+=this.m_invIB*p}else{var B=this.m_K.Solve22(new n,-b,-v);this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,c=B.x*this.m_perp.x,h=B.x*this.m_perp.y,_=B.x*this.m_s1+B.y,p=B.x*this.m_s2+B.y,s.x-=this.m_invMassA*c,s.y-=this.m_invMassA*h,a-=this.m_invIA*_,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*h,m+=this.m_invIB*p}i.m_linearVelocity.SetV(s),i.m_angularVelocity=a,o.m_linearVelocity.SetV(l),o.m_angularVelocity=m},C.prototype.SolvePositionConstraints=function(o){void 0===o&&(o=0);var s,a=this.m_bodyA,l=this.m_bodyB,m=a.m_sweep.c,c=a.m_sweep.a,h=l.m_sweep.c,_=l.m_sweep.a,p=0,y=0,u=0,x=0,f=0,d=0,b=0,v=!1,C=0,A=i.FromAngle(c),S=i.FromAngle(_);s=A;var g=this.m_localAnchor1.x-this.m_localCenterA.x,w=this.m_localAnchor1.y-this.m_localCenterA.y;p=s.col1.x*g+s.col2.x*w,w=s.col1.y*g+s.col2.y*w,g=p,s=S;var D=this.m_localAnchor2.x-this.m_localCenterB.x,B=this.m_localAnchor2.y-this.m_localCenterB.y;p=s.col1.x*D+s.col2.x*B,B=s.col1.y*D+s.col2.y*B,D=p;var M=h.x+D-m.x-g,V=h.y+B-m.y-w;if(this.m_enableLimit){this.m_axis=e.MulMV(A,this.m_localXAxis1),this.m_a1=(M+g)*this.m_axis.y-(V+w)*this.m_axis.x,this.m_a2=D*this.m_axis.y-B*this.m_axis.x;var I=this.m_axis.x*M+this.m_axis.y*V;e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(C=e.Clamp(I,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),d=e.Abs(I),v=!0):I<=this.m_lowerTranslation?(C=e.Clamp(I-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),d=this.m_lowerTranslation-I,v=!0):I>=this.m_upperTranslation&&(C=e.Clamp(I-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),d=I-this.m_upperTranslation,v=!0)}this.m_perp=e.MulMV(A,this.m_localYAxis1),this.m_s1=(M+g)*this.m_perp.y-(V+w)*this.m_perp.x,this.m_s2=D*this.m_perp.y-B*this.m_perp.x;var G=new r,L=this.m_perp.x*M+this.m_perp.y*V,J=_-c-this.m_refAngle;if(d=e.Max(d,e.Abs(L)),b=e.Abs(J),v)y=this.m_invMassA,u=this.m_invMassB,x=this.m_invIA,f=this.m_invIB,this.m_K.col1.x=y+u+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1+f*this.m_s2,this.m_K.col1.z=x*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=x+f,this.m_K.col2.z=x*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=y+u+x*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_K.Solve33(G,-L,-J,-C);else{y=this.m_invMassA,u=this.m_invMassB,x=this.m_invIA,f=this.m_invIB;var F=y+u+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,P=x*this.m_s1+f*this.m_s2,R=x+f;this.m_K.col1.Set(F,P,0),this.m_K.col2.Set(P,R,0);var T=this.m_K.Solve22(new n,-L,-J);G.x=T.x,G.y=T.y,G.z=0}var k=G.x*this.m_perp.x+G.z*this.m_axis.x,z=G.x*this.m_perp.y+G.z*this.m_axis.y,N=G.x*this.m_s1+G.y+G.z*this.m_a1,E=G.x*this.m_s2+G.y+G.z*this.m_a2;return m.x-=this.m_invMassA*k,m.y-=this.m_invMassA*z,c-=this.m_invIA*N,h.x+=this.m_invMassB*k,h.y+=this.m_invMassB*z,_+=this.m_invIB*E,a.m_sweep.a=c,l.m_sweep.a=_,a.SynchronizeTransform(),l.SynchronizeTransform(),d<=t.b2_linearSlop&&b<=t.b2_angularSlop},s.inherit(A,s.Dynamics.Joints.b2JointDef),A.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,A.b2PrismaticJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},A.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},A.prototype.Initialize=function(t,i,o,e){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.localAxisA=this.bodyA.GetLocalVector(e),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},s.inherit(S,s.Dynamics.Joints.b2Joint),S.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,S.b2PulleyJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u1=new n,this.m_u2=new n},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},S.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},S.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},S.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},S.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},S.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),i=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,e=t.x-i,n=t.y-o;return Math.sqrt(e*e+n*n)},S.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),i=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,e=t.x-i,n=t.y-o;return Math.sqrt(e*e+n*n)},S.prototype.GetRatio=function(){return this.m_ratio},S.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=e.Min(t.maxLengthA,this.m_constant-this.m_ratio*S.b2_minPulleyLength),this.m_maxLength2=e.Min(t.maxLengthB,(this.m_constant-S.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},S.prototype.InitVelocityConstraints=function(i){var o,e=this.m_bodyA,n=this.m_bodyB;o=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,a=o.col1.x*s+o.col2.x*r;r=o.col1.y*s+o.col2.y*r,s=a,o=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,m=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=o.col1.x*l+o.col2.x*m,m=o.col1.y*l+o.col2.y*m,l=a;var c=e.m_sweep.c.x+s,h=e.m_sweep.c.y+r,_=n.m_sweep.c.x+l,p=n.m_sweep.c.y+m,u=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,x=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,d=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-u,h-x),this.m_u2.Set(_-f,p-d);var b=this.m_u1.Length(),v=this.m_u2.Length();b>t.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero(),this.m_constant-b-this.m_ratio*v>0?(this.m_state=y.e_inactiveLimit,this.m_impulse=0):this.m_state=y.e_atUpperLimit,b<this.m_maxLength1?(this.m_limitState1=y.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=y.e_atUpperLimit,v<this.m_maxLength2?(this.m_limitState2=y.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=y.e_atUpperLimit;var C=s*this.m_u1.y-r*this.m_u1.x,A=l*this.m_u2.y-m*this.m_u2.x;if(this.m_limitMass1=e.m_invMass+e.m_invI*C*C,this.m_limitMass2=n.m_invMass+n.m_invI*A*A,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,i.warmStarting){this.m_impulse*=i.dtRatio,this.m_limitImpulse1*=i.dtRatio,this.m_limitImpulse2*=i.dtRatio;var S=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,g=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,w=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,D=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*S,e.m_linearVelocity.y+=e.m_invMass*g,e.m_angularVelocity+=e.m_invI*(s*g-r*S),n.m_linearVelocity.x+=n.m_invMass*w,n.m_linearVelocity.y+=n.m_invMass*D,n.m_angularVelocity+=n.m_invI*(l*D-m*w)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},S.prototype.SolveVelocityConstraints=function(t){var i,o=this.m_bodyA,n=this.m_bodyB;i=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,r=this.m_localAnchor1.y-o.m_sweep.localCenter.y,a=i.col1.x*s+i.col2.x*r;r=i.col1.y*s+i.col2.y*r,s=a,i=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,m=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=i.col1.x*l+i.col2.x*m,m=i.col1.y*l+i.col2.y*m,l=a;var c=0,h=0,_=0,p=0,u=0,x=0,f=0,d=0,b=0,v=0,C=0;this.m_state==y.e_atUpperLimit&&(c=o.m_linearVelocity.x+-o.m_angularVelocity*r,h=o.m_linearVelocity.y+o.m_angularVelocity*s,_=n.m_linearVelocity.x+-n.m_angularVelocity*m,p=n.m_linearVelocity.y+n.m_angularVelocity*l,b=-(this.m_u1.x*c+this.m_u1.y*h)-this.m_ratio*(this.m_u2.x*_+this.m_u2.y*p),v=this.m_pulleyMass*-b,C=this.m_impulse,this.m_impulse=e.Max(0,this.m_impulse+v),v=this.m_impulse-C,u=-v*this.m_u1.x,x=-v*this.m_u1.y,f=-this.m_ratio*v*this.m_u2.x,d=-this.m_ratio*v*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*u,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(s*x-r*u),n.m_linearVelocity.x+=n.m_invMass*f,n.m_linearVelocity.y+=n.m_invMass*d,n.m_angularVelocity+=n.m_invI*(l*d-m*f)),this.m_limitState1==y.e_atUpperLimit&&(c=o.m_linearVelocity.x+-o.m_angularVelocity*r,h=o.m_linearVelocity.y+o.m_angularVelocity*s,b=-(this.m_u1.x*c+this.m_u1.y*h),v=-this.m_limitMass1*b,C=this.m_limitImpulse1,this.m_limitImpulse1=e.Max(0,this.m_limitImpulse1+v),v=this.m_limitImpulse1-C,u=-v*this.m_u1.x,x=-v*this.m_u1.y,o.m_linearVelocity.x+=o.m_invMass*u,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(s*x-r*u)),this.m_limitState2==y.e_atUpperLimit&&(_=n.m_linearVelocity.x+-n.m_angularVelocity*m,p=n.m_linearVelocity.y+n.m_angularVelocity*l,b=-(this.m_u2.x*_+this.m_u2.y*p),v=-this.m_limitMass2*b,C=this.m_limitImpulse2,this.m_limitImpulse2=e.Max(0,this.m_limitImpulse2+v),v=this.m_limitImpulse2-C,f=-v*this.m_u2.x,d=-v*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*f,n.m_linearVelocity.y+=n.m_invMass*d,n.m_angularVelocity+=n.m_invI*(l*d-m*f))},S.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,n=this.m_bodyA,s=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,m=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,h=0,_=0,p=0,u=0,x=0,f=0,d=0,b=0,v=0,C=0,A=0,S=0,g=0;return this.m_state==y.e_atUpperLimit&&(o=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,h=this.m_localAnchor1.y-n.m_sweep.localCenter.y,S=o.col1.x*c+o.col2.x*h,h=o.col1.y*c+o.col2.y*h,c=S,o=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,p=this.m_localAnchor2.y-s.m_sweep.localCenter.y,S=o.col1.x*_+o.col2.x*p,p=o.col1.y*_+o.col2.y*p,_=S,u=n.m_sweep.c.x+c,x=n.m_sweep.c.y+h,f=s.m_sweep.c.x+_,d=s.m_sweep.c.y+p,this.m_u1.Set(u-r,x-a),this.m_u2.Set(f-l,d-m),b=this.m_u1.Length(),v=this.m_u2.Length(),b>t.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero(),C=this.m_constant-b-this.m_ratio*v,g=e.Max(g,-C),C=e.Clamp(C+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),A=-this.m_pulleyMass*C,u=-A*this.m_u1.x,x=-A*this.m_u1.y,f=-this.m_ratio*A*this.m_u2.x,d=-this.m_ratio*A*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*u,n.m_sweep.c.y+=n.m_invMass*x,n.m_sweep.a+=n.m_invI*(c*x-h*u),s.m_sweep.c.x+=s.m_invMass*f,s.m_sweep.c.y+=s.m_invMass*d,s.m_sweep.a+=s.m_invI*(_*d-p*f),n.SynchronizeTransform(),s.SynchronizeTransform()),this.m_limitState1==y.e_atUpperLimit&&(o=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,h=this.m_localAnchor1.y-n.m_sweep.localCenter.y,S=o.col1.x*c+o.col2.x*h,h=o.col1.y*c+o.col2.y*h,c=S,u=n.m_sweep.c.x+c,x=n.m_sweep.c.y+h,this.m_u1.Set(u-r,x-a),b=this.m_u1.Length(),b>t.b2_linearSlop?(this.m_u1.x*=1/b,this.m_u1.y*=1/b):this.m_u1.SetZero(),C=this.m_maxLength1-b,g=e.Max(g,-C),C=e.Clamp(C+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),A=-this.m_limitMass1*C,u=-A*this.m_u1.x,x=-A*this.m_u1.y,n.m_sweep.c.x+=n.m_invMass*u,n.m_sweep.c.y+=n.m_invMass*x,n.m_sweep.a+=n.m_invI*(c*x-h*u),n.SynchronizeTransform()),this.m_limitState2==y.e_atUpperLimit&&(o=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,p=this.m_localAnchor2.y-s.m_sweep.localCenter.y,S=o.col1.x*_+o.col2.x*p,p=o.col1.y*_+o.col2.y*p,_=S,f=s.m_sweep.c.x+_,d=s.m_sweep.c.y+p,this.m_u2.Set(f-l,d-m),v=this.m_u2.Length(),v>t.b2_linearSlop?(this.m_u2.x*=1/v,this.m_u2.y*=1/v):this.m_u2.SetZero(),C=this.m_maxLength2-v,g=e.Max(g,-C),C=e.Clamp(C+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),A=-this.m_limitMass2*C,f=-A*this.m_u2.x,d=-A*this.m_u2.y,s.m_sweep.c.x+=s.m_invMass*f,s.m_sweep.c.y+=s.m_invMass*d,s.m_sweep.a+=s.m_invI*(_*d-p*f),s.SynchronizeTransform()),g<t.b2_linearSlop},s.postDefs.push(function(){s.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),s.inherit(g,s.Dynamics.Joints.b2JointDef),g.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,g.b2PulleyJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new n,this.groundAnchorB=new n,this.localAnchorA=new n,this.localAnchorB=new n},g.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},g.prototype.Initialize=function(t,i,o,e,n,s,r){void 0===r&&(r=0),this.bodyA=t,this.bodyB=i,this.groundAnchorA.SetV(o),this.groundAnchorB.SetV(e),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s);var a=n.x-o.x,l=n.y-o.y;this.lengthA=Math.sqrt(a*a+l*l);var m=s.x-e.x,c=s.y-e.y;this.lengthB=Math.sqrt(m*m+c*c),this.ratio=r;var h=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=h-this.ratio*S.b2_minPulleyLength,this.maxLengthB=(h-S.b2_minPulleyLength)/this.ratio},s.inherit(w,s.Dynamics.Joints.b2Joint),w.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,w.b2RevoluteJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new i,this.K1=new i,this.K2=new i,this.K3=new i,this.impulse3=new r,this.impulse2=new n,this.reduced=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_impulse=new r,this.m_mass=new o},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},w.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},w.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},w.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},w.prototype.IsLimitEnabled=function(){return this.m_enableLimit};w.prototype.EnableLimit=function(t){this.m_enableLimit=t},w.prototype.GetLowerLimit=function(){return this.m_lowerAngle},w.prototype.GetUpperLimit=function(){return this.m_upperAngle},w.prototype.SetLimits=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.m_lowerAngle=t,this.m_upperAngle=i},w.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},w.prototype.EnableMotor=function(t){this.m_enableMotor=t},w.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},w.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},w.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},w.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},w.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=y.e_inactiveLimit},w.prototype.InitVelocityConstraints=function(i){var o,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_enableMotor||this.m_enableLimit,o=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,l=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=o.col1.x*a+o.col2.x*l,l=o.col1.y*a+o.col2.y*l,a=r,o=s.m_xf.R;var m=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=o.col1.x*m+o.col2.x*c,c=o.col1.y*m+o.col2.y*c,m=r;var h=n.m_invMass,_=s.m_invMass,p=n.m_invI,u=s.m_invI;if(this.m_mass.col1.x=h+_+l*l*p+c*c*u,this.m_mass.col2.x=-l*a*p-c*m*u,this.m_mass.col3.x=-l*p-c*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+_+a*a*p+m*m*u,this.m_mass.col3.y=a*p+m*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+u,this.m_motorMass=1/(p+u),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var x=s.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;e.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=y.e_equalLimits:x<=this.m_lowerAngle?(this.m_limitState!=y.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=y.e_atLowerLimit):x>=this.m_upperAngle?(this.m_limitState!=y.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=y.e_atUpperLimit):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=y.e_inactiveLimit;if(i.warmStarting){this.m_impulse.x*=i.dtRatio,this.m_impulse.y*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var f=this.m_impulse.x,d=this.m_impulse.y;n.m_linearVelocity.x-=h*f,n.m_linearVelocity.y-=h*d,n.m_angularVelocity-=p*(a*d-l*f+this.m_motorImpulse+this.m_impulse.z),s.m_linearVelocity.x+=_*f,s.m_linearVelocity.y+=_*d,s.m_angularVelocity+=u*(m*d-c*f+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},w.prototype.SolveVelocityConstraints=function(t){var i,o=this.m_bodyA,n=this.m_bodyB,s=0,r=0,a=0,l=0,m=0,c=o.m_linearVelocity,h=o.m_angularVelocity,_=n.m_linearVelocity,p=n.m_angularVelocity,u=o.m_invMass,x=n.m_invMass,f=o.m_invI,d=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var b=p-h-this.m_motorSpeed,v=this.m_motorMass*-b,C=this.m_motorImpulse,A=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=e.Clamp(this.m_motorImpulse+v,-A,A),v=this.m_motorImpulse-C,h-=f*v,p+=d*v}if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){i=o.m_xf.R,r=this.m_localAnchor1.x-o.m_sweep.localCenter.x,a=this.m_localAnchor1.y-o.m_sweep.localCenter.y,s=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=s,i=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,m=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=i.col1.x*l+i.col2.x*m,m=i.col1.y*l+i.col2.y*m,l=s;var S=_.x+-p*m-c.x- -h*a,g=_.y+p*l-c.y-h*r,w=p-h;this.m_mass.Solve33(this.impulse3,-S,-g,-w),this.m_limitState==y.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==y.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-S,-g),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==y.e_atUpperLimit&&this.m_impulse.z+this.impulse3.z>0&&(this.m_mass.Solve22(this.reduced,-S,-g),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),c.x-=u*this.impulse3.x,c.y-=u*this.impulse3.y,h-=f*(r*this.impulse3.y-a*this.impulse3.x+this.impulse3.z),_.x+=x*this.impulse3.x,_.y+=x*this.impulse3.y,p+=d*(l*this.impulse3.y-m*this.impulse3.x+this.impulse3.z)}else{i=o.m_xf.R,r=this.m_localAnchor1.x-o.m_sweep.localCenter.x,a=this.m_localAnchor1.y-o.m_sweep.localCenter.y,s=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=s,i=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,m=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=i.col1.x*l+i.col2.x*m,m=i.col1.y*l+i.col2.y*m,l=s;var D=_.x+-p*m-c.x- -h*a,B=_.y+p*l-c.y-h*r;this.m_mass.Solve22(this.impulse2,-D,-B),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=u*this.impulse2.x,c.y-=u*this.impulse2.y,h-=f*(r*this.impulse2.y-a*this.impulse2.x),_.x+=x*this.impulse2.x,_.y+=x*this.impulse2.y,p+=d*(l*this.impulse2.y-m*this.impulse2.x)}o.m_linearVelocity.SetV(c),o.m_angularVelocity=h,n.m_linearVelocity.SetV(_),n.m_angularVelocity=p},w.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,n=0,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,m=0,c=0,h=0;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var _=r.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,p=0;this.m_limitState==y.e_equalLimits?(n=e.Clamp(_-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),p=-this.m_motorMass*n,a=e.Abs(n)):this.m_limitState==y.e_atLowerLimit?(n=_-this.m_lowerAngle,a=-n,n=e.Clamp(n+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),p=-this.m_motorMass*n):this.m_limitState==y.e_atUpperLimit&&(n=_-this.m_upperAngle,a=n,n=e.Clamp(n-t.b2_angularSlop,0,t.b2_maxAngularCorrection),p=-this.m_motorMass*n),s.m_sweep.a-=s.m_invI*p,r.m_sweep.a+=r.m_invI*p,s.SynchronizeTransform(),r.SynchronizeTransform()}o=s.m_xf.R;var u=this.m_localAnchor1.x-s.m_sweep.localCenter.x,x=this.m_localAnchor1.y-s.m_sweep.localCenter.y;m=o.col1.x*u+o.col2.x*x,x=o.col1.y*u+o.col2.y*x,u=m,o=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,d=this.m_localAnchor2.y-r.m_sweep.localCenter.y;m=o.col1.x*f+o.col2.x*d,d=o.col1.y*f+o.col2.y*d,f=m;var b=r.m_sweep.c.x+f-s.m_sweep.c.x-u,v=r.m_sweep.c.y+d-s.m_sweep.c.y-x,C=b*b+v*v,A=Math.sqrt(C);l=A;var S=s.m_invMass,g=r.m_invMass,D=s.m_invI,B=r.m_invI,M=10*t.b2_linearSlop;if(C>M*M){var V=S+g,I=1/V;c=I*-b,h=I*-v;s.m_sweep.c.x-=.5*S*c,s.m_sweep.c.y-=.5*S*h,r.m_sweep.c.x+=.5*g*c,r.m_sweep.c.y+=.5*g*h,b=r.m_sweep.c.x+f-s.m_sweep.c.x-u,v=r.m_sweep.c.y+d-s.m_sweep.c.y-x}return this.K1.col1.x=S+g,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=S+g,this.K2.col1.x=D*x*x,this.K2.col2.x=-D*u*x,this.K2.col1.y=-D*u*x,this.K2.col2.y=D*u*u,this.K3.col1.x=B*d*d,this.K3.col2.x=-B*f*d,this.K3.col1.y=-B*f*d,this.K3.col2.y=B*f*f,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(w.tImpulse,-b,-v),c=w.tImpulse.x,h=w.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*c,s.m_sweep.c.y-=s.m_invMass*h,s.m_sweep.a-=s.m_invI*(u*h-x*c),r.m_sweep.c.x+=r.m_invMass*c,r.m_sweep.c.y+=r.m_invMass*h,r.m_sweep.a+=r.m_invI*(f*h-d*c),s.SynchronizeTransform(),r.SynchronizeTransform(),l<=t.b2_linearSlop&&a<=t.b2_angularSlop},s.postDefs.push(function(){s.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n}),s.inherit(D,s.Dynamics.Joints.b2JointDef),D.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,D.b2RevoluteJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},D.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},D.prototype.Initialize=function(t,i,o){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},s.inherit(B,s.Dynamics.Joints.b2Joint),B.prototype.__super=s.Dynamics.Joints.b2Joint.prototype,B.b2WeldJoint=function(){s.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_impulse=new r,this.m_mass=new o},B.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},B.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},B.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},B.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new o},B.prototype.InitVelocityConstraints=function(t){var i,o=0,e=this.m_bodyA,n=this.m_bodyB;i=e.m_xf.R;var s=this.m_localAnchorA.x-e.m_sweep.localCenter.x,r=this.m_localAnchorA.y-e.m_sweep.localCenter.y;o=i.col1.x*s+i.col2.x*r,r=i.col1.y*s+i.col2.y*r,s=o,i=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,l=this.m_localAnchorB.y-n.m_sweep.localCenter.y;o=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=o;var m=e.m_invMass,c=n.m_invMass,h=e.m_invI,_=n.m_invI;this.m_mass.col1.x=m+c+r*r*h+l*l*_,this.m_mass.col2.x=-r*s*h-l*a*_,this.m_mass.col3.x=-r*h-l*_,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+c+s*s*h+a*a*_,this.m_mass.col3.y=s*h+a*_,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=h+_,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,e.m_linearVelocity.x-=m*this.m_impulse.x,e.m_linearVelocity.y-=m*this.m_impulse.y,e.m_angularVelocity-=h*(s*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=c*this.m_impulse.x,n.m_linearVelocity.y+=c*this.m_impulse.y,n.m_angularVelocity+=_*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},B.prototype.SolveVelocityConstraints=function(t){var i,o=0,e=this.m_bodyA,n=this.m_bodyB,s=e.m_linearVelocity,a=e.m_angularVelocity,l=n.m_linearVelocity,m=n.m_angularVelocity,c=e.m_invMass,h=n.m_invMass,_=e.m_invI,p=n.m_invI;i=e.m_xf.R;var y=this.m_localAnchorA.x-e.m_sweep.localCenter.x,u=this.m_localAnchorA.y-e.m_sweep.localCenter.y;o=i.col1.x*y+i.col2.x*u,u=i.col1.y*y+i.col2.y*u,y=o,i=n.m_xf.R;var x=this.m_localAnchorB.x-n.m_sweep.localCenter.x,f=this.m_localAnchorB.y-n.m_sweep.localCenter.y;o=i.col1.x*x+i.col2.x*f,f=i.col1.y*x+i.col2.y*f,x=o;var d=l.x-m*f-s.x+a*u,b=l.y+m*x-s.y-a*y,v=m-a,C=new r;this.m_mass.Solve33(C,-d,-b,-v),this.m_impulse.Add(C),s.x-=c*C.x,s.y-=c*C.y,a-=_*(y*C.y-u*C.x+C.z),l.x+=h*C.x,l.y+=h*C.y,m+=p*(x*C.y-f*C.x+C.z),e.m_angularVelocity=a,n.m_angularVelocity=m},B.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,n=0,s=this.m_bodyA,a=this.m_bodyB;o=s.m_xf.R;var l=this.m_localAnchorA.x-s.m_sweep.localCenter.x,m=this.m_localAnchorA.y-s.m_sweep.localCenter.y;n=o.col1.x*l+o.col2.x*m,m=o.col1.y*l+o.col2.y*m,l=n,o=a.m_xf.R
;var c=this.m_localAnchorB.x-a.m_sweep.localCenter.x,h=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=o.col1.x*c+o.col2.x*h,h=o.col1.y*c+o.col2.y*h,c=n;var _=s.m_invMass,p=a.m_invMass,y=s.m_invI,u=a.m_invI,x=a.m_sweep.c.x+c-s.m_sweep.c.x-l,f=a.m_sweep.c.y+h-s.m_sweep.c.y-m,d=a.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,b=10*t.b2_linearSlop,v=Math.sqrt(x*x+f*f),C=e.Abs(d);v>b&&(y*=1,u*=1),this.m_mass.col1.x=_+p+m*m*y+h*h*u,this.m_mass.col2.x=-m*l*y-h*c*u,this.m_mass.col3.x=-m*y-h*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=_+p+l*l*y+c*c*u,this.m_mass.col3.y=l*y+c*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=y+u;var A=new r;return this.m_mass.Solve33(A,-x,-f,-d),s.m_sweep.c.x-=_*A.x,s.m_sweep.c.y-=_*A.y,s.m_sweep.a-=y*(l*A.y-m*A.x+A.z),a.m_sweep.c.x+=p*A.x,a.m_sweep.c.y+=p*A.y,a.m_sweep.a+=u*(c*A.y-h*A.x+A.z),s.SynchronizeTransform(),a.SynchronizeTransform(),v<=t.b2_linearSlop&&C<=t.b2_angularSlop},s.inherit(M,s.Dynamics.Joints.b2JointDef),M.prototype.__super=s.Dynamics.Joints.b2JointDef.prototype,M.b2WeldJointDef=function(){s.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_weldJoint,this.referenceAngle=0},M.prototype.Initialize=function(t,i,o){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=s.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},t.prototype._color=function(t,i){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+i+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){void 0===t&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){void 0===t&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){void 0===t&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){void 0===t&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){void 0===t&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){void 0===t&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){void 0===t&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){void 0===t&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(o.color,this.m_alpha),e.moveTo(t[0].x*n,t[0].y*n);for(var s=1;s<i;s++)e.lineTo(t[s].x*n,t[s].y*n);e.lineTo(t[0].x*n,t[0].y*n),e.closePath(),e.stroke()}},t.prototype.DrawSolidPolygon=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(o.color,this.m_alpha),e.fillStyle=this._color(o.color,this.m_fillAlpha),e.moveTo(t[0].x*n,t[0].y*n);for(var s=1;s<i;s++)e.lineTo(t[s].x*n,t[s].y*n);e.lineTo(t[0].x*n,t[0].y*n),e.closePath(),e.fill(),e.stroke()}},t.prototype.DrawCircle=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(o.color,this.m_alpha),e.arc(t.x*n,t.y*n,i*n,0,2*Math.PI,!0),e.closePath(),e.stroke()}},t.prototype.DrawSolidCircle=function(t,i,o,e){if(i){var n=this.m_ctx,s=this.m_drawScale,r=t.x*s,a=t.y*s;n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(e.color,this.m_alpha),n.fillStyle=this._color(e.color,this.m_fillAlpha),n.arc(r,a,i*s,0,2*Math.PI,!0),n.moveTo(r,a),n.lineTo((t.x+o.x*i)*s,(t.y+o.y*i)*s),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawSegment=function(t,i,o){var e=this.m_ctx,n=this.m_drawScale;e.strokeStyle=this._color(o.color,this.m_alpha),e.beginPath(),e.moveTo(t.x*n,t.y*n),e.lineTo(i.x*n,i.y*n),e.closePath(),e.stroke()},t.prototype.DrawTransform=function(t){var i=this.m_ctx,o=this.m_drawScale;i.beginPath(),i.strokeStyle=this._color(16711680,this.m_alpha),i.moveTo(t.position.x*o,t.position.y*o),i.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*o,(t.position.y+this.m_xformScale*t.R.col1.y)*o),i.strokeStyle=this._color(65280,this.m_alpha),i.moveTo(t.position.x*o,t.position.y*o),i.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*o,(t.position.y+this.m_xformScale*t.R.col2.y)*o),i.closePath(),i.stroke()}}();var l;for(l=0;l<s.postDefs.length;++l)s.postDefs[l]();o.exports=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);
		};
	



</script>

<script>

	var __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalScriptAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.func=window.gLocalAssetContainer[o],e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load script asset"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);

	!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";var n=e("@akashic/akashic-engine"),o=e("./validator"),i=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error("Slots is not supported.");default:throw new Error("Unknown region.")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf("akst:")){var n=e.slice("akst:".length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf("*")||"*"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf("akst:")&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error("Invalid condition.");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error("Unknown StorageCountsOperation");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem("akst:"+e,JSON.stringify(t))},e.prototype.getValue=function(e){return JSON.parse(this._localStorage.getItem("akst:"+e))},e.prototype.storageKeyToStringKey=function(e){return(e.region||"")+"/"+(null!=e.gameId?String(e.gameId):"")+"/"+(null!=e.userId?String(e.userId):"")+"/"+(e.regionKey||"")},e.prototype.stringKeyToStorageKey=function(e){var t=e.split("/"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||"",r=null!=e.gameId?String(e.gameId):"",n=null!=e.userId?String(e.userId):"",o="";if("*"===n&&(n="[0-9]+"),-1!==e.regionKey.indexOf("*")){var i=e.regionKey.split(".");i.forEach(function(e,t){"*"===e?o+="[.a-z0-9]*":-1!==e.indexOf("*")?o+=e.replace("*","[a-z0-9]*"):o+=e,t!==i.length-1&&(o+=".")})}else o=e.regionKey.replace(".",".");return new RegExp("^"+t+"/"+r+"/"+n+"/"+o+"$")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf("$gameId")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=i},{"./validator":3,"@akashic/akashic-engine":"@akashic/akashic-engine"}],2:[function(e,t,r){"use strict";var n=e("./GameStorage");r.GameStorage=n.GameStorage},{"./GameStorage":1}],3:[function(e,t,r){"use strict";function n(e,t){u(e.length>0,"regionKey is empty.");var r=e.split(".");u(r.length<=c,"The maximum number of layers in the region key is "+c+".");for(var n=!1,o=0;o<r.length;++o)t?"*"===r[o]?(u(!n,"The only one layer of the region key for reading consists of a wildcard character."),n=!0):u(/^(\*|[a-z])[a-z0-9]{0,31}\*?$/.test(r[o]),"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'."):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,"Invalid region."),u(e.regionKey,"regionKey must be set."),n(e.regionKey,t),u(e.gameId||e.userId,"StorageKey must have any one at least from gameId and userId."),null!=e.gameId&&(u.equal(typeof e.gameId,"string","gameId must be a string type."),u(e.gameId.length>0,"gameId is empty.")),null!=e.userId&&(u.equal(typeof e.userId,"string","userId must be a string type."),u(e.userId.length>0,"userId is empty."),t?"*"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is "*".'),u(-1===e.regionKey.indexOf("*"),'regionKey for reading must not include "*" when userId is "*".')):u("*"!==e.userId,'userId for writing must not include "*".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,"Invalid keyOrder."),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,"Invalid valueOrder.")}}function a(e){}var u=e("assert"),s=e("@akashic/akashic-engine"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{"@akashic/akashic-engine":"@akashic/akashic-engine",assert:4}],4:[function(e,t,r){(function(r){"use strict";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function o(e){return r.Buffer&&"function"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return!o(e)&&"function"==typeof r.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e);return"[Function"+(t?": "+t:"")+"]"}function l(e){return s(c(e.actual),128)+" "+e.operator+" "+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,"==",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)||(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,"notDeepStrictEqual",h)}function m(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function v(e){var t;try{e()}catch(e){t=e}return t}function S(e,t,r,n){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!o&&f(o,r,"Missing expected exception"+n);var i="string"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,"Got unwanted exception"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e("util/"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return"foo"===function(){}.name}(),x=t.exports=g,I=/\s*function\s+([^\(\s]*)\s*/;x.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf("\n"+o);if(i>=0){var a=n.indexOf("\n",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,"==",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,"!=",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,"deepEqual",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,"deepStrictEqual",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,"notDeepEqual",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,"===",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,"!==",x.notStrictEqual)},x.throws=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":8}],5:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g="function"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?": "+t.name:"";return e.stylize("[Function"+h+"]","special")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(I(t))return l(t)}var m="",v=!1,b=["{","}"];if(d(t)&&(v=!0,b=["[","]"]),k(t)&&(m=" [Function"+(t.name?": "+t.name:"")+"]"),O(t)&&(m=" "+RegExp.prototype.toString.call(t)),x(t)&&(m=" "+Date.prototype.toUTCString.call(t)),I(t)&&(m=" "+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(n<0)return O(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w;return w=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(w,m,b)}function c(e,t){if(w(t))return e.stylize("undefined","undefined");if(S(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return v(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;a<u;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),D(n,o)||(a="["+o+"]"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf("\n")>-1&&(u=i?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),w(a)){if(i&&o.match(/^\d+$/))return u;a=JSON.stringify(""+o),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+u}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return"number"==typeof e}function S(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&"[object RegExp]"===K(e)}function E(e){return"object"==typeof e&&null!==e}function x(e){return E(e)&&"[object Date]"===K(e)}function I(e){return E(e)&&("[object Error]"===K(e)||e instanceof Error)}function k(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function K(e){return Object.prototype.toString.call(e)}function j(e){return e<10?"0"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":");return[e.getDate(),C[e.getMonth()],t].join(" ")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),u=n[r];r<i;u=n[++r])h(u)||!E(u)?a+=" "+u:a+=" "+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!q[e])if(new RegExp("\\b"+e+"\\b","i").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",V(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}]},{},[2])(2)});

	window.addEventListener("load",function(){!function(e){function n(e){if(s.containerController){var n={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},t=Math.min(n.width/e.width,n.height/e.height),o={width:Math.floor(e.width*t),height:Math.floor(e.height*t)};s.containerController.changeScale(t,t);var i={x:Math.floor((n.width-o.width)/2),y:Math.floor((n.height-o.height)/2)};s.containerController.inputHandlerLayer.setOffset(i)}}var t=e,o={id:"9999",name:"sandbox-player"},i=new gameStorage.GameStorage(window.localStorage,{gameId:t}),a=engineFiles.pdiBrowser,r=engineFiles.gameDriver,d=new r.MemoryAmflowClient({playId:"sandboxDummyPlayId",putStorageDataSyncFunc:i.set.bind(i),getStorageDataSyncFunc:function(e){var n=i.load(e);return e.map(function(e,t){return{readKey:e,values:n[t]}})}});if(!0===window.__akashic__.autoSendEvents||"string"==typeof window.__akashic__.autoSendEvents){var c=window.__akashic__.sandboxConfigFunc(),l=!0===window.__akashic__.autoSendEvents?c.autoSendEvents:window.__akashic__.autoSendEvents;c&&l&&c.events&&c.events[l]&&c.events[l].forEach(function(e){d.sendEvent(e)})}var u;u="file:"!==location.protocol?[a.WebAudioPlugin,a.HTMLAudioPlugin]:[a.HTMLAudioPlugin];var s=new a.Platform({amflow:d,containerView:document.getElementById("container"),audioPlugins:u});s.loadGameConfiguration=function(e,n){try{var t=window.gLocalAssetContainer["game.json"];t=decodeURIComponent(t),n(null,JSON.parse(t))}catch(e){n(e,null)}},s._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};var w=function(e,n){return new LocalTextAsset(e,n)};"undefined"!=typeof LocalTextAsset&&(s._resourceFactory.createTextAsset=w),driver=new r.GameDriver({platform:s,player:o,errorHandler:function(e){console.log("ERRORHANDLER:",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(n(e),window.addEventListener("resize",function(){n(e)}))}),driver.initialize({configurationUrl:"game.json",assetBase:"./",driverConfiguration:{playId:"sandboxDummyPlayId",playToken:"dummyToken",executionMode:r.ExecutionMode.Active},loopConfiguration:{loopMode:r.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}("exportHTML")});

	window.g=require("@akashic/akashic-engine"),"gLocalAssetContainer"in window||(window.gLocalAssetContainer={}),"__akashic__"in window||(window.__akashic__={});

	var __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalTextAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.data=decodeURIComponent(window.gLocalAssetContainer[o]),e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load text asset"))},0)},o}(g.TextAsset);

</script>

<style type="text/css">
* {
	margin: 0;
	border: 0;
	padding: 0;
}

html {
	width: 100%;
	height: 100%;
}

body {
	overflow: hidden;
	width: 100%;
	height: 100%;
}

#container {
	margin: 0px;
	padding: 0px;
	overflow: hidden;
	touch-action: none;
	width: 100%;
	height: 100%;

	/* iOS: body */
	position: absolute;
}

#container canvas {
	background-size: contain;
}

</style>



</head>
<body>
<div id="container">
</div>
</body>
</html>
